[{"created_at":"2019-01-26T22:35:12.040Z","crossposted_at":null,"edited_at":"2020-10-27T11:44:10.690Z","last_comment_at":"2020-11-29T15:35:55.818Z","published_at":"2019-01-27T01:00:16.393Z","canonical_url":null,"feed_source_url":null,"video_closed_caption_track_url":null,"video_source_url":null,"video_thumbnail_url":null,"body_markdown":"---\ntitle: How Promises May Be Slowing Your App\npublished: true\ncover_image: https://images.unsplash.com/photo-1530685932526-48ec92998eaa?ixlib=rb-1.2.1\u0026ixid=eyJhcHBfaWQiOjEyMDd9\u0026auto=format\u0026fit=crop\u0026w=700\u0026q=60\ndescription: \ntags: \n---\n\nHello Dev.to community, this is my first post! (Edit: And here's [the second](https://dev.to/deanius/observably-better-than-promises-4pmf), which elaborates on this one)\n\n```js\nusedToLovePromises.then(() =\u003e console.log( 😡😤 ))\n```\n\nAs a solution to Callback Hell, Promises were my new hotness for a while. I gave talks on them - while juggling, even, because— concurrency 🤣 [Youtube](https://www.youtube.com/watch?v=dyz3tAI6GaI\u0026t=37).\n\nBut I realized that like every technology, they bring with them a few gotchas. So, before I tell you what I'm currently using (RxJS Observables with [polyrhythm](https://github.com/deanius/polyrhythm)), let's look at the top 5 ways Promises may be slowing down your application today:\n\n- Await in a Loop Destroys Parallelism.\n- Await turns rejected Promises into Exceptions.\n- Sync Values, inside of Promises are only available Later.\n- The Single-value limitation negates Streaming benefits\n- Inability to be canceled means resources can be consumed longer than their consumers need them for\n\nThe first two you can work around, the rest require bigger changes, but are still doable.... let's dive in!\n\n### Await in a Loop Destroys Parallelism\n\n```js\nasync function(usernames) {\n  let users = []\n\n  for(let name of usernames) {\n     users.push(await fetch(`http://server/users/${user}`))\n  }\n\n  return users;\n  \n}(['bob', 'angie'])\n```\n\nWhat's wrong with this code? It aims to transform an array of usernames into the full objects returned by some remote service. And it's using the common practice of `await`ing a Promise. But what happens when you await one user at a time? That's right— you are no longer able to retrieve users in parallel. Let's say your responses took 1 and 1.5 seconds - instead of having all your users back in 1.5 seconds, you'll have them back in 2.5 seconds. Instead of the overall duration being `max(times)`, it will take `sum(times)`.\n\nWorkaround: Use [Promise.all](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/all)\n\n### Using Await turns rejected Promises into Program-Crashing Exceptions\n\nWhile `await` is nice on the happy path, it's unhappy path can be downright ugly.\n\nDepending on your Promise-returning AJAX library, sometimes a 500 error code received from a server causes the returned Promise to be rejected. If you use `await` on a rejected Promise you get a synchronous exception!\n\nSynchronous exceptions 'rip the call stack' which is a fancy way of saying 'take a long time do what they do'. And more alarmingly, they threaten to bring down your entire application! We don't want our applications to be brittle. Sometimes stateless services can be restarted, but that takes time too. \n\nWhen an HTTP 200 and an HTTP 500 response may have only one byte different between them, and when they both represent a successful transfer of content from a server to your application, and when it's entirely anticipatable that servers will sometimes be slow, or unavailable, `await` starts to look like a real foot-gun.\n\nWorkaround: Use `await` in your app only when you have top-level exception handling. Don't use `await` at all for operations which have a reasonable chance of failing, and for which terminating a running application would not be an appropriate response.\n\n\n### By Design: Sync Values, inside of Promises are only available Later\n\n```js\nlet status = 'not loaded'\nPromise.resolve('loaded').then(newStatus =\u003e {\n  status = newStatus\n})\nconsole.log(status)\n```\n\nWhat is the value of `status` above? Promise fans know that it will be `\"not loaded\"`. This makes sense right, because— async. And like [Jake Archibald mentions](https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/), the resolve happens as quickly after the present moment as possible. But why delay at all?\n\nThe answer to this is that by design, even if a promise is resolved *now*, its callbacks get called _later_, to resolve ambiguity. Which is a bit like dentists preemptively removing all your teeth, but hey, at least it doesn't unleash Zalgo!\n\nChallenge: Integrating the usage of Promises for async values, and different techniques entirely for synchronously available values. \n\n### By Design: Single-value limitation negates Streaming benefits\n\nIf your server streams a large JSON document in response to `/users`, flushing its response stream after every user, and your client application gets the first 50 users, but uses a Promise for the resulting Array of users, your user is prevented from seeing those first 50 users until all users have been returned! And if the server fails to return the final `]` in JSON, the user's browser (or your Node process) will have all the data in memory, but it will be unusable! (Ask me how I know!) \n\nThis might seem a little pedantic, but like [Juan Caicedo](https://vimeo.com/169948440) mentions, all users are not always on fast or reliable connections.\n\nWhy are Promises to blame here? Because until the browser has an entire Array of users, it can't fulfill the Promise.\n\nI have [a little demo]() of how to query the same endpoint with an Observable vs a Promise, and it's no contest - the Observable, since it represents a stream of users, is able to deliver users one at a time while the Promise variant delivers nothing to the UI until it's all done. Performance is only one reason to favor many-valued Observables over single-valued Promises, but it's a valid one.\n\nChallenge: Juggling multiple promises and relating them to each other is hard.\n\n### Inability to be canceled means resources are tied up for longer\n\nThis, for anyone working on memory/network constrained devices is perhaps the biggest deal-breaker. It's why Brian Holt gave a talk [Promise Not To Use Promises](https://www.youtube.com/watch?v=DaCc8lckuw8) that, although old, was way ahead of its time. If you start an AJAX request on a route that represents a chat room, and the user navigates to another room, Promises do not let you cancel that first request! So in the best case, the bandwidth available for the new room messages is cut in half, and in the worst case, the browser has used up its [last available connection](http://sgdev-blog.blogspot.com/2014/01/maximum-concurrent-connection-to-same.html), and the new room's messages are blocked!\n\nThis is not a happy place. The moment an app knows it doesn't need the result of some process, it needs to be able to shut down that process and free its resources immediately. As a friend of mine said \"Don't start something you don't know how to end\". True for computing as well as children's games. :)\n\nChallenge: Not canceling is wasteful, yet using cancelation tokens manually is tricky. _(That's why [the TC-39 proposal to add cancelability to Promises](https://github.com/tc39/proposal-cancelable-promises) fizzled!)_\n\n\n## Conclusion\n\nI'll write up soon how I think the Observable data type solves the above issues, (and the new challenges it brings), but that's for another time. For now, just know that these are possible Promise gotchas to be mindful of. They are still a huge improvement over callbacks, and a goto tool, until you realize [Observables are a Superset of Promises](https://dev.to/deanius/observably-better-than-promises-4pmf)\n\n![Observe](https://thepracticaldev.s3.amazonaws.com/i/9b5wrh6hftwextbtlk4u.JPG)\n","cached_tag_list":"","cached_user_name":"Dean Radcliffe","cached_user_username":"deanius","comments_count":1,"description":"Hello Dev.to community, this is my first post! (Edit: And here's the second, which elaborates on this...","main_image":"https://images.unsplash.com/photo-1530685932526-48ec92998eaa?ixlib=rb-1.2.1\u0026ixid=eyJhcHBfaWQiOjEyMDd9\u0026auto=format\u0026fit=crop\u0026w=700\u0026q=60","main_image_background_hex_color":"#dddddd","path":"/deanius/5-ways-promises-may-be-slowing-your-app-hgm","public_reactions_count":6,"processed_html":"\u003cp\u003eHello Dev.to community, this is my first post! (Edit: And here's \u003ca href=\"https://dev.to/deanius/observably-better-than-promises-4pmf\"\u003ethe second\u003c/a\u003e, which elaborates on this one)\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003eusedToLovePromises\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ethen\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"err\"\u003e😡😤\u003c/span\u003e \u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eAs a solution to Callback Hell, Promises were my new hotness for a while. I gave talks on them - while juggling, even, because— concurrency 🤣 \u003ca href=\"https://www.youtube.com/watch?v=dyz3tAI6GaI\u0026amp;t=37\" target=\"_blank\" rel=\"noopener noreferrer\"\u003eYoutube\u003c/a\u003e.\u003c/p\u003e\n\n\u003cp\u003eBut I realized that like every technology, they bring with them a few gotchas. So, before I tell you what I'm currently using (RxJS Observables with \u003ca href=\"https://github.com/deanius/polyrhythm\" target=\"_blank\" rel=\"noopener noreferrer\"\u003epolyrhythm\u003c/a\u003e), let's look at the top 5 ways Promises may be slowing down your application today:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eAwait in a Loop Destroys Parallelism.\u003c/li\u003e\n\u003cli\u003eAwait turns rejected Promises into Exceptions.\u003c/li\u003e\n\u003cli\u003eSync Values, inside of Promises are only available Later.\u003c/li\u003e\n\u003cli\u003eThe Single-value limitation negates Streaming benefits\u003c/li\u003e\n\u003cli\u003eInability to be canceled means resources can be consumed longer than their consumers need them for\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eThe first two you can work around, the rest require bigger changes, but are still doable.... let's dive in!\u003c/p\u003e\n\n\u003ch3\u003e\n  \u003ca name=\"await-in-a-loop-destroys-parallelism\" href=\"#await-in-a-loop-destroys-parallelism\"\u003e\n  \u003c/a\u003e\n  Await in a Loop Destroys Parallelism\n\u003c/h3\u003e\n\n\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eusernames\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003eusers\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003ename\u003c/span\u003e \u003cspan class=\"k\"\u003eof\u003c/span\u003e \u003cspan class=\"nx\"\u003eusernames\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n     \u003cspan class=\"nx\"\u003eusers\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003epush\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"nf\"\u003efetch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`http://server/users/\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003euser\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003eusers\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"p\"\u003e}([\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ebob\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eangie\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eWhat's wrong with this code? It aims to transform an array of usernames into the full objects returned by some remote service. And it's using the common practice of \u003ccode\u003eawait\u003c/code\u003eing a Promise. But what happens when you await one user at a time? That's right— you are no longer able to retrieve users in parallel. Let's say your responses took 1 and 1.5 seconds - instead of having all your users back in 1.5 seconds, you'll have them back in 2.5 seconds. Instead of the overall duration being \u003ccode\u003emax(times)\u003c/code\u003e, it will take \u003ccode\u003esum(times)\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eWorkaround: Use \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/all\" target=\"_blank\" rel=\"noopener noreferrer\"\u003ePromise.all\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n  \u003ca name=\"using-await-turns-rejected-promises-into-programcrashing-exceptions\" href=\"#using-await-turns-rejected-promises-into-programcrashing-exceptions\"\u003e\n  \u003c/a\u003e\n  Using Await turns rejected Promises into Program-Crashing Exceptions\n\u003c/h3\u003e\n\n\u003cp\u003eWhile \u003ccode\u003eawait\u003c/code\u003e is nice on the happy path, it's unhappy path can be downright ugly.\u003c/p\u003e\n\n\u003cp\u003eDepending on your Promise-returning AJAX library, sometimes a 500 error code received from a server causes the returned Promise to be rejected. If you use \u003ccode\u003eawait\u003c/code\u003e on a rejected Promise you get a synchronous exception!\u003c/p\u003e\n\n\u003cp\u003eSynchronous exceptions 'rip the call stack' which is a fancy way of saying 'take a long time do what they do'. And more alarmingly, they threaten to bring down your entire application! We don't want our applications to be brittle. Sometimes stateless services can be restarted, but that takes time too. \u003c/p\u003e\n\n\u003cp\u003eWhen an HTTP 200 and an HTTP 500 response may have only one byte different between them, and when they both represent a successful transfer of content from a server to your application, and when it's entirely anticipatable that servers will sometimes be slow, or unavailable, \u003ccode\u003eawait\u003c/code\u003e starts to look like a real foot-gun.\u003c/p\u003e\n\n\u003cp\u003eWorkaround: Use \u003ccode\u003eawait\u003c/code\u003e in your app only when you have top-level exception handling. Don't use \u003ccode\u003eawait\u003c/code\u003e at all for operations which have a reasonable chance of failing, and for which terminating a running application would not be an appropriate response.\u003c/p\u003e\n\n\u003ch3\u003e\n  \u003ca name=\"by-design-sync-values-inside-of-promises-are-only-available-later\" href=\"#by-design-sync-values-inside-of-promises-are-only-available-later\"\u003e\n  \u003c/a\u003e\n  By Design: Sync Values, inside of Promises are only available Later\n\u003c/h3\u003e\n\n\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003estatus\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003enot loaded\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\n\u003cspan class=\"nb\"\u003ePromise\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eresolve\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eloaded\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003ethen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003enewStatus\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003estatus\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003enewStatus\u003c/span\u003e\n\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003estatus\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eWhat is the value of \u003ccode\u003estatus\u003c/code\u003e above? Promise fans know that it will be \u003ccode\u003e\"not loaded\"\u003c/code\u003e. This makes sense right, because— async. And like \u003ca href=\"https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/\" target=\"_blank\" rel=\"noopener noreferrer\"\u003eJake Archibald mentions\u003c/a\u003e, the resolve happens as quickly after the present moment as possible. But why delay at all?\u003c/p\u003e\n\n\u003cp\u003eThe answer to this is that by design, even if a promise is resolved \u003cem\u003enow\u003c/em\u003e, its callbacks get called \u003cem\u003elater\u003c/em\u003e, to resolve ambiguity. Which is a bit like dentists preemptively removing all your teeth, but hey, at least it doesn't unleash Zalgo!\u003c/p\u003e\n\n\u003cp\u003eChallenge: Integrating the usage of Promises for async values, and different techniques entirely for synchronously available values. \u003c/p\u003e\n\n\u003ch3\u003e\n  \u003ca name=\"by-design-singlevalue-limitation-negates-streaming-benefits\" href=\"#by-design-singlevalue-limitation-negates-streaming-benefits\"\u003e\n  \u003c/a\u003e\n  By Design: Single-value limitation negates Streaming benefits\n\u003c/h3\u003e\n\n\u003cp\u003eIf your server streams a large JSON document in response to \u003ccode\u003e/users\u003c/code\u003e, flushing its response stream after every user, and your client application gets the first 50 users, but uses a Promise for the resulting Array of users, your user is prevented from seeing those first 50 users until all users have been returned! And if the server fails to return the final \u003ccode\u003e]\u003c/code\u003e in JSON, the user's browser (or your Node process) will have all the data in memory, but it will be unusable! (Ask me how I know!) \u003c/p\u003e\n\n\u003cp\u003eThis might seem a little pedantic, but like \u003ca href=\"https://vimeo.com/169948440\" target=\"_blank\" rel=\"noopener noreferrer\"\u003eJuan Caicedo\u003c/a\u003e mentions, all users are not always on fast or reliable connections.\u003c/p\u003e\n\n\u003cp\u003eWhy are Promises to blame here? Because until the browser has an entire Array of users, it can't fulfill the Promise.\u003c/p\u003e\n\n\u003cp\u003eI have \u003ca href=\"\"\u003ea little demo\u003c/a\u003e of how to query the same endpoint with an Observable vs a Promise, and it's no contest - the Observable, since it represents a stream of users, is able to deliver users one at a time while the Promise variant delivers nothing to the UI until it's all done. Performance is only one reason to favor many-valued Observables over single-valued Promises, but it's a valid one.\u003c/p\u003e\n\n\u003cp\u003eChallenge: Juggling multiple promises and relating them to each other is hard.\u003c/p\u003e\n\n\u003ch3\u003e\n  \u003ca name=\"inability-to-be-canceled-means-resources-are-tied-up-for-longer\" href=\"#inability-to-be-canceled-means-resources-are-tied-up-for-longer\"\u003e\n  \u003c/a\u003e\n  Inability to be canceled means resources are tied up for longer\n\u003c/h3\u003e\n\n\u003cp\u003eThis, for anyone working on memory/network constrained devices is perhaps the biggest deal-breaker. It's why Brian Holt gave a talk \u003ca href=\"https://www.youtube.com/watch?v=DaCc8lckuw8\" target=\"_blank\" rel=\"noopener noreferrer\"\u003ePromise Not To Use Promises\u003c/a\u003e that, although old, was way ahead of its time. If you start an AJAX request on a route that represents a chat room, and the user navigates to another room, Promises do not let you cancel that first request! So in the best case, the bandwidth available for the new room messages is cut in half, and in the worst case, the browser has used up its \u003ca href=\"http://sgdev-blog.blogspot.com/2014/01/maximum-concurrent-connection-to-same.html\" target=\"_blank\" rel=\"noopener noreferrer\"\u003elast available connection\u003c/a\u003e, and the new room's messages are blocked!\u003c/p\u003e\n\n\u003cp\u003eThis is not a happy place. The moment an app knows it doesn't need the result of some process, it needs to be able to shut down that process and free its resources immediately. As a friend of mine said \"Don't start something you don't know how to end\". True for computing as well as children's games. :)\u003c/p\u003e\n\n\u003cp\u003eChallenge: Not canceling is wasteful, yet using cancelation tokens manually is tricky. \u003cem\u003e(That's why \u003ca href=\"https://github.com/tc39/proposal-cancelable-promises\" target=\"_blank\" rel=\"noopener noreferrer\"\u003ethe TC-39 proposal to add cancelability to Promises\u003c/a\u003e fizzled!)\u003c/em\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"conclusion\" href=\"#conclusion\"\u003e\n  \u003c/a\u003e\n  Conclusion\n\u003c/h2\u003e\n\n\u003cp\u003eI'll write up soon how I think the Observable data type solves the above issues, (and the new challenges it brings), but that's for another time. For now, just know that these are possible Promise gotchas to be mindful of. They are still a huge improvement over callbacks, and a goto tool, until you realize \u003ca href=\"https://dev.to/deanius/observably-better-than-promises-4pmf\"\u003eObservables are a Superset of Promises\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://media.dev.to/cdn-cgi/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2F631t51smnet81kmb1jxe.JPG\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://media.dev.to/cdn-cgi/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fuploads%2Farticles%2F631t51smnet81kmb1jxe.JPG\" alt=\"Observe\" loading=\"lazy\" width=\"800\" height=\"1066\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n","published":true,"published_from_feed":false,"show_comments":true,"slug":"5-ways-promises-may-be-slowing-your-app-hgm","social_image":null,"title":"How Promises May Be Slowing Your App","video":null,"video_code":null},{"created_at":"2019-01-28T16:22:49.984Z","crossposted_at":null,"edited_at":"2022-03-16T15:15:51.025Z","last_comment_at":"2019-01-28T17:19:48.816Z","published_at":"2019-01-28T17:19:48.816Z","canonical_url":null,"feed_source_url":null,"video_closed_caption_track_url":null,"video_source_url":null,"video_thumbnail_url":null,"body_markdown":"---\ntitle: Observably Faster Than Promises\npublished: true\ndescription: \ntags: RxJS, Angular, Observable, Promises\n---\n\nIn [my last post](https://dev.to/deanius/5-ways-promises-may-be-slowing-your-app-hgm), I explained 5 ways Promises may be slowing down your app. The first two can be solved by changing what you do with Promises, the last 3 you will be stuck with if you only use Promises. Very often a look at your app on a slow or intermittent connection, or an underpowered device can reveal that it's not performing well enough. So, to serve the widest possible audience, I think a best practice is to \"Waste As Little Time As Possible\" inside your app, and Observables help you do this.\n\nLet's revisit the by-design causes of slowness with Promises, and see how Observables fix these issues.\n\n- Sync Values, inside of Promises are only available Later\n- The Single-value limitation negates Streaming benefits\n- Inability to be canceled means resources are tied up for longer\n\n### Sync Values, inside of Observables can be used synchronously\n\nRecall that this Promise example would not alert the new status on the final line.\n\n```js\nlet status = 'not loaded'\nPromise.resolve('loaded').then(newStatus =\u003e {\n  status = newStatus\n})\nconsole.log(status) // logs 'not loaded'\n```\n\nHowever, this Observable version will in fact log 'loaded', since the Observable returned from `of` has the data already:\n\n```js\nconst { of } = rxjs\nlet status = 'not loaded'\n\nof('loaded').subscribe(newStatus =\u003e {\n  status = newStatus\n})\nconsole.log(status) // logs 'loaded'\n```\n\nWhy is this useful? \n\nBecause RxJS (Observables in general) are designed to \"Waste As Little Time As Possible\", if your data to be processed are available synchronously, processing them through an Observable incurs minimal overhead. There's really a much larger topic, called [Schedulers](https://blog.strongbrew.io/what-are-schedulers-in-rxjs/), which explain how Observables can be reassigned to run sync, async, on every animationFrame, or many other rich options. But the part to remember in comparison to Promises, is that there is no built-in slow-down.\n\n###  Observables are many-valued, enabling incremental delivery\n\nI mentioned how a Promise-based `fetch` of users from a remote server would not make any users available to the browser until the final `]` came back and the JSON could be parsed, and how this is bad for slow or intermittent connections which may lose all the data they've already received.\n\nThe way to think about an Observable for a REST result of many items, is that it is similar to starting a `ls -l` process on a directory. Each line that comes back could be the one you were looking for, so the sooner each line can be shown to the user, the sooner the user can work on it, and possibly free up resources by canceling the listing as described in the next section.\n\nHere is some Promise code to get the occupancy for a bunch of rooms in a fictional hotel, the Hotel California.. The data look like:\n\n```js\n[\n  {\"room\":\"30\",\"occupancy\":\"open\"},\n  {\"room\":\"31\",\"occupancy\":\"full\"},\n...\n]\n```\n\nAnd the Promise-getting version that waits for them all looks like:\n\n```js\n    callApi(\"/api/occupancy\").then(records =\u003e {\n      records.forEach(record =\u003e\n        store.dispatch({ type: \"setOccupancy\", payload: record })\n      );\n    });\n```\n\nMeanwhile, the Observable version, using `ajaxStreamingGet` from the `rx-helper` library, looks like:\n\n```js\najaxStreamingGet({ url: \"/api/occupancy\" }).subscribe(\n  record =\u003e store.dispatch({ type: \"setOccupancy\", payload: record })\n);\n```\n\nVirtually identical code, but the Observable version has its Time-To-Use-Of-Data much lower. Check out [this live demo](https://deanius.github.io/antares/) that hits the Github API through a slowed-down endpoint. All else being equal, data that is available sooner is more valuable than data available later! And if the user sees what they want, or moves on to another page before the result is downloaded, because it's an Observable, not a Promise, it can be canceled. So let's dig into that..\n\n\n### Observables were designed for scheduling AND cancelation!\n\nGood advice I've heard is _\"Dont start something you don't know how to finish\"_. It's certainly true in computing that when needs change, sometimes things must be shut down, so as not to be wasteful. Or to destroy the entire planet! Let's look at a Promise for initiating nuclear war in 10 seconds:\n\n```js\nconst initiateLaunch = new Promise(resolve =\u003e {\n  console.log(\"FIRING ZE MISSLES IN 10 SECONDS!\"); \n  const timeoutId = setTimeout(() =\u003e {\n    console.log(\"LAUNCHED\")\n    resolve(\"were all goners\")\n  }, 10*1000)\n})\n\ninitiateLaunch.then(result =\u003e console.log(\"Uh Oh: \" + result))\n```\n\nThe first thing to be wary of is that the mere act of defining the Promise sets the missile firing into motion. And since Promises don't provide for cancelation, we will all, in fact, be goners!\n\nObservables don't work this way. They are best thought of as recipes on index cards - the mere reading of the recipe does not cause the cooking to begin. They are like the string `ls -l` which _can be turned into a running process_ that will produce results, but is not already running. This is what is meant by \"Observables are lazy\". It's good. It means you can define the missile firing process without initiating it. \n\nAnd as far as cancelation goes, when you define an Observable, you can (and should!) provide for a means of canceling it. You return a function that wraps up the cancelation logic, and the user of the Observable cancels it with the method 'unsubscribe' (Can you guess how you initiate the Observable running?). Putting it all together, we have:\n\n```js\nconst initiateLaunchSafe = new Observable(notify =\u003e {\n  console.log(\"FIRING ZE MISSLES IN 10 SECONDS!\"); \n  const timeoutId = setTimeout(() =\u003e {\n    console.log(\"LAUNCHED\")\n    notify.complete()\n  }, 10*1000)\n\n  // Make available the means to cancel by returning a function\n  return () =\u003e clearTimeout(timeoutId)\n})\n```\n\nSweet! This code, unlike the Promise version, is not running right away— to start it we must first call `subscribe`. But going one step further, let's imagine a situation where this launch sequence is defined, then 1 second later, we cancel it. Can we do this??\n\n```js\n\n// Calling subscribe starts it, and returns a Subscription object\nconst launchSequence = initiateLaunchSafe.subscribe()\n\nsetTimeout(() =\u003e {\n  launchSequence.unsubscribe()\n  console.log(\"SAVED THE PLANET!\")\n}, 1 * 1000)\n\n```\n\nIn fact we can, and do save the planet by using Observables.\nI made this [JSBin](https://jsbin.com/diyurej/edit?js,console) where you can play with saving the planet yourself.\n\n### Conclusion\n\nObservables are really excellent general purpose tools for Wasting As Little Time As Possible. What makes this possible is their support for:\n\n- synchronous operation when available\n- incremental results\n- cancelation to free up resources\n\nWhile there are abstractions that make these things possible with Promises, I can write several more posts on the advantages of Observables for simply modeling problems concisely, and writing more declarative code than you could with Promises. While there are no silver bullets in programming, sometimes the correct layer of abstraction can make complexity just vanish. We no longer manipulate memory addresses to get different elements of arrays (like is necessary in C), because the Array abstraction saves us from low-level stuff like that. Similarly, Observables save us from time-and-resource management issues we have if we only use Promises.\n\nAlways use the right tool for the job, and your users, team, and company will thank you. Let me know what you think in comments below!\n\nDean\n","cached_tag_list":"rxjs, angular, observable, promises","cached_user_name":"Dean Radcliffe","cached_user_username":"deanius","comments_count":0,"description":"In my last post, I explained 5 ways Promises may be slowing down your app. The first two can be...","main_image":null,"main_image_background_hex_color":"#dddddd","path":"/deanius/observably-better-than-promises-4pmf","public_reactions_count":16,"processed_html":"\u003cp\u003eIn \u003ca href=\"https://dev.to/deanius/5-ways-promises-may-be-slowing-your-app-hgm\"\u003emy last post\u003c/a\u003e, I explained 5 ways Promises may be slowing down your app. The first two can be solved by changing what you do with Promises, the last 3 you will be stuck with if you only use Promises. Very often a look at your app on a slow or intermittent connection, or an underpowered device can reveal that it's not performing well enough. So, to serve the widest possible audience, I think a best practice is to \"Waste As Little Time As Possible\" inside your app, and Observables help you do this.\u003c/p\u003e\n\n\u003cp\u003eLet's revisit the by-design causes of slowness with Promises, and see how Observables fix these issues.\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eSync Values, inside of Promises are only available Later\u003c/li\u003e\n\u003cli\u003eThe Single-value limitation negates Streaming benefits\u003c/li\u003e\n\u003cli\u003eInability to be canceled means resources are tied up for longer\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n  \u003ca name=\"sync-values-inside-of-observables-can-be-used-synchronously\" href=\"#sync-values-inside-of-observables-can-be-used-synchronously\"\u003e\n  \u003c/a\u003e\n  Sync Values, inside of Observables can be used synchronously\n\u003c/h3\u003e\n\n\u003cp\u003eRecall that this Promise example would not alert the new status on the final line.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003estatus\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003enot loaded\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\n\u003cspan class=\"nb\"\u003ePromise\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eresolve\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eloaded\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003ethen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003enewStatus\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003estatus\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003enewStatus\u003c/span\u003e\n\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003estatus\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// logs 'not loaded'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eHowever, this Observable version will in fact log 'loaded', since the Observable returned from \u003ccode\u003eof\u003c/code\u003e has the data already:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003eof\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003erxjs\u003c/span\u003e\n\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003estatus\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003enot loaded\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eloaded\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003esubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003enewStatus\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003estatus\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003enewStatus\u003c/span\u003e\n\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003estatus\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// logs 'loaded'\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eWhy is this useful? \u003c/p\u003e\n\n\u003cp\u003eBecause RxJS (Observables in general) are designed to \"Waste As Little Time As Possible\", if your data to be processed are available synchronously, processing them through an Observable incurs minimal overhead. There's really a much larger topic, called \u003ca href=\"https://blog.strongbrew.io/what-are-schedulers-in-rxjs/\"\u003eSchedulers\u003c/a\u003e, which explain how Observables can be reassigned to run sync, async, on every animationFrame, or many other rich options. But the part to remember in comparison to Promises, is that there is no built-in slow-down.\u003c/p\u003e\n\n\u003ch3\u003e\n  \u003ca name=\"observables-are-manyvalued-enabling-incremental-delivery\" href=\"#observables-are-manyvalued-enabling-incremental-delivery\"\u003e\n  \u003c/a\u003e\n  Observables are many-valued, enabling incremental delivery\n\u003c/h3\u003e\n\n\u003cp\u003eI mentioned how a Promise-based \u003ccode\u003efetch\u003c/code\u003e of users from a remote server would not make any users available to the browser until the final \u003ccode\u003e]\u003c/code\u003e came back and the JSON could be parsed, and how this is bad for slow or intermittent connections which may lose all the data they've already received.\u003c/p\u003e\n\n\u003cp\u003eThe way to think about an Observable for a REST result of many items, is that it is similar to starting a \u003ccode\u003els -l\u003c/code\u003e process on a directory. Each line that comes back could be the one you were looking for, so the sooner each line can be shown to the user, the sooner the user can work on it, and possibly free up resources by canceling the listing as described in the next section.\u003c/p\u003e\n\n\u003cp\u003eHere is some Promise code to get the occupancy for a bunch of rooms in a fictional hotel, the Hotel California.. The data look like:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eroom\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e30\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eoccupancy\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eopen\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eroom\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e31\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eoccupancy\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003efull\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\n\u003cspan class=\"p\"\u003e...\u003c/span\u003e\n\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eAnd the Promise-getting version that waits for them all looks like:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e    \u003cspan class=\"nx\"\u003ecallApi\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e/api/occupancy\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003ethen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003erecords\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003erecords\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eforEach\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003erecord\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edispatch\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003esetOccupancy\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"na\"\u003epayload\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003erecord\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eMeanwhile, the Observable version, using \u003ccode\u003eajaxStreamingGet\u003c/code\u003e from the \u003ccode\u003erx-helper\u003c/code\u003e library, looks like:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003eajaxStreamingGet\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e/api/occupancy\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e \u003cspan class=\"p\"\u003e}).\u003c/span\u003e\u003cspan class=\"nx\"\u003esubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003erecord\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edispatch\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003esetOccupancy\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"na\"\u003epayload\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003erecord\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eVirtually identical code, but the Observable version has its Time-To-Use-Of-Data much lower. Check out \u003ca href=\"https://deanius.github.io/antares/\"\u003ethis live demo\u003c/a\u003e that hits the Github API through a slowed-down endpoint. All else being equal, data that is available sooner is more valuable than data available later! And if the user sees what they want, or moves on to another page before the result is downloaded, because it's an Observable, not a Promise, it can be canceled. So let's dig into that..\u003c/p\u003e\n\n\u003ch3\u003e\n  \u003ca name=\"observables-were-designed-for-scheduling-and-cancelation\" href=\"#observables-were-designed-for-scheduling-and-cancelation\"\u003e\n  \u003c/a\u003e\n  Observables were designed for scheduling AND cancelation!\n\u003c/h3\u003e\n\n\u003cp\u003eGood advice I've heard is \u003cem\u003e\"Dont start something you don't know how to finish\"\u003c/em\u003e. It's certainly true in computing that when needs change, sometimes things must be shut down, so as not to be wasteful. Or to destroy the entire planet! Let's look at a Promise for initiating nuclear war in 10 seconds:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003einitiateLaunch\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nb\"\u003ePromise\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eresolve\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eFIRING ZE MISSLES IN 10 SECONDS!\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003etimeoutId\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003esetTimeout\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eLAUNCHED\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eresolve\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003ewere all goners\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e},\u003c/span\u003e \u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"mi\"\u003e1000\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003einitiateLaunch\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ethen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eresult\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eUh Oh: \u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nx\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eThe first thing to be wary of is that the mere act of defining the Promise sets the missile firing into motion. And since Promises don't provide for cancelation, we will all, in fact, be goners!\u003c/p\u003e\n\n\u003cp\u003eObservables don't work this way. They are best thought of as recipes on index cards - the mere reading of the recipe does not cause the cooking to begin. They are like the string \u003ccode\u003els -l\u003c/code\u003e which \u003cem\u003ecan be turned into a running process\u003c/em\u003e that will produce results, but is not already running. This is what is meant by \"Observables are lazy\". It's good. It means you can define the missile firing process without initiating it. \u003c/p\u003e\n\n\u003cp\u003eAnd as far as cancelation goes, when you define an Observable, you can (and should!) provide for a means of canceling it. You return a function that wraps up the cancelation logic, and the user of the Observable cancels it with the method 'unsubscribe' (Can you guess how you initiate the Observable running?). Putting it all together, we have:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003einitiateLaunchSafe\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003enotify\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eFIRING ZE MISSLES IN 10 SECONDS!\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003etimeoutId\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003esetTimeout\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eLAUNCHED\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003enotify\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecomplete\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e},\u003c/span\u003e \u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"mi\"\u003e1000\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n  \u003cspan class=\"c1\"\u003e// Make available the means to cancel by returning a function\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003eclearTimeout\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003etimeoutId\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eSweet! This code, unlike the Promise version, is not running right away— to start it we must first call \u003ccode\u003esubscribe\u003c/code\u003e. But going one step further, let's imagine a situation where this launch sequence is defined, then 1 second later, we cancel it. Can we do this??\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\n\u003cspan class=\"c1\"\u003e// Calling subscribe starts it, and returns a Subscription object\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003elaunchSequence\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003einitiateLaunchSafe\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003esetTimeout\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003elaunchSequence\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eunsubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eSAVED THE PLANET!\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e},\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e1000\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eIn fact we can, and do save the planet by using Observables.\u003cbr\u003e\nI made this \u003ca href=\"https://jsbin.com/diyurej/edit?js,console\"\u003eJSBin\u003c/a\u003e where you can play with saving the planet yourself.\u003c/p\u003e\n\n\u003ch3\u003e\n  \u003ca name=\"conclusion\" href=\"#conclusion\"\u003e\n  \u003c/a\u003e\n  Conclusion\n\u003c/h3\u003e\n\n\u003cp\u003eObservables are really excellent general purpose tools for Wasting As Little Time As Possible. What makes this possible is their support for:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003esynchronous operation when available\u003c/li\u003e\n\u003cli\u003eincremental results\u003c/li\u003e\n\u003cli\u003ecancelation to free up resources\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eWhile there are abstractions that make these things possible with Promises, I can write several more posts on the advantages of Observables for simply modeling problems concisely, and writing more declarative code than you could with Promises. While there are no silver bullets in programming, sometimes the correct layer of abstraction can make complexity just vanish. We no longer manipulate memory addresses to get different elements of arrays (like is necessary in C), because the Array abstraction saves us from low-level stuff like that. Similarly, Observables save us from time-and-resource management issues we have if we only use Promises.\u003c/p\u003e\n\n\u003cp\u003eAlways use the right tool for the job, and your users, team, and company will thank you. Let me know what you think in comments below!\u003c/p\u003e\n\n\u003cp\u003eDean\u003c/p\u003e\n\n","published":true,"published_from_feed":false,"show_comments":true,"slug":"observably-better-than-promises-4pmf","social_image":null,"title":"Observably Faster Than Promises","video":null,"video_code":null},{"created_at":"2019-05-21T23:19:58.693Z","crossposted_at":null,"edited_at":null,"last_comment_at":"2024-07-03T03:02:33.917Z","published_at":"2019-05-21T23:22:36.993Z","canonical_url":null,"feed_source_url":null,"video_closed_caption_track_url":null,"video_source_url":null,"video_thumbnail_url":null,"body_markdown":"---\ntitle: How to Read JSX as \"Just Objects\"\npublished: true\ndescription: \ntags: React, JSX, VDom, Svelte\n---\n\n# How to See Through JSX in React\n\nMost devs who know React, also learn of its relationship to JSX, and decide that the most idiomatic React is to render a list of items as shown:\n\n```jsx\nrender() {\n\u003cul\u003e\n  { languages.map(item =\u003e (\n    \u003cli\u003e{item}\u003c/li\u003e\n  )) }\n\u003c/ul\u003e\n}\n```\n\nIf the syntax highlighting seems broken, that's exactly my point - there's a lot going on here! And whenever there's a lot going on, computers (but mostly humans) will get stuff wrong. In the 6 lines of our component, rendering 2 node types, we change syntaxes from JS to JSX, and back, 8 times! Count them - it's like `JS(JSX(JS(JSX(JS))))`! This is **not** the simplest code we can write. And simpler is usually better; in terms of ability to read and be maintained, simpler is less expensive in time and money over the code's lifetime. Let's see how we can write more simply - and if it's not idiomatic, let's consider changing the idiom to be simpler.\n\n# Simplify!\nBut, let's first format this into proper component, so we can see just what we have going on, and understand how to get simpler:\n\n```jsx\nconst List = ({ items }) =\u003e (\n  \u003cul\u003e\n    {items.map(item =\u003e (\n      \u003cli\u003e{item}\u003c/li\u003e\n    ))}\n  \u003c/ul\u003e\n);\n```\n\nInstead of explaining line by line, I want to show what this returns as a text representation of the tree of objects this component returns.\n\n```\nul\n ├── li (item)\n └── li (item)\n```\n\nRecall that the magic of JSX, React's 'language' for describing UI, is that it takes the component code you write and turns it into a chain of `createElement` calls. Let's abbreviate the function named `React.createElement` to simply `vdom` (because it returns Virtual-DOM objects).\n\n```js\n// \u003cli\u003eitem\u003c/li\u003e becomes =\u003e\n\nvdom('li', {}, item);\n```\n\nThe first parameter represents the name of the element, the empty object represents any attributes, such as `title=\"item-one\"` that may be on the item, and the final is the content, or an array of content. And these can nest! So we can write our component:\n\n```js\nconst List = ({ items }) =\u003e {\n  const listItems = items.map(item =\u003e vdom('li', {}, item));\n  return vdom('ul', {}, listItems);\n};\n```\n\nHow does the above example look to you? The number of context-switches your brain must make is reduced to zero. Much simpler. But the shape of the code doesn't resemble the markup any more. What about this:\n\n```js\nconst List = ({ items }) =\u003e \n  vdom(\n    'ul',\n    {},\n    items.map(item =\u003e vdom('li', {}, item))\n  );\n};\n```\n\nJust as simple, and without the arbitrary variable name - a more functional style.\n\n# How do you want it?\n\nI'm very curious for your thoughts - which syntax is most intuitive for you? At the end of the day - React is all just objects, built-up in JavaScript. The fact that those objects get rendered to HTML with angle-bracket tags is truly an implementation detail. Its worth reminding yourself, especially as you learn, that React does not 'render HTML' or even know about HTML - it just returns objects. It's the React-DOM library's job to compare those objects to the real DOM and surgically alter it. This gives you the twin benefits of a declarative UI, and the speed advantages of selective DOM replacement that has made React so popular to begin with.\n\nUltimately, I think teams can choose a style and stick with it, and usually JSX will be that style. But I also think simpler solutions can be better, and when the idiom excludes them, perhaps we should consider broadening what we call Idiomatic React.\n","cached_tag_list":"react, jsx, vdom, svelte","cached_user_name":"Dean Radcliffe","cached_user_username":"deanius","comments_count":3,"description":"How to See Through JSX in React   Most devs who know React, also learn of its relationship t...","main_image":null,"main_image_background_hex_color":"#dddddd","path":"/deanius/how-to-read-jsx-as-just-objects-507e","public_reactions_count":6,"processed_html":"\u003ch1\u003e\n  \u003ca name=\"how-to-see-through-jsx-in-react\" href=\"#how-to-see-through-jsx-in-react\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  How to See Through JSX in React\n\u003c/h1\u003e\n\n\u003cp\u003eMost devs who know React, also learn of its relationship to JSX, and decide that the most idiomatic React is to render a list of items as shown:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight jsx\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003erender\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003eul\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"si\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003elanguages\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eitem\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003eli\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eitem\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003eli\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"si\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003eul\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eIf the syntax highlighting seems broken, that's exactly my point - there's a lot going on here! And whenever there's a lot going on, computers (but mostly humans) will get stuff wrong. In the 6 lines of our component, rendering 2 node types, we change syntaxes from JS to JSX, and back, 8 times! Count them - it's like \u003ccode\u003eJS(JSX(JS(JSX(JS))))\u003c/code\u003e! This is \u003cstrong\u003enot\u003c/strong\u003e the simplest code we can write. And simpler is usually better; in terms of ability to read and be maintained, simpler is less expensive in time and money over the code's lifetime. Let's see how we can write more simply - and if it's not idiomatic, let's consider changing the idiom to be simpler.\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"simplify\" href=\"#simplify\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Simplify!\n\u003c/h1\u003e\n\n\u003cp\u003eBut, let's first format this into proper component, so we can see just what we have going on, and understand how to get simpler:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight jsx\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eList\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e({\u003c/span\u003e \u003cspan class=\"nx\"\u003eitems\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003eul\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eitem\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003eli\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eitem\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003eli\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e))\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003eul\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eInstead of explaining line by line, I want to show what this returns as a text representation of the tree of objects this component returns.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003eul\n ├── li (item)\n └── li (item)\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eRecall that the magic of JSX, React's 'language' for describing UI, is that it takes the component code you write and turns it into a chain of \u003ccode\u003ecreateElement\u003c/code\u003e calls. Let's abbreviate the function named \u003ccode\u003eReact.createElement\u003c/code\u003e to simply \u003ccode\u003evdom\u003c/code\u003e (because it returns Virtual-DOM objects).\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// \u0026lt;li\u0026gt;item\u0026lt;/li\u0026gt; becomes =\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003evdom\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eli\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{},\u003c/span\u003e \u003cspan class=\"nx\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eThe first parameter represents the name of the element, the empty object represents any attributes, such as \u003ccode\u003etitle=\"item-one\"\u003c/code\u003e that may be on the item, and the final is the content, or an array of content. And these can nest! So we can write our component:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eList\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e({\u003c/span\u003e \u003cspan class=\"nx\"\u003eitems\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003elistItems\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eitem\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003evdom\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eli\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{},\u003c/span\u003e \u003cspan class=\"nx\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003evdom\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eul\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{},\u003c/span\u003e \u003cspan class=\"nx\"\u003elistItems\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eHow does the above example look to you? The number of context-switches your brain must make is reduced to zero. Much simpler. But the shape of the code doesn't resemble the markup any more. What about this:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eList\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e({\u003c/span\u003e \u003cspan class=\"nx\"\u003eitems\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \n  \u003cspan class=\"nx\"\u003evdom\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eul\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{},\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eitem\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003evdom\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eli\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{},\u003c/span\u003e \u003cspan class=\"nx\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eJust as simple, and without the arbitrary variable name - a more functional style.\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"how-do-you-want-it\" href=\"#how-do-you-want-it\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  How do you want it?\n\u003c/h1\u003e\n\n\u003cp\u003eI'm very curious for your thoughts - which syntax is most intuitive for you? At the end of the day - React is all just objects, built-up in JavaScript. The fact that those objects get rendered to HTML with angle-bracket tags is truly an implementation detail. Its worth reminding yourself, especially as you learn, that React does not 'render HTML' or even know about HTML - it just returns objects. It's the React-DOM library's job to compare those objects to the real DOM and surgically alter it. This gives you the twin benefits of a declarative UI, and the speed advantages of selective DOM replacement that has made React so popular to begin with.\u003c/p\u003e\n\n\u003cp\u003eUltimately, I think teams can choose a style and stick with it, and usually JSX will be that style. But I also think simpler solutions can be better, and when the idiom excludes them, perhaps we should consider broadening what we call Idiomatic React.\u003c/p\u003e\n\n","published":true,"published_from_feed":false,"show_comments":true,"slug":"how-to-read-jsx-as-just-objects-507e","social_image":null,"title":"How to Read JSX as \"Just Objects\"","video":null,"video_code":null},{"created_at":"2019-06-26T21:48:55.328Z","crossposted_at":null,"edited_at":"2019-06-27T21:19:46.524Z","last_comment_at":"2024-07-03T03:02:34.651Z","published_at":"2019-06-26T21:51:52.198Z","canonical_url":null,"feed_source_url":null,"video_closed_caption_track_url":null,"video_source_url":null,"video_thumbnail_url":null,"body_markdown":"---\ntitle: Lower The Pain of Mocking in Tests, the React Way\npublished: true\ntags: React, Storybook, Testing, OOP\n---\n\nHave you ever wondered, when you search for a domain name to possibly buy from a site like GoDaddy, if one of their admins is looking at a page of recent searches, to see if they want to buy a domain you searched for out from under you? Maybe I'm paranoid, but I totally picture them looking at page like this:\n\n| Last Search | Domain Name    | # Searches | Still Available (Ajax) |\n| ----------- | -------------- | ---------- | ---------------------- |\n| 1/1/2019    | unicorn.com    | 1000       | 🚫                     |\n| 1/1/2019    | unicornius.com | 2          | ✅                     |\n| 1/2/2019    | unicorny.com   | 200        | ✅                     |\n\nOur goal is going to be to examine a couple of different ways of building the component that represents a row in this table, and see how the solutions compare in terms of testability. As a result, we'll be able to choose the right style for the job, and possibly end up with better designs.\n\nTo make it interesting, let's\n\n- Write in pure JavaScript (no frameworks)\n- Make the population of the \"Still Available\" field available only via an async function named `lookup`\n- Worry about updating a view later - simply focus on the state management of the object.\n\nA reasonable OO practitioner might write code like this:\n\n```js\nclass DomainSearchInfo {\n  constructor(lastSearchDate, domain, searchCount) {\n    this.lastSearchDate = lastSearchDate;\n    this.domain = domain;\n    this.searchCount = searchCount;\n    this.stillAvailable = null; // unknown, initially\n\n    this.checkAvailability();\n  }\n  checkAvailability() {\n    this.lookup(this.domain).then(({ isAvailable }) =\u003e {\n      this.stillAvailable = isAvailable;\n    });\n  }\n  lookup(domain) {\n    return axios.get('http://someurl.com?domain=' + domain);\n  }\n  // rendering omitted\n}\n```\n\nBut they'd run into trouble when trying to test.\n\n## Are You Mocking Me?\n\nThey'd have questions like _How Do I mock \"axios.get\"_, and start spending time digging through mocking library documentation (time we've all spent, but does it ever feel productive?). When they finally finish their mock implementation, it turns out that there's a problem in the way they expected certain arguments, and they need to tweak the mock. Some advocates in the field like Eric Elliott say that [mocking is a smell](https://medium.com/javascript-scene/mocking-is-a-code-smell-944a70c90a6a). Is there something we can do to lower the pain of mocking?\n\nLet's see how a React [functional component](https://www.robinwieruch.de/react-function-component/) might do the same thing, with lower mocking pain:\n\n```js\nconst DomainSearchInfo = ({\n  lastSearchDate,\n  domain,\n  searchCount,\n  // default to this implementation of lookup\n  lookup = domain =\u003e axios.get(...)\n}) =\u003e {\n  const [isAvailable, setAvailable] = useState(null);\n\n  // useEffect hook omitted\n  lookup(domain).then(({ isAvailable }) =\u003e {\n    setAvailable(isAvailable);\n  });\n\n  // rendering omitted\n};\n```\n\nThe main difference is that in React, the component doesn't encapsulate completely around the `lookup` method. It provides a default implementation but allows its environment to override it. Like Michael Weststrate says in [UI As An Afterthought](https://medium.com/@mweststrate/ui-as-an-afterthought-26e5d2bb24d6), your code always runs in at least two environments - your production app, and your test suite. The React code is inherently testable without mocks because it allows you to inject whatever implementation of lookup you want. Like any of the following:\n\n```js\nconst delayedAvailabilityCheck = (isAvailable, delay) =\u003e\n  new Promise(resolve =\u003e {\n    setTimeout(() =\u003e resolve({ isAvailable }), delay);\n  });\n\n// Instant pass/fail\nconst immediateAvailabilityCheck = isAvailable =\u003e {\n  return Promise.resolve({ isAvailable });\n};\n\n// Typical\nconst shortDelayCheck = isAvailable =\u003e\n  delayedAvailabilityCheck(isAvailable, 200);\n\n// Slow connection\nconst longDelayCheck = isAvailable =\u003e\n  delayedAvailabilityCheck(isAvailable, 5000);\n```\n\nDid I say, inject a function? As in dependency injection? Yes, but the lightweight kind, not the Angular, or Spring kind. The easy, functional-programming concept that a component can receive both functions AND data as arguments. This is something you are free to do in OOP - it just bears repeating because it is not typical. But, if it's useful, you should do it.\n\nNow, dependency injection is nothing new to React developers. What's new though is assessing its impact on testing, and in particular a kind of visual testing in a tool called Storybook.\n\n## A Story of Storybook\n\nOne of the reasons I re-discovered this pattern of injecting function props, was to bring more life to the stories my team was writing in Storybook. Storybook (https://storybook.js.org) is for your visual designs what unit tests are for your logic. You use it to lay out, and make stylable all of the visual states of your application - no clicking around required - just jump right to the state:\n\nAnd one thing that's often an after-thought when dealing with async code is that your loading states need to be designed every bit as much as every other state. We just tend not to see these states too often on our fast development computers with local network connections!\n\nIf we make our DomainNameInfo component in Storybook, how cool would it be if we were able to control the speed of resolution of the availability lookup, and have a story for each speed?\n\nIt would look like this:\n\n![](https://cl.ly/54c86393ba69/Screen%252520Recording%2525202019-06-26%252520at%25252004.35%252520PM.gif)\n\nI implemented this recently for my team, and we were able to pin down the exact UI look and feel, even with varied timing scenarios.\n\n_Bonus:_ If you want to test a component that actually receives multiple events, or props over time, and are familiar with RxJS, I can show you a wrapper component that lets you control a Storybook story with an Observable of props! But that might have to wait till another blog post :)\n\n# Summary: Pass In Functions ⇒ Resolve Your Testing Woes\n\nIn short, the common OOP practice of coding function implementations directly into components has a cost - the cost of needing to use mocking tools vs regular programming techniques to set up states for testing. In contrast, the practice of Dependency Injection, in its basic form of passing functions into components, keeps things testable, and visualizable in tools like Storybook. This allows you to code for, and verify all the possibilities your users **will** encounter. As a bonus, by having an easy way (compared to mocking) to set up different scenarios, you'll be more inclined to try different ones than if writing each one were painful. Hey, maybe you'll even write a case for when the Domain Name Lookup fails!\n\nMaybe nobody is truly out there spying on your domain name lookups. But with time-saving tips like these, maybe you can roll your own, well-tested one, in even less time. I won't mock you if you try.\n","cached_tag_list":"react, storybook, testing, oop","cached_user_name":"Dean Radcliffe","cached_user_username":"deanius","comments_count":2,"description":"Have you ever wondered, when you search for a domain name to possibly buy from a site like GoDaddy, i...","main_image":null,"main_image_background_hex_color":"#dddddd","path":"/deanius/test-oop-better-by-encapsulating-less-like-react-18ej","public_reactions_count":37,"processed_html":"\u003cp\u003eHave you ever wondered, when you search for a domain name to possibly buy from a site like GoDaddy, if one of their admins is looking at a page of recent searches, to see if they want to buy a domain you searched for out from under you? Maybe I'm paranoid, but I totally picture them looking at page like this:\u003c/p\u003e\n\n\u003cdiv class=\"table-wrapper-paragraph\"\u003e\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eLast Search\u003c/th\u003e\n\u003cth\u003eDomain Name\u003c/th\u003e\n\u003cth\u003e# Searches\u003c/th\u003e\n\u003cth\u003eStill Available (Ajax)\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e1/1/2019\u003c/td\u003e\n\u003ctd\u003eunicorn.com\u003c/td\u003e\n\u003ctd\u003e1000\u003c/td\u003e\n\u003ctd\u003e🚫\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e1/1/2019\u003c/td\u003e\n\u003ctd\u003eunicornius.com\u003c/td\u003e\n\u003ctd\u003e2\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e1/2/2019\u003c/td\u003e\n\u003ctd\u003eunicorny.com\u003c/td\u003e\n\u003ctd\u003e200\u003c/td\u003e\n\u003ctd\u003e✅\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\u003c/div\u003e\n\n\u003cp\u003eOur goal is going to be to examine a couple of different ways of building the component that represents a row in this table, and see how the solutions compare in terms of testability. As a result, we'll be able to choose the right style for the job, and possibly end up with better designs.\u003c/p\u003e\n\n\u003cp\u003eTo make it interesting, let's\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eWrite in pure JavaScript (no frameworks)\u003c/li\u003e\n\u003cli\u003eMake the population of the \"Still Available\" field available only via an async function named \u003ccode\u003elookup\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eWorry about updating a view later - simply focus on the state management of the object.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eA reasonable OO practitioner might write code like this:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eDomainSearchInfo\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nf\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003elastSearchDate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003edomain\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003esearchCount\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elastSearchDate\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003elastSearchDate\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edomain\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003edomain\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esearchCount\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003esearchCount\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estillAvailable\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e// unknown, initially\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003echeckAvailability\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"nf\"\u003echeckAvailability\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003elookup\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edomain\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003ethen\u003c/span\u003e\u003cspan class=\"p\"\u003e(({\u003c/span\u003e \u003cspan class=\"nx\"\u003eisAvailable\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estillAvailable\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eisAvailable\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"nf\"\u003elookup\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003edomain\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003eaxios\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ehttp://someurl.com?domain=\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nx\"\u003edomain\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e// rendering omitted\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eBut they'd run into trouble when trying to test.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"are-you-mocking-me\" href=\"#are-you-mocking-me\"\u003e\n  \u003c/a\u003e\n  Are You Mocking Me?\n\u003c/h2\u003e\n\n\u003cp\u003eThey'd have questions like \u003cem\u003eHow Do I mock \"axios.get\"\u003c/em\u003e, and start spending time digging through mocking library documentation (time we've all spent, but does it ever feel productive?). When they finally finish their mock implementation, it turns out that there's a problem in the way they expected certain arguments, and they need to tweak the mock. Some advocates in the field like Eric Elliott say that \u003ca href=\"https://medium.com/javascript-scene/mocking-is-a-code-smell-944a70c90a6a\" target=\"_blank\" rel=\"noopener noreferrer\"\u003emocking is a smell\u003c/a\u003e. Is there something we can do to lower the pain of mocking?\u003c/p\u003e\n\n\u003cp\u003eLet's see how a React \u003ca href=\"https://www.robinwieruch.de/react-function-component/\" target=\"_blank\" rel=\"noopener noreferrer\"\u003efunctional component\u003c/a\u003e might do the same thing, with lower mocking pain:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eDomainSearchInfo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e({\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003elastSearchDate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003edomain\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003esearchCount\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e// default to this implementation of lookup\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003elookup\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003edomain\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003eaxios\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(...)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e})\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003eisAvailable\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003esetAvailable\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003euseState\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n  \u003cspan class=\"c1\"\u003e// useEffect hook omitted\u003c/span\u003e\n  \u003cspan class=\"nf\"\u003elookup\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003edomain\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003ethen\u003c/span\u003e\u003cspan class=\"p\"\u003e(({\u003c/span\u003e \u003cspan class=\"nx\"\u003eisAvailable\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003esetAvailable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eisAvailable\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n  \u003cspan class=\"c1\"\u003e// rendering omitted\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eThe main difference is that in React, the component doesn't encapsulate completely around the \u003ccode\u003elookup\u003c/code\u003e method. It provides a default implementation but allows its environment to override it. Like Michael Weststrate says in \u003ca href=\"https://medium.com/@mweststrate/ui-as-an-afterthought-26e5d2bb24d6\" target=\"_blank\" rel=\"noopener noreferrer\"\u003eUI As An Afterthought\u003c/a\u003e, your code always runs in at least two environments - your production app, and your test suite. The React code is inherently testable without mocks because it allows you to inject whatever implementation of lookup you want. Like any of the following:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003edelayedAvailabilityCheck\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eisAvailable\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003edelay\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nc\"\u003ePromise\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eresolve\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003esetTimeout\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eresolve\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e \u003cspan class=\"nx\"\u003eisAvailable\u003c/span\u003e \u003cspan class=\"p\"\u003e}),\u003c/span\u003e \u003cspan class=\"nx\"\u003edelay\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// Instant pass/fail\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eimmediateAvailabilityCheck\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eisAvailable\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nb\"\u003ePromise\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eresolve\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e \u003cspan class=\"nx\"\u003eisAvailable\u003c/span\u003e \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// Typical\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eshortDelayCheck\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eisAvailable\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nf\"\u003edelayedAvailabilityCheck\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eisAvailable\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e200\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// Slow connection\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003elongDelayCheck\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eisAvailable\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nf\"\u003edelayedAvailabilityCheck\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eisAvailable\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e5000\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eDid I say, inject a function? As in dependency injection? Yes, but the lightweight kind, not the Angular, or Spring kind. The easy, functional-programming concept that a component can receive both functions AND data as arguments. This is something you are free to do in OOP - it just bears repeating because it is not typical. But, if it's useful, you should do it.\u003c/p\u003e\n\n\u003cp\u003eNow, dependency injection is nothing new to React developers. What's new though is assessing its impact on testing, and in particular a kind of visual testing in a tool called Storybook.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"a-story-of-storybook\" href=\"#a-story-of-storybook\"\u003e\n  \u003c/a\u003e\n  A Story of Storybook\n\u003c/h2\u003e\n\n\u003cp\u003eOne of the reasons I re-discovered this pattern of injecting function props, was to bring more life to the stories my team was writing in Storybook. Storybook (\u003ca href=\"https://storybook.js.org\" target=\"_blank\" rel=\"noopener noreferrer\"\u003ehttps://storybook.js.org\u003c/a\u003e) is for your visual designs what unit tests are for your logic. You use it to lay out, and make stylable all of the visual states of your application - no clicking around required - just jump right to the state:\u003c/p\u003e\n\n\u003cp\u003eAnd one thing that's often an after-thought when dealing with async code is that your loading states need to be designed every bit as much as every other state. We just tend not to see these states too often on our fast development computers with local network connections!\u003c/p\u003e\n\n\u003cp\u003eIf we make our DomainNameInfo component in Storybook, how cool would it be if we were able to control the speed of resolution of the availability lookup, and have a story for each speed?\u003c/p\u003e\n\n\u003cp\u003eIt would look like this:\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fcl.ly%2F54c86393ba69%2FScreen%25252520Recording%252525202019-06-26%25252520at%2525252004.35%25252520PM.gif\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fcl.ly%2F54c86393ba69%2FScreen%25252520Recording%252525202019-06-26%25252520at%2525252004.35%25252520PM.gif\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eI implemented this recently for my team, and we were able to pin down the exact UI look and feel, even with varied timing scenarios.\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003eBonus:\u003c/em\u003e If you want to test a component that actually receives multiple events, or props over time, and are familiar with RxJS, I can show you a wrapper component that lets you control a Storybook story with an Observable of props! But that might have to wait till another blog post :)\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"summary-pass-in-functions-%E2%87%92-resolve-your-testing-woes\" href=\"#summary-pass-in-functions-%E2%87%92-resolve-your-testing-woes\"\u003e\n  \u003c/a\u003e\n  Summary: Pass In Functions ⇒ Resolve Your Testing Woes\n\u003c/h1\u003e\n\n\u003cp\u003eIn short, the common OOP practice of coding function implementations directly into components has a cost - the cost of needing to use mocking tools vs regular programming techniques to set up states for testing. In contrast, the practice of Dependency Injection, in its basic form of passing functions into components, keeps things testable, and visualizable in tools like Storybook. This allows you to code for, and verify all the possibilities your users \u003cstrong\u003ewill\u003c/strong\u003e encounter. As a bonus, by having an easy way (compared to mocking) to set up different scenarios, you'll be more inclined to try different ones than if writing each one were painful. Hey, maybe you'll even write a case for when the Domain Name Lookup fails!\u003c/p\u003e\n\n\u003cp\u003eMaybe nobody is truly out there spying on your domain name lookups. But with time-saving tips like these, maybe you can roll your own, well-tested one, in even less time. I won't mock you if you try.\u003c/p\u003e\n\n","published":true,"published_from_feed":false,"show_comments":true,"slug":"test-oop-better-by-encapsulating-less-like-react-18ej","social_image":null,"title":"Lower The Pain of Mocking in Tests, the React Way","video":null,"video_code":null},{"created_at":"2019-09-09T04:45:34.015Z","crossposted_at":null,"edited_at":"2019-09-13T21:25:35.002Z","last_comment_at":"2019-09-09T04:53:42.232Z","published_at":"2019-09-09T04:53:42.232Z","canonical_url":null,"feed_source_url":null,"video_closed_caption_track_url":null,"video_source_url":null,"video_thumbnail_url":null,"body_markdown":"---\ntitle: How To Survive Your First Conference Talk\npublished: true\ndescription: \ntags: tech, conference speaking, presentation, rxjs\n---\n\n# How To Survive Your First Conference Talk\n\n![](https://s3.amazonaws.com/www.deanius.com/freakout-cat.jpg)\n\n\nDoes any of this sound familiar?\n\n- You chose a conference that looked like it had interesting people and topics.\n- You wrote 1 (or more) proposals about something you wanted to share, or learn about.\n- To your surprise, you were chosen to present at the conference!\n- Now, that sinking feeling - _Oh crap, How am I going to pull this off?_\n\nWhen I found out I'd be presenting at [RxJS Live](https://rxjs.live), and had only 3 days to flesh out the talk, I was excited, but quite anxious. But when I pulled it off, I realized I needed to share with others who might be in similar need.\n\nIf you're a person who likes to follow a recipe, I'll suggest one that you can use. It's an idealized version of the process that I followed. I followed a process since there was no time to be lost. I think it helped me create a talk that was:\n\n- Organized\n- Well-Paced\n- Able to be spoken clearly\n\nSome things, I won't cover in this post, however:\n\n- How much time to spend on each part of your preparation\n- What your topic is, or how deep to go\n- How to use voice and body language effectively\n\nBut I will go over each section of preparing you'll need to do, and leave you some simple, easy take-aways in each section.\n\nAlso, if you want to learn from someone who's done this far more than me, I can recommend Justin Searls' well-illustrated [Crafting A Conference Talk](http://blog.testdouble.com/posts/2014-04-04-crafting-a-conference-talk).\n\nNow, let's dig in!\n\n---\n\n# Mind Map It\n\nThe first thing you need to do is decide what you will, and won’t cover. The biggest risk to you, dear presenter, is overcommitting to material. The best thinking tool I’ve found for organizing possible topics is a Mind Map. Used correctly it will be fast, fun, and allow you to know when you’ve got enough, or too much.\n\nA mind-map is a 2-D layout of your topics that you build organically. There's actually a specific definition of Mind Map, with neuro-science based rules and articulated benefits, which you can read about in [The Mind Map Book](https://www.amazon.com/Mind-Map-Book-Thinking-Potential/dp/0452273226/ref=asc_df_0452273226/?tag=hyprod-20\u0026linkCode=df0\u0026hvadid=312562231174\u0026hvpos=1o1\u0026hvnetw=g\u0026hvrand=3402376297543394140\u0026hvpone=\u0026hvptwo=\u0026hvqmt=\u0026hvdev=c\u0026hvdvcmdl=\u0026hvlocint=\u0026hvlocphy=9021565\u0026hvtargid=pla-434642348396\u0026psc=1). But for now, use any portable tool - pencil \u0026 paper, or the really awesome SimpleMind app. I can't recommend [SimpleMind](https://simplemind.eu) enough - it's intuitive, stays out of my way, and allows me to edit on the go, and in airplane mode! Here's a mind map of this blog post:\n\n![](https://s3.amazonaws.com/www.deanius.com/mind-map-talk.png)\n\nAdvice for mindmapping:\n\nWhat to do:\n- Exploit the freedom to add topics in any order\n- Keep descriptions of bubbles (\"topics\") short\n- Create neighborhoods (\"topic groups\") of topics\n- Actually physically _walk around_, speaking out loud as though presenting, but without pressure. It's fun! :)\n\nWhat not to do:\n- Decide exactly what to say for each topic\n- Obsess about images or wording\n- Let stress build up about the finished product\n\nA good rule of thumb is to have **one topic on your mind map per minute of time you have to fill**. In my case I had a 30 minute talk. Here's an intentionally blurred picture of the Map of the talk I gave, so you can just see the shape and organization:\n\n![](https://s3.amazonaws.com/www.deanius.com/mm-blur.jpg)\n\nThe visual weight of each area shows whether your talk's sections are roughly balanced. It takes 3-6 topics to create a memorable [story-arc](https://en.wikipedia.org/wiki/Story_arc) of introduction, elaboration, and resolution. So about 5-6 topics can give a feeling of progress without belaboring things. Too small, and a topic group will be forgotten, so each one needs a little meat on its bones. Many memorable songs have that many sections - a couple verses, choruses, a bridge. If each topic group is as memorable as a Beatles song, you'll be just fine :)\n\nDone with your mind map? Great! Now, we need to put topics in an order that unifies them, and allows for smooth transitions. This is incredibly important, so let's get on it..\n\n---\n# The Narrative - Topic Order\n\n2-D is fun for brainstorming, but your talk must be given linearly. So now you have to settle on an order, and iterate it until it is smooth.\n\nWhat you are going to do, is talk through your mind map, saying at least a few sentences that you want to say for each topic. You can do this as many times as you like, refining your mindmap as needed. It's best to debug the topic order now than once you've started building within an order.\n\nSimpleMind wins here, by being able to turn your mindmap into an outline. You can reorder this outline, and STILL keep the exact visual grouping of the mindmap! Again, from the mindmap of this post:\n\n![](https://s3.amazonaws.com/www.deanius.com/mm-outline.jpg)\n\n Talk around your mindmap a few times, from topic to topic, until you arrive at the same order every time. This may require multiple sessions to do this, and that's OK! Moving on while it's still shaky will be disastrous and cost you time you don't have. Writing your narrative and choosing images is all that's left to do after this, and that can be done under the gun, but massive re-orderings cannot!\n\n Proceed to writing your Talking Points only when ready.\n\n---\n\n# The Narrative - Talking Points\n\nNow that the topic order is set, you'll want to get down to writing down those talking points that you came up with while walking your map. You will generally be talking continually, but with pauses, throughout your talk. This means each topic needs words, and words work better in sentence, of course! So you're going to write sentences - approximately 5 per topic.\n\nThe rule of thumb for this is:\n\n**5 sentences max per topic, and 15-20 words per sentence!** \n\nThere's a reason for these numbers. But don't worry about that yet. For now, your goal is simply to capture those thoughts you had that determined the topic order. The process of writing out each sentence will do a lot for you. The more you can commit to the exact words you'll use, the more professional and polished you'll sound. Maybe you don't have time for that now, but at least try to create sentences that feel right, and are authentically you. 5 sentences of 15-20 words, based on a speaking pace of 120-150 words per minute, leaves room in your word-budget that you can turn into pauses, or improvise in later.\n\nNow get down to it! \n\nWhat to do:\n- Re-walk your mind map, writing down the sentences that helped you determine your topic order\n- Using a text editor, keep sentences short enough so they fit on one line.\n\nWhat not to do:\n- Write your sentences when the topic order is not solid.\n- Lay these words out as bullet points on slides (keep them Presenter Notes or in a separate application like a text editor)\n\n---\n\n# Visuals/Slides\n\n![](https://images.unsplash.com/photo-1542050939822-419d5716b8b3?ixlib=rb-1.2.1\u0026ixid=eyJhcHBfaWQiOjEyMDd9\u0026auto=format\u0026fit=crop\u0026w=2550\u0026q=80)\n\nCongrats - you are in the home stretch! For my 30 minute talk I did the previous steps over 2 days, during transit, waiting in line— anywhere I could. This final step I did in 2 1/2 unbroken hours after the first day of the conference, and the day before I went on. Finding/making images and memes, choosing props - I find this to be so fun. It's where the palms start to sweat from excitement, not just nerves!\n\nStarting from each topic group, practicing each topic's sentences aloud, ask yourself what your audience should be seeing. Each of these methods, and others can be considered:\n\n- A Lone Image\n- Bullet Points\n- A code sample\n- An audience demonstration or poll\n\nWith 30 topics or more, your audience needs variety: each one cannot be delivered in the same way! Your content, and how much time you have to prepare, will determine exactly what you commit to showing or playing. But, variety will make things far more memorable. And the last thing you want after all your hard work is for your message to be forgotten.\n\nWhat to do:\n- Talk over each topic group with images as it gets completed.\n- With a stopwatch, time each section with the exact words and support visuals to verify it still works with the narrative\n- Practice! Practice!\n\nWhat not to do:\n\n- Try a brand new presentation software if you're pressed for time.\n- Get a big idea to add or rewrite more than 1% \n- Freak out and call the whole thing off (really?)\n\nRemember **WHY** this was important enough to you to do this. \n\nRemember **WHAT** you love about this topic. \n\nRemember **HOW** you want to make things better for your audience.\n\nAt the end they're not judging your slides, or even you. They want to reach a new level of understanding, feel smarter, enlightened, aware. You can only do your best. But you are there for a reason, and it's really out of your hands once you've gotten to this point. So trust-fall into the universe once you've prepared this much. You got this! (Let me know how it goes)\n\n![](https://s3.amazonaws.com/www.deanius.com/family.jpg)","cached_tag_list":"tech, conferencespeaking, presentation, rxjs","cached_user_name":"Dean Radcliffe","cached_user_username":"deanius","comments_count":0,"description":"","main_image":null,"main_image_background_hex_color":"#dddddd","path":"/deanius/how-to-survive-your-first-conference-talk-1bpk","public_reactions_count":5,"processed_html":"\u003ch1\u003e\n  \u003ca name=\"how-to-survive-your-first-conference-talk\" href=\"#how-to-survive-your-first-conference-talk\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  How To Survive Your First Conference Talk\n\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--sZqvKf_i--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://s3.amazonaws.com/www.deanius.com/freakout-cat.jpg\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--sZqvKf_i--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://s3.amazonaws.com/www.deanius.com/freakout-cat.jpg\" alt=\"\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eDoes any of this sound familiar?\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eYou chose a conference that looked like it had interesting people and topics.\u003c/li\u003e\n\u003cli\u003eYou wrote 1 (or more) proposals about something you wanted to share, or learn about.\u003c/li\u003e\n\u003cli\u003eTo your surprise, you were chosen to present at the conference!\u003c/li\u003e\n\u003cli\u003eNow, that sinking feeling - \u003cem\u003eOh crap, How am I going to pull this off?\u003c/em\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eWhen I found out I'd be presenting at \u003ca href=\"https://rxjs.live\"\u003eRxJS Live\u003c/a\u003e, and had only 3 days to flesh out the talk, I was excited, but quite anxious. But when I pulled it off, I realized I needed to share with others who might be in similar need.\u003c/p\u003e\n\n\u003cp\u003eIf you're a person who likes to follow a recipe, I'll suggest one that you can use. It's an idealized version of the process that I followed. I followed a process since there was no time to be lost. I think it helped me create a talk that was:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eOrganized\u003c/li\u003e\n\u003cli\u003eWell-Paced\u003c/li\u003e\n\u003cli\u003eAble to be spoken clearly\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eSome things, I won't cover in this post, however:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eHow much time to spend on each part of your preparation\u003c/li\u003e\n\u003cli\u003eWhat your topic is, or how deep to go\u003c/li\u003e\n\u003cli\u003eHow to use voice and body language effectively\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eBut I will go over each section of preparing you'll need to do, and leave you some simple, easy take-aways in each section.\u003c/p\u003e\n\n\u003cp\u003eAlso, if you want to learn from someone who's done this far more than me, I can recommend Justin Searls' well-illustrated \u003ca href=\"http://blog.testdouble.com/posts/2014-04-04-crafting-a-conference-talk\"\u003eCrafting A Conference Talk\u003c/a\u003e.\u003c/p\u003e\n\n\u003cp\u003eNow, let's dig in!\u003c/p\u003e\n\n\n\u003chr\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"mind-map-it\" href=\"#mind-map-it\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Mind Map It\n\u003c/h1\u003e\n\n\u003cp\u003eThe first thing you need to do is decide what you will, and won’t cover. The biggest risk to you, dear presenter, is overcommitting to material. The best thinking tool I’ve found for organizing possible topics is a Mind Map. Used correctly it will be fast, fun, and allow you to know when you’ve got enough, or too much.\u003c/p\u003e\n\n\u003cp\u003eA mind-map is a 2-D layout of your topics that you build organically. There's actually a specific definition of Mind Map, with neuro-science based rules and articulated benefits, which you can read about in \u003ca href=\"https://www.amazon.com/Mind-Map-Book-Thinking-Potential/dp/0452273226/ref=asc_df_0452273226/?tag=hyprod-20\u0026amp;linkCode=df0\u0026amp;hvadid=312562231174\u0026amp;hvpos=1o1\u0026amp;hvnetw=g\u0026amp;hvrand=3402376297543394140\u0026amp;hvpone=\u0026amp;hvptwo=\u0026amp;hvqmt=\u0026amp;hvdev=c\u0026amp;hvdvcmdl=\u0026amp;hvlocint=\u0026amp;hvlocphy=9021565\u0026amp;hvtargid=pla-434642348396\u0026amp;psc=1\"\u003eThe Mind Map Book\u003c/a\u003e. But for now, use any portable tool - pencil \u0026amp; paper, or the really awesome SimpleMind app. I can't recommend \u003ca href=\"https://simplemind.eu\"\u003eSimpleMind\u003c/a\u003e enough - it's intuitive, stays out of my way, and allows me to edit on the go, and in airplane mode! Here's a mind map of this blog post:\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--j-MG54KG--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://s3.amazonaws.com/www.deanius.com/mind-map-talk.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--j-MG54KG--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://s3.amazonaws.com/www.deanius.com/mind-map-talk.png\" alt=\"\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eAdvice for mindmapping:\u003c/p\u003e\n\n\u003cp\u003eWhat to do:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eExploit the freedom to add topics in any order\u003c/li\u003e\n\u003cli\u003eKeep descriptions of bubbles (\"topics\") short\u003c/li\u003e\n\u003cli\u003eCreate neighborhoods (\"topic groups\") of topics\u003c/li\u003e\n\u003cli\u003eActually physically \u003cem\u003ewalk around\u003c/em\u003e, speaking out loud as though presenting, but without pressure. It's fun! :)\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eWhat not to do:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eDecide exactly what to say for each topic\u003c/li\u003e\n\u003cli\u003eObsess about images or wording\u003c/li\u003e\n\u003cli\u003eLet stress build up about the finished product\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eA good rule of thumb is to have \u003cstrong\u003eone topic on your mind map per minute of time you have to fill\u003c/strong\u003e. In my case I had a 30 minute talk. Here's an intentionally blurred picture of the Map of the talk I gave, so you can just see the shape and organization:\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--iDnddEDW--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://s3.amazonaws.com/www.deanius.com/mm-blur.jpg\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--iDnddEDW--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://s3.amazonaws.com/www.deanius.com/mm-blur.jpg\" alt=\"\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eThe visual weight of each area shows whether your talk's sections are roughly balanced. It takes 3-6 topics to create a memorable \u003ca href=\"https://en.wikipedia.org/wiki/Story_arc\"\u003estory-arc\u003c/a\u003e of introduction, elaboration, and resolution. So about 5-6 topics can give a feeling of progress without belaboring things. Too small, and a topic group will be forgotten, so each one needs a little meat on its bones. Many memorable songs have that many sections - a couple verses, choruses, a bridge. If each topic group is as memorable as a Beatles song, you'll be just fine :)\u003c/p\u003e\n\n\u003cp\u003eDone with your mind map? Great! Now, we need to put topics in an order that unifies them, and allows for smooth transitions. This is incredibly important, so let's get on it..\u003c/p\u003e\n\n\n\u003chr\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"the-narrative-topic-order\" href=\"#the-narrative-topic-order\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  The Narrative - Topic Order\n\u003c/h1\u003e\n\n\u003cp\u003e2-D is fun for brainstorming, but your talk must be given linearly. So now you have to settle on an order, and iterate it until it is smooth.\u003c/p\u003e\n\n\u003cp\u003eWhat you are going to do, is talk through your mind map, saying at least a few sentences that you want to say for each topic. You can do this as many times as you like, refining your mindmap as needed. It's best to debug the topic order now than once you've started building within an order.\u003c/p\u003e\n\n\u003cp\u003eSimpleMind wins here, by being able to turn your mindmap into an outline. You can reorder this outline, and STILL keep the exact visual grouping of the mindmap! Again, from the mindmap of this post:\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--DtLyD-Nb--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://s3.amazonaws.com/www.deanius.com/mm-outline.jpg\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--DtLyD-Nb--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://s3.amazonaws.com/www.deanius.com/mm-outline.jpg\" alt=\"\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eTalk around your mindmap a few times, from topic to topic, until you arrive at the same order every time. This may require multiple sessions to do this, and that's OK! Moving on while it's still shaky will be disastrous and cost you time you don't have. Writing your narrative and choosing images is all that's left to do after this, and that can be done under the gun, but massive re-orderings cannot!\u003c/p\u003e\n\n\u003cp\u003eProceed to writing your Talking Points only when ready.\u003c/p\u003e\n\n\n\u003chr\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"the-narrative-talking-points\" href=\"#the-narrative-talking-points\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  The Narrative - Talking Points\n\u003c/h1\u003e\n\n\u003cp\u003eNow that the topic order is set, you'll want to get down to writing down those talking points that you came up with while walking your map. You will generally be talking continually, but with pauses, throughout your talk. This means each topic needs words, and words work better in sentence, of course! So you're going to write sentences - approximately 5 per topic.\u003c/p\u003e\n\n\u003cp\u003eThe rule of thumb for this is:\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003e5 sentences max per topic, and 15-20 words per sentence!\u003c/strong\u003e \u003c/p\u003e\n\n\u003cp\u003eThere's a reason for these numbers. But don't worry about that yet. For now, your goal is simply to capture those thoughts you had that determined the topic order. The process of writing out each sentence will do a lot for you. The more you can commit to the exact words you'll use, the more professional and polished you'll sound. Maybe you don't have time for that now, but at least try to create sentences that feel right, and are authentically you. 5 sentences of 15-20 words, based on a speaking pace of 120-150 words per minute, leaves room in your word-budget that you can turn into pauses, or improvise in later.\u003c/p\u003e\n\n\u003cp\u003eNow get down to it! \u003c/p\u003e\n\n\u003cp\u003eWhat to do:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eRe-walk your mind map, writing down the sentences that helped you determine your topic order\u003c/li\u003e\n\u003cli\u003eUsing a text editor, keep sentences short enough so they fit on one line.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eWhat not to do:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eWrite your sentences when the topic order is not solid.\u003c/li\u003e\n\u003cli\u003eLay these words out as bullet points on slides (keep them Presenter Notes or in a separate application like a text editor)\u003c/li\u003e\n\u003c/ul\u003e\n\n\n\u003chr\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"visualsslides\" href=\"#visualsslides\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Visuals/Slides\n\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--IPBM1niJ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://images.unsplash.com/photo-1542050939822-419d5716b8b3%3Fixlib%3Drb-1.2.1%26ixid%3DeyJhcHBfaWQiOjEyMDd9%26auto%3Dformat%26fit%3Dcrop%26w%3D2550%26q%3D80\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--IPBM1niJ--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://images.unsplash.com/photo-1542050939822-419d5716b8b3%3Fixlib%3Drb-1.2.1%26ixid%3DeyJhcHBfaWQiOjEyMDd9%26auto%3Dformat%26fit%3Dcrop%26w%3D2550%26q%3D80\" alt=\"\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eCongrats - you are in the home stretch! For my 30 minute talk I did the previous steps over 2 days, during transit, waiting in line— anywhere I could. This final step I did in 2 1/2 unbroken hours after the first day of the conference, and the day before I went on. Finding/making images and memes, choosing props - I find this to be so fun. It's where the palms start to sweat from excitement, not just nerves!\u003c/p\u003e\n\n\u003cp\u003eStarting from each topic group, practicing each topic's sentences aloud, ask yourself what your audience should be seeing. Each of these methods, and others can be considered:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eA Lone Image\u003c/li\u003e\n\u003cli\u003eBullet Points\u003c/li\u003e\n\u003cli\u003eA code sample\u003c/li\u003e\n\u003cli\u003eAn audience demonstration or poll\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eWith 30 topics or more, your audience needs variety: each one cannot be delivered in the same way! Your content, and how much time you have to prepare, will determine exactly what you commit to showing or playing. But, variety will make things far more memorable. And the last thing you want after all your hard work is for your message to be forgotten.\u003c/p\u003e\n\n\u003cp\u003eWhat to do:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eTalk over each topic group with images as it gets completed.\u003c/li\u003e\n\u003cli\u003eWith a stopwatch, time each section with the exact words and support visuals to verify it still works with the narrative\u003c/li\u003e\n\u003cli\u003ePractice! Practice!\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eWhat not to do:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eTry a brand new presentation software if you're pressed for time.\u003c/li\u003e\n\u003cli\u003eGet a big idea to add or rewrite more than 1% \u003c/li\u003e\n\u003cli\u003eFreak out and call the whole thing off (really?)\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eRemember \u003cstrong\u003eWHY\u003c/strong\u003e this was important enough to you to do this. \u003c/p\u003e\n\n\u003cp\u003eRemember \u003cstrong\u003eWHAT\u003c/strong\u003e you love about this topic. \u003c/p\u003e\n\n\u003cp\u003eRemember \u003cstrong\u003eHOW\u003c/strong\u003e you want to make things better for your audience.\u003c/p\u003e\n\n\u003cp\u003eAt the end they're not judging your slides, or even you. They want to reach a new level of understanding, feel smarter, enlightened, aware. You can only do your best. But you are there for a reason, and it's really out of your hands once you've gotten to this point. So trust-fall into the universe once you've prepared this much. You got this! (Let me know how it goes)\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--dilA4Tp3--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://s3.amazonaws.com/www.deanius.com/family.jpg\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--dilA4Tp3--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://s3.amazonaws.com/www.deanius.com/family.jpg\" alt=\"\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n","published":true,"published_from_feed":false,"show_comments":true,"slug":"how-to-survive-your-first-conference-talk-1bpk","social_image":null,"title":"How To Survive Your First Conference Talk","video":null,"video_code":null},{"created_at":"2019-10-04T04:37:09.864Z","crossposted_at":null,"edited_at":"2022-09-20T04:49:05.275Z","last_comment_at":"2024-07-03T03:02:34.452Z","published_at":"2019-10-04T04:37:19.657Z","canonical_url":null,"feed_source_url":null,"video_closed_caption_track_url":null,"video_source_url":null,"video_thumbnail_url":null,"body_markdown":"---\ntitle: Error Handling in RxJS — Building an RxJS PubSub\npublished: false\ndescription: Is RxJS suitable for PubSub? And if not, can we make it so?\ntags: rxjs, catchError, observable, promise\n---\n\n# Building a PubSub Implementation on RxJS\n\nAs I attempted to tighten up error-handling for the [Rx-Helper](https://github.com/deanius/rx-helper) library, I started digging deep into exactly how RxJS errors work.\n\nI made this contrived example, which uses an Observable, and two subscribers, one of which misbehaves, to answer the following burning question:\n\n\u003e How are Publishers and Subscribers isolated from the errors of other Subscribers?\n\nIn other words, is RxJS suitable for PubSub? And if not, can we make it so?\n\n## You Start Me Up\n\nIn our contrived example, a publish routine synchronously pushes two values, and one asynchronously via `setTimeout`.\n\n```js\nfunction publishSomeData() {\n  try {\n    [1, 2].forEach(i =\u003e {\n      console.log(`publisher: Pushing ${i}`);\n      publish(i);\n    });\n\n    setTimeout(() =\u003e {\n      console.log(\"publisher: Pushing 3\");\n      publish(3);\n      console.log(`publisher: Done async publishing`);\n    }, 0);\n  } catch (e) {\n    console.log(\"publisher: Saw an exception:\", e.message);\n  } finally {\n    console.log(`publisher: Done sync publishing`);\n  }\n}\n```\n\nThe implementation of `publish` is simply to call `next` on a Subject\n\n```js\nconst subject = new Subject();\nfunction publish(item) {\n  subject.next(item);\n}\n```\n\nWith two subscribers\n\n```js\nsubject.subscribe(logObserver);\nsubject.subscribe(flakyObserver);\n```\n\n```js\nconst logObserver = v =\u003e console.log(`logObserver: Saw ${v}`);\nconst flakyObserver = {\n  next(v) {\n    console.log(`flakyObserver: Saw ${v}`);\n    if (v \u003e 0) {\n      throw new Error(\"Im bad, will stop you from seeing more\");\n    }\n  }\n};\n```\n\n## It's Log, It's Log!\n\nTo understand, let's build up from simple cases first. For example, if `flakyObserver` does not throw, we will see:\n\n```js\n➽ Pushing 1\n📜: Log 1\n👀: Flaky 1\n➽ Pushing 2\n📜: Log 2\n👀: Flaky 2\n➽ Done sync publishing\n➽ Pushing 3\n📜: Log 3\n👀: Flaky 3\n➽ Done async publishing\n```\n\nLog Observer was subscribed first, and each observer is synchronous, so between each publish we see our observer's messages in order. This is an important part of the design of RxJS, and works fine - until one of the Observers throws in it's `next` callback.\n\n```js\nconst flakyObserver = {\n  next(v) {\n    console.log(`👀: Flaky ${v} 💥`);\n    if (v \u003e 0) {\n      throw new Error(\"Im bad, will stop you from seeing more\");\n    }\n  }\n};\n```\n\nWe now see:\n\n```js\n➽ Pushing 1\n📜: Log 1\n👀: Flaky 1 💥\n➽ Pushing 2\n📜: Log 2\n➽ Done sync publishing\nError: Im bad, will stop you from seeing more\n```\nWhere is our 3rd, asynchronous, published event?? What if that was an event representing a user giving us their credit info to pay for their order, did we just see 💰 go out the window 💸?\n\nAccording to Ben Lesh' [NGConf video on RxJS6 Errors](https://www.youtube.com/watch?v=JCXZhe6KsxQ\u0026t=5m0s), this is exactly expected behavior, and it's due to the line of code below, that turns unhandled errors in this stack into unhandled errors in the next stack, but I think this is a little piece of evil.\n\n```js\n./node_modules/rxjs/internal/util/hostReportError.js:4\n    setTimeout(() =\u003e { throw err; }, 0);\n```\n\nThis seems to be with the goal of of decoupling one Observer's problems from another, and its effect is seen in the fact that 2 was pushed, and seen by Log Observer 📜. But event 3 was never even logged, due to Flaky Observer 👀. For that matter, even though the publisher tried to handle an exception, there was nothing it could do to catch. A bad subscriber irreparably broke the publisher. Assuming the published events have meaning (such as a user's checkout request, or billing info), failing to handle them could have very dire consequences. What can we do about this?\n\n## PubSub\n\nI think what we want instead, is a system that would have the following log output:\n\n```js\n➽ Pushing 1\n📜: Log 1\n👀: Flaky 1 💥\nError: Im bad, will try to stop you from seeing more\n    at flakyObserver (rx-helper/demos/exceptions-agent.js:15:11)\n\n➽ Pushing 2\n📜: Log 2\n➽ Done sync publishing\n➽ Pushing 3\n📜: Log 3\n➽ Done async publishing\n```\n\nOnce Flaky Observer 👀 fails, the system reports its error, and it is never heard from again. Sure, it's harsh, but it's the only way that's fair to other, well-behaved Observers. Given a choice, I don't want to build a system that is more coupled than this. Watch Ben talk about the production issue that led to RxJS6 Error handling, and you'll hear that isolation is key. I just don't think it goes far enough to save only the remaining synchronous notifications, while letting the asynchronous ones die.\n\n# A New Order of PubSub - How does it feel?\n\nRxJS can still be used to build an abstraction layer that can provide reliability guarantees that you don't get with raw RxJS. The first two parts of this abstraction are Publishers and Handlers.\n\nPublishers and Handlers follow these rules..\n\nA publisher of events:\n\n- Recieves synchronous errors for illegal events only, not for failures to process them\n- Is not interrupted synchronously or asynchronously by failures to process events\n\nHandlers that receive a fail during processing and don't replace it with a proper event will:\n\n- Not interfere with other handlers (or Publishers, see above)\n- Be shutdown, and not given further events (restarting them is an option)\n\nA special type of Handler, called a Filter, plays by different rules, and is useful for the case of detecting illegal events - malformed, wrong data types, etc..\n\nExceptions thrown from Filters:\n\n- Become exceptions in Publishers\n- Prevent any handler from running on that Event, but doesn't unsubscribe them\n\n## Strike It Up!\n\nHere's how we'd look if we pointed the publish method to the `agent` of the `rx-helper` library, after setting up Handlers with `agent.on`:\n\n```js\nimport { agent } from \"rx-helper\";\n\nagent.on(/.*/, logObserver);\nagent.on(/.*/, flakyObserver);\n\nfunction publish(item) {\n  agent.trigger(\"an-event\", item)\n}\n```\n\nUnlike the unconditional subscription of RxJS, `agent.on` takes an event pattern to match (remember JQuery??). The function is only invoked when an event's type matches this pattern - here we use a wildcard Regex, but Strings, booleans, and function predicates are also valid matchers. We'll skip descriptions of the 3rd argument and return value of `on` for now.\n\nWe'll update the Observers just a tad, to work with Rx-Helper's arguments, and set them to listen:\n\n```js\nconst logHandler = ({ payload: v }) =\u003e console.log(`📜: Log ${v}`)\nconst flakyHandler = ({ payload: v }) =\u003e {\n  console.log(`👀: Flaky ${v} 💥`)\n  if (v \u003e 0) {\n    throw new Error(\"Im bad, will stop you from seeing more\")\n  }\n}\nagent.on(/.*/, logHandler)\nagent.on(/.*/, flakyHandler)\n\n```\n\nNow we DO get the error-isolated output we sought!\n\n```js\n➽ Pushing 1\n📜: Log 1\n👀: Flaky 1 💥\nError: Im bad, will try to stop you from seeing more\n    at flakyHandler (rx-helper/demos/exceptions-agent.js:15:11)\n\n➽ Pushing 2\n📜: Log 2\n➽ Done sync publishing\n➽ Pushing 3\n📜: Log 3\n➽ Done async publishing\n```\n\nEven if we go to a 3rd and 4th event, and a filter is set to synchronously reject the 3rd event,\n```js\nconst not3Filter = ({ payload: v }) =\u003e {(v === 3) \u0026\u0026 throw new Error(\"Not 3, I have Trypophobia!\")}\n\nagent.filter(true, not3Filter)\n```\n\nAs long as the publisher catches and keeps going, we'll still log 4 - it'll just be like event 3 was filtered out of existence. Now that's a decent PubSub implementation.\n\n```js\n➽ Pushing 1\n📜: Log 1\n👀: Flaky 1 💥\nIm bad, will stop you from seeing more Error: Im bad, will stop you from seeing more\n\n➽ Pushing 2\n📜: Log 2\n➽ Done sync publishing\n➽ Pushing 3\n💥\n➽ Pushing 4\n📜: Log 4\n➽ Done async publishing\n```\n\n## How Will I Know?\n\nBut actually our publish function should do one more thing other than call trigger, it should set up asynchronous error handling on the `completed` property of the result.\n\n```js\nagent.trigger(\"an-event\", item).completed.catch(() =\u003e null);\n```\n\nFor the benefit of the publisher, errors from handlers are turned into rejected Promises, and the `completed` property is a `Promise.all` of all of them. If a single handler fails, we have access to it, but it doesn't block or prevent later code from running. If we didn't have the catch, our logs would be the more verbose version below, but we'd still be safer than the RxJS6 default behavior.\n\n```js\n➽ Pushing 1\n📜: Log 1\n👀: Flaky 1 💥\nError: Im bad, will stop you from seeing more\n    at flakyHandler (/Users/dradcliffe/src/deanius/rx-helper/demos/\n\n➽ Pushing 2\n📜: Log 2\n➽ Done sync publishing\n    (node:79649) UnhandledPromiseRejectionWarning: Error: Im bad, will stop you from seeing more\n      at flakyHandler (/Users/dradcliffe/src/deanius/rx-helper/demos/exceptions-agent.js:15:11)\n    (node:79649) UnhandledPromiseRejectionWarning: Unhandled promise rejection.\n       (rejection id: 2)\n    (node:79649) [DEP0018] DeprecationWarning: Unhandled promise rejections are deprecated.\n       In the future, promise rejections that are not handled will terminate the Node.js process with a non-zero exit code.\n➽ Pushing 3\n📜: Log 3\n➽ Done async publishing\n```\n\n## Err Of Our Ways\n\nSo there we have it- RxJS error handling can be Hard to Handle, but with a little wrapper library like Rx-Helper over it we have a PubSub implementation that can be as robust as external job boxes. Well, up to the point of JavaScript being single-threaded. \n\nThat's all for the theory of it, read other articles in the [Rx-Helper GitHub](https://github.com/deanius/rx-helper) for all the cool things you can build with it.\n\n—Dean\n\n\n","cached_tag_list":"rxjs, catcherror, observable, promise","cached_user_name":"Dean Radcliffe","cached_user_username":"deanius","comments_count":2,"description":"Is RxJS suitable for PubSub? And if not, can we make it so?","main_image":null,"main_image_background_hex_color":"#dddddd","path":"/deanius/error-handling-in-rxjs-building-an-rxjs-pubsub-3lik","public_reactions_count":6,"processed_html":"\u003ch1\u003e\n  \u003ca name=\"building-a-pubsub-implementation-on-rxjs\" href=\"#building-a-pubsub-implementation-on-rxjs\"\u003e\n  \u003c/a\u003e\n  Building a PubSub Implementation on RxJS\n\u003c/h1\u003e\n\n\u003cp\u003eAs I attempted to tighten up error-handling for the \u003ca href=\"https://github.com/deanius/rx-helper\"\u003eRx-Helper\u003c/a\u003e library, I started digging deep into exactly how RxJS errors work.\u003c/p\u003e\n\n\u003cp\u003eI made this contrived example, which uses an Observable, and two subscribers, one of which misbehaves, to answer the following burning question:\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eHow are Publishers and Subscribers isolated from the errors of other Subscribers?\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eIn other words, is RxJS suitable for PubSub? And if not, can we make it so?\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"you-start-me-up\" href=\"#you-start-me-up\"\u003e\n  \u003c/a\u003e\n  You Start Me Up\n\u003c/h2\u003e\n\n\u003cp\u003eIn our contrived example, a publish routine synchronously pushes two values, and one asynchronously via \u003ccode\u003esetTimeout\u003c/code\u003e.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003epublishSomeData\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003etry\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nx\"\u003eforEach\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`publisher: Pushing \u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003epublish\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003esetTimeout\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003epublisher: Pushing 3\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003epublish\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`publisher: Done async publishing`\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e},\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003ecatch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003epublisher: Saw an exception:\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efinally\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`publisher: Done sync publishing`\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eThe implementation of \u003ccode\u003epublish\u003c/code\u003e is simply to call \u003ccode\u003enext\u003c/code\u003e on a Subject\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003esubject\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eSubject\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003epublish\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003esubject\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003enext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eWith two subscribers\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003esubject\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003elogObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"nx\"\u003esubject\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eflakyObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003elogObserver\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ev\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`logObserver: Saw \u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eflakyObserver\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003enext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`flakyObserver: Saw \u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ev\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nb\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eIm bad, will stop you from seeing more\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003ch2\u003e\n  \u003ca name=\"its-log-its-log\" href=\"#its-log-its-log\"\u003e\n  \u003c/a\u003e\n  It's Log, It's Log!\n\u003c/h2\u003e\n\n\u003cp\u003eTo understand, let's build up from simple cases first. For example, if \u003ccode\u003eflakyObserver\u003c/code\u003e does not throw, we will see:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"err\"\u003e➽\u003c/span\u003e \u003cspan class=\"nx\"\u003ePushing\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\u003cspan class=\"err\"\u003e📜\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eLog\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\u003cspan class=\"err\"\u003e👀\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eFlaky\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\u003cspan class=\"err\"\u003e➽\u003c/span\u003e \u003cspan class=\"nx\"\u003ePushing\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\n\u003cspan class=\"err\"\u003e📜\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eLog\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\n\u003cspan class=\"err\"\u003e👀\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eFlaky\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\n\u003cspan class=\"err\"\u003e➽\u003c/span\u003e \u003cspan class=\"nx\"\u003eDone\u003c/span\u003e \u003cspan class=\"nx\"\u003esync\u003c/span\u003e \u003cspan class=\"nx\"\u003epublishing\u003c/span\u003e\n\u003cspan class=\"err\"\u003e➽\u003c/span\u003e \u003cspan class=\"nx\"\u003ePushing\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\n\u003cspan class=\"err\"\u003e📜\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eLog\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\n\u003cspan class=\"err\"\u003e👀\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eFlaky\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\n\u003cspan class=\"err\"\u003e➽\u003c/span\u003e \u003cspan class=\"nx\"\u003eDone\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"nx\"\u003epublishing\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eLog Observer was subscribed first, and each observer is synchronous, so between each publish we see our observer's messages in order. This is an important part of the design of RxJS, and works fine - until one of the Observers throws in it's \u003ccode\u003enext\u003c/code\u003e callback.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eflakyObserver\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003enext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`👀: Flaky \u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e 💥`\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ev\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nb\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eIm bad, will stop you from seeing more\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eWe now see:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"err\"\u003e➽\u003c/span\u003e \u003cspan class=\"nx\"\u003ePushing\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\u003cspan class=\"err\"\u003e📜\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eLog\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\u003cspan class=\"err\"\u003e👀\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eFlaky\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"err\"\u003e💥\u003c/span\u003e\n\u003cspan class=\"err\"\u003e➽\u003c/span\u003e \u003cspan class=\"nx\"\u003ePushing\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\n\u003cspan class=\"err\"\u003e📜\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eLog\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\n\u003cspan class=\"err\"\u003e➽\u003c/span\u003e \u003cspan class=\"nx\"\u003eDone\u003c/span\u003e \u003cspan class=\"nx\"\u003esync\u003c/span\u003e \u003cspan class=\"nx\"\u003epublishing\u003c/span\u003e\n\u003cspan class=\"nb\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eIm\u003c/span\u003e \u003cspan class=\"nx\"\u003ebad\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ewill\u003c/span\u003e \u003cspan class=\"nx\"\u003estop\u003c/span\u003e \u003cspan class=\"nx\"\u003eyou\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"nx\"\u003eseeing\u003c/span\u003e \u003cspan class=\"nx\"\u003emore\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eWhere is our 3rd, asynchronous, published event?? What if that was an event representing a user giving us their credit info to pay for their order, did we just see 💰 go out the window 💸?\u003c/p\u003e\n\n\u003cp\u003eAccording to Ben Lesh' \u003ca href=\"https://www.youtube.com/watch?v=JCXZhe6KsxQ\u0026amp;t=5m0s\"\u003eNGConf video on RxJS6 Errors\u003c/a\u003e, this is exactly expected behavior, and it's due to the line of code below, that turns unhandled errors in this stack into unhandled errors in the next stack, but I think this is a little piece of evil.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003enode_modules\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003erxjs\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003einternal\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003eutil\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003ehostReportError\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ejs\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003esetTimeout\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eThis seems to be with the goal of of decoupling one Observer's problems from another, and its effect is seen in the fact that 2 was pushed, and seen by Log Observer 📜. But event 3 was never even logged, due to Flaky Observer 👀. For that matter, even though the publisher tried to handle an exception, there was nothing it could do to catch. A bad subscriber irreparably broke the publisher. Assuming the published events have meaning (such as a user's checkout request, or billing info), failing to handle them could have very dire consequences. What can we do about this?\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"pubsub\" href=\"#pubsub\"\u003e\n  \u003c/a\u003e\n  PubSub\n\u003c/h2\u003e\n\n\u003cp\u003eI think what we want instead, is a system that would have the following log output:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"err\"\u003e➽\u003c/span\u003e \u003cspan class=\"nx\"\u003ePushing\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\u003cspan class=\"err\"\u003e📜\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eLog\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\u003cspan class=\"err\"\u003e👀\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eFlaky\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"err\"\u003e💥\u003c/span\u003e\n\u003cspan class=\"nb\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eIm\u003c/span\u003e \u003cspan class=\"nx\"\u003ebad\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ewill\u003c/span\u003e \u003cspan class=\"k\"\u003etry\u003c/span\u003e \u003cspan class=\"nx\"\u003eto\u003c/span\u003e \u003cspan class=\"nx\"\u003estop\u003c/span\u003e \u003cspan class=\"nx\"\u003eyou\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"nx\"\u003eseeing\u003c/span\u003e \u003cspan class=\"nx\"\u003emore\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eat\u003c/span\u003e \u003cspan class=\"nx\"\u003eflakyObserver\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003erx\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003ehelper\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003edemos\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003eexceptions\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003eagent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ejs\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e15\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e11\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"err\"\u003e➽\u003c/span\u003e \u003cspan class=\"nx\"\u003ePushing\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\n\u003cspan class=\"err\"\u003e📜\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eLog\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\n\u003cspan class=\"err\"\u003e➽\u003c/span\u003e \u003cspan class=\"nx\"\u003eDone\u003c/span\u003e \u003cspan class=\"nx\"\u003esync\u003c/span\u003e \u003cspan class=\"nx\"\u003epublishing\u003c/span\u003e\n\u003cspan class=\"err\"\u003e➽\u003c/span\u003e \u003cspan class=\"nx\"\u003ePushing\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\n\u003cspan class=\"err\"\u003e📜\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eLog\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\n\u003cspan class=\"err\"\u003e➽\u003c/span\u003e \u003cspan class=\"nx\"\u003eDone\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"nx\"\u003epublishing\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eOnce Flaky Observer 👀 fails, the system reports its error, and it is never heard from again. Sure, it's harsh, but it's the only way that's fair to other, well-behaved Observers. Given a choice, I don't want to build a system that is more coupled than this. Watch Ben talk about the production issue that led to RxJS6 Error handling, and you'll hear that isolation is key. I just don't think it goes far enough to save only the remaining synchronous notifications, while letting the asynchronous ones die.\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"a-new-order-of-pubsub-how-does-it-feel\" href=\"#a-new-order-of-pubsub-how-does-it-feel\"\u003e\n  \u003c/a\u003e\n  A New Order of PubSub - How does it feel?\n\u003c/h1\u003e\n\n\u003cp\u003eRxJS can still be used to build an abstraction layer that can provide reliability guarantees that you don't get with raw RxJS. The first two parts of this abstraction are Publishers and Handlers.\u003c/p\u003e\n\n\u003cp\u003ePublishers and Handlers follow these rules..\u003c/p\u003e\n\n\u003cp\u003eA publisher of events:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eRecieves synchronous errors for illegal events only, not for failures to process them\u003c/li\u003e\n\u003cli\u003eIs not interrupted synchronously or asynchronously by failures to process events\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eHandlers that receive a fail during processing and don't replace it with a proper event will:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eNot interfere with other handlers (or Publishers, see above)\u003c/li\u003e\n\u003cli\u003eBe shutdown, and not given further events (restarting them is an option)\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eA special type of Handler, called a Filter, plays by different rules, and is useful for the case of detecting illegal events - malformed, wrong data types, etc..\u003c/p\u003e\n\n\u003cp\u003eExceptions thrown from Filters:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eBecome exceptions in Publishers\u003c/li\u003e\n\u003cli\u003ePrevent any handler from running on that Event, but doesn't unsubscribe them\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"strike-it-up\" href=\"#strike-it-up\"\u003e\n  \u003c/a\u003e\n  Strike It Up!\n\u003c/h2\u003e\n\n\u003cp\u003eHere's how we'd look if we pointed the publish method to the \u003ccode\u003eagent\u003c/code\u003e of the \u003ccode\u003erx-helper\u003c/code\u003e library, after setting up Handlers with \u003ccode\u003eagent.on\u003c/code\u003e:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eagent\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003erx-helper\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eagent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eon\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sr\"\u003e/.*/\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003elogObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"nx\"\u003eagent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eon\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sr\"\u003e/.*/\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eflakyObserver\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003epublish\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eagent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etrigger\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003ean-event\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eUnlike the unconditional subscription of RxJS, \u003ccode\u003eagent.on\u003c/code\u003e takes an event pattern to match (remember JQuery??). The function is only invoked when an event's type matches this pattern - here we use a wildcard Regex, but Strings, booleans, and function predicates are also valid matchers. We'll skip descriptions of the 3rd argument and return value of \u003ccode\u003eon\u003c/code\u003e for now.\u003c/p\u003e\n\n\u003cp\u003eWe'll update the Observers just a tad, to work with Rx-Helper's arguments, and set them to listen:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003elogHandler\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e({\u003c/span\u003e \u003cspan class=\"na\"\u003epayload\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003ev\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`📜: Log \u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eflakyHandler\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e({\u003c/span\u003e \u003cspan class=\"na\"\u003epayload\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003ev\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`👀: Flaky \u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e 💥`\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ev\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nb\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eIm bad, will stop you from seeing more\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"nx\"\u003eagent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eon\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sr\"\u003e/.*/\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003elogHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"nx\"\u003eagent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eon\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sr\"\u003e/.*/\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eflakyHandler\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eNow we DO get the error-isolated output we sought!\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"err\"\u003e➽\u003c/span\u003e \u003cspan class=\"nx\"\u003ePushing\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\u003cspan class=\"err\"\u003e📜\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eLog\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\u003cspan class=\"err\"\u003e👀\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eFlaky\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"err\"\u003e💥\u003c/span\u003e\n\u003cspan class=\"nb\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eIm\u003c/span\u003e \u003cspan class=\"nx\"\u003ebad\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ewill\u003c/span\u003e \u003cspan class=\"k\"\u003etry\u003c/span\u003e \u003cspan class=\"nx\"\u003eto\u003c/span\u003e \u003cspan class=\"nx\"\u003estop\u003c/span\u003e \u003cspan class=\"nx\"\u003eyou\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"nx\"\u003eseeing\u003c/span\u003e \u003cspan class=\"nx\"\u003emore\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eat\u003c/span\u003e \u003cspan class=\"nx\"\u003eflakyHandler\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003erx\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003ehelper\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003edemos\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003eexceptions\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003eagent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ejs\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e15\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e11\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"err\"\u003e➽\u003c/span\u003e \u003cspan class=\"nx\"\u003ePushing\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\n\u003cspan class=\"err\"\u003e📜\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eLog\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\n\u003cspan class=\"err\"\u003e➽\u003c/span\u003e \u003cspan class=\"nx\"\u003eDone\u003c/span\u003e \u003cspan class=\"nx\"\u003esync\u003c/span\u003e \u003cspan class=\"nx\"\u003epublishing\u003c/span\u003e\n\u003cspan class=\"err\"\u003e➽\u003c/span\u003e \u003cspan class=\"nx\"\u003ePushing\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\n\u003cspan class=\"err\"\u003e📜\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eLog\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\n\u003cspan class=\"err\"\u003e➽\u003c/span\u003e \u003cspan class=\"nx\"\u003eDone\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"nx\"\u003epublishing\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eEven if we go to a 3rd and 4th event, and a filter is set to synchronously reject the 3rd event,\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003enot3Filter\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e({\u003c/span\u003e \u003cspan class=\"na\"\u003epayload\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003ev\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{(\u003c/span\u003e\u003cspan class=\"nx\"\u003ev\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nb\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eNot 3, I have Trypophobia!\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)}\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eagent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003efilter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003enot3Filter\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eAs long as the publisher catches and keeps going, we'll still log 4 - it'll just be like event 3 was filtered out of existence. Now that's a decent PubSub implementation.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"err\"\u003e➽\u003c/span\u003e \u003cspan class=\"nx\"\u003ePushing\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\u003cspan class=\"err\"\u003e📜\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eLog\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\u003cspan class=\"err\"\u003e👀\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eFlaky\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"err\"\u003e💥\u003c/span\u003e\n\u003cspan class=\"nx\"\u003eIm\u003c/span\u003e \u003cspan class=\"nx\"\u003ebad\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ewill\u003c/span\u003e \u003cspan class=\"nx\"\u003estop\u003c/span\u003e \u003cspan class=\"nx\"\u003eyou\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"nx\"\u003eseeing\u003c/span\u003e \u003cspan class=\"nx\"\u003emore\u003c/span\u003e \u003cspan class=\"nb\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eIm\u003c/span\u003e \u003cspan class=\"nx\"\u003ebad\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ewill\u003c/span\u003e \u003cspan class=\"nx\"\u003estop\u003c/span\u003e \u003cspan class=\"nx\"\u003eyou\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"nx\"\u003eseeing\u003c/span\u003e \u003cspan class=\"nx\"\u003emore\u003c/span\u003e\n\n\u003cspan class=\"err\"\u003e➽\u003c/span\u003e \u003cspan class=\"nx\"\u003ePushing\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\n\u003cspan class=\"err\"\u003e📜\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eLog\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\n\u003cspan class=\"err\"\u003e➽\u003c/span\u003e \u003cspan class=\"nx\"\u003eDone\u003c/span\u003e \u003cspan class=\"nx\"\u003esync\u003c/span\u003e \u003cspan class=\"nx\"\u003epublishing\u003c/span\u003e\n\u003cspan class=\"err\"\u003e➽\u003c/span\u003e \u003cspan class=\"nx\"\u003ePushing\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\n\u003cspan class=\"err\"\u003e💥\u003c/span\u003e\n\u003cspan class=\"err\"\u003e➽\u003c/span\u003e \u003cspan class=\"nx\"\u003ePushing\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\n\u003cspan class=\"err\"\u003e📜\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eLog\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\n\u003cspan class=\"err\"\u003e➽\u003c/span\u003e \u003cspan class=\"nx\"\u003eDone\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"nx\"\u003epublishing\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003ch2\u003e\n  \u003ca name=\"how-will-i-know\" href=\"#how-will-i-know\"\u003e\n  \u003c/a\u003e\n  How Will I Know?\n\u003c/h2\u003e\n\n\u003cp\u003eBut actually our publish function should do one more thing other than call trigger, it should set up asynchronous error handling on the \u003ccode\u003ecompleted\u003c/code\u003e property of the result.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003eagent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etrigger\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003ean-event\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003ecompleted\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003ecatch\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eFor the benefit of the publisher, errors from handlers are turned into rejected Promises, and the \u003ccode\u003ecompleted\u003c/code\u003e property is a \u003ccode\u003ePromise.all\u003c/code\u003e of all of them. If a single handler fails, we have access to it, but it doesn't block or prevent later code from running. If we didn't have the catch, our logs would be the more verbose version below, but we'd still be safer than the RxJS6 default behavior.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"err\"\u003e➽\u003c/span\u003e \u003cspan class=\"nx\"\u003ePushing\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\u003cspan class=\"err\"\u003e📜\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eLog\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\u003cspan class=\"err\"\u003e👀\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eFlaky\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"err\"\u003e💥\u003c/span\u003e\n\u003cspan class=\"nb\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eIm\u003c/span\u003e \u003cspan class=\"nx\"\u003ebad\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ewill\u003c/span\u003e \u003cspan class=\"nx\"\u003estop\u003c/span\u003e \u003cspan class=\"nx\"\u003eyou\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"nx\"\u003eseeing\u003c/span\u003e \u003cspan class=\"nx\"\u003emore\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eat\u003c/span\u003e \u003cspan class=\"nx\"\u003eflakyHandler\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sr\"\u003e/Users/\u003c/span\u003e\u003cspan class=\"nx\"\u003edradcliffe\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003esrc\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003edeanius\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003erx\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003ehelper\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003edemos\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\n\n\u003cspan class=\"err\"\u003e➽\u003c/span\u003e \u003cspan class=\"nx\"\u003ePushing\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\n\u003cspan class=\"err\"\u003e📜\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eLog\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\n\u003cspan class=\"err\"\u003e➽\u003c/span\u003e \u003cspan class=\"nx\"\u003eDone\u003c/span\u003e \u003cspan class=\"nx\"\u003esync\u003c/span\u003e \u003cspan class=\"nx\"\u003epublishing\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003enode\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e79649\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nx\"\u003eUnhandledPromiseRejectionWarning\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eIm\u003c/span\u003e \u003cspan class=\"nx\"\u003ebad\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ewill\u003c/span\u003e \u003cspan class=\"nx\"\u003estop\u003c/span\u003e \u003cspan class=\"nx\"\u003eyou\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"nx\"\u003eseeing\u003c/span\u003e \u003cspan class=\"nx\"\u003emore\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003eat\u003c/span\u003e \u003cspan class=\"nx\"\u003eflakyHandler\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sr\"\u003e/Users/\u003c/span\u003e\u003cspan class=\"nx\"\u003edradcliffe\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003esrc\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003edeanius\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003erx\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003ehelper\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003edemos\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003eexceptions\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003eagent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ejs\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e15\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e11\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003enode\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e79649\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nx\"\u003eUnhandledPromiseRejectionWarning\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eUnhandled\u003c/span\u003e \u003cspan class=\"nx\"\u003epromise\u003c/span\u003e \u003cspan class=\"nx\"\u003erejection\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\n       \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003erejection\u003c/span\u003e \u003cspan class=\"nx\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003enode\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e79649\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003eDEP0018\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"nx\"\u003eDeprecationWarning\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eUnhandled\u003c/span\u003e \u003cspan class=\"nx\"\u003epromise\u003c/span\u003e \u003cspan class=\"nx\"\u003erejections\u003c/span\u003e \u003cspan class=\"nx\"\u003eare\u003c/span\u003e \u003cspan class=\"nx\"\u003edeprecated\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\n       \u003cspan class=\"nx\"\u003eIn\u003c/span\u003e \u003cspan class=\"nx\"\u003ethe\u003c/span\u003e \u003cspan class=\"nx\"\u003efuture\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003epromise\u003c/span\u003e \u003cspan class=\"nx\"\u003erejections\u003c/span\u003e \u003cspan class=\"nx\"\u003ethat\u003c/span\u003e \u003cspan class=\"nx\"\u003eare\u003c/span\u003e \u003cspan class=\"nx\"\u003enot\u003c/span\u003e \u003cspan class=\"nx\"\u003ehandled\u003c/span\u003e \u003cspan class=\"nx\"\u003ewill\u003c/span\u003e \u003cspan class=\"nx\"\u003eterminate\u003c/span\u003e \u003cspan class=\"nx\"\u003ethe\u003c/span\u003e \u003cspan class=\"nx\"\u003eNode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ejs\u003c/span\u003e \u003cspan class=\"nx\"\u003eprocess\u003c/span\u003e \u003cspan class=\"kd\"\u003ewith\u003c/span\u003e \u003cspan class=\"nx\"\u003ea\u003c/span\u003e \u003cspan class=\"nx\"\u003enon\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003ezero\u003c/span\u003e \u003cspan class=\"nx\"\u003eexit\u003c/span\u003e \u003cspan class=\"nx\"\u003ecode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\n\u003cspan class=\"err\"\u003e➽\u003c/span\u003e \u003cspan class=\"nx\"\u003ePushing\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\n\u003cspan class=\"err\"\u003e📜\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eLog\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\n\u003cspan class=\"err\"\u003e➽\u003c/span\u003e \u003cspan class=\"nx\"\u003eDone\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"nx\"\u003epublishing\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003ch2\u003e\n  \u003ca name=\"err-of-our-ways\" href=\"#err-of-our-ways\"\u003e\n  \u003c/a\u003e\n  Err Of Our Ways\n\u003c/h2\u003e\n\n\u003cp\u003eSo there we have it- RxJS error handling can be Hard to Handle, but with a little wrapper library like Rx-Helper over it we have a PubSub implementation that can be as robust as external job boxes. Well, up to the point of JavaScript being single-threaded. \u003c/p\u003e\n\n\u003cp\u003eThat's all for the theory of it, read other articles in the \u003ca href=\"https://github.com/deanius/rx-helper\"\u003eRx-Helper GitHub\u003c/a\u003e for all the cool things you can build with it.\u003c/p\u003e\n\n\u003cp\u003e—Dean\u003c/p\u003e\n\n","published":false,"published_from_feed":false,"show_comments":true,"slug":"error-handling-in-rxjs-building-an-rxjs-pubsub-3lik","social_image":null,"title":"Error Handling in RxJS — Building an RxJS PubSub","video":null,"video_code":null},{"created_at":"2019-10-08T02:40:56.344Z","crossposted_at":null,"edited_at":null,"last_comment_at":"2019-10-10T21:01:01.285Z","published_at":"2019-10-08T02:40:56.329Z","canonical_url":null,"feed_source_url":null,"video_closed_caption_track_url":null,"video_source_url":null,"video_thumbnail_url":null,"body_markdown":"---\ntitle: What I've Learned Contributing to Open Source Software (OSS)\npublished: true\ndescription: If you're trying to get an idea of what contributing to Open Source might be like for you..\ntags: oss, first pr, pull request, github\n---\n\n![](https://images.unsplash.com/photo-1531206715517-5c0ba140b2b8?ixlib=rb-1.2.1\u0026ixid=eyJhcHBfaWQiOjEyMDd9\u0026auto=format\u0026fit=crop\u0026w=2100\u0026q=80)\n\nIt was the Ruby community that first got me excited about Open Source. Ruby was free and open, Matz was a likable and intelligent role model, and it wasn't too long before I wondered if I could give back to the community like Matz, Wayne Seguin, Aaron Patterson, and others. \n\nToday I have a much more realistic view of the enterprise of free software than I've had before. And the biggest lesson I can share is probably as true of your job as much as in Open Source:\n\n\u003e Your Contribution is not limited to your Code.\n\nSo now that you have the TL;DR, the tweetable phrase, let me share the my Open Source attempts that I learned the most from. If you're trying to get an idea of what it might be like for you, check out a guide like [First Timers Only](https://www.firsttimersonly.com), or read on.\n\n## 2012 - Ruby - Chronic \n\nAs I played with new Ruby libraries, I would often find something they didn't do that seemed natural to me, but they didn't handle. Chronic, the library that turns DateTime values like `-0.1250` into the text \"3 hours ago\" was surpemely useful, but the first thing I tried did not work. Maybe not everyone wanted \"quarter till one\" to parse into 0.55, but I did! _\"Could this be my first PR?\"_, I thought.\n\nMy PR was accepted on its first attempt. How did I do it? I looked for issues matching mine first, before writing code. I found other PRs that were like mine, and copied them. I added code, tests, and docs to match other PRs. It was a quick turn around. \n\nIt was a small change, but it felt exhilarating to know thousands of users would get this code. It made the whole community feel less distant. It was small, but that was enough—it was only the beginning.\n\n__Lesson:__ Stay within the project style. No change is too small if it's done well.  [Link to Commit](https://github.com/mojombo/chronic/commit/c3b311cf68c2b0642121b2fefffbf357abef014d)\n\n\n## 2012 - Scheme - Lilypond\n\nLilypond is a music software, written in Scheme, and a custom markup language, that can turn plain text into MIDI, staff notation and chord charts. Music is like a second language to me, and particularly music that swings, like blues and jazz. But Lilypond lacked a feature to take uniformly spaced notes like `1 \u0026 2 \u0026 3 4 \u0026` and play them with a shuffle like `1  \u00262  \u00263 \u00264  \u0026`. \n\nI had never written Scheme, and it was __hard__ to do so! But I tried and tried, until I had something that kinda worked—for my limited use case. But in the time that I was struggling, people took my use case, and wanted to expand it. \"But Brazilian samba\", \"But the Viennese Waltz\" the comments poured in. How could I code all those variations when I could barely transform 50% to 66% in a language with so many parentheses?! \n\nAt first I was disappointed that my code got relegated to a user-downloadable plugin, and not part of Lilypond core. But I was mistaken not to see what happened. People piled their expertise and ideas into a feature _I_ wanted, to make it far better than I could have expected. My name is still mentioned in the comment threads, though none of my amateurish Scheme code made the cut.\n\n__Lesson:__ Starting a discussion is often enough. If someone else can take your idea and run with it (and do it better), be glad! You can learn alot for the price of your ego. [Link to thread](http://git.savannah.gnu.org/gitweb/?p=lilypond.git;a=commit;h=464cf0d8111976c63fe778f358ddbe28bce532a8)\n\n\n## 2016 - JavaScript - Scripty\n\nWell into the JavaScript renaissance, the fabulous Justin Searls came up with a solution to ugly, long scripts appearing in `package.json` files, called Scripty. Only one problem: arguments passed after a double-dash did not make it to the script that Scripty referred to. `npm run scripty -- -addArg1` didn't work.\n\nI flipped open my shiny new MacBook pro (the last one with a good keyboard!) and banged out a solution and submitted a PR. It was backward compatible. It was elegant. It... didn't work on Windows.\n\nMy change did not hurt Windows users - it just didn't extend the new benefits to them. So we went back and forth about it, but ultimately I didn't see a benefit to me in doing the work to embrace Windows users. As a maintainer, though, Justin did not want to leave anyone behind. 4 commits of his later, it was fixed and merged for Windows. I learned about AppVeyor, a CI tool to run on Windows from his solution.\n\n__Lesson:__ Maintainers have to meet the needs of a broader audience than you might imagine. You can learn from them if you can hang in there, but everyone has to decide where their involvement is good enough. [Link to Issue](https://github.com/testdouble/scripty/issues/6)\n\n## 2019 - Ruby - Overcommit\n\nI'd been in the land of NPM and Husky commit hooks for so long, I didn't know Ruby had Overcommit. Until I was commiting my JavaScript code into a mono-repo that was mainly Ruby. Imagine my shock and horror when I saw that the commit hooks _edited your files_ 😱😱. This was a minor nuisance at first, but at one point I lost work. And this happened to a coworker too. Something had to be done.\n\nLike before I started with the intent to write the code to fix it. I had patience. I opened the issue. I floated an idea for an implementation. I knew Ruby wasn't my strong suit anymore, but I refused to get stuck. And I got really great guidance. Ultimately though, I just couldn't keep up. But not 2 weeks after the idea crystallized and was validated, a new release made it so my files (and my coworkers') would not be touched in the vast majority of circumstances. I updated our shared repos gems with a smile just this morning :)\n\n[Link to Pull Request](https://github.com/sds/overcommit/issues/669)\n\n__Lesson:__ Maintainers will help you if you're inquisitive and show a willingness to implement their ideas. But if you can't keep up, don't take it personally if they close the issue, or go and implement it without you.\n\n---\n\nI don't believe it's right for everybody at every time to contribute to Open Source. But there's a feeling that comes from doing it that is horizon-broadening. And if you're looking to affect people positively, it's certainly one channel. I hope the stories above give you a taste of what can happen. None of it was very bad, thankfully. Just remember, read what you can - the Code of Conduct, the Contributor's guide, the README, LICENSE, issues and PRs, and try to be patient. Many maintainers will help you. The world needs your input - if you've got the time, then what have you got to lose?!\n\n---\n\nHonorable mentions for most learning:\n\n[2015 - MeteorJS](https://github.com/meteor/meteor/pull/4710) - This was the largest OSS project to have accepted a contribution of mine. I learned the value of patience. Also, I did work on an issue that was already being championed by other people. I just put up an acceptable implementation. Other original ideas I put up ([here](https://github.com/meteor/meteor/issues/4891) and [here](https://github.com/meteor/meteor/issues/3776)) were not accepted. \n\n[2015 - deanius:promise](https://atmospherejs.com/deanius/promise) - This package earned the most downloads/installs of any package I authored. I learned how much time it can take to build and promote a package. It was helpful to a lot of people, however, and as I gave talks on it, its help to my career and understanding of async and Promises was invaluable.\n\n\n\n","cached_tag_list":"opensource, firstpr, pullrequest, github","cached_user_name":"Dean Radcliffe","cached_user_username":"deanius","comments_count":1,"description":"If you're trying to get an idea of what contributing to Open Source might be like for you..","main_image":null,"main_image_background_hex_color":"#dddddd","path":"/deanius/what-i-ve-learned-contributing-to-open-source-software-oss-47hp","public_reactions_count":5,"processed_html":"\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--6UPgMesN--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://images.unsplash.com/photo-1531206715517-5c0ba140b2b8%3Fixlib%3Drb-1.2.1%26ixid%3DeyJhcHBfaWQiOjEyMDd9%26auto%3Dformat%26fit%3Dcrop%26w%3D2100%26q%3D80\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--6UPgMesN--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://images.unsplash.com/photo-1531206715517-5c0ba140b2b8%3Fixlib%3Drb-1.2.1%26ixid%3DeyJhcHBfaWQiOjEyMDd9%26auto%3Dformat%26fit%3Dcrop%26w%3D2100%26q%3D80\" alt=\"\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eIt was the Ruby community that first got me excited about Open Source. Ruby was free and open, Matz was a likable and intelligent role model, and it wasn't too long before I wondered if I could give back to the community like Matz, Wayne Seguin, Aaron Patterson, and others. \u003c/p\u003e\n\n\u003cp\u003eToday I have a much more realistic view of the enterprise of free software than I've had before. And the biggest lesson I can share is probably as true of your job as much as in Open Source:\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eYour Contribution is not limited to your Code.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eSo now that you have the TL;DR, the tweetable phrase, let me share the my Open Source attempts that I learned the most from. If you're trying to get an idea of what it might be like for you, check out a guide like \u003ca href=\"https://www.firsttimersonly.com\"\u003eFirst Timers Only\u003c/a\u003e, or read on.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"2012-ruby-chronic\" href=\"#2012-ruby-chronic\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  2012 - Ruby - Chronic\n\u003c/h2\u003e\n\n\u003cp\u003eAs I played with new Ruby libraries, I would often find something they didn't do that seemed natural to me, but they didn't handle. Chronic, the library that turns DateTime values like \u003ccode\u003e-0.1250\u003c/code\u003e into the text \"3 hours ago\" was surpemely useful, but the first thing I tried did not work. Maybe not everyone wanted \"quarter till one\" to parse into 0.55, but I did! \u003cem\u003e\"Could this be my first PR?\"\u003c/em\u003e, I thought.\u003c/p\u003e\n\n\u003cp\u003eMy PR was accepted on its first attempt. How did I do it? I looked for issues matching mine first, before writing code. I found other PRs that were like mine, and copied them. I added code, tests, and docs to match other PRs. It was a quick turn around. \u003c/p\u003e\n\n\u003cp\u003eIt was a small change, but it felt exhilarating to know thousands of users would get this code. It made the whole community feel less distant. It was small, but that was enough—it was only the beginning.\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eLesson:\u003c/strong\u003e Stay within the project style. No change is too small if it's done well.  \u003ca href=\"https://github.com/mojombo/chronic/commit/c3b311cf68c2b0642121b2fefffbf357abef014d\"\u003eLink to Commit\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"2012-scheme-lilypond\" href=\"#2012-scheme-lilypond\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  2012 - Scheme - Lilypond\n\u003c/h2\u003e\n\n\u003cp\u003eLilypond is a music software, written in Scheme, and a custom markup language, that can turn plain text into MIDI, staff notation and chord charts. Music is like a second language to me, and particularly music that swings, like blues and jazz. But Lilypond lacked a feature to take uniformly spaced notes like \u003ccode\u003e1 \u0026amp; 2 \u0026amp; 3 4 \u0026amp;\u003c/code\u003e and play them with a shuffle like \u003ccode\u003e1  \u0026amp;2  \u0026amp;3 \u0026amp;4  \u0026amp;\u003c/code\u003e. \u003c/p\u003e\n\n\u003cp\u003eI had never written Scheme, and it was \u003cstrong\u003ehard\u003c/strong\u003e to do so! But I tried and tried, until I had something that kinda worked—for my limited use case. But in the time that I was struggling, people took my use case, and wanted to expand it. \"But Brazilian samba\", \"But the Viennese Waltz\" the comments poured in. How could I code all those variations when I could barely transform 50% to 66% in a language with so many parentheses?! \u003c/p\u003e\n\n\u003cp\u003eAt first I was disappointed that my code got relegated to a user-downloadable plugin, and not part of Lilypond core. But I was mistaken not to see what happened. People piled their expertise and ideas into a feature \u003cem\u003eI\u003c/em\u003e wanted, to make it far better than I could have expected. My name is still mentioned in the comment threads, though none of my amateurish Scheme code made the cut.\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eLesson:\u003c/strong\u003e Starting a discussion is often enough. If someone else can take your idea and run with it (and do it better), be glad! You can learn alot for the price of your ego. \u003ca href=\"http://git.savannah.gnu.org/gitweb/?p=lilypond.git;a=commit;h=464cf0d8111976c63fe778f358ddbe28bce532a8\"\u003eLink to thread\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"2016-javascript-scripty\" href=\"#2016-javascript-scripty\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  2016 - JavaScript - Scripty\n\u003c/h2\u003e\n\n\u003cp\u003eWell into the JavaScript renaissance, the fabulous Justin Searls came up with a solution to ugly, long scripts appearing in \u003ccode\u003epackage.json\u003c/code\u003e files, called Scripty. Only one problem: arguments passed after a double-dash did not make it to the script that Scripty referred to. \u003ccode\u003enpm run scripty -- -addArg1\u003c/code\u003e didn't work.\u003c/p\u003e\n\n\u003cp\u003eI flipped open my shiny new MacBook pro (the last one with a good keyboard!) and banged out a solution and submitted a PR. It was backward compatible. It was elegant. It... didn't work on Windows.\u003c/p\u003e\n\n\u003cp\u003eMy change did not hurt Windows users - it just didn't extend the new benefits to them. So we went back and forth about it, but ultimately I didn't see a benefit to me in doing the work to embrace Windows users. As a maintainer, though, Justin did not want to leave anyone behind. 4 commits of his later, it was fixed and merged for Windows. I learned about AppVeyor, a CI tool to run on Windows from his solution.\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eLesson:\u003c/strong\u003e Maintainers have to meet the needs of a broader audience than you might imagine. You can learn from them if you can hang in there, but everyone has to decide where their involvement is good enough. \u003ca href=\"https://github.com/testdouble/scripty/issues/6\"\u003eLink to Issue\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"2019-ruby-overcommit\" href=\"#2019-ruby-overcommit\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  2019 - Ruby - Overcommit\n\u003c/h2\u003e\n\n\u003cp\u003eI'd been in the land of NPM and Husky commit hooks for so long, I didn't know Ruby had Overcommit. Until I was commiting my JavaScript code into a mono-repo that was mainly Ruby. Imagine my shock and horror when I saw that the commit hooks \u003cem\u003eedited your files\u003c/em\u003e 😱😱. This was a minor nuisance at first, but at one point I lost work. And this happened to a coworker too. Something had to be done.\u003c/p\u003e\n\n\u003cp\u003eLike before I started with the intent to write the code to fix it. I had patience. I opened the issue. I floated an idea for an implementation. I knew Ruby wasn't my strong suit anymore, but I refused to get stuck. And I got really great guidance. Ultimately though, I just couldn't keep up. But not 2 weeks after the idea crystallized and was validated, a new release made it so my files (and my coworkers') would not be touched in the vast majority of circumstances. I updated our shared repos gems with a smile just this morning :)\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/sds/overcommit/issues/669\"\u003eLink to Pull Request\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eLesson:\u003c/strong\u003e Maintainers will help you if you're inquisitive and show a willingness to implement their ideas. But if you can't keep up, don't take it personally if they close the issue, or go and implement it without you.\u003c/p\u003e\n\n\n\u003chr\u003e\n\n\u003cp\u003eI don't believe it's right for everybody at every time to contribute to Open Source. But there's a feeling that comes from doing it that is horizon-broadening. And if you're looking to affect people positively, it's certainly one channel. I hope the stories above give you a taste of what can happen. None of it was very bad, thankfully. Just remember, read what you can - the Code of Conduct, the Contributor's guide, the README, LICENSE, issues and PRs, and try to be patient. Many maintainers will help you. The world needs your input - if you've got the time, then what have you got to lose?!\u003c/p\u003e\n\n\n\u003chr\u003e\n\n\u003cp\u003eHonorable mentions for most learning:\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/meteor/meteor/pull/4710\"\u003e2015 - MeteorJS\u003c/a\u003e - This was the largest OSS project to have accepted a contribution of mine. I learned the value of patience. Also, I did work on an issue that was already being championed by other people. I just put up an acceptable implementation. Other original ideas I put up (\u003ca href=\"https://github.com/meteor/meteor/issues/4891\"\u003ehere\u003c/a\u003e and \u003ca href=\"https://github.com/meteor/meteor/issues/3776\"\u003ehere\u003c/a\u003e) were not accepted. \u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://atmospherejs.com/deanius/promise\"\u003e2015 - deanius:promise\u003c/a\u003e - This package earned the most downloads/installs of any package I authored. I learned how much time it can take to build and promote a package. It was helpful to a lot of people, however, and as I gave talks on it, its help to my career and understanding of async and Promises was invaluable.\u003c/p\u003e\n\n","published":true,"published_from_feed":false,"show_comments":true,"slug":"what-i-ve-learned-contributing-to-open-source-software-oss-47hp","social_image":null,"title":"What I've Learned Contributing to Open Source Software (OSS)","video":null,"video_code":null},{"created_at":"2019-10-28T22:25:13.158Z","crossposted_at":null,"edited_at":"2022-11-02T16:14:59.666Z","last_comment_at":"2019-10-28T22:25:13.143Z","published_at":"2019-10-28T22:25:13.143Z","canonical_url":null,"feed_source_url":null,"video_closed_caption_track_url":null,"video_source_url":null,"video_thumbnail_url":null,"body_markdown":"---\ntitle: ToggleMap, I've Missed You\npublished: true\ndescription: \ntags: rxjs, rxfx, javascript, async\n---\n\n\nI have a question for you about a simple device I'm sure you think you already understand - the TV (or Hulu) remote control: \n\n\u003e What should a remote control do when you press Channel Down _*while*_ it's changing? \n\nMost people believe one of these outcomes should happen:\n\n- _Change down 2 channels_ - Because: You clicked Channel Down twice, two channels should be advanced; the effect is cumulative.\n- _Change down 1 channel_ - Because: There can only be one 'Channel Down' in progress at once, and you should arrive at the first channel before additional 'Channel Down' events should be recognized.\n- _Cancel the channel change_ - Because: It was taking too long, so stop the spinner and let me watch what I was watching.\n\nThe question is - would you know exactly what code to write to implement your preferred choice of mode? And if you were required to switch modes - how big a change would that be to your code? And how would you explain \n\n## A Problem of Shared Vocabulary\n\nIt turns out there are a total of 5 possible modes that can govern this behavior, and currently no library accommodates, or names them all. \n\n- '2 channel' mode is **queueing**; the reason being that each channel-change is processed one after the other.\n- '1 channel' mode is **blocking** - the new channel change is blocked, because one was already in progress.\n- 'Cancel the channel change' mode is **toggling** - there is no other button to cancel, so the same button is used to cancel.\n\nI looked at the RxJS library to find if there were other modes. RxJS has functions called operators, which in fact deal exactly with how to combine effects when they would overlap. And **queueing** and **blocking** correspond to two operators called `concatMap` and `exhaustMap` in RxJS. In fact RxJS has two more operators, `mergeMap`, and `switchMap`, which we can call **immediate** and **replacing**. \n\n## Finding the Lost Operator\n\nI discovered the **toggling** mode when I sat looking at my son's favorite Halloween toy, asking it if these 4 operators covered the way it behaved.\n\n![Childrens toy in toggle mode](http://www.deanius.com/spooky-guy.png)\n\nIt's a goofy little noise making thing with a single button. You press the button, and it makes a spooky noise and its eyes glow.\n\nThat's when I wondered - what happens if I hit that button _while_ it's playing the spooky music!\n\nWant to see for yourself? Check it out [on YouTube](https://www.youtube.com/watch?v=MW1-o8x0vGI)\n\nIn short, the current channel change could be canceled if the remote operated in \"toggling\" mode. My car's auto-closing trunk behaves in this way.\n\n## toggleMap\n\nIf you cancel an already-executing effect but don't start another unless no effect was running, you are **toggling**. You can implement this by passing `toggleMap` from `@rxfx/operators` into an RxJS pipe, or by using a bus or service from the [𝗥𝘅𝑓𝑥](https://github.com/deanrad/rxfx)\n\n## Examples!\n\nWith 𝗥𝘅𝑓𝑥, it is easy to declaratively choose a mode. One of them will surely fit your use case. \n\n## Tell Me What You Think!\n\nThis post is just meant to give you the concepts - the CodeSandbox has the goods you'll need to actually put it to work.\n\n## Bring Clarity to Async\n\nWhile we seem to take it as fact that _Async Is Hard_, perhaps the problem is that we haven't sufficiently built tools to handle the most common cases with ease. Most async cases I've seen in the wild are handleable via the 3 parameters, and 5 modes listed above. \n\nImmediate, queueing, replacing, blocking, and toggling. Start using these terms and you'll find you'll find your toolbox for async has never felt fuller.\n\n\u003e Dean\n","cached_tag_list":"rxjs, rxfx, javascript, async","cached_user_name":"Dean Radcliffe","cached_user_username":"deanius","comments_count":0,"description":"I have a question for you about a simple device I'm sure you think you already understand - the TV...","main_image":null,"main_image_background_hex_color":"#dddddd","path":"/deanius/declarative-concurrency-with-rx-helper-and-rxjs-30ai","public_reactions_count":7,"processed_html":"\u003cp\u003eI have a question for you about a simple device I'm sure you think you already understand - the TV (or Hulu) remote control: \u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eWhat should a remote control do when you press Channel Down \u003cem\u003e\u003cem\u003ewhile\u003c/em\u003e\u003c/em\u003e it's changing? \u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eMost people believe one of these outcomes should happen:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003cem\u003eChange down 2 channels\u003c/em\u003e - Because: You clicked Channel Down twice, two channels should be advanced; the effect is cumulative.\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003eChange down 1 channel\u003c/em\u003e - Because: There can only be one 'Channel Down' in progress at once, and you should arrive at the first channel before additional 'Channel Down' events should be recognized.\u003c/li\u003e\n\u003cli\u003e\n\u003cem\u003eCancel the channel change\u003c/em\u003e - Because: It was taking too long, so stop the spinner and let me watch what I was watching.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eThe question is - would you know exactly what code to write to implement your preferred choice of mode? And if you were required to switch modes - how big a change would that be to your code? And how would you explain \u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"a-problem-of-shared-vocabulary\" href=\"#a-problem-of-shared-vocabulary\"\u003e\n  \u003c/a\u003e\n  A Problem of Shared Vocabulary\n\u003c/h2\u003e\n\n\u003cp\u003eIt turns out there are a total of 5 possible modes that can govern this behavior, and currently no library accommodates, or names them all. \u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e'2 channel' mode is \u003cstrong\u003equeueing\u003c/strong\u003e; the reason being that each channel-change is processed one after the other.\u003c/li\u003e\n\u003cli\u003e'1 channel' mode is \u003cstrong\u003eblocking\u003c/strong\u003e - the new channel change is blocked, because one was already in progress.\u003c/li\u003e\n\u003cli\u003e'Cancel the channel change' mode is \u003cstrong\u003etoggling\u003c/strong\u003e - there is no other button to cancel, so the same button is used to cancel.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eI looked at the RxJS library to find if there were other modes. RxJS has functions called operators, which in fact deal exactly with how to combine effects when they would overlap. And \u003cstrong\u003equeueing\u003c/strong\u003e and \u003cstrong\u003eblocking\u003c/strong\u003e correspond to two operators called \u003ccode\u003econcatMap\u003c/code\u003e and \u003ccode\u003eexhaustMap\u003c/code\u003e in RxJS. In fact RxJS has two more operators, \u003ccode\u003emergeMap\u003c/code\u003e, and \u003ccode\u003eswitchMap\u003c/code\u003e, which we can call \u003cstrong\u003eimmediate\u003c/strong\u003e and \u003cstrong\u003ereplacing\u003c/strong\u003e. \u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"finding-the-lost-operator\" href=\"#finding-the-lost-operator\"\u003e\n  \u003c/a\u003e\n  Finding the Lost Operator\n\u003c/h2\u003e\n\n\u003cp\u003eI discovered the \u003cstrong\u003etoggling\u003c/strong\u003e mode when I sat looking at my son's favorite Halloween toy, asking it if these 4 operators covered the way it behaved.\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/http%3A%2F%2Fwww.deanius.com%2Fspooky-guy.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/http%3A%2F%2Fwww.deanius.com%2Fspooky-guy.png\" alt=\"Childrens toy in toggle mode\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eIt's a goofy little noise making thing with a single button. You press the button, and it makes a spooky noise and its eyes glow.\u003c/p\u003e\n\n\u003cp\u003eThat's when I wondered - what happens if I hit that button \u003cem\u003ewhile\u003c/em\u003e it's playing the spooky music!\u003c/p\u003e\n\n\u003cp\u003eWant to see for yourself? Check it out \u003ca href=\"https://www.youtube.com/watch?v=MW1-o8x0vGI\" target=\"_blank\" rel=\"noopener noreferrer\"\u003eon YouTube\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eIn short, the current channel change could be canceled if the remote operated in \"toggling\" mode. My car's auto-closing trunk behaves in this way.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"togglemap\" href=\"#togglemap\"\u003e\n  \u003c/a\u003e\n  toggleMap\n\u003c/h2\u003e\n\n\u003cp\u003eIf you cancel an already-executing effect but don't start another unless no effect was running, you are \u003cstrong\u003etoggling\u003c/strong\u003e. You can implement this by passing \u003ccode\u003etoggleMap\u003c/code\u003e from \u003ccode\u003e@rxfx/operators\u003c/code\u003e into an RxJS pipe, or by using a bus or service from the \u003ca href=\"https://github.com/deanrad/rxfx\" target=\"_blank\" rel=\"noopener noreferrer\"\u003e𝗥𝘅𝑓𝑥\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"examples\" href=\"#examples\"\u003e\n  \u003c/a\u003e\n  Examples!\n\u003c/h2\u003e\n\n\u003cp\u003eWith 𝗥𝘅𝑓𝑥, it is easy to declaratively choose a mode. One of them will surely fit your use case. \u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"tell-me-what-you-think\" href=\"#tell-me-what-you-think\"\u003e\n  \u003c/a\u003e\n  Tell Me What You Think!\n\u003c/h2\u003e\n\n\u003cp\u003eThis post is just meant to give you the concepts - the CodeSandbox has the goods you'll need to actually put it to work.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"bring-clarity-to-async\" href=\"#bring-clarity-to-async\"\u003e\n  \u003c/a\u003e\n  Bring Clarity to Async\n\u003c/h2\u003e\n\n\u003cp\u003eWhile we seem to take it as fact that \u003cem\u003eAsync Is Hard\u003c/em\u003e, perhaps the problem is that we haven't sufficiently built tools to handle the most common cases with ease. Most async cases I've seen in the wild are handleable via the 3 parameters, and 5 modes listed above. \u003c/p\u003e\n\n\u003cp\u003eImmediate, queueing, replacing, blocking, and toggling. Start using these terms and you'll find you'll find your toolbox for async has never felt fuller.\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eDean\u003c/p\u003e\n\u003c/blockquote\u003e\n\n","published":true,"published_from_feed":false,"show_comments":true,"slug":"declarative-concurrency-with-rx-helper-and-rxjs-30ai","social_image":null,"title":"ToggleMap, I've Missed You","video":null,"video_code":null},{"created_at":"2019-11-08T15:43:13.523Z","crossposted_at":null,"edited_at":"2019-11-08T22:34:56.443Z","last_comment_at":"2019-11-13T17:48:37.299Z","published_at":"2019-11-08T22:33:04.154Z","canonical_url":null,"feed_source_url":null,"video_closed_caption_track_url":null,"video_source_url":null,"video_thumbnail_url":null,"body_markdown":"---\ntitle: The 5 Possible Concurrency Modes of JavaScript\npublished: true\ndescription: Simplifying async JavaScript with Combinatorics\ntags: rxjs async\n---\n\nAsync is hard, they say. But that's only true if you don't have a complete set of tools for dealing with it. The 5 concurrency strategies: `parallel`, `serial`, `cutoff`, `mute` and `toggle` are all of the 5 fundamental ways you can do concurrency in JS, and they can all be easily understood if you personify them. Let's learn the theory, and in another post I'll go over how to apply it.\n\n---\n\nWe all know somebody who's insanely productive. If you want it done - you ask them. People like this always have multiple things going on at once. But any time a new thing comes in, there are basically 5 ways they can respond. What do you think the most productive people do - start everything the moment it comes in? Like everything- it depends. But let's understand the relative strengths of each strategy in isolation, so we can make better choices.\n\n# The Characters and their Styles \n\nBruce Banner - Bruce Banner (aka the Hulk) is a person whose focus is extremely fragile. If he's doing something, and you interrupt him to ask him to do another thing, you're likely to have thrown him off for the rest of the day. And maybe he's thrown you off (a roof) as well. To work well with Bruce, you'd better know better than to interrupt him.\n\nSuperman - Superman might be in the middle of rescuing a bus of kids going over a waterfall, and notice an old lady about to slip on the ice - he'll carry the bus over to the old lady and save her too! He's not about to let anything slip, nor interrupt a rescue to start another one. If we all could be like Superman - but alas, we're not.\n\nThor - If Thor is busy doing something, and you ask him to do another thing, it's not that he's ignoring you - he just doesn't hear you! His mind doesn't work that way - it's pretty inherently Single Track.\n\nWonder Woman - Wonder Woman was once fighting off an invasion from another planet, when her cellphone (from her cover life as a museum curator) got a text that a new artifact was available for her to pick up and catalog. No sweat- she just continued to drive the aliens away, and vowed to get to the catalog-ing work once she'd finished and changed back into her civilian clothes.\n\nIron Man - Tony Stark is driven by novelty. He's so into chasing the next big thing that if he was working on a rocket for Mars, and you mentioned how long it took for you to get between two cities, he'd start working on as HyperLoop right away.\n\n\n# The Character's Styles Decoded\n\nNow, as fun as those descriptions are, they correspond to the 5 primary concurrency strategies you can implement in JavaScript.\n\nSuperman is the `parallel` mode - Work starts ASAP, continues in parallel with other jobs, and assumes (and requires) a pretty unbounded set of system resources.  (RxJS' mergeMap)\n\nWonder Woman is the `serial` mode - Work will get done just as soon as the current work is done. A queue is needed to hold the next tasks, and only 1 job is in progress at any given time. (RxJS' concatMap)\n\nIron Man/Stark is the `cutoff` mode - Work that is interesting replaces existing work. Still, only 1 job is in progress at any given time. (RxJS' switchMap)\n\nThor is the `mute` mode - The sound of incoming work is `mute`d to him while he's busy. Of course, only 1 job is in progress at any given time. (RxJS' exhaustMap)\n\nHulk is the `toggle` mode - New requests toggle other requests off. At most 1 job is in progress at any given time. (RxHelper's toggleMap)\n\n# Choosing a Mode in Code\n\nHere are some typical web development Patterns where one or the other of these modes works best:\n\n* An Autocompleter like Google Search - Here you want a `cutoff` strategy when it comes to fetching results. New searches should cut off previous searches to keep the system working on the most latest search. \n\n* Like Buttons- These probably should be processed in `parallel`, as long as the system can handle multiple connections, or pipeline them under the covers.\n\n* A Downloader - It makes sense to download files one after the other in queued `serial` mode, like adding songs to a Jukebox's playlist.\n\n* A Form Submit - It may make sense to prevent a double form submission with a `mute` strategy for clicks after the first.\n\n* A Light Switch - A light switch, rather than keeping track of its own state in a field outside its button-event stream, can just apply the `turnOn` function in `toggle` mode. \n\n# Enabling Flexibility\n\nReturning objects in code which represent cancelable, unstarted processes is the key to enabling this. This is why a system that allows for plugging in these strategies must be based on Observables. Only Observables, not Promises, are cancelable (for `cutoff` and `toggle`), and unstarted (for `serial`).\n\n\n# Play with it\n\nThere are several [Code Sandboxes for the Rx-Helper library](https://codesandbox.io/search?query=\u0026page=1\u0026configure%5BhitsPerPage%5D=12\u0026refinementList%5Bnpm_dependencies.dependency%5D%5B0%5D=rx-helper) which illustrate these and other patterns that are possible with it.\n\nLet me know if this helps clear things up! In a future post- the proof that these 5 modes are a complete set of tools for solving problems up the first 3 orders of difficulty, and that more complicated solutions are simply recombinations of these basic elements.","cached_tag_list":"rxjsasync","cached_user_name":"Dean Radcliffe","cached_user_username":"deanius","comments_count":1,"description":"Simplifying async JavaScript with Combinatorics","main_image":null,"main_image_background_hex_color":"#dddddd","path":"/deanius/the-5-possible-concurrency-modes-of-javascript-3238","public_reactions_count":6,"processed_html":"\u003cp\u003eAsync is hard, they say. But that's only true if you don't have a complete set of tools for dealing with it. The 5 concurrency strategies: \u003ccode\u003eparallel\u003c/code\u003e, \u003ccode\u003eserial\u003c/code\u003e, \u003ccode\u003ecutoff\u003c/code\u003e, \u003ccode\u003emute\u003c/code\u003e and \u003ccode\u003etoggle\u003c/code\u003e are all of the 5 fundamental ways you can do concurrency in JS, and they can all be easily understood if you personify them. Let's learn the theory, and in another post I'll go over how to apply it.\u003c/p\u003e\n\n\n\u003chr\u003e\n\n\u003cp\u003eWe all know somebody who's insanely productive. If you want it done - you ask them. People like this always have multiple things going on at once. But any time a new thing comes in, there are basically 5 ways they can respond. What do you think the most productive people do - start everything the moment it comes in? Like everything- it depends. But let's understand the relative strengths of each strategy in isolation, so we can make better choices.\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"the-characters-and-their-styles\" href=\"#the-characters-and-their-styles\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  The Characters and their Styles\n\u003c/h1\u003e\n\n\u003cp\u003eBruce Banner - Bruce Banner (aka the Hulk) is a person whose focus is extremely fragile. If he's doing something, and you interrupt him to ask him to do another thing, you're likely to have thrown him off for the rest of the day. And maybe he's thrown you off (a roof) as well. To work well with Bruce, you'd better know better than to interrupt him.\u003c/p\u003e\n\n\u003cp\u003eSuperman - Superman might be in the middle of rescuing a bus of kids going over a waterfall, and notice an old lady about to slip on the ice - he'll carry the bus over to the old lady and save her too! He's not about to let anything slip, nor interrupt a rescue to start another one. If we all could be like Superman - but alas, we're not.\u003c/p\u003e\n\n\u003cp\u003eThor - If Thor is busy doing something, and you ask him to do another thing, it's not that he's ignoring you - he just doesn't hear you! His mind doesn't work that way - it's pretty inherently Single Track.\u003c/p\u003e\n\n\u003cp\u003eWonder Woman - Wonder Woman was once fighting off an invasion from another planet, when her cellphone (from her cover life as a museum curator) got a text that a new artifact was available for her to pick up and catalog. No sweat- she just continued to drive the aliens away, and vowed to get to the catalog-ing work once she'd finished and changed back into her civilian clothes.\u003c/p\u003e\n\n\u003cp\u003eIron Man - Tony Stark is driven by novelty. He's so into chasing the next big thing that if he was working on a rocket for Mars, and you mentioned how long it took for you to get between two cities, he'd start working on as HyperLoop right away.\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"the-characters-styles-decoded\" href=\"#the-characters-styles-decoded\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  The Character's Styles Decoded\n\u003c/h1\u003e\n\n\u003cp\u003eNow, as fun as those descriptions are, they correspond to the 5 primary concurrency strategies you can implement in JavaScript.\u003c/p\u003e\n\n\u003cp\u003eSuperman is the \u003ccode\u003eparallel\u003c/code\u003e mode - Work starts ASAP, continues in parallel with other jobs, and assumes (and requires) a pretty unbounded set of system resources.  (RxJS' mergeMap)\u003c/p\u003e\n\n\u003cp\u003eWonder Woman is the \u003ccode\u003eserial\u003c/code\u003e mode - Work will get done just as soon as the current work is done. A queue is needed to hold the next tasks, and only 1 job is in progress at any given time. (RxJS' concatMap)\u003c/p\u003e\n\n\u003cp\u003eIron Man/Stark is the \u003ccode\u003ecutoff\u003c/code\u003e mode - Work that is interesting replaces existing work. Still, only 1 job is in progress at any given time. (RxJS' switchMap)\u003c/p\u003e\n\n\u003cp\u003eThor is the \u003ccode\u003emute\u003c/code\u003e mode - The sound of incoming work is \u003ccode\u003emute\u003c/code\u003ed to him while he's busy. Of course, only 1 job is in progress at any given time. (RxJS' exhaustMap)\u003c/p\u003e\n\n\u003cp\u003eHulk is the \u003ccode\u003etoggle\u003c/code\u003e mode - New requests toggle other requests off. At most 1 job is in progress at any given time. (RxHelper's toggleMap)\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"choosing-a-mode-in-code\" href=\"#choosing-a-mode-in-code\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Choosing a Mode in Code\n\u003c/h1\u003e\n\n\u003cp\u003eHere are some typical web development Patterns where one or the other of these modes works best:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003eAn Autocompleter like Google Search - Here you want a \u003ccode\u003ecutoff\u003c/code\u003e strategy when it comes to fetching results. New searches should cut off previous searches to keep the system working on the most latest search. \u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eLike Buttons- These probably should be processed in \u003ccode\u003eparallel\u003c/code\u003e, as long as the system can handle multiple connections, or pipeline them under the covers.\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eA Downloader - It makes sense to download files one after the other in queued \u003ccode\u003eserial\u003c/code\u003e mode, like adding songs to a Jukebox's playlist.\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eA Form Submit - It may make sense to prevent a double form submission with a \u003ccode\u003emute\u003c/code\u003e strategy for clicks after the first.\u003c/p\u003e\u003c/li\u003e\n\u003cli\u003e\u003cp\u003eA Light Switch - A light switch, rather than keeping track of its own state in a field outside its button-event stream, can just apply the \u003ccode\u003eturnOn\u003c/code\u003e function in \u003ccode\u003etoggle\u003c/code\u003e mode. \u003c/p\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"enabling-flexibility\" href=\"#enabling-flexibility\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Enabling Flexibility\n\u003c/h1\u003e\n\n\u003cp\u003eReturning objects in code which represent cancelable, unstarted processes is the key to enabling this. This is why a system that allows for plugging in these strategies must be based on Observables. Only Observables, not Promises, are cancelable (for \u003ccode\u003ecutoff\u003c/code\u003e and \u003ccode\u003etoggle\u003c/code\u003e), and unstarted (for \u003ccode\u003eserial\u003c/code\u003e).\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"play-with-it\" href=\"#play-with-it\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Play with it\n\u003c/h1\u003e\n\n\u003cp\u003eThere are several \u003ca href=\"https://codesandbox.io/search?query=\u0026amp;page=1\u0026amp;configure%5BhitsPerPage%5D=12\u0026amp;refinementList%5Bnpm_dependencies.dependency%5D%5B0%5D=rx-helper\"\u003eCode Sandboxes for the Rx-Helper library\u003c/a\u003e which illustrate these and other patterns that are possible with it.\u003c/p\u003e\n\n\u003cp\u003eLet me know if this helps clear things up! In a future post- the proof that these 5 modes are a complete set of tools for solving problems up the first 3 orders of difficulty, and that more complicated solutions are simply recombinations of these basic elements.\u003c/p\u003e\n\n","published":true,"published_from_feed":false,"show_comments":true,"slug":"the-5-possible-concurrency-modes-of-javascript-3238","social_image":null,"title":"The 5 Possible Concurrency Modes of JavaScript","video":null,"video_code":null},{"created_at":"2020-03-16T05:10:50.858Z","crossposted_at":null,"edited_at":"2020-03-16T05:11:13.737Z","last_comment_at":"2020-03-16T05:10:50.836Z","published_at":"2020-03-16T05:10:50.836Z","canonical_url":null,"feed_source_url":null,"video_closed_caption_track_url":null,"video_source_url":null,"video_thumbnail_url":null,"body_markdown":"---\ntitle: Stop Wasting Time, It's Time to Get Real-Time\npublished: true\ndescription: How to use Real-Time Web Technology to Decrease Digital Distance\ntags: rxjs, socketio, react, javascript\n---\n\n\n## Awaiting A Service\nSunday March 15 2020, the first Sunday after the Coronavirus Pandemic really exploded in the US, my church hosted its first online service. The instructions for us were to \"Join our livestream on our Facebook Page\". Sounds like clear instructions, right? Then - why do you think the livestream, which displays a count of watchers, didn't reach its full count of 180+ until a few minutes after the service began? I estimate over 100 minutes of participation were lost due to a technical choice that is all too easy to make. (For the fix to this, read about [Youtube Livestreams](https://support.google.com/youtube/answer/2853700?hl=en)).\n\nBut before I get into solutions, I want to say that the subject I'm talking about, while technical, is of **uber-importance** for everyone to pay attention to, but especially developers. Developers, the skillset you've been taught is **not** the one you'll need to solve the problem that caused these digital delays. We can't seem to stop introducing digital latencies, as long as the current canon of Web Developer skills leads invariably to wasted user time. And wasted time, in a time of crisis - can cost lives. We need to build platforms that are fully reactive - fully realtime, and not stuck in the document-oriented mindset the web was created with.\n\n## Transferring Docs or Serving Apps?\n\nIt's helpful to have some historical background as to why the web is such a latency-burdened platform. HTTP, the computer protocol which we are using when we surf the web, was made originally just to deliver documents. A document is just a page, or data, which you have to re-request every time. A Realtime Service (not a traditional REST service) is one which brings content to the user without them needing to ask, providing them, well, a service! \"Your Uber has arrived\" is not a message you want to receive minutes late, and you don't want the ride to leave because you forgot to click refresh. Uber is built as a service. I don't have to sell you on the success of that business model, which real-time critically enabled. \n\nSometimes we're so trapped in this document mindset that we don't see that we're making a poorer choice - as my church did. They gave a link to their facebook page, which exists to give real-time updates on itself, but not to show any livestreams it contained! Had they sent out instead a link directly to the livestream, it'd have opened automatically for everyone. A church-service-service you could say! Then there'd be nobody doing what i did - being glued to my screen so I could click that link ASAP, or being left behind a minute or two because they were getting a cup of coffee, and missed critical news on the Coronavirus.\n\n## Video Conferencing\nUse of live-streaming URLs is one way you can Stop Wasting Time. Another trick exists if you create online meetings, and want attendees to be able to converse even if you're late and haven't started it. Choose the wrong option and your guests will see this screen, and not be able to talk to each other.\n \n![](https://assets.zoom.us/images/en-us/desktop/generic/wait-for-host-to-start-meeting.png)\n\nThe feature to use is called Join Before Host, and it's not enabled by default, so you should turn it on in your settings and unlock many more minutes of collaboration-time instantly. Read more on it in [Zoom's knowledge base](https://support.zoom.us/hc/en-us/articles/202828525-Join-Before-Host)\n\n## Developer Tools For Getting Real (time)\n\nSpecifically for web developers, below is an *incomplete* list (please let me what I'm missing and I'll add it) of technology that can be used to build real-time apps. \n\n- [ActionCable (Rails)](https://guides.rubyonrails.org/action_cable_overview.html)\n- [Amazon SNS](https://aws.amazon.com/sns/?whats-new-cards.sort-by=item.additionalFields.postDateTime\u0026whats-new-cards.sort-order=desc)\n- [Feathers JS](https://feathersjs.com/)\n- [GraphQL](https://github.com/apollographql/graphql-subscriptions)\n- [MeteorJS](https://www.meteor.com/)\n- [Phoenix (Elixir)](https://www.phoenixframework.org/)\n- [RxJS]([https://rxjs.dev/](https://rxjs.dev/))\n- [Socket.IO](https://rxjs.dev/)\n\nIf some of these are unfamiliar to you, I assure you they're not out of reach. The mindset that is most useful for working with these tools is one where events go in both directions. A more equal protocol where the server OR the client may have something to say at any time. A protocol of events, not a protocol of documents. If your server won't be able to stream results right away, you can simulate real-time with polling that notifies upon any changes.\n\nYou don't have to change everything you do overnight to get real-time - Github added SocketIO into their REST app after years of not having it. Try and make a habit of asking yourself and your team what you can do to bring down unnecessary digital distance. Think of all the tools you depend upon for notifications, and ask whether what you're building for customers is as usable as you require. In these days of increased physical distance, I'm thinking decreased digital distance might be just what the doctor ordered.\n\nDean [@deaniusol](twitter.com/deaniusol)","cached_tag_list":"rxjs, socketio, react, javascript","cached_user_name":"Dean Radcliffe","cached_user_username":"deanius","comments_count":0,"description":"How to use Real-Time Web Technology to Decrease Digital Distance","main_image":null,"main_image_background_hex_color":"#dddddd","path":"/deanius/stop-wasting-time-it-s-time-to-get-real-time-dg3","public_reactions_count":11,"processed_html":"\u003ch2\u003e\n  \u003ca name=\"awaiting-a-service\" href=\"#awaiting-a-service\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Awaiting A Service\n\u003c/h2\u003e\n\n\u003cp\u003eSunday March 15 2020, the first Sunday after the Coronavirus Pandemic really exploded in the US, my church hosted its first online service. The instructions for us were to \"Join our livestream on our Facebook Page\". Sounds like clear instructions, right? Then - why do you think the livestream, which displays a count of watchers, didn't reach its full count of 180+ until a few minutes after the service began? I estimate over 100 minutes of participation were lost due to a technical choice that is all too easy to make. (For the fix to this, read about \u003ca href=\"https://support.google.com/youtube/answer/2853700?hl=en\"\u003eYoutube Livestreams\u003c/a\u003e).\u003c/p\u003e\n\n\u003cp\u003eBut before I get into solutions, I want to say that the subject I'm talking about, while technical, is of \u003cstrong\u003euber-importance\u003c/strong\u003e for everyone to pay attention to, but especially developers. Developers, the skillset you've been taught is \u003cstrong\u003enot\u003c/strong\u003e the one you'll need to solve the problem that caused these digital delays. We can't seem to stop introducing digital latencies, as long as the current canon of Web Developer skills leads invariably to wasted user time. And wasted time, in a time of crisis - can cost lives. We need to build platforms that are fully reactive - fully realtime, and not stuck in the document-oriented mindset the web was created with.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"transferring-docs-or-serving-apps\" href=\"#transferring-docs-or-serving-apps\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Transferring Docs or Serving Apps?\n\u003c/h2\u003e\n\n\u003cp\u003eIt's helpful to have some historical background as to why the web is such a latency-burdened platform. HTTP, the computer protocol which we are using when we surf the web, was made originally just to deliver documents. A document is just a page, or data, which you have to re-request every time. A Realtime Service (not a traditional REST service) is one which brings content to the user without them needing to ask, providing them, well, a service! \"Your Uber has arrived\" is not a message you want to receive minutes late, and you don't want the ride to leave because you forgot to click refresh. Uber is built as a service. I don't have to sell you on the success of that business model, which real-time critically enabled. \u003c/p\u003e\n\n\u003cp\u003eSometimes we're so trapped in this document mindset that we don't see that we're making a poorer choice - as my church did. They gave a link to their facebook page, which exists to give real-time updates on itself, but not to show any livestreams it contained! Had they sent out instead a link directly to the livestream, it'd have opened automatically for everyone. A church-service-service you could say! Then there'd be nobody doing what i did - being glued to my screen so I could click that link ASAP, or being left behind a minute or two because they were getting a cup of coffee, and missed critical news on the Coronavirus.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"video-conferencing\" href=\"#video-conferencing\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Video Conferencing\n\u003c/h2\u003e\n\n\u003cp\u003eUse of live-streaming URLs is one way you can Stop Wasting Time. Another trick exists if you create online meetings, and want attendees to be able to converse even if you're late and haven't started it. Choose the wrong option and your guests will see this screen, and not be able to talk to each other.\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--VwiTw_DT--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://assets.zoom.us/images/en-us/desktop/generic/wait-for-host-to-start-meeting.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--VwiTw_DT--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://assets.zoom.us/images/en-us/desktop/generic/wait-for-host-to-start-meeting.png\" alt=\"\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eThe feature to use is called Join Before Host, and it's not enabled by default, so you should turn it on in your settings and unlock many more minutes of collaboration-time instantly. Read more on it in \u003ca href=\"https://support.zoom.us/hc/en-us/articles/202828525-Join-Before-Host\"\u003eZoom's knowledge base\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"developer-tools-for-getting-real-time\" href=\"#developer-tools-for-getting-real-time\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Developer Tools For Getting Real (time)\n\u003c/h2\u003e\n\n\u003cp\u003eSpecifically for web developers, below is an \u003cem\u003eincomplete\u003c/em\u003e list (please let me what I'm missing and I'll add it) of technology that can be used to build real-time apps. \u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://guides.rubyonrails.org/action_cable_overview.html\"\u003eActionCable (Rails)\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://aws.amazon.com/sns/?whats-new-cards.sort-by=item.additionalFields.postDateTime\u0026amp;whats-new-cards.sort-order=desc\"\u003eAmazon SNS\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://feathersjs.com/\"\u003eFeathers JS\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/apollographql/graphql-subscriptions\"\u003eGraphQL\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.meteor.com/\"\u003eMeteorJS\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.phoenixframework.org/\"\u003ePhoenix (Elixir)\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"%5Bhttps://rxjs.dev/%5D(https://rxjs.dev/)\"\u003eRxJS\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://rxjs.dev/\"\u003eSocket.IO\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eIf some of these are unfamiliar to you, I assure you they're not out of reach. The mindset that is most useful for working with these tools is one where events go in both directions. A more equal protocol where the server OR the client may have something to say at any time. A protocol of events, not a protocol of documents. If your server won't be able to stream results right away, you can simulate real-time with polling that notifies upon any changes.\u003c/p\u003e\n\n\u003cp\u003eYou don't have to change everything you do overnight to get real-time - Github added SocketIO into their REST app after years of not having it. Try and make a habit of asking yourself and your team what you can do to bring down unnecessary digital distance. Think of all the tools you depend upon for notifications, and ask whether what you're building for customers is as usable as you require. In these days of increased physical distance, I'm thinking decreased digital distance might be just what the doctor ordered.\u003c/p\u003e\n\n\u003cp\u003eDean \u003ca href=\"//twitter.com/deaniusol\"\u003e@deaniusol\u003c/a\u003e\u003c/p\u003e\n\n","published":true,"published_from_feed":false,"show_comments":true,"slug":"stop-wasting-time-it-s-time-to-get-real-time-dg3","social_image":null,"title":"Stop Wasting Time, It's Time to Get Real-Time","video":null,"video_code":null},{"created_at":"2020-05-17T17:26:52.155Z","crossposted_at":null,"edited_at":null,"last_comment_at":"2020-05-17T17:26:52.139Z","published_at":"2020-05-17T17:26:52.139Z","canonical_url":null,"feed_source_url":null,"video_closed_caption_track_url":null,"video_source_url":null,"video_thumbnail_url":null,"body_markdown":"---\ntitle: Promises, Cancelation and AbortController in Deno\npublished: true\ndescription: Why Aren't Observables used in Deno?\ncover_image: https://images.unsplash.com/photo-1552775838-b0c8d3b881fb?ixlib=rb-1.2.1\u0026ixid=eyJhcHBfaWQiOjEyMDd9\u0026auto=format\u0026fit=crop\u0026w=1837\u0026q=80\ntags: deno, oak, async, rxjs\n---\n\nAs excited as I am about Deno (the new Node-like runtime), and that it has cancellation semantics, I don't like seeing that they bypassed an over 10 year old concept of Observables, in favor of a barely adopted standard for cancellation - the AbortController.\n\nShould you want to shut down a server, using the oak framework (an anagram of koa, get it?), you have to do the following:\n\n```js\nimport { Application } from \"https://deno.land/x/oak/mod.ts\";\n\nconst app = new Application();\n\nconst controller = new AbortController();\nconst { signal } = controller;\n\nconst listenPromise = app.listen({ port: 8000, signal });\n\n// In order to close the sever...\ncontroller.abort();\n\n// Listen will stop listening for requests and the promise will resolve...\nawait listenPromise;\n```\n(From: https://github.com/oakserver/oak#closing-the-server)\n\nThere are at least two things about this I don't like:\n\n- If `listen` wasn't called with the `signal`, there is no way to shut down the server\n- It's unclear to me whether an aborted server ought to be considered a resolved promise (a value, when awaited), or a rejected Promise. \n\nThe problem of needing to know you're setting up a cancelable thing is unfortunate. If it's something you need to know in advance - it's easy to forget. And people won't fall into the 'pit of success' if you impose more upon them to do up front. By the time you know a thing needs to be cancelable, it's often already caused problems.\n\nThe problem of Promise cancellation is a deep one, and I'll just leave it at \"Promises aren't a good fit for cancellation\". That's why the proposal to add cancelation natively to Promises [died in committee](https://github.com/tc39/proposal-cancelable-promises/issues/70).\n\nHere's what the code would look like if the server were an Observable.\n\n```js\nimport { Application } from \"https://deno.land/x/oak/mod.ts\";\n\nconst app = new Application();\n\nconst controller = new AbortController();\nconst { signal } = controller;\n\nconst listener = app.listen({ port: 8000, signal }).subscribe()\n\n// In order to close the sever...\nlistener.unsubscribe();\n\n// etc..\n\n```\nIt clearly fixes those problems. It may introduce a new one IF the cancelation itself is an async operation, and I suspect it may have been because of this, but I don't know whether shutting down a server is a long thing, if you accept that it means canceling running activity.\n\n---\n\nIn short, these days I'm often asking \"Why not Observables?\" and I would love to hear your answer. Observables are the best proxy I've seen for \"A process you start up (possibly in the future), and may want to shut down.\" \n\nObservables are like having strings around for UNIX processes - they are not executing at the time they're defined, but they begin executing when you call `subscribe()`, and the object returned has an `unsubscribe()` method which sends them a `Ctrl-C`:\n\nIn a contrived example:\n\n```typescript\nimport { Observable, Subscription } from 'rxjs'\ninterface findResults {\n  (finder:string): Observable\n}\n\nconst resultFinder:string = \"ls -l magic*\"\nconst results:Observable = findResults(resultFinder)\nlet process:Subscription\n\nconst findMagicBag = (item) =\u003e {\n  if(item === \"magic-bag.md\") {\n    console.log(\"Found my magic bag!\");\n    process.unsubscribe();\n  }\n}\n\n// starts executing on this next line\nprocess = results.subscribe(findMagicBag);\n```\n\nAgain, we don't have to 'add' cancelation, it's just baked in. And it's a good thing, because once we've found the thing we're looking for, *why not* shut the process down? In servers, particularly, leaving handles open for longer than you need to is problematic.\n\nSo I'm excited about Deno, and Oak. And Promises are way better than callbacks. But let's not stop the improvements there, especially in this greenfield area. And with an [Observable Proposal in TC39](https://github.com/tc39/proposal-observable/issues/112) that couldn't possibly fare worse than Promise cancelation did, we should take a look and see if that fits the bill. :)\n\n---\n- [Observable Proposal in TC39](https://github.com/tc39/proposal-observable/issues/112)\n- [RxJS](http://rxjs-dev.firebaseapp.com/)\n- [Promise Cancellation in TC39](https://github.com/tc39/proposal-cancelable-promises/issues/70)\nPhoto by [Michael Dziedzic](https://unsplash.com/@lazycreekimages?utm_source=unsplash\u0026utm_medium=referral\u0026utm_content=creditCopyText) on Unsplash","cached_tag_list":"deno, oak, async, rxjs","cached_user_name":"Dean Radcliffe","cached_user_username":"deanius","comments_count":0,"description":"Why Aren't Observables used in Deno?","main_image":"https://images.unsplash.com/photo-1552775838-b0c8d3b881fb?ixlib=rb-1.2.1\u0026ixid=eyJhcHBfaWQiOjEyMDd9\u0026auto=format\u0026fit=crop\u0026w=1837\u0026q=80","main_image_background_hex_color":"#dddddd","path":"/deanius/promises-cancelation-and-abortcontroller-in-deno-1fph","public_reactions_count":10,"processed_html":"\u003cp\u003eAs excited as I am about Deno (the new Node-like runtime), and that it has cancellation semantics, I don't like seeing that they bypassed an over 10 year old concept of Observables, in favor of a barely adopted standard for cancellation - the AbortController.\u003c/p\u003e\n\n\u003cp\u003eShould you want to shut down a server, using the oak framework (an anagram of koa, get it?), you have to do the following:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eApplication\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003ehttps://deno.land/x/oak/mod.ts\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eapp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eApplication\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eAbortController\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003esignal\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003elistenPromise\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elisten\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e \u003cspan class=\"na\"\u003eport\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e8000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003esignal\u003c/span\u003e \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// In order to close the sever...\u003c/span\u003e\n\u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eabort\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// Listen will stop listening for requests and the promise will resolve...\u003c/span\u003e\n\u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"nx\"\u003elistenPromise\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003e(From: \u003ca href=\"https://github.com/oakserver/oak#closing-the-server\"\u003ehttps://github.com/oakserver/oak#closing-the-server\u003c/a\u003e)\u003c/p\u003e\n\n\u003cp\u003eThere are at least two things about this I don't like:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eIf \u003ccode\u003elisten\u003c/code\u003e wasn't called with the \u003ccode\u003esignal\u003c/code\u003e, there is no way to shut down the server\u003c/li\u003e\n\u003cli\u003eIt's unclear to me whether an aborted server ought to be considered a resolved promise (a value, when awaited), or a rejected Promise. \u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eThe problem of needing to know you're setting up a cancelable thing is unfortunate. If it's something you need to know in advance - it's easy to forget. And people won't fall into the 'pit of success' if you impose more upon them to do up front. By the time you know a thing needs to be cancelable, it's often already caused problems.\u003c/p\u003e\n\n\u003cp\u003eThe problem of Promise cancellation is a deep one, and I'll just leave it at \"Promises aren't a good fit for cancellation\". That's why the proposal to add cancelation natively to Promises \u003ca href=\"https://github.com/tc39/proposal-cancelable-promises/issues/70\"\u003edied in committee\u003c/a\u003e.\u003c/p\u003e\n\n\u003cp\u003eHere's what the code would look like if the server were an Observable.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eApplication\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003ehttps://deno.land/x/oak/mod.ts\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eapp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eApplication\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eAbortController\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003esignal\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003econtroller\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003elistener\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eapp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elisten\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e \u003cspan class=\"na\"\u003eport\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e8000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003esignal\u003c/span\u003e \u003cspan class=\"p\"\u003e}).\u003c/span\u003e\u003cspan class=\"nx\"\u003esubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// In order to close the sever...\u003c/span\u003e\n\u003cspan class=\"nx\"\u003elistener\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eunsubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// etc..\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eIt clearly fixes those problems. It may introduce a new one IF the cancelation itself is an async operation, and I suspect it may have been because of this, but I don't know whether shutting down a server is a long thing, if you accept that it means canceling running activity.\u003c/p\u003e\n\n\n\u003chr\u003e\n\n\u003cp\u003eIn short, these days I'm often asking \"Why not Observables?\" and I would love to hear your answer. Observables are the best proxy I've seen for \"A process you start up (possibly in the future), and may want to shut down.\" \u003c/p\u003e\n\n\u003cp\u003eObservables are like having strings around for UNIX processes - they are not executing at the time they're defined, but they begin executing when you call \u003ccode\u003esubscribe()\u003c/code\u003e, and the object returned has an \u003ccode\u003eunsubscribe()\u003c/code\u003e method which sends them a \u003ccode\u003eCtrl-C\u003c/code\u003e:\u003c/p\u003e\n\n\u003cp\u003eIn a contrived example:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eSubscription\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003erxjs\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\n\u003cspan class=\"kr\"\u003einterface\u003c/span\u003e \u003cspan class=\"nx\"\u003efindResults\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003efinder\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"nx\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"nx\"\u003eObservable\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eresultFinder\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"nx\"\u003estring\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003els -l magic*\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eresults\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"nx\"\u003eObservable\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003efindResults\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eresultFinder\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003eprocess\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"nx\"\u003eSubscription\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003efindMagicBag\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eitem\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003emagic-bag.md\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eFound my magic bag!\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eprocess\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eunsubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// starts executing on this next line\u003c/span\u003e\n\u003cspan class=\"nx\"\u003eprocess\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eresults\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003efindMagicBag\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eAgain, we don't have to 'add' cancelation, it's just baked in. And it's a good thing, because once we've found the thing we're looking for, \u003cem\u003ewhy not\u003c/em\u003e shut the process down? In servers, particularly, leaving handles open for longer than you need to is problematic.\u003c/p\u003e\n\n\u003cp\u003eSo I'm excited about Deno, and Oak. And Promises are way better than callbacks. But let's not stop the improvements there, especially in this greenfield area. And with an \u003ca href=\"https://github.com/tc39/proposal-observable/issues/112\"\u003eObservable Proposal in TC39\u003c/a\u003e that couldn't possibly fare worse than Promise cancelation did, we should take a look and see if that fits the bill. :)\u003c/p\u003e\n\n\n\u003chr\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/tc39/proposal-observable/issues/112\"\u003eObservable Proposal in TC39\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://rxjs-dev.firebaseapp.com/\"\u003eRxJS\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"https://github.com/tc39/proposal-cancelable-promises/issues/70\"\u003ePromise Cancellation in TC39\u003c/a\u003e\nPhoto by \u003ca href=\"https://unsplash.com/@lazycreekimages?utm_source=unsplash\u0026amp;utm_medium=referral\u0026amp;utm_content=creditCopyText\"\u003eMichael Dziedzic\u003c/a\u003e on Unsplash\u003c/li\u003e\n\u003c/ul\u003e\n\n","published":true,"published_from_feed":false,"show_comments":true,"slug":"promises-cancelation-and-abortcontroller-in-deno-1fph","social_image":null,"title":"Promises, Cancelation and AbortController in Deno","video":null,"video_code":null},{"created_at":"2020-05-17T19:40:11.806Z","crossposted_at":null,"edited_at":null,"last_comment_at":"2020-05-17T19:40:11.783Z","published_at":"2020-05-17T19:40:11.783Z","canonical_url":null,"feed_source_url":null,"video_closed_caption_track_url":null,"video_source_url":null,"video_thumbnail_url":null,"body_markdown":"---\ntitle:React 3JS Word Sphere\npublished: true\ntags: codesandbox, animation, webgl, 3js\n---\n\nThank you, CodeSandbox for such a rich ecosystem for sharing live demos!\nAnd thank you Paul Henschel, for showing us what's possible!\n\n{% codesandbox prz5q %}","cached_tag_list":"codesandbox, animation, webgl, 3js","cached_user_name":"Dean Radcliffe","cached_user_username":"deanius","comments_count":0,"description":"Thank you, CodeSandbox for such a rich ecosystem for sharing live demos! And thank you Paul Henschel,...","main_image":null,"main_image_background_hex_color":"#dddddd","path":"/deanius/react-3js-word-sphere-aok","public_reactions_count":4,"processed_html":"\u003cp\u003eThank you, CodeSandbox for such a rich ecosystem for sharing live demos!\u003cbr\u003e\nAnd thank you Paul Henschel, for showing us what's possible!\u003c/p\u003e\n\n\u003cp\u003e\u003ciframe src=\"https://codesandbox.io/embed/prz5q\" style=\"width:100%; height:calc(300px + 8vw); border:0; border-radius: 4px; overflow:hidden;\" allow=\"geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media; usb\" loading=\"lazy\" sandbox=\"allow-modals allow-forms allow-popups allow-scripts allow-same-origin\"\u003e\n\u003c/iframe\u003e\n\u003c/p\u003e\n\n","published":true,"published_from_feed":false,"show_comments":true,"slug":"react-3js-word-sphere-aok","social_image":null,"title":"React 3JS Word Sphere","video":null,"video_code":null},{"created_at":"2020-05-19T16:18:13.578Z","crossposted_at":null,"edited_at":null,"last_comment_at":"2020-05-19T16:18:13.560Z","published_at":"2020-05-19T16:18:13.560Z","canonical_url":null,"feed_source_url":null,"video_closed_caption_track_url":null,"video_source_url":null,"video_thumbnail_url":null,"body_markdown":"---\ntitle: Let's Give Events (`$.on`) a Closer Look!\npublished: true\ndescription: A library called polyrhythm can help us gain the benefits of evented code with none of that legacy event-pain.\ntags: jquery, react ,rxjs ,polyrhythm\n---\n\n# Why Events?\n\nRemember the simplicity of `$.on('click', function(){ ... })`? You probably haven't written code like that in a while. And I posit that it's time to give that style another look. But, astute reader, you'll remind me that there were reasons why we left it behind. So let's look at those.\n\n## Why Not Events Reason 1 - Concurrency\n\nA problem everyone whose written an event handler has experienced is that the \"events came in too fast\".\n\nUsers double-submit. Start multiple downloads at once. Wonder whether their first button press worked, and smash a few more times for good measure.\n\n```js\n$(\"form\").on(\"submit\", () =\u003e {\n  // something that mustn't run concurrently with itself!\n});\n```\n\nUser Problems result. Search boxes show old results. Sound or videos play simultaneously that should be queued. Animations don't play nice.\n\nAnd Developer problems result. Code gets crazier, harder to read. Simple gets complex. Tests don't keep up. And concurrency-related code gets sprinkled on. And complexity leaks out.\n\n```js\n$(\"form\").on(\"submit\", () =\u003e {\n  // something that mustn't run concurrently with itself!\n});\n```\n\n```js\nlet isRunning;\n$(\"form\").on(\"submit\", () =\u003e {\n  if (isRunning) {\n    return;\n  }\n  // something that mustn't run concurrently with itself!\n});\n```\n\n## Why Not Events  Reason 2 - Direct Calling Preference\n\n\u003e \"Event driven code is hard to read, it's hard to tell what caused what\"\n\nI've felt this pain for sure. Being able to Alt-Click to a function definition is more expedient than looking for the event handler. And the inversion of control that events bring makes you more reliant on the framework's internal timing elements.\n\nBut that 2nd problem goes away if you're using events to interface with your own actors/services/modules. And `grep` and `console.log` are still the most powerful debugging tools, so being able to attach a debugger to certain event name/type stirngs, or grep for them, can make up for that direct link in pretty significant ways. \n\nAlso direct linking presumes certain things won't change - a synchronous function will always be synchronous - a generator function won't become async iterator, etc.. Direct linking can bind layers of your stack together in pretty challenging ways. So if there was something that wouldn't do that - wouldn't you want that?\n\n## Ready to reconsider?\n\nI too moved away from the JQuery `$.on` style with some of these above reservations. But with new tools, it's time to give event-oriented front-ends another look. It's already dominated much of the React landscape (see [Redux](https://redux.js.org)), as well as anything that uses a reducer. But my focus will be particularly on how to use a new library [polyrhythm](https://github.com/deanius/polyrhythm) to achieve these benefits, since it includes some timing tricks for Reason #1 that are not present in other event/command-object oriented frameworks. \n\nWith these changes, you'll be able to deliver bang-up UX experiences via events, the natural language of front-ends, and *NOT* paint yourself into corners.\n\nI've worked several years on the concepts in polyrhythm. I'm a drummer and musician, and juggling multiple streams of activity is a passion for me. I hope you'll give it a look, and please engage with me on Dev.to here, in twitter, or directly in the repo, if I can help you judge whether it's a fit for you.\n\nHappy rhythm-ing!\n\n\n\n---\n- [polyrhythm](https://github.com/deanius/polyrhythm)\n","cached_tag_list":"jquery, react, rxjs, polyrhythm","cached_user_name":"Dean Radcliffe","cached_user_username":"deanius","comments_count":0,"description":"A library called polyrhythm can help us gain the benefits of evented code with none of that legacy event-pain.","main_image":null,"main_image_background_hex_color":"#dddddd","path":"/deanius/let-s-give-events-on-a-closer-look-21l4","public_reactions_count":5,"processed_html":"\u003ch1\u003e\n  \u003ca name=\"why-events\" href=\"#why-events\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Why Events?\n\u003c/h1\u003e\n\n\u003cp\u003eRemember the simplicity of \u003ccode\u003e$.on('click', function(){ ... })\u003c/code\u003e? You probably haven't written code like that in a while. And I posit that it's time to give that style another look. But, astute reader, you'll remind me that there were reasons why we left it behind. So let's look at those.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"why-not-events-reason-1-concurrency\" href=\"#why-not-events-reason-1-concurrency\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Why Not Events Reason 1 - Concurrency\n\u003c/h2\u003e\n\n\u003cp\u003eA problem everyone whose written an event handler has experienced is that the \"events came in too fast\".\u003c/p\u003e\n\n\u003cp\u003eUsers double-submit. Start multiple downloads at once. Wonder whether their first button press worked, and smash a few more times for good measure.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eform\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003eon\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003esubmit\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e// something that mustn't run concurrently with itself!\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eUser Problems result. Search boxes show old results. Sound or videos play simultaneously that should be queued. Animations don't play nice.\u003c/p\u003e\n\n\u003cp\u003eAnd Developer problems result. Code gets crazier, harder to read. Simple gets complex. Tests don't keep up. And concurrency-related code gets sprinkled on. And complexity leaks out.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eform\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003eon\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003esubmit\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e// something that mustn't run concurrently with itself!\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003eisRunning\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"nx\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eform\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003eon\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003esubmit\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eisRunning\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e// something that mustn't run concurrently with itself!\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003ch2\u003e\n  \u003ca name=\"why-not-events-reason-2-direct-calling-preference\" href=\"#why-not-events-reason-2-direct-calling-preference\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Why Not Events  Reason 2 - Direct Calling Preference\n\u003c/h2\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\"Event driven code is hard to read, it's hard to tell what caused what\"\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eI've felt this pain for sure. Being able to Alt-Click to a function definition is more expedient than looking for the event handler. And the inversion of control that events bring makes you more reliant on the framework's internal timing elements.\u003c/p\u003e\n\n\u003cp\u003eBut that 2nd problem goes away if you're using events to interface with your own actors/services/modules. And \u003ccode\u003egrep\u003c/code\u003e and \u003ccode\u003econsole.log\u003c/code\u003e are still the most powerful debugging tools, so being able to attach a debugger to certain event name/type stirngs, or grep for them, can make up for that direct link in pretty significant ways. \u003c/p\u003e\n\n\u003cp\u003eAlso direct linking presumes certain things won't change - a synchronous function will always be synchronous - a generator function won't become async iterator, etc.. Direct linking can bind layers of your stack together in pretty challenging ways. So if there was something that wouldn't do that - wouldn't you want that?\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"ready-to-reconsider\" href=\"#ready-to-reconsider\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Ready to reconsider?\n\u003c/h2\u003e\n\n\u003cp\u003eI too moved away from the JQuery \u003ccode\u003e$.on\u003c/code\u003e style with some of these above reservations. But with new tools, it's time to give event-oriented front-ends another look. It's already dominated much of the React landscape (see \u003ca href=\"https://redux.js.org\"\u003eRedux\u003c/a\u003e), as well as anything that uses a reducer. But my focus will be particularly on how to use a new library \u003ca href=\"https://github.com/deanius/polyrhythm\"\u003epolyrhythm\u003c/a\u003e to achieve these benefits, since it includes some timing tricks for Reason #1 that are not present in other event/command-object oriented frameworks. \u003c/p\u003e\n\n\u003cp\u003eWith these changes, you'll be able to deliver bang-up UX experiences via events, the natural language of front-ends, and \u003cem\u003eNOT\u003c/em\u003e paint yourself into corners.\u003c/p\u003e\n\n\u003cp\u003eI've worked several years on the concepts in polyrhythm. I'm a drummer and musician, and juggling multiple streams of activity is a passion for me. I hope you'll give it a look, and please engage with me on Dev.to here, in twitter, or directly in the repo, if I can help you judge whether it's a fit for you.\u003c/p\u003e\n\n\u003cp\u003eHappy rhythm-ing!\u003c/p\u003e\n\n\n\u003chr\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/deanius/polyrhythm\"\u003epolyrhythm\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n","published":true,"published_from_feed":false,"show_comments":true,"slug":"let-s-give-events-on-a-closer-look-21l4","social_image":null,"title":"Let's Give Events (`$.on`) a Closer Look!","video":null,"video_code":null},{"created_at":"2020-05-27T19:53:19.661Z","crossposted_at":null,"edited_at":null,"last_comment_at":"2020-05-27T19:53:19.644Z","published_at":"2020-05-27T19:53:19.644Z","canonical_url":null,"feed_source_url":null,"video_closed_caption_track_url":null,"video_source_url":null,"video_thumbnail_url":null,"body_markdown":"---\ntitle: How The JAM Stack Can Drive Scalability\npublished: true\ndescription: Static sites\ncover_image: https://images.unsplash.com/photo-1525604885849-bb72cf86832c?ixlib=rb-1.2.1\u0026ixid=eyJhcHBfaWQiOjEyMDd9\u0026auto=format\u0026fit=crop\u0026w=1000\u0026q=80\ntags: gatsby, rails, netlify\n---\n\n\nFor those who've worked on high-traffic sites built in Ruby on Rails, Node, or any other platform, a riddle: \n\n\u003e A site for (frequently updated) COVID-19 data had an average daily load of 100,000 users. On a single day, after a White House mention, it spiked to 1.2 million users. It never errored out or fell over, and its all-volunteer team never encountered a huge hosting bill for that day. _What technologies was it built in?_\n\n_Source: [The Covid Tracking Project](https://jamstackconfvirtual.sched.com/event/cES0/the-covid-tracking-project-0-to-2m-api-requests-in-3-months)_\n\nYou must be running through the AWS service catalog in your head now, or thinking of Postgres optimizations. You must be thinking Kubernetes must be involved, or at least Docker or Elastic Compute. You probably were not thinking the real answer: Google Drive Sheets and GatsbyJS, hosted on Netlify. The JAM Stack of JavaScript, APIs and Markup.\n\nIt's not easy, with the current 'standard' set of web technologies, to produce something that scalable in only 3 months. If you started at the beginning with Rails and MySQL, even with Redis, caching, or a screaming Postgres, how many months would you have to iterate upon before you could reach that level? More than 3 I would say. And more importantly - why does it seem that an order of magnitude of more challenges lie in the way of the standard MVC based web site that are simply not an issue with the JAM Stack? Why is caching and caring for high-volume databases hard, but pushing daily updates of files built from Google Sheets so simple that an all-distributed, all-volunteer team can do it with little ramp-up?\n\nI think one of the biggest architectural choices that impacts this decision is articulated by Martin Kleppman in [Turning The Database Inside Out](https://www.confluent.io/blog/turning-the-database-inside-out-with-apache-samza/). He talks about the concept of the materialized view as a DB construct that dodges the notoriously hard problem of cache invalidation completely. Sure the materialized view is a 'cache', as is a static site like a JAM Stack one, but it relates to its upstream very differently - it is maintained by the database **server**, whereas a cache is maintained by a client. With a materialized view, the client selects from it, and through magic that the client need not know about, it gets a fast place to query. The client doesn't have to ask whether the view is up to date - it just trusts that it sees \"the latest\" - at least up to the point that transaction isolation and the [CAP Thorem](https://en.wikipedia.org/wiki/CAP_theorem) allow for. The point is - when a client can trust the server to do some work for it, the net complexity (or modularity, or failure-proneness) of the system **may** go down.\n\nThe reason this happens has to do with the [Dependency Inversion](https://deviq.com/dependency-inversion-principle/) principle. When you build sites the MVC/Rails/Node way your site code depends on the database.\n\n\n![Regular Web Flow](https://dev-to-uploads.s3.amazonaws.com/i/ss55toqhye6dun3tkjxi.png)\n\nWhereas in the JAM Stack, the dependency arrows follow the flow of data instead of a flow of 'requests'.\n \n![JAM Stack Flow](https://dev-to-uploads.s3.amazonaws.com/i/1bsqiah0wfi2h6qqo4bl.png)\n\nThe front-end is \"built from\" the database but it does not _\"query\"_ the database. Like a Materialized View, or a Gatsby static site.\n\nThe sheer amount of differences of these two architectures is hard to appreciate from just these diagrams, but if you've felt the pain of a front-end needing to both query a database, and a cache, reconcile and coordinate differences in their answers, and keep the cache up to date, you'll understand how much momentum is sapped by having to do that part of the process manually. We need to use computers to automate away this work as much as possible.\n\nIt's what the [Reactive Manifesto](https://www.reactivemanifesto.org/) tries to address - we need systems that are Reactive to data changes. If we can point the arrows **toward** our users, turning the database inside out, we can empower ourselves to better address their needs on a timeline that balances our needs with their important demands. Users may not directly care about our need for reliability, simplicity, or our delivery schedules, but we need to care about those if we are going to help them.\n\nAnd sometimes the way to best help them is by saying Google Sheets is good enough, and then dropping it into the correct place of an architecture where it will not be a bottleneck. And then you can push out life-saving data without even having to start from or even involve a relational database. Except through JavaScript, APIs, and Markup. The JAM Stack.\n\nYes, sometimes companies want to pay for literally up-to-the-second live data - in which case you have this set of challenges that doesn't exist with static sites. True. So it's not an apples to apples comparison. But it's a provocative way to question what points we start from - because eventually we may be bound by those decisions, and it's good to know when picking an architecture a) what are your current choices and b) what are their possible, or eventual failure modes.\n\n-Dean\n\n---\nResources:\n\n- [The Covid Tracking Project](https://jamstackconfvirtual.sched.com/event/cES0/the-covid-tracking-project-0-to-2m-api-requests-in-3-months)\n- [Turning The Database Inside Out](https://www.confluent.io/blog/turning-the-database-inside-out-with-apache-samza/)\n- [CAP Thorem](https://en.wikipedia.org/wiki/CAP_theorem)\n- [Dependency Inversion](https://deviq.com/dependency-inversion-principle/)\n- [Reactive Manifesto](https://www.reactivemanifesto.org/)\n\n\n","cached_tag_list":"gatsby, rails, netlify","cached_user_name":"Dean Radcliffe","cached_user_username":"deanius","comments_count":0,"description":"Static sites","main_image":"https://images.unsplash.com/photo-1525604885849-bb72cf86832c?ixlib=rb-1.2.1\u0026ixid=eyJhcHBfaWQiOjEyMDd9\u0026auto=format\u0026fit=crop\u0026w=1000\u0026q=80","main_image_background_hex_color":"#dddddd","path":"/deanius/how-the-jam-stack-can-drive-scalability-1b0p","public_reactions_count":5,"processed_html":"\u003cp\u003eFor those who've worked on high-traffic sites built in Ruby on Rails, Node, or any other platform, a riddle: \u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eA site for (frequently updated) COVID-19 data had an average daily load of 100,000 users. On a single day, after a White House mention, it spiked to 1.2 million users. It never errored out or fell over, and its all-volunteer team never encountered a huge hosting bill for that day. \u003cem\u003eWhat technologies was it built in?\u003c/em\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\u003cem\u003eSource: \u003ca href=\"https://jamstackconfvirtual.sched.com/event/cES0/the-covid-tracking-project-0-to-2m-api-requests-in-3-months\" target=\"_blank\" rel=\"noopener noreferrer\"\u003eThe Covid Tracking Project\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003eYou must be running through the AWS service catalog in your head now, or thinking of Postgres optimizations. You must be thinking Kubernetes must be involved, or at least Docker or Elastic Compute. You probably were not thinking the real answer: Google Drive Sheets and GatsbyJS, hosted on Netlify. The JAM Stack of JavaScript, APIs and Markup.\u003c/p\u003e\n\n\u003cp\u003eIt's not easy, with the current 'standard' set of web technologies, to produce something that scalable in only 3 months. If you started at the beginning with Rails and MySQL, even with Redis, caching, or a screaming Postgres, how many months would you have to iterate upon before you could reach that level? More than 3 I would say. And more importantly - why does it seem that an order of magnitude of more challenges lie in the way of the standard MVC based web site that are simply not an issue with the JAM Stack? Why is caching and caring for high-volume databases hard, but pushing daily updates of files built from Google Sheets so simple that an all-distributed, all-volunteer team can do it with little ramp-up?\u003c/p\u003e\n\n\u003cp\u003eI think one of the biggest architectural choices that impacts this decision is articulated by Martin Kleppman in \u003ca href=\"https://www.confluent.io/blog/turning-the-database-inside-out-with-apache-samza/\" target=\"_blank\" rel=\"noopener noreferrer\"\u003eTurning The Database Inside Out\u003c/a\u003e. He talks about the concept of the materialized view as a DB construct that dodges the notoriously hard problem of cache invalidation completely. Sure the materialized view is a 'cache', as is a static site like a JAM Stack one, but it relates to its upstream very differently - it is maintained by the database \u003cstrong\u003eserver\u003c/strong\u003e, whereas a cache is maintained by a client. With a materialized view, the client selects from it, and through magic that the client need not know about, it gets a fast place to query. The client doesn't have to ask whether the view is up to date - it just trusts that it sees \"the latest\" - at least up to the point that transaction isolation and the \u003ca href=\"https://en.wikipedia.org/wiki/CAP_theorem\" target=\"_blank\" rel=\"noopener noreferrer\"\u003eCAP Thorem\u003c/a\u003e allow for. The point is - when a client can trust the server to do some work for it, the net complexity (or modularity, or failure-proneness) of the system \u003cstrong\u003emay\u003c/strong\u003e go down.\u003c/p\u003e\n\n\u003cp\u003eThe reason this happens has to do with the \u003ca href=\"https://deviq.com/dependency-inversion-principle/\" target=\"_blank\" rel=\"noopener noreferrer\"\u003eDependency Inversion\u003c/a\u003e principle. When you build sites the MVC/Rails/Node way your site code depends on the database.\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fi%2Fss55toqhye6dun3tkjxi.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fi%2Fss55toqhye6dun3tkjxi.png\" alt=\"Regular Web Flow\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eWhereas in the JAM Stack, the dependency arrows follow the flow of data instead of a flow of 'requests'.\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fi%2F1bsqiah0wfi2h6qqo4bl.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fdev-to-uploads.s3.amazonaws.com%2Fi%2F1bsqiah0wfi2h6qqo4bl.png\" alt=\"JAM Stack Flow\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eThe front-end is \"built from\" the database but it does not \u003cem\u003e\"query\"\u003c/em\u003e the database. Like a Materialized View, or a Gatsby static site.\u003c/p\u003e\n\n\u003cp\u003eThe sheer amount of differences of these two architectures is hard to appreciate from just these diagrams, but if you've felt the pain of a front-end needing to both query a database, and a cache, reconcile and coordinate differences in their answers, and keep the cache up to date, you'll understand how much momentum is sapped by having to do that part of the process manually. We need to use computers to automate away this work as much as possible.\u003c/p\u003e\n\n\u003cp\u003eIt's what the \u003ca href=\"https://www.reactivemanifesto.org/\" target=\"_blank\" rel=\"noopener noreferrer\"\u003eReactive Manifesto\u003c/a\u003e tries to address - we need systems that are Reactive to data changes. If we can point the arrows \u003cstrong\u003etoward\u003c/strong\u003e our users, turning the database inside out, we can empower ourselves to better address their needs on a timeline that balances our needs with their important demands. Users may not directly care about our need for reliability, simplicity, or our delivery schedules, but we need to care about those if we are going to help them.\u003c/p\u003e\n\n\u003cp\u003eAnd sometimes the way to best help them is by saying Google Sheets is good enough, and then dropping it into the correct place of an architecture where it will not be a bottleneck. And then you can push out life-saving data without even having to start from or even involve a relational database. Except through JavaScript, APIs, and Markup. The JAM Stack.\u003c/p\u003e\n\n\u003cp\u003eYes, sometimes companies want to pay for literally up-to-the-second live data - in which case you have this set of challenges that doesn't exist with static sites. True. So it's not an apples to apples comparison. But it's a provocative way to question what points we start from - because eventually we may be bound by those decisions, and it's good to know when picking an architecture a) what are your current choices and b) what are their possible, or eventual failure modes.\u003c/p\u003e\n\n\u003cp\u003e-Dean\u003c/p\u003e\n\n\n\u003chr\u003e\n\n\u003cp\u003eResources:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://jamstackconfvirtual.sched.com/event/cES0/the-covid-tracking-project-0-to-2m-api-requests-in-3-months\" target=\"_blank\" rel=\"noopener noreferrer\"\u003eThe Covid Tracking Project\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.confluent.io/blog/turning-the-database-inside-out-with-apache-samza/\" target=\"_blank\" rel=\"noopener noreferrer\"\u003eTurning The Database Inside Out\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://en.wikipedia.org/wiki/CAP_theorem\" target=\"_blank\" rel=\"noopener noreferrer\"\u003eCAP Thorem\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://deviq.com/dependency-inversion-principle/\" target=\"_blank\" rel=\"noopener noreferrer\"\u003eDependency Inversion\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.reactivemanifesto.org/\" target=\"_blank\" rel=\"noopener noreferrer\"\u003eReactive Manifesto\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n","published":true,"published_from_feed":false,"show_comments":true,"slug":"how-the-jam-stack-can-drive-scalability-1b0p","social_image":null,"title":"How The JAM Stack Can Drive Scalability","video":null,"video_code":null},{"created_at":"2020-06-19T04:31:24.799Z","crossposted_at":null,"edited_at":"2020-06-21T11:26:29.945Z","last_comment_at":"2024-07-03T03:02:35.281Z","published_at":"2020-06-19T04:34:49.427Z","canonical_url":null,"feed_source_url":null,"video_closed_caption_track_url":null,"video_source_url":null,"video_thumbnail_url":null,"body_markdown":"---\ntitle: When Is It Time To Kill Your Pet Project?\npublished: true\ndescription: How do you know when it's time to move on\ntags: JavaScript, React, life, opensource\ncover_image: https://images.unsplash.com/photo-1559167147-8ed7885ee190?ixlib=rb-1.2.1\u0026ixid=eyJhcHBfaWQiOjEyMDd9\u0026auto=format\u0026fit=crop\u0026w=1000\u0026q=80\n---\n\nWhen it's time to kill your pet project, it's probably not easy to do it, after all you've spent so much time already and had such big plans for it! But how will you know when it's time to kill it? This is my story of how I knew I had to fish or cut bait on my pet project, polyrhythm.\n\n---\nEveryone in the house was asleep, It was almost midnight, and I was up talking to myself in the bathroom mirror while I cleaned it, determined that night to make another example app to play with, for my pet project [polyrhythm](https://github.com/deanius/polyrhythm). That's when it happened. The thought that couldn't be shook came and said _You either finish that example tonight, or you need to write a post on, and follow through with - killing your pet project._\n\nI knew at that instant that it was absolutely worth giving the project killing post a try. After all, if I could kill my own interest in something that wasn't paying the bills, then why not? It's not like as a husband and father I couldn't reclaim that time, if my employer didn't need it. I decided to face some hard truths. Or at least dare myself to look at them before I continued down the road I was on. And so should you.\n\nI don't think I need to tell you **how** to kill your pet project - that would be different for everyone. But I think I can tell you, from personal experience, **when** it might be time to kill it.\n\n---\n\nI had started polyrhythm while at a client nearly 3 years ago. It was a major upgrade in my role, and I was motivated to do the best work I could for them. Part of that work caused remnants to drop on the floor, figuratively, and I would save those remnants. On my commute home, I'd toy with how they fit together, and that's when version 1 took shape. I enjoyed applying this project to some long-standing problems I'd had that I felt previous tools inadequately addressed. ** But when that client engagement ended, I got my first warning sign that I was addicted: I told myself that polyrhythm would be my next meal ticket, if only I could develop it enough. And between that engagement and the next one I got, I built dozens of sample apps upon polyrhythm, wrote dozens of gitbook pages as tutorials. It helped my chops- but didn't help my life though. I needed every spare minute for polyrhythm, so when I was around my family I was distracted. I wish I could say that distractedness was unique to that period of time, but it wasn't. And this brings us to the first warning sign: you want to spend **all** the time on it. It's fine to have a dream, to be \"building a boat\" in the garage, but to confuse that with real work is really dangerous since you can be chasing something that will never pay off.\n\nThe next warning sign came after I instructed a 12 week JavaScript bootcamp. This didn't leave me with after-hours time for polyrhythm at all, but it did fill my head with ideas on how polyrhythm could simplify so many of the things these students were learning in NodeJS, JQuery MongoDB and React. I thought it was actually unfair to put them through so many different API styles (synchronous DOM updates, callbacks, Promises, React class-based and functional components, `async/await`, while they were just getting their feet underneath them with coding! I just knew then, and still believe now, that if you start with polyrhythm, then you can have nicer architecture and end results than with nearly any other web framework. And so after that engagement ended, I took my freshly-honed teaching skills and made even MORE polyrhythm examples, demos and documentation. But still, it was me working on my pet project. No plans to monetize it, no business model - just a better way **for me**, that I wanted to explore and share, but it consumed so much time for me exploring it.\n\nOn another engagement, I was using React again, and growing really frustrated with the growing list of props. The problem was - there were too many props, many of them functions that had to be carefully memoized - yuck! So with an aim to see how it could help in a React context and help with the prop-passing and prop-drilling problem, and with the chance to re-write it in TypeScript, my interest in polyrhythm got a new boost. \n\nBut the next warning sign showed up too—when I told people about it, their follow-up questions showed I'd missed the mark. One was confused by its lack of a concise \"elevator pitch\". One said \"You've clearly put a lot of work into this - why?\", and others just nodded politely. If I was able to use the same tool to build 60FPS games as regular CRUD over REST or even WebSockets - why were others not excited as I was? And the warning sign is this: you tell yourself you just need to work harder (on your explanations, examples, code, tests, etc)  and *then* everyone will understand. This kind of logic justifies what is really an addictive behavior, and has little to do with its likeliness to show a return. If you find yourself here, you are in yellow-light territory.\n\nBut the final red-light warning sign was its death knell: I could not find the time to fit in the ever growing list of ideas for it. My ambitions had grown far beyond my capacity. And the plans I'd concoct to keep going how I was were increasingly met with resistance by reality and time constraints. I'd rationalize that it wouldn't take long since it was **only** an adjustment. I just did not have that kind of time. And I started to realize it just wasn't making me feel good anymore. I'd feel guilt that I wasn't feeding the Monster rather than the joy of playing with it or sharing it. I'd be missing moments with my wife and children when I was distracted or unhappy with that day's progress. When you know this, you must be kind to yourself, and others, and you have to kill it.\n\nIf you recognize yourself in this story, only you know if killing your project is what you need to do. If you do, though, one way to make it easier on yourself is to remind yourself that it will be there for you to return to if it becomes useful due to new circumstances. Another is to pick up a different hobby - like the banjo, or juggling or something - one that let's you be excited in a similar, but where you cannot get so deeply involved. \n\nIf you love what you do, you owe it to yourself to focus on the things with the highest impact. Your pet projects should be those things whose promise of exciting results is bringing you joy, or into ever-richer sharing and conversation. It should be a net positive. And when it goes south, well, you can be kind, but you know what you have to do. \n\n\n","cached_tag_list":"javascript, react, life, opensource","cached_user_name":"Dean Radcliffe","cached_user_username":"deanius","comments_count":4,"description":"How do you know when it's time to move on","main_image":"https://images.unsplash.com/photo-1559167147-8ed7885ee190?ixlib=rb-1.2.1\u0026ixid=eyJhcHBfaWQiOjEyMDd9\u0026auto=format\u0026fit=crop\u0026w=1000\u0026q=80","main_image_background_hex_color":"#dddddd","path":"/deanius/when-is-it-time-to-kill-your-pet-project-1816","public_reactions_count":7,"processed_html":"\u003cp\u003eWhen it's time to kill your pet project, it's probably not easy to do it, after all you've spent so much time already and had such big plans for it! But how will you know when it's time to kill it? This is my story of how I knew I had to fish or cut bait on my pet project, polyrhythm.\u003c/p\u003e\n\n\n\u003chr\u003e\n\n\u003cp\u003eEveryone in the house was asleep, It was almost midnight, and I was up talking to myself in the bathroom mirror while I cleaned it, determined that night to make another example app to play with, for my pet project \u003ca href=\"https://github.com/deanius/polyrhythm\"\u003epolyrhythm\u003c/a\u003e. That's when it happened. The thought that couldn't be shook came and said \u003cem\u003eYou either finish that example tonight, or you need to write a post on, and follow through with - killing your pet project.\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003eI knew at that instant that it was absolutely worth giving the project killing post a try. After all, if I could kill my own interest in something that wasn't paying the bills, then why not? It's not like as a husband and father I couldn't reclaim that time, if my employer didn't need it. I decided to face some hard truths. Or at least dare myself to look at them before I continued down the road I was on. And so should you.\u003c/p\u003e\n\n\u003cp\u003eI don't think I need to tell you \u003cstrong\u003ehow\u003c/strong\u003e to kill your pet project - that would be different for everyone. But I think I can tell you, from personal experience, \u003cstrong\u003ewhen\u003c/strong\u003e it might be time to kill it.\u003c/p\u003e\n\n\n\u003chr\u003e\n\n\u003cp\u003eI had started polyrhythm while at a client nearly 3 years ago. It was a major upgrade in my role, and I was motivated to do the best work I could for them. Part of that work caused remnants to drop on the floor, figuratively, and I would save those remnants. On my commute home, I'd toy with how they fit together, and that's when version 1 took shape. I enjoyed applying this project to some long-standing problems I'd had that I felt previous tools inadequately addressed. ** But when that client engagement ended, I got my first warning sign that I was addicted: I told myself that polyrhythm would be my next meal ticket, if only I could develop it enough. And between that engagement and the next one I got, I built dozens of sample apps upon polyrhythm, wrote dozens of gitbook pages as tutorials. It helped my chops- but didn't help my life though. I needed every spare minute for polyrhythm, so when I was around my family I was distracted. I wish I could say that distractedness was unique to that period of time, but it wasn't. And this brings us to the first warning sign: you want to spend \u003cstrong\u003eall\u003c/strong\u003e the time on it. It's fine to have a dream, to be \"building a boat\" in the garage, but to confuse that with real work is really dangerous since you can be chasing something that will never pay off.\u003c/p\u003e\n\n\u003cp\u003eThe next warning sign came after I instructed a 12 week JavaScript bootcamp. This didn't leave me with after-hours time for polyrhythm at all, but it did fill my head with ideas on how polyrhythm could simplify so many of the things these students were learning in NodeJS, JQuery MongoDB and React. I thought it was actually unfair to put them through so many different API styles (synchronous DOM updates, callbacks, Promises, React class-based and functional components, \u003ccode\u003easync/await\u003c/code\u003e, while they were just getting their feet underneath them with coding! I just knew then, and still believe now, that if you start with polyrhythm, then you can have nicer architecture and end results than with nearly any other web framework. And so after that engagement ended, I took my freshly-honed teaching skills and made even MORE polyrhythm examples, demos and documentation. But still, it was me working on my pet project. No plans to monetize it, no business model - just a better way \u003cstrong\u003efor me\u003c/strong\u003e, that I wanted to explore and share, but it consumed so much time for me exploring it.\u003c/p\u003e\n\n\u003cp\u003eOn another engagement, I was using React again, and growing really frustrated with the growing list of props. The problem was - there were too many props, many of them functions that had to be carefully memoized - yuck! So with an aim to see how it could help in a React context and help with the prop-passing and prop-drilling problem, and with the chance to re-write it in TypeScript, my interest in polyrhythm got a new boost. \u003c/p\u003e\n\n\u003cp\u003eBut the next warning sign showed up too—when I told people about it, their follow-up questions showed I'd missed the mark. One was confused by its lack of a concise \"elevator pitch\". One said \"You've clearly put a lot of work into this - why?\", and others just nodded politely. If I was able to use the same tool to build 60FPS games as regular CRUD over REST or even WebSockets - why were others not excited as I was? And the warning sign is this: you tell yourself you just need to work harder (on your explanations, examples, code, tests, etc)  and \u003cem\u003ethen\u003c/em\u003e everyone will understand. This kind of logic justifies what is really an addictive behavior, and has little to do with its likeliness to show a return. If you find yourself here, you are in yellow-light territory.\u003c/p\u003e\n\n\u003cp\u003eBut the final red-light warning sign was its death knell: I could not find the time to fit in the ever growing list of ideas for it. My ambitions had grown far beyond my capacity. And the plans I'd concoct to keep going how I was were increasingly met with resistance by reality and time constraints. I'd rationalize that it wouldn't take long since it was \u003cstrong\u003eonly\u003c/strong\u003e an adjustment. I just did not have that kind of time. And I started to realize it just wasn't making me feel good anymore. I'd feel guilt that I wasn't feeding the Monster rather than the joy of playing with it or sharing it. I'd be missing moments with my wife and children when I was distracted or unhappy with that day's progress. When you know this, you must be kind to yourself, and others, and you have to kill it.\u003c/p\u003e\n\n\u003cp\u003eIf you recognize yourself in this story, only you know if killing your project is what you need to do. If you do, though, one way to make it easier on yourself is to remind yourself that it will be there for you to return to if it becomes useful due to new circumstances. Another is to pick up a different hobby - like the banjo, or juggling or something - one that let's you be excited in a similar, but where you cannot get so deeply involved. \u003c/p\u003e\n\n\u003cp\u003eIf you love what you do, you owe it to yourself to focus on the things with the highest impact. Your pet projects should be those things whose promise of exciting results is bringing you joy, or into ever-richer sharing and conversation. It should be a net positive. And when it goes south, well, you can be kind, but you know what you have to do. \u003c/p\u003e\n\n","published":true,"published_from_feed":false,"show_comments":true,"slug":"when-is-it-time-to-kill-your-pet-project-1816","social_image":null,"title":"When Is It Time To Kill Your Pet Project?","video":null,"video_code":null},{"created_at":"2020-08-02T17:30:37.952Z","crossposted_at":null,"edited_at":"2020-08-05T15:34:56.496Z","last_comment_at":"2020-08-02T20:53:50.917Z","published_at":"2020-08-02T20:53:50.917Z","canonical_url":null,"feed_source_url":null,"video_closed_caption_track_url":null,"video_source_url":null,"video_thumbnail_url":null,"body_markdown":"---\ntitle: Redux Observable vs Polyrhythm\npublished: true\ndescription: If you like Redux/Observable, you might like polyrhythm\ntags: redux, rxjs, javascript, angular\ncover_image: https://images.unsplash.com/photo-1577727979487-ed2750b2d2d5?ixlib=rb-1.2.1\u0026ixid=eyJhcHBfaWQiOjEyMDd9\u0026auto=format\u0026fit=crop\u0026w=2767\u0026q=80\n---\n\nRedux took the front-end world by storm, elegantly solving the problem of synchronous state changes. Yet it left developers mostly on their own when it came to async.\n\nToday I'll discuss two libraries: a Redux middleware called Redux Observable, and a non-Redux library called polyrhythm, and compare and explain how they both fill that gap, and why you might choose one or the other.\n\nIn the spirit of transparency, I am the author of polyrhythm, but I freely cite Redux Observable as an influence and wouldn't discourage you from choosing it- but I would welcome you to give polyrhythm, and its many examples a look!\n\n---\n\n# The Need For Asynchrony\n\nConsider how we work with money in the real world. There are events (_transactions_) that result in instantaneous settlement, and then there are those that take time. On the one hand, if you pay with a $20 bill for a latte that costs $3.60, you get your $16.40 change instantanteously. _Synchronously_. On the other hand, when you initiate a wire transfer, it will settle, but some time later that business day or another day. _Asynchronously, like a Promise_.\n\nThe core of the async problem is that JavaScript, like most current languages, is based entirely on synchronous data. You can't use `if-else` with an asynchronous value- even the language's control structures don't work on async data. The `Promise` is only officially 5 years old, and the language had 15 years of evolution and use before. So basically, asynchrony is still an afterthought, resulting in a hodgepodge of solutions.\n\nSome folks believe that Promises are enough if you only want a single value ([see this thread](https://twitter.com/BenLesh/status/1284504443795509249?s=20)). But I think a single value has never been enough for the Web. A value from a remote server is stale right away—unless it includes all future updates in the form of a stream. And if you want single-value delivery to have nice things like progress notifications, or `start/(end|error)` events, you've left the single-value paradigm.\n\nThe bottom line is that the fundamental data type of a stream, defined in the [TC39 Observable proposal](), and implemented primarily by RxJS, is a useful everyday value type in web development. \n\nSince Redux Observable and polyrhythm both agree with that premise, let's use an example to compare!\n\n## Example: From a Job, A Stream of Payments\n\nOur example, is a happy one, celebrating a recent event in my life. In it, you get a job (by dispatching a `job/start` action), and thus can happily consume a stream of `job/paycheck` actions in return!\n\n```js\nconst jobAction = {\n  type: 'job/start',\n  payload: {\n      employeeId: 271828,\n\t  employerId: 314159,\n\t  startDate: '2020-08-10'\n  }\n}\n```\nFor an Observable of paychecks (let's use 30ms as a stand-in for 30 days), we define a stream called `payActions`.\n\n```js\nconst payActions = interval(30).pipe(mapTo({\n  type: 'job/paycheck',\n  payload: {\n     amount: 1000000,\n     currency: 'dollars'\n  }\n}))\n```\n\nWe can now look at how each of these frameworks would dispatch events from `payActions` in response to a `job/start` action. So let's start!\n\n### Redux Observable\n\nFirst we import some operators, and define an epic. From the R/O docs:\n\n\u003e An epic takes a stream of actions and returns a stream of actions.\n\n```js\nimport { filter, mergeMap } from 'rxjs/operators';\n\nconst salaryEpic = (action$) =\u003e action$.pipe(\n\t filter(action =\u003e (action.type === 'job/start')),\n\t mergeMap(() =\u003e payActions)\n  )\n```\n\nThe salary epic takes as input _all_ of the actions that the store ever sees (`action$`), filters them down to those with type `job/start` using `ofType`, and then produces (and returns)  a stream that automatically dispatches `job/paycheck` events every 30 units `mergeMap`. This resulting stream is automatically sent back (dispatch-ed) through the store. (`mergeMap` would allow you to have multiple jobs at once, but we'll discuss that further when we talk about Concurrency.)\n\nThe setup involves modifying your Redux store to include the Redux Observable middleware, and bringing our epic into the middleware:\n\n```js\n// store.js\nimport { createStore, applyMiddleware } from 'redux';\nimport { createEpicMiddleware } from 'redux-observable';\nimport { jobReducer, salaryEpic } from './employment';\n\nconst epicMiddleware = createEpicMiddleware();\nconst store = createStore(\n  jobReducer,\n  applyMiddleware(epicMiddleware)\n);\n\nepicMiddleware.run(combineEpics(salaryEpic));\n```\nAnd we're done!\n\nNow that we've identified the parts of that solution, let's see how those parts correspond to those in polyrhythm.\n\n### Polyrhythm - V.0\n\nPolyrhythm looks a lot like event handlers from the JQuery days. It lets you do anything in handler functions, not just dispatch events. So first we set up the event bus to send every event through the store.\n\nThe imports we use are `listen` and `trigger`— `listen`  takes the event pattern to match as its 1st argument, and `trigger` takes the event to put back on the bus. The setup we need is to send every event (or some subset) into the Redux store, like this:\n\n```js\nimport { listen, trigger } from 'polyrhythm'\nimport store from './localStore'\n\nlisten(true, event =\u003e store.dispatch(event))\n```\n\nAt this point, we've subscribed the store to all actions/events, because the criteria `true` matches all events. Now, `trigger(event)`, or `trigger(type, payload)` will send an event through the Redux store. Thus all we need to do is call `trigger` for every payAction upon a `job/start` event.\n\n```js\nimport { listen, trigger } from 'polyrhythm'\n\nlisten('job/start', () =\u003e {\n  payActions.subscribe(trigger)\n})\n```\n\nNow the shape of the code actually follows its intent, for those familiar with RxJS' `subscribe`:\n\n\u003e Listen for job/start events, on each one, trigger a paycheck for every pay action.\n \n But can we get that one call to `subscribe` out of the code so it's easier to read and explain? \n\n### Polyrhythm V.1 - No more `subscribe`\n\nI'm always compelled to simplify code. My goal is that each constituent part intentionally serves a single purpose. \n\nOur listener function can return the Observable, and never need to call `subscribe` - its subscription will be managed by polyrhythm. Managing Subscription objects is a common RxJS pain point, and Redux Observable doesn't require you to do call `subscribe` so polyrhythm doesn't either:\n\n```js\nlisten('job/start', () =\u003e {\n  return payActions.pipe(tap(trigger))\n})\n```\nBut what if the Observable you're turning into actions isn't written for Redux?\n\n### Polyrhythm V.2 - Use a non-Redux Observable\n\nConsider how the `payActions` Observable is coupled to the names of the dispatched actions. Polyrhythm can decouple the payloads from the types by letting you return Observables of raw values, and assigning types separately.\n\nFirst, let's suppose we have a Redux-unaware Observable `paycheckValues`, which incorporates only pay-related values-over-time like this:\n\n```js\nconst paycheckValues = interval(30).pipe(mapTo({\n   amount: 1000000,\n   currency: 'dollars'\n}))\n```\n\nWe could use the 3rd argument to the `listen` function to both subscribe to these values, and trigger them as `job/paycheck` events!\n\n```js\nlisten('job/start', () =\u003e paycheckValues, {\n\ttrigger: {next: 'job/paycheck'}\n})\n```\nHow cool is that! We get to completely drop the `tap` operator, the pipe, and just rely on what's in `polyrhythm` and our value-only Observables. Our code now reads:\n\n\u003e When you get a job/start event, take the paycheckValues stream and trigger each as job/paycheck.\n\nNow let's see how polyrhythm takes one of RxJS strength - timing control - and allows you to make it even more configurable.\n\n## Con-Concurrency\n\nOne of the big questions of async is - when an async operation is ongoing, do you start a new one, enqueue it, or what? In our job example - can you work multiple jobs at once?\n\nRecall, that with Redux Observable, we use standard RxJS operators in order to control how Observables are combined. A couple of issues with this are:\n\n- It's hard and confusing to choose operators\n- Changing them results in changing a chain of code\n\nFor example, the Redux Observable diff that takes this from a multi-job example to a single-job-at-a-time looks like this:\n\n```diff\nconst salaryEpic = (action$) =\u003e action$.pipe(\n\t ofType('job/start'),\n-\t mergeMap(() =\u003e payActions)\n+\t switchMap(() =\u003e payActions)\n  )\n```\n\nIf you know RxJS you know why this works - but how confusing is it to read?! Not only that, must the concurrency behavior be baked-in to the Observable or can it be decoupled from it for easier testability/changeability? \n\nPolyrhythm's 3rd argument has just a spot for controlling concurrency:\n\n```diff\nlisten('job/start', () =\u003e paycheckValues, {\n\ttrigger: {next: 'job/paycheck'},\n-   mode: 'parallel'\t\n+   mode: 'replace'\t\n})\n```\nNow we are really close the business language:\n\n\u003e When you get a job/start event, trigger a paycheck with the specified values (as job/paycheck), and end the previous job's paycheck stream, replacing it with the new paycheck stream!\n\n## A DSL for concurrency\n\nIn my experience, async concurrency matters a great deal to UX! Downloaders should be serial, autocompletes should replace old results, etc. But these behaviors are often not specified along with the requirements of a feature. To help you, the developer, tease out the desired behavior when you get a new feature request-  this graphic can help you prompt _\"Which mode is this feature supposed to operate in?\"_ (My PM/Designer Jase learned to tolerate, if not love getting questions like these from me :) )\n\n![Polyrhythm Concurrency Modes](https://s3.amazonaws.com/www.deanius.com/ConcurModes2.png)\n\nThese are built upon the RxJS operators, but named according to what they do, and including a mode 'toggle' for completeness:\n\n![enter image description here](http://www.deanius.com/async-strategy-matrix.png)\n\n## Other Benefits\n\n -  A polyrhythm trigger criteria can be a string, an Array of strings like R/O, but also a Regex, a function returning a boolean, or a boolean like `true`.\n - The return value from a listener may be a\n   Promise, a single value, an Observable of side effects, or a function which returns a Promise.\n - When you have a listener returned from `listen`, you can shut it down at runtime via `listener.unsubscribe()`\n - `trigger` can accept either an action, or type and payload separately as in `trigger('job/paycheck', '100 USD')`\n - You need not create actions for component-local state changes - `listen`-er functions aren't limited to living in the store, so your components can listen directly.\n\nBasically, whenever I could remove boilerplate, decouple, or otherwise improve DX (Developer Experience), I tried to do so. \n\n## Respect to Prior Art\n\nOne brilliant aspect about Redux Observable is its insight that each new piece of functionality can be implemented in a function which creates a stream of new actions/events  in response to existing events, showing such a safe, and pure-functional way to grow an app. Polyrhythm, while essentially the same architecture, but outside of Redux, exists to get all those benefits, yet still have code that is as readable, and jargon-free as possible. \n\nI hope you'll enjoy giving polyrhythm a try. Check out [its repository](https://github.com/deanius/polyrhythm). It's more than a proof of concept - used in production and highly tested - but use whichever one helps.  \n\nThanks to the Redux Observable team (special mention to Jay Phelps) for inspiration and a hugely helpful Gitter channel.\n\n— Dean\n","cached_tag_list":"redux, rxjs, javascript, angular","cached_user_name":"Dean Radcliffe","cached_user_username":"deanius","comments_count":0,"description":"If you like Redux/Observable, you might like polyrhythm","main_image":"https://images.unsplash.com/photo-1577727979487-ed2750b2d2d5?ixlib=rb-1.2.1\u0026ixid=eyJhcHBfaWQiOjEyMDd9\u0026auto=format\u0026fit=crop\u0026w=2767\u0026q=80","main_image_background_hex_color":"#dddddd","path":"/deanius/redux-observable-vs-polyrhythm-i1n","public_reactions_count":9,"processed_html":"\u003cp\u003eRedux took the front-end world by storm, elegantly solving the problem of synchronous state changes. Yet it left developers mostly on their own when it came to async.\u003c/p\u003e\n\n\u003cp\u003eToday I'll discuss two libraries: a Redux middleware called Redux Observable, and a non-Redux library called polyrhythm, and compare and explain how they both fill that gap, and why you might choose one or the other.\u003c/p\u003e\n\n\u003cp\u003eIn the spirit of transparency, I am the author of polyrhythm, but I freely cite Redux Observable as an influence and wouldn't discourage you from choosing it- but I would welcome you to give polyrhythm, and its many examples a look!\u003c/p\u003e\n\n\n\u003chr\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"the-need-for-asynchrony\" href=\"#the-need-for-asynchrony\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  The Need For Asynchrony\n\u003c/h1\u003e\n\n\u003cp\u003eConsider how we work with money in the real world. There are events (\u003cem\u003etransactions\u003c/em\u003e) that result in instantaneous settlement, and then there are those that take time. On the one hand, if you pay with a $20 bill for a latte that costs $3.60, you get your $16.40 change instantanteously. \u003cem\u003eSynchronously\u003c/em\u003e. On the other hand, when you initiate a wire transfer, it will settle, but some time later that business day or another day. \u003cem\u003eAsynchronously, like a Promise\u003c/em\u003e.\u003c/p\u003e\n\n\u003cp\u003eThe core of the async problem is that JavaScript, like most current languages, is based entirely on synchronous data. You can't use \u003ccode\u003eif-else\u003c/code\u003e with an asynchronous value- even the language's control structures don't work on async data. The \u003ccode\u003ePromise\u003c/code\u003e is only officially 5 years old, and the language had 15 years of evolution and use before. So basically, asynchrony is still an afterthought, resulting in a hodgepodge of solutions.\u003c/p\u003e\n\n\u003cp\u003eSome folks believe that Promises are enough if you only want a single value (\u003ca href=\"https://twitter.com/BenLesh/status/1284504443795509249?s=20\"\u003esee this thread\u003c/a\u003e). But I think a single value has never been enough for the Web. A value from a remote server is stale right away—unless it includes all future updates in the form of a stream. And if you want single-value delivery to have nice things like progress notifications, or \u003ccode\u003estart/(end|error)\u003c/code\u003e events, you've left the single-value paradigm.\u003c/p\u003e\n\n\u003cp\u003eThe bottom line is that the fundamental data type of a stream, defined in the \u003ca href=\"\"\u003eTC39 Observable proposal\u003c/a\u003e, and implemented primarily by RxJS, is a useful everyday value type in web development. \u003c/p\u003e\n\n\u003cp\u003eSince Redux Observable and polyrhythm both agree with that premise, let's use an example to compare!\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"example-from-a-job-a-stream-of-payments\" href=\"#example-from-a-job-a-stream-of-payments\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Example: From a Job, A Stream of Payments\n\u003c/h2\u003e\n\n\u003cp\u003eOur example, is a happy one, celebrating a recent event in my life. In it, you get a job (by dispatching a \u003ccode\u003ejob/start\u003c/code\u003e action), and thus can happily consume a stream of \u003ccode\u003ejob/paycheck\u003c/code\u003e actions in return!\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ejobAction\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ejob/start\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"na\"\u003epayload\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eemployeeId\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e271828\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eemployerId\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e314159\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n      \u003cspan class=\"na\"\u003estartDate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e2020-08-10\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eFor an Observable of paychecks (let's use 30ms as a stand-in for 30 days), we define a stream called \u003ccode\u003epayActions\u003c/code\u003e.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003epayActions\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003einterval\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e30\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003epipe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emapTo\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n  \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ejob/paycheck\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"na\"\u003epayload\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n     \u003cspan class=\"na\"\u003eamount\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1000000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n     \u003cspan class=\"na\"\u003ecurrency\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003edollars\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}))\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eWe can now look at how each of these frameworks would dispatch events from \u003ccode\u003epayActions\u003c/code\u003e in response to a \u003ccode\u003ejob/start\u003c/code\u003e action. So let's start!\u003c/p\u003e\n\n\u003ch3\u003e\n  \u003ca name=\"redux-observable\" href=\"#redux-observable\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Redux Observable\n\u003c/h3\u003e\n\n\u003cp\u003eFirst we import some operators, and define an epic. From the R/O docs:\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eAn epic takes a stream of actions and returns a stream of actions.\u003cbr\u003e\n\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003efilter\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003emergeMap\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003erxjs/operators\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003esalaryEpic\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eaction$\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003eaction$\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epipe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n     \u003cspan class=\"nx\"\u003efilter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eaction\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etype\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ejob/start\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e)),\u003c/span\u003e\n     \u003cspan class=\"nx\"\u003emergeMap\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003epayActions\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eThe salary epic takes as input \u003cem\u003eall\u003c/em\u003e of the actions that the store ever sees (\u003ccode\u003eaction$\u003c/code\u003e), filters them down to those with type \u003ccode\u003ejob/start\u003c/code\u003e using \u003ccode\u003eofType\u003c/code\u003e, and then produces (and returns)  a stream that automatically dispatches \u003ccode\u003ejob/paycheck\u003c/code\u003e events every 30 units \u003ccode\u003emergeMap\u003c/code\u003e. This resulting stream is automatically sent back (dispatch-ed) through the store. (\u003ccode\u003emergeMap\u003c/code\u003e would allow you to have multiple jobs at once, but we'll discuss that further when we talk about Concurrency.)\u003c/p\u003e\n\n\u003cp\u003eThe setup involves modifying your Redux store to include the Redux Observable middleware, and bringing our epic into the middleware:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// store.js\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003ecreateStore\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eapplyMiddleware\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eredux\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003ecreateEpicMiddleware\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eredux-observable\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003ejobReducer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003esalaryEpic\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e./employment\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eepicMiddleware\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ecreateEpicMiddleware\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003estore\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ecreateStore\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003ejobReducer\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eapplyMiddleware\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eepicMiddleware\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003eepicMiddleware\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003erun\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ecombineEpics\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003esalaryEpic\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eAnd we're done!\u003c/p\u003e\n\n\u003cp\u003eNow that we've identified the parts of that solution, let's see how those parts correspond to those in polyrhythm.\u003c/p\u003e\n\n\u003ch3\u003e\n  \u003ca name=\"polyrhythm-v0\" href=\"#polyrhythm-v0\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Polyrhythm - V.0\n\u003c/h3\u003e\n\n\u003cp\u003ePolyrhythm looks a lot like event handlers from the JQuery days. It lets you do anything in handler functions, not just dispatch events. So first we set up the event bus to send every event through the store.\u003c/p\u003e\n\n\u003cp\u003eThe imports we use are \u003ccode\u003elisten\u003c/code\u003e and \u003ccode\u003etrigger\u003c/code\u003e— \u003ccode\u003elisten\u003c/code\u003e  takes the event pattern to match as its 1st argument, and \u003ccode\u003etrigger\u003c/code\u003e takes the event to put back on the bus. The setup we need is to send every event (or some subset) into the Redux store, like this:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003elisten\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003etrigger\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003epolyrhythm\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nx\"\u003estore\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e./localStore\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003elisten\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eevent\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edispatch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eevent\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eAt this point, we've subscribed the store to all actions/events, because the criteria \u003ccode\u003etrue\u003c/code\u003e matches all events. Now, \u003ccode\u003etrigger(event)\u003c/code\u003e, or \u003ccode\u003etrigger(type, payload)\u003c/code\u003e will send an event through the Redux store. Thus all we need to do is call \u003ccode\u003etrigger\u003c/code\u003e for every payAction upon a \u003ccode\u003ejob/start\u003c/code\u003e event.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003elisten\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003etrigger\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003epolyrhythm\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003elisten\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ejob/start\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003epayActions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003etrigger\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eNow the shape of the code actually follows its intent, for those familiar with RxJS' \u003ccode\u003esubscribe\u003c/code\u003e:\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eListen for job/start events, on each one, trigger a paycheck for every pay action.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eBut can we get that one call to \u003ccode\u003esubscribe\u003c/code\u003e out of the code so it's easier to read and explain? \u003c/p\u003e\n\n\u003ch3\u003e\n  \u003ca name=\"polyrhythm-v1-no-more-raw-subscribe-endraw-\" href=\"#polyrhythm-v1-no-more-raw-subscribe-endraw-\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Polyrhythm V.1 - No more \u003ccode\u003esubscribe\u003c/code\u003e\n\u003c/h3\u003e\n\n\u003cp\u003eI'm always compelled to simplify code. My goal is that each constituent part intentionally serves a single purpose. \u003c/p\u003e\n\n\u003cp\u003eOur listener function can return the Observable, and never need to call \u003ccode\u003esubscribe\u003c/code\u003e - its subscription will be managed by polyrhythm. Managing Subscription objects is a common RxJS pain point, and Redux Observable doesn't require you to do call \u003ccode\u003esubscribe\u003c/code\u003e so polyrhythm doesn't either:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003elisten\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ejob/start\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003epayActions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epipe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003etap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003etrigger\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eBut what if the Observable you're turning into actions isn't written for Redux?\u003c/p\u003e\n\n\u003ch3\u003e\n  \u003ca name=\"polyrhythm-v2-use-a-nonredux-observable\" href=\"#polyrhythm-v2-use-a-nonredux-observable\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Polyrhythm V.2 - Use a non-Redux Observable\n\u003c/h3\u003e\n\n\u003cp\u003eConsider how the \u003ccode\u003epayActions\u003c/code\u003e Observable is coupled to the names of the dispatched actions. Polyrhythm can decouple the payloads from the types by letting you return Observables of raw values, and assigning types separately.\u003c/p\u003e\n\n\u003cp\u003eFirst, let's suppose we have a Redux-unaware Observable \u003ccode\u003epaycheckValues\u003c/code\u003e, which incorporates only pay-related values-over-time like this:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003epaycheckValues\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003einterval\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e30\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003epipe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emapTo\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n   \u003cspan class=\"na\"\u003eamount\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1000000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n   \u003cspan class=\"na\"\u003ecurrency\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003edollars\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}))\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eWe could use the 3rd argument to the \u003ccode\u003elisten\u003c/code\u003e function to both subscribe to these values, and trigger them as \u003ccode\u003ejob/paycheck\u003c/code\u003e events!\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003elisten\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ejob/start\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003epaycheckValues\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etrigger\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"na\"\u003enext\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ejob/paycheck\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eHow cool is that! We get to completely drop the \u003ccode\u003etap\u003c/code\u003e operator, the pipe, and just rely on what's in \u003ccode\u003epolyrhythm\u003c/code\u003e and our value-only Observables. Our code now reads:\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eWhen you get a job/start event, take the paycheckValues stream and trigger each as job/paycheck.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eNow let's see how polyrhythm takes one of RxJS strength - timing control - and allows you to make it even more configurable.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"conconcurrency\" href=\"#conconcurrency\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Con-Concurrency\n\u003c/h2\u003e\n\n\u003cp\u003eOne of the big questions of async is - when an async operation is ongoing, do you start a new one, enqueue it, or what? In our job example - can you work multiple jobs at once?\u003c/p\u003e\n\n\u003cp\u003eRecall, that with Redux Observable, we use standard RxJS operators in order to control how Observables are combined. A couple of issues with this are:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eIt's hard and confusing to choose operators\u003c/li\u003e\n\u003cli\u003eChanging them results in changing a chain of code\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eFor example, the Redux Observable diff that takes this from a multi-job example to a single-job-at-a-time looks like this:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight diff\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003econst salaryEpic = (action$) =\u0026gt; action$.pipe(\n\u003c/span\u003e     ofType('job/start'),\n\u003cspan class=\"gd\"\u003e-    mergeMap(() =\u0026gt; payActions)\n\u003c/span\u003e\u003cspan class=\"gi\"\u003e+    switchMap(() =\u0026gt; payActions)\n\u003c/span\u003e  )\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eIf you know RxJS you know why this works - but how confusing is it to read?! Not only that, must the concurrency behavior be baked-in to the Observable or can it be decoupled from it for easier testability/changeability? \u003c/p\u003e\n\n\u003cp\u003ePolyrhythm's 3rd argument has just a spot for controlling concurrency:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight\"\u003e\u003cpre class=\"highlight diff\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003elisten('job/start', () =\u0026gt; paycheckValues, {\n\u003c/span\u003e    trigger: {next: 'job/paycheck'},\n\u003cspan class=\"gd\"\u003e-   mode: 'parallel'    \n\u003c/span\u003e\u003cspan class=\"gi\"\u003e+   mode: 'replace' \n\u003c/span\u003e\u003cspan class=\"err\"\u003e})\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\n\n\n\u003cp\u003eNow we are really close the business language:\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eWhen you get a job/start event, trigger a paycheck with the specified values (as job/paycheck), and end the previous job's paycheck stream, replacing it with the new paycheck stream!\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"a-dsl-for-concurrency\" href=\"#a-dsl-for-concurrency\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  A DSL for concurrency\n\u003c/h2\u003e\n\n\u003cp\u003eIn my experience, async concurrency matters a great deal to UX! Downloaders should be serial, autocompletes should replace old results, etc. But these behaviors are often not specified along with the requirements of a feature. To help you, the developer, tease out the desired behavior when you get a new feature request-  this graphic can help you prompt \u003cem\u003e\"Which mode is this feature supposed to operate in?\"\u003c/em\u003e (My PM/Designer Jase learned to tolerate, if not love getting questions like these from me :) )\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--i9tHOOHF--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://s3.amazonaws.com/www.deanius.com/ConcurModes2.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--i9tHOOHF--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://s3.amazonaws.com/www.deanius.com/ConcurModes2.png\" alt=\"Polyrhythm Concurrency Modes\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eThese are built upon the RxJS operators, but named according to what they do, and including a mode 'toggle' for completeness:\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--7Ny0FRjw--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/http://www.deanius.com/async-strategy-matrix.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--7Ny0FRjw--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/http://www.deanius.com/async-strategy-matrix.png\" alt=\"enter image description here\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"other-benefits\" href=\"#other-benefits\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Other Benefits\n\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e A polyrhythm trigger criteria can be a string, an Array of strings like R/O, but also a Regex, a function returning a boolean, or a boolean like \u003ccode\u003etrue\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eThe return value from a listener may be a\nPromise, a single value, an Observable of side effects, or a function which returns a Promise.\u003c/li\u003e\n\u003cli\u003eWhen you have a listener returned from \u003ccode\u003elisten\u003c/code\u003e, you can shut it down at runtime via \u003ccode\u003elistener.unsubscribe()\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003etrigger\u003c/code\u003e can accept either an action, or type and payload separately as in \u003ccode\u003etrigger('job/paycheck', '100 USD')\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003eYou need not create actions for component-local state changes - \u003ccode\u003elisten\u003c/code\u003e-er functions aren't limited to living in the store, so your components can listen directly.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eBasically, whenever I could remove boilerplate, decouple, or otherwise improve DX (Developer Experience), I tried to do so. \u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"respect-to-prior-art\" href=\"#respect-to-prior-art\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Respect to Prior Art\n\u003c/h2\u003e\n\n\u003cp\u003eOne brilliant aspect about Redux Observable is its insight that each new piece of functionality can be implemented in a function which creates a stream of new actions/events  in response to existing events, showing such a safe, and pure-functional way to grow an app. Polyrhythm, while essentially the same architecture, but outside of Redux, exists to get all those benefits, yet still have code that is as readable, and jargon-free as possible. \u003c/p\u003e\n\n\u003cp\u003eI hope you'll enjoy giving polyrhythm a try. Check out \u003ca href=\"https://github.com/deanius/polyrhythm\"\u003eits repository\u003c/a\u003e. It's more than a proof of concept - used in production and highly tested - but use whichever one helps.  \u003c/p\u003e\n\n\u003cp\u003eThanks to the Redux Observable team (special mention to Jay Phelps) for inspiration and a hugely helpful Gitter channel.\u003c/p\u003e\n\n\u003cp\u003e— Dean\u003c/p\u003e\n\n","published":true,"published_from_feed":false,"show_comments":true,"slug":"redux-observable-vs-polyrhythm-i1n","social_image":null,"title":"Redux Observable vs Polyrhythm","video":null,"video_code":null},{"created_at":"2020-08-04T20:52:38.689Z","crossposted_at":null,"edited_at":"2020-09-04T14:58:18.233Z","last_comment_at":"2021-05-25T07:39:27.542Z","published_at":"2020-08-06T18:46:50.246Z","canonical_url":null,"feed_source_url":null,"video_closed_caption_track_url":null,"video_source_url":null,"video_thumbnail_url":null,"body_markdown":"---\ntitle: Building a Chat with Typing Indicator in React, RxJS and polyrhythm\npublished: true\ndescription: Learn how to do elegant async using RxJS and 🎵polyrhythm🎶\ntags: react, rxjs, redux, angular\ncover_image: https://s3.amazonaws.com/www.deanius.com/ChatCliffhanger.png\n---\n\nIn this post we'll see how we can use Event-Driven Development, and a library called [polyrhythm](https://github.com/deanius/polyrhythm) to solve problems which routinely come up doing async in JavaScript in React, Angular, Vanilla JS, and even Node. It can help decouple components, in particular when sharing data across a component tree, with a simpler API than React Context. It solves problems like:\n\nIn React:\n- Prop-drilling and function-memoization\n- Closing over stale state\n\nAnd in RxJS:\n- Improving the readability of RxJS code\n- Avoiding RxJS operator soup\n\nWe'll also introduce a generalized event handler framework, that shows how useful it can be to return an RxJS Observable as the response from an Event Handler. This will lead us to a new, useful API for implementing and testing async behavior. \n\nSo, now that we know what benefits we can expect to gain, let's see how Event-Driven Development with polyrhythm helps us build a async UI experience we're all familiar with - a Chat UI.\n\n# Chat UI ... _(is typing)_ \n\nChat UIs are pretty ubiquitous on the web now, and can do pretty amazing things whether a person or AI is behind them.\n![Chat UI](https://s3.amazonaws.com/www.deanius.com/ChatUI.gif)\n\nFor our purposes, we'll focus on a two-party version of chat, not a full Slack clone. And for some spicy async behavior, we'll include the typing indicator that shows 3 animated dots when the other user (but not you) is composing a message.\n\n# Plan of Attack\n\nFor completeness, we'll include these acceptance criteria, though I suspect you already know what a Chat UI does :)\n\n```\nChat UI\n  Messages\n    Typing\n      - Builds a pending message\n    Submitting\n      - Clears the pending message\n      - Adds the pending message to the message log\n      - Puts the pending message on the network\n    Receiving\n      - Adds received messages to the message log\n```\n\nThis will take a little while, but will be extremely satisfying - let's begin!\n\n# Part 1 - Messages\n\n## Step 1 — Compose Messages\n\nLet's start by assigning the role of creating and submitting a message to a `MessageComposer` component. \n\nRemember how React is very sensitive to over-rendering, and how over-rendering can ruin our performance? In our `MessageComposer`, we will not require a callback function be passed in `props` in order for us to deliver messages.  Instead of a `prop` callback, we will use an imported function named `trigger`. Trigger neither needs to be passed to other components, nor memoized, since its identity is always the same. So performance won't inadvertently degrade, and that's a win.\n\nThe API of`trigger`, is just like Redux' `dispatch`, except it can take the `type` and `payload` as separate arguments, reducing boilerplate, for another win:\n\n```js\ntrigger('foo', { bar: 1 })\n// is shorter than...\ndispatch({ type: 'foo', payload: {bar: 1} })\n```\n\nNow, to add `pendingMessage` management and `trigger`-ing our component is blissfully straightforward: \n\n```js\nimport { trigger } from \"polyrhythm\";\n\nconst MessageComposer = () =\u003e {\n  const [pendingMessage, setPendingMessage] = useState(\"\");\n\n  const handleChange = (e) =\u003e {\n    setPendingMessage(e.target.value);\n  };\n\n  const handleSend = () =\u003e {\n    setPendingMessage(\"\"); // async - doesn't change pendingMessage\n    trigger(\"message/create\", { text: pendingMessage }); // \u003c---- HERE!!\n  };\n\n  return (\n    \u003cdiv\u003e\n      \u003cinput value={pendingMessage} onchange={handleChange} /\u003e\n      \u003cbutton onclick={handleSend}\u003eSend\u003c/button\u003e\n    \u003c/div\u003e\n  );\n};\n```\n\nTrigger puts a **message/create** message on the default channel - an instance of an event bus. And trigger-ing is all our `MessageComposer` will ever need to do! It never needs to know about what happens to the messages it creates. Decoupling is the next win.\n\nThis clever use of Pub-Sub lets us finish components in any order. What's more, we know that once they are done they will generally not need to change. In over a year working on a large React app with many cooperating components, never once did one `trigger`-ing component need to be changed in order to handle changes to the consumers of that data. \n\nSo, finally, we start our component tree off with an instance of our `MessageComposer` like this:\n\n```js\nconst App = () =\u003e {\n    \u003c\u003e\n      \u003cMessageComposer /\u003e\n    \u003c/\u003e\n  );\n};\n```\n\n## Step 2.1 — Connect the WebSocket and Receive Messages\n\nLet's create a job for a component called `WebsocketService`. It will open a WebSocket client to be able to see message from the other user. When those socket events happen, it will put them onto our event bus with type **message/from/UID**, where UID identifies the other user.\n\nLets assume the Websocket receives all triggered events from the server with the entire Redux-Style event we'll as its payload. \n\n![Embedding an event in a WebSocket frame](https://s3.amazonaws.com/www.deanius.com/socket-on-event.png)\n\nNow, if it's an event we want, we'll trigger it onto the event bus. Here's that code:\n\n```js\nimport { trigger, useEffectAtMount } from \"polyrhythm\";\nimport io from \"socketio.client\";\n\nexport const WebSocketService = ({ myID, url = \"\" }) =\u003e {\n  useEffectAtMount(() =\u003e {\n    const socket = io(url);\n\n    socket.on(\"event\", ({ type, payload }) =\u003e {\n      if (type.startsWith(\"message/from/\")) {\n        trigger(type, payload); // \u003c\u003c------ Announce \"you've got a chat\"!\n      }\n    });\n\n    return () =\u003e {\n      socket.close();\n    };\n  });\n};\n```\nAt mount and unmount time we create and close the socket. `useEffectAtMount` is use a shorthand for `useEffect(fn, [])`. And like `useEffect`, it returns a cancellation function, similar to the Observable constructor from RxJS. It's just a win not to have to figure out what empty brackets means.\n\nThen, upon those socket events we call `trigger` with that payload, and we're done. With those events on the event bus, there's no cost when nothing is listening for them, and we'll listen for them shortly. \n\nNow, in order to pass our local messages on to the socket - we must first `listen` for the **message/create** events in the `WebsocketService`.\n\n## Step 2.2 - Tell them of our messages\n\n`WebsocketService` is where our socket lives - so it should also be able to put our **message/create** events on the wire as **message/from/UID** where UID is populated from a local value we'll call `myId`.\n\nPolyrhythm believes you shouldn't be coupled to a Framework for control over essential things. And listening to the event bus is one of those essential things. You can create a listener—a function which runs in response to matching events, and with a specified concurrency— outside of React, or even in Node— by using the `listen` function.\n\nWhen you call `listen`, the object returned is an RxJS Subscription; it can be shut down just like any Subscribable via the `unsubscribe` method. The way this is implemented is that any event handlers which are in-flight at the time that the listener is shut down - should also be shut down. That's explored more soon, but for now, we'll create and properly shut down our message forwarder, and just call `socket.emit` for matching events.\n\n\n```diff\n- import { trigger, useEffectAtMount } from \"polyrhythm\";\n+ import { trigger, useEffectAtMount, listen } from \"polyrhythm\";\nimport io from \"socketio.client\";\n\nconst WebSocketService = ({ myID }) =\u003e {\n  useEffectAtMount(() =\u003e {\n    const socket = new io(url);\n\t...\n+    const forwarder = listen(\"message/create\", ({ type, payload }) =\u003e {\n+      socket.emit(\"event\", { type: `message/from/${myID}`, payload });\n+    });\n\n    return () =\u003e {\n+     forwarder.unsubscribe();\n      socket.close();\n    };\n  });\n};\n```\n\n## Step 3 — Display Messages\n\nNow that we have components that are originators of **message/(from|create)** events, we'll create a new `ChatLog` component to be in charge of pulling those events' payloads into the `messages` field of state.\n\nLet's use this as an excuse to use the React hook version of `listen`—`useListener`. Remember that when listeners are unsubscribed, any handlings that are in progress will be canceled? When you use `useListener` to perform side-effects, and wrap those side-effects in RxJS Observables, then when your component is unmounted, everything is cleaned up for you right down to the currently executing events! That makes for less leaking of resources - in fact it can be quite bulletproof - I've noticed my mocha watch modes are far more stable than ever while writing the test suite for polyrhythm.\n\nSo basically we have:\n\n```js\nimport { useListener } from \"polyrhythm\";\n\nexport const ChatLog = () =\u003e {\n  const [messages, setMessages] = useState([]);\n\n  useListener(/message\\/(from|create)/, (event) =\u003e {\n    const message = event.payload;\n    setMessages((all) =\u003e [...all, message]);\n  });\n\n  return (\n    \u003cdiv className=\"chat-log\"\u003e\n      {messages.map((message, i) =\u003e {\n        return \u003cChatMessage key={i} {...message} /\u003e;\n      })}\n    \u003c/div\u003e\n  );\n};\n// const ChatMessage = () =\u003e \u003cdiv\u003e...\u003c/div\u003e\n```\n\nWe use `useListener` to maintain an array of `messages`.  You might wonder, would our listener hook be vulnerable to the React stale state problem, if it closed over the variable `messages`? It is not, and here's how it avoids that: It uses the functional form of `setMessages`, which each time passes us the accumulated messages in the variable `all`. That way `messages` is always up-to-date, and `setMessages` is a stable function reference. \n\nHaving to worry about function-reference and variable-reference stability has been the least fun part of working in React for me. I've developed the patterns I'm advocating here in order to help others steer clear of the issues I've experienced that I believe to be inherited by the React framework, and not inherent to the task at hand.\n\nHere is [a working version](https://codesandbox.io/s/poly-chat-imw2z) up to this part. In another post I'll describe what tests we'll have that actually verify what we've got is working, even though everything is as decoupled as it is. But moving on, we'll get into polyrhythm's real strength - timing control.\n\n# Part 2 - The Typing Indicator ...\n\n\nCode always gets more cluttered when you add new requirements, particularly ones that are async and whose behavior overlaps existing requirements.\n\nWhen we add in typing functionality, our Event Grammar grows a bit. The new events are:\n\n- **message/edit/me** When I edit a message, this event is created. A behavior causes it to go out over the wire as **message/edit/UID** where UID is my identifier. It should be sent initially right away, but no more often than once per second.\n- **message/edit/UID** When I get this event from someone else, my typing indicator should get activated (it should auto-clear at 5 seconds, unless extended)\n\nAnd this event has a new consequence:\n\n- **message/from/UID** When I get a message from someone else, the typing indicator should be cleared. (Remember, this is only a 2-party conversation in this demo.)\n\nNow, when adding functionality like the typing indicator, how great would it be if you could make this change, and future changes, with zero-to-minimal effects on other components? The magic of Event Driven Development is that, due to the Pub-Sub architecture, isolation and decoupling is built-in. Let's code it up: \n\n## Step 1 - Announce our Editing\nThe one change to an existing component we must make is to get our `MessageComposer`\nto emit **message/edit/me**:\n\n```diff\nconst MessageComposer = ({ pendingMessage }) =\u003e {\n\n  const handleChange = (e) =\u003e {\n    setPendingMessage(e.target.value);\n+    trigger(\"message/edit/me\")\n  };\n\n};\n```\n\nThis component does no debouncing/throttling, nor should it. A `MessageComposer` should not need to know who wants to know that we have edited. This is the separation of concerns a Pub-Sub or Actor model can afford us, and it leads to highly flexible components that don't get more complicated as the number of listeners grows. \n\n## Step 2.1 — Forward our Editing (throttled)\n\nNow in the `WebSocketService` we decide not to put every **message/edit/me** event on the wire, by throttling to 1000 msec, while remapping the message type to **message/edit/UID** which is the format other clients will expect.\n\nBut before you go reaching for your favorite `throttle` implementation, let me ask - are you sure of whether it's throttle or debounce? Or leading-edge/trailing-edge?\n\nI could never remember those very well, so I broke things down into their basics. What we mean in this case is that for a second after sending a typing notification we should not send another. This can be broken down into two parts.\n\n_Q: What is the task to be done in response to an event?_ \nA: Call `socket.emit` , then wait 1000msec\n\n_Q: Does the task run again even if it is running already?_\nA: Nope. The new task is ignored/not started if an existing task is running.\n\nThe first part is defined by what we return from the listener function. The `concat` operator from RxJS can combine any Observables, so we pass it a couple of Observables made by polyrhythm's `after` function. The first is the synchronous call to `socket.emit`, wrapped in an Observable with no delay. The next is the 1000 msec wait, which doesn't need a return value.\n\n```js\nimport { after } from \"polyrhythm\";\n\nconst WebSocketService = ({ myID }) =\u003e {\n  const typingForwarder = listen(\n    \"message/edit/me\",\n    () =\u003e concat(\n      after(0, () =\u003e socket.emit(\"event\", { type: `message/edit/${myID}` })),\n      after(1000)\n    ),\n    { mode: \"ignore\" }\n  );\n  ...\n  return () =\u003e {\n\t  typingForwarder.unsubscribe()\n  }\n};\n```\n\nThe part about how the listener invocations are combined, is specified in the 3rd argument to `listen`. Any listener execution can be combined with any existing execution according to 1 of 5 modes. We choose the **ignore** mode, so if its' the second time within 1000 msec we see **message/edit/me**, we ignore sending the **message/edit/UID** event over the wire. See how easy it is to map this code onto the language of the requirements given to us:\n\n\u003e Upon editing, send the **message/edit** event right away, but don't send again for the 1000 msec following.\n\n## Step 2.2 — Listen for Other's Edits\n\nThe other half of the typing messages will be that others will put their messages on the wire in a similarly throttled fashion, and we should have those events `trigger`-ed for us to respond to as well.\n\n```diff\nconst WebSocketService = ({ myID }) =\u003e {\n...\n-    if (type.startsWith(\"message/from/\") {\n+    if (type.startsWith(\"message/from/\") ||\n+        type.startsWith(\"message/edit/\")) {\n        trigger(type, payload); \n      }\n    });\n```\n\n## Step 3 — Show the Typing Indicator, With Auto-Hide\n\nLets add a component to `App` called `TypingIndicator` which will listen to these events, and show or hide the typing indicator under the chat log.\n\n```diff\nconst App = () =\u003e {\n    ...\n    return \u003c\u003e\n    \u003cChatLog messages={messages} /\u003e\n+    \u003cTypingIndicator/\u003e\n    \u003cMessageComposer/\u003e\n    \u003cWebsocketService /\u003e\n    \u003c/\u003e\n}\n```\n\nYou may think the TypingIndicator just has to listen for these **message/edit** events, but there are a lot of details. We need to turn off the typing indicator after some time if we haven't heard another **message/edit**. If we receive a **message/from** event then we should turn off the typing indicator.\n\nIn summary:\n\n```\nTyping Indicator\n  Showing\n    - Shows when other has typed\n  Hiding\n    - Hides when other hasn't typed in 5 seconds\n    - Hides when other's message is received\n```\n\nFor auto-hiding, we'll use a similar pattern of returning an Observable of what should happen. But the concurrency mode called **replace** (like the beloved RxJS `switchMap` ) will be the one we'll use.\n\nWe ask the same event-listener questions as before:\n\n_Q: What is the task to be done in response to an event?_ \nA: Show the typing indicator, then hide it after 5000msec.\n\n_Q: Does the task run again even if it is running already?_\nA: Yep. The existing autoTimeout is canceled, and a new one is begun, effectively replacing the old timeout.\n\n```js\nimport { concat, after, useListener } from 'polyrhythm'\n\nconst TypingIndicator = ({ timeout = 5000 }) =\u003e {\n  const [ isTyping, setTyping ] = useState(false);\n\n  const autoTimeoutTyper = () =\u003e concat(\n    after(0, () =\u003e setTyping(true)),\n    after(timeout, () =\u003e setTyping(false))\n  )\n\n  useListener(/message\\/edit\\/(?!me)/, autoTimeoutTyper, { mode: 'replace' });\n  useListener(/message\\/from/, () =\u003e setTyping(false)  )\n\n  return isTyping \u0026\u0026 \u003cdiv className=\"chat-message__typing\"/\u003e;\n}\n```\n\nWe return an Observable that is the `concat`-enation (aka sequencing) of an immediate Observable and a deferred one. Like before these are both created, using the `after` utility function which creates a synchronous or asynchronous Observable ([docs](https://github.com/deanius/polyrhythm/blob/main/src/utils.ts#L22)), depending on its first argument.\n\nEach new triggering of the autoTimeout sequence due to an event matching **message/edit/UID** aborts the previous one, due to the line `{ mode: 'replace' }`. With this option, the listener behaves similarly to the RxJS `switchMap` operator, but in declarative form. \n\nWith that, we have implemented all of our requirements and have a fully functioning chat app! [CodeSandbox here](https://codesandbox.io/s/poly-chat-imw2z).\n\n## Event Graph\n\nThe thing that makes Event Driven Development different is its focus on cause-and-effect mappings. _\"When this, do that\"_ It's useful even before you know what your state will look like, because its closely aligned to your requirements and acceptance criteria, not the implementation of it.\n\nSee how the event graph - which we can produce even before writing a line of code — tells a lot about the architecture of the system, and can be used to vet requirements and acceptance criteria against.\n\n![Event Grammar](https://s3.amazonaws.com/www.deanius.com/ChatUIEventGraph.png)\n\n_BTW I highly recommend you check out the fine MermaidJS Live Editor, which allows you to produce event graphs like this with a very straightforward language ([view source](https://bit.ly/2DqSig0))_\n\n# next() steps\n\nNow you've seen how to build a really cool Chat UI that handled growing new async requirements without destabilizing existing components. It lowered boilerplate, used a concise API, and has very low coupling, while being immune to memoization and prop-drilling complexities.\n\nI hope you've enjoyed learning about the event bus/polyrhythm coding style. If you've got any questions, ask me on twitter at [@deaniusdev](https://twitter.com/deaniusdev) \n\nEnjoy polyrhythm-ing your async 🎵🎶 !\n\nDean\n\nPS If you'd like to use Redux Observable, Redux Saga, Mobx or another library that does similar things to this, then go right ahead. They inspired this library and I continue to learn a great deal from what they do. \n\n\n\n","cached_tag_list":"react, rxjs, redux, angular","cached_user_name":"Dean Radcliffe","cached_user_username":"deanius","comments_count":1,"description":"Learn how to do elegant async using RxJS and 🎵polyrhythm🎶","main_image":"https://s3.amazonaws.com/www.deanius.com/ChatCliffhanger.png","main_image_background_hex_color":"#dddddd","path":"/deanius/building-a-chat-with-typing-indicator-in-rxjs-and-polyrhythm-1bgh","public_reactions_count":12,"processed_html":"\u003cp\u003eIn this post we'll see how we can use Event-Driven Development, and a library called \u003ca href=\"https://github.com/deanius/polyrhythm\" target=\"_blank\" rel=\"noopener noreferrer\"\u003epolyrhythm\u003c/a\u003e to solve problems which routinely come up doing async in JavaScript in React, Angular, Vanilla JS, and even Node. It can help decouple components, in particular when sharing data across a component tree, with a simpler API than React Context. It solves problems like:\u003c/p\u003e\n\n\u003cp\u003eIn React:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eProp-drilling and function-memoization\u003c/li\u003e\n\u003cli\u003eClosing over stale state\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eAnd in RxJS:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eImproving the readability of RxJS code\u003c/li\u003e\n\u003cli\u003eAvoiding RxJS operator soup\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eWe'll also introduce a generalized event handler framework, that shows how useful it can be to return an RxJS Observable as the response from an Event Handler. This will lead us to a new, useful API for implementing and testing async behavior. \u003c/p\u003e\n\n\u003cp\u003eSo, now that we know what benefits we can expect to gain, let's see how Event-Driven Development with polyrhythm helps us build a async UI experience we're all familiar with - a Chat UI.\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"chat-ui-is-typing\" href=\"#chat-ui-is-typing\"\u003e\n  \u003c/a\u003e\n  Chat UI ... \u003cem\u003e(is typing)\u003c/em\u003e\n\u003c/h1\u003e\n\n\u003cp\u003eChat UIs are pretty ubiquitous on the web now, and can do pretty amazing things whether a person or AI is behind them.\u003cbr\u003e\n\u003ca href=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fs3.amazonaws.com%2Fwww.deanius.com%2FChatUI.gif\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fs3.amazonaws.com%2Fwww.deanius.com%2FChatUI.gif\" alt=\"Chat UI\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eFor our purposes, we'll focus on a two-party version of chat, not a full Slack clone. And for some spicy async behavior, we'll include the typing indicator that shows 3 animated dots when the other user (but not you) is composing a message.\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"plan-of-attack\" href=\"#plan-of-attack\"\u003e\n  \u003c/a\u003e\n  Plan of Attack\n\u003c/h1\u003e\n\n\u003cp\u003eFor completeness, we'll include these acceptance criteria, though I suspect you already know what a Chat UI does :)\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e\n\nChat UI\n  Messages\n    Typing\n      - Builds a pending message\n    Submitting\n      - Clears the pending message\n      - Adds the pending message to the message log\n      - Puts the pending message on the network\n    Receiving\n      - Adds received messages to the message log\n\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eThis will take a little while, but will be extremely satisfying - let's begin!\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"part-1-messages\" href=\"#part-1-messages\"\u003e\n  \u003c/a\u003e\n  Part 1 - Messages\n\u003c/h1\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"step-1-compose-messages\" href=\"#step-1-compose-messages\"\u003e\n  \u003c/a\u003e\n  Step 1 — Compose Messages\n\u003c/h2\u003e\n\n\u003cp\u003eLet's start by assigning the role of creating and submitting a message to a \u003ccode\u003eMessageComposer\u003c/code\u003e component. \u003c/p\u003e\n\n\u003cp\u003eRemember how React is very sensitive to over-rendering, and how over-rendering can ruin our performance? In our \u003ccode\u003eMessageComposer\u003c/code\u003e, we will not require a callback function be passed in \u003ccode\u003eprops\u003c/code\u003e in order for us to deliver messages.  Instead of a \u003ccode\u003eprop\u003c/code\u003e callback, we will use an imported function named \u003ccode\u003etrigger\u003c/code\u003e. Trigger neither needs to be passed to other components, nor memoized, since its identity is always the same. So performance won't inadvertently degrade, and that's a win.\u003c/p\u003e\n\n\u003cp\u003eThe API of\u003ccode\u003etrigger\u003c/code\u003e, is just like Redux' \u003ccode\u003edispatch\u003c/code\u003e, except it can take the \u003ccode\u003etype\u003c/code\u003e and \u003ccode\u003epayload\u003c/code\u003e as separate arguments, reducing boilerplate, for another win:\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\n\n\u003cspan class=\"nf\"\u003etrigger\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003efoo\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"na\"\u003ebar\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// is shorter than...\u003c/span\u003e\n\u003cspan class=\"nf\"\u003edispatch\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003efoo\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"na\"\u003epayload\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"na\"\u003ebar\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eNow, to add \u003ccode\u003ependingMessage\u003c/code\u003e management and \u003ccode\u003etrigger\u003c/code\u003e-ing our component is blissfully straightforward: \u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\n\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003etrigger\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003epolyrhythm\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eMessageComposer\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003ependingMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003esetPendingMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003euseState\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ehandleChange\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003esetPendingMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etarget\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ehandleSend\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003esetPendingMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// async - doesn't change pendingMessage\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003etrigger\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003emessage/create\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"na\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003ependingMessage\u003c/span\u003e \u003cspan class=\"p\"\u003e});\u003c/span\u003e \u003cspan class=\"c1\"\u003e// \u0026lt;---- HERE!!\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003ereturn \u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003ediv\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003einput\u003c/span\u003e \u003cspan class=\"nx\"\u003evalue\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003ependingMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"nx\"\u003eonchange\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003ehandleChange\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"sr\"\u003e/\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026gt;\n\u003c/span\u003e      \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003ebutton\u003c/span\u003e \u003cspan class=\"nx\"\u003eonclick\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003ehandleSend\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eSend\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"sr\"\u003e/button\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026gt;\n\u003c/span\u003e    \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"sr\"\u003e/div\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026gt;\n\u003c/span\u003e  \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eTrigger puts a \u003cstrong\u003emessage/create\u003c/strong\u003e message on the default channel - an instance of an event bus. And trigger-ing is all our \u003ccode\u003eMessageComposer\u003c/code\u003e will ever need to do! It never needs to know about what happens to the messages it creates. Decoupling is the next win.\u003c/p\u003e\n\n\u003cp\u003eThis clever use of Pub-Sub lets us finish components in any order. What's more, we know that once they are done they will generally not need to change. In over a year working on a large React app with many cooperating components, never once did one \u003ccode\u003etrigger\u003c/code\u003e-ing component need to be changed in order to handle changes to the consumers of that data. \u003c/p\u003e\n\n\u003cp\u003eSo, finally, we start our component tree off with an instance of our \u003ccode\u003eMessageComposer\u003c/code\u003e like this:\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\n\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eApp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e\u0026lt;\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eMessageComposer\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"sr\"\u003e/\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026gt;\n\u003c/span\u003e  \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003ch2\u003e\n  \u003ca name=\"step-21-connect-the-websocket-and-receive-messages\" href=\"#step-21-connect-the-websocket-and-receive-messages\"\u003e\n  \u003c/a\u003e\n  Step 2.1 — Connect the WebSocket and Receive Messages\n\u003c/h2\u003e\n\n\u003cp\u003eLet's create a job for a component called \u003ccode\u003eWebsocketService\u003c/code\u003e. It will open a WebSocket client to be able to see message from the other user. When those socket events happen, it will put them onto our event bus with type \u003cstrong\u003emessage/from/UID\u003c/strong\u003e, where UID identifies the other user.\u003c/p\u003e\n\n\u003cp\u003eLets assume the Websocket receives all triggered events from the server with the entire Redux-Style event we'll as its payload. \u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fs3.amazonaws.com%2Fwww.deanius.com%2Fsocket-on-event.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fs3.amazonaws.com%2Fwww.deanius.com%2Fsocket-on-event.png\" alt=\"Embedding an event in a WebSocket frame\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eNow, if it's an event we want, we'll trigger it onto the event bus. Here's that code:\u003c/p\u003e\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\n\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003etrigger\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003euseEffectAtMount\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003epolyrhythm\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nx\"\u003eio\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003esocketio.client\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eexport\u003c/span\u003e \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eWebSocketService\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e({\u003c/span\u003e \u003cspan class=\"nx\"\u003emyID\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eurl\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\"\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nf\"\u003euseEffectAtMount\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003esocket\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eio\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003esocket\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eon\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eevent\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e({\u003c/span\u003e \u003cspan class=\"nx\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003epayload\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eif \u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003estartsWith\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003emessage/from/\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003etrigger\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003epayload\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// \u0026lt;\u0026lt;------ Announce \"you've got a chat\"!\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ereturn \u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003esocket\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eclose\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eAt mount and unmount time we create and close the socket. \u003ccode\u003euseEffectAtMount\u003c/code\u003e is use a shorthand for \u003ccode\u003euseEffect(fn, [])\u003c/code\u003e. And like \u003ccode\u003euseEffect\u003c/code\u003e, it returns a cancellation function, similar to the Observable constructor from RxJS. It's just a win not to have to figure out what empty brackets means.\u003c/p\u003e\n\n\u003cp\u003eThen, upon those socket events we call \u003ccode\u003etrigger\u003c/code\u003e with that payload, and we're done. With those events on the event bus, there's no cost when nothing is listening for them, and we'll listen for them shortly. \u003c/p\u003e\n\n\u003cp\u003eNow, in order to pass our local messages on to the socket - we must first \u003ccode\u003elisten\u003c/code\u003e for the \u003cstrong\u003emessage/create\u003c/strong\u003e events in the \u003ccode\u003eWebsocketService\u003c/code\u003e.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"step-22-tell-them-of-our-messages\" href=\"#step-22-tell-them-of-our-messages\"\u003e\n  \u003c/a\u003e\n  Step 2.2 - Tell them of our messages\n\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eWebsocketService\u003c/code\u003e is where our socket lives - so it should also be able to put our \u003cstrong\u003emessage/create\u003c/strong\u003e events on the wire as \u003cstrong\u003emessage/from/UID\u003c/strong\u003e where UID is populated from a local value we'll call \u003ccode\u003emyId\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003ePolyrhythm believes you shouldn't be coupled to a Framework for control over essential things. And listening to the event bus is one of those essential things. You can create a listener—a function which runs in response to matching events, and with a specified concurrency— outside of React, or even in Node— by using the \u003ccode\u003elisten\u003c/code\u003e function.\u003c/p\u003e\n\n\u003cp\u003eWhen you call \u003ccode\u003elisten\u003c/code\u003e, the object returned is an RxJS Subscription; it can be shut down just like any Subscribable via the \u003ccode\u003eunsubscribe\u003c/code\u003e method. The way this is implemented is that any event handlers which are in-flight at the time that the listener is shut down - should also be shut down. That's explored more soon, but for now, we'll create and properly shut down our message forwarder, and just call \u003ccode\u003esocket.emit\u003c/code\u003e for matching events.\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight diff\"\u003e\u003ccode\u003e\u003cspan class=\"err\"\u003e\n\n\u003c/span\u003e\u003cspan class=\"gd\"\u003e- import { trigger, useEffectAtMount } from \"polyrhythm\";\n\u003c/span\u003e\u003cspan class=\"gi\"\u003e+ import { trigger, useEffectAtMount, listen } from \"polyrhythm\";\n\u003c/span\u003e\u003cspan class=\"p\"\u003eimport io from \"socketio.client\";\n\u003c/span\u003e\u003cspan class=\"err\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003econst WebSocketService = ({ myID }) =\u0026gt; {\n\u003c/span\u003e  useEffectAtMount(() =\u0026gt; {\n    const socket = new io(url);\n    ...\n\u003cspan class=\"gi\"\u003e+    const forwarder = listen(\"message/create\", ({ type, payload }) =\u0026gt; {\n+      socket.emit(\"event\", { type: `message/from/${myID}`, payload });\n+    });\n\u003c/span\u003e\u003cspan class=\"err\"\u003e\n\u003c/span\u003e    return () =\u0026gt; {\n\u003cspan class=\"gi\"\u003e+     forwarder.unsubscribe();\n\u003c/span\u003e      socket.close();\n    };\n  });\n};\n\u003cspan class=\"err\"\u003e\n\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003ch2\u003e\n  \u003ca name=\"step-3-display-messages\" href=\"#step-3-display-messages\"\u003e\n  \u003c/a\u003e\n  Step 3 — Display Messages\n\u003c/h2\u003e\n\n\u003cp\u003eNow that we have components that are originators of \u003cstrong\u003emessage/(from|create)\u003c/strong\u003e events, we'll create a new \u003ccode\u003eChatLog\u003c/code\u003e component to be in charge of pulling those events' payloads into the \u003ccode\u003emessages\u003c/code\u003e field of state.\u003c/p\u003e\n\n\u003cp\u003eLet's use this as an excuse to use the React hook version of \u003ccode\u003elisten\u003c/code\u003e—\u003ccode\u003euseListener\u003c/code\u003e. Remember that when listeners are unsubscribed, any handlings that are in progress will be canceled? When you use \u003ccode\u003euseListener\u003c/code\u003e to perform side-effects, and wrap those side-effects in RxJS Observables, then when your component is unmounted, everything is cleaned up for you right down to the currently executing events! That makes for less leaking of resources - in fact it can be quite bulletproof - I've noticed my mocha watch modes are far more stable than ever while writing the test suite for polyrhythm.\u003c/p\u003e\n\n\u003cp\u003eSo basically we have:\u003c/p\u003e\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\n\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003euseListener\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003epolyrhythm\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eexport\u003c/span\u003e \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eChatLog\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003emessages\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003esetMessages\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003euseState\u003c/span\u003e\u003cspan class=\"p\"\u003e([]);\u003c/span\u003e\n\n  \u003cspan class=\"nf\"\u003euseListener\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sr\"\u003e/message\u003c/span\u003e\u003cspan class=\"se\"\u003e\\/(\u003c/span\u003e\u003cspan class=\"sr\"\u003efrom|create\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"sr\"\u003e/\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eevent\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003emessage\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eevent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epayload\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003esetMessages\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"nx\"\u003eall\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e[...\u003c/span\u003e\u003cspan class=\"nx\"\u003eall\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003ereturn \u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003ediv\u003c/span\u003e \u003cspan class=\"nx\"\u003eclassName\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003echat-log\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003emessages\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003emap\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"nx\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eChatMessage\u003c/span\u003e \u003cspan class=\"nx\"\u003ekey\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e{...\u003c/span\u003e\u003cspan class=\"nx\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"sr\"\u003e/\u0026gt;\u003c/span\u003e\u003cspan class=\"err\"\u003e;\n\u003c/span\u003e      \u003cspan class=\"p\"\u003e})}\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"sr\"\u003e/div\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026gt;\n\u003c/span\u003e  \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// const ChatMessage = () =\u0026gt; \u0026lt;div\u0026gt;...\u0026lt;/div\u0026gt;\u003c/span\u003e\n\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eWe use \u003ccode\u003euseListener\u003c/code\u003e to maintain an array of \u003ccode\u003emessages\u003c/code\u003e.  You might wonder, would our listener hook be vulnerable to the React stale state problem, if it closed over the variable \u003ccode\u003emessages\u003c/code\u003e? It is not, and here's how it avoids that: It uses the functional form of \u003ccode\u003esetMessages\u003c/code\u003e, which each time passes us the accumulated messages in the variable \u003ccode\u003eall\u003c/code\u003e. That way \u003ccode\u003emessages\u003c/code\u003e is always up-to-date, and \u003ccode\u003esetMessages\u003c/code\u003e is a stable function reference. \u003c/p\u003e\n\n\u003cp\u003eHaving to worry about function-reference and variable-reference stability has been the least fun part of working in React for me. I've developed the patterns I'm advocating here in order to help others steer clear of the issues I've experienced that I believe to be inherited by the React framework, and not inherent to the task at hand.\u003c/p\u003e\n\n\u003cp\u003eHere is \u003ca href=\"https://codesandbox.io/s/poly-chat-imw2z\" target=\"_blank\" rel=\"noopener noreferrer\"\u003ea working version\u003c/a\u003e up to this part. In another post I'll describe what tests we'll have that actually verify what we've got is working, even though everything is as decoupled as it is. But moving on, we'll get into polyrhythm's real strength - timing control.\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"part-2-the-typing-indicator-\" href=\"#part-2-the-typing-indicator-\"\u003e\n  \u003c/a\u003e\n  Part 2 - The Typing Indicator ...\n\u003c/h1\u003e\n\n\u003cp\u003eCode always gets more cluttered when you add new requirements, particularly ones that are async and whose behavior overlaps existing requirements.\u003c/p\u003e\n\n\u003cp\u003eWhen we add in typing functionality, our Event Grammar grows a bit. The new events are:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003cstrong\u003emessage/edit/me\u003c/strong\u003e When I edit a message, this event is created. A behavior causes it to go out over the wire as \u003cstrong\u003emessage/edit/UID\u003c/strong\u003e where UID is my identifier. It should be sent initially right away, but no more often than once per second.\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003emessage/edit/UID\u003c/strong\u003e When I get this event from someone else, my typing indicator should get activated (it should auto-clear at 5 seconds, unless extended)\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eAnd this event has a new consequence:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003cstrong\u003emessage/from/UID\u003c/strong\u003e When I get a message from someone else, the typing indicator should be cleared. (Remember, this is only a 2-party conversation in this demo.)\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eNow, when adding functionality like the typing indicator, how great would it be if you could make this change, and future changes, with zero-to-minimal effects on other components? The magic of Event Driven Development is that, due to the Pub-Sub architecture, isolation and decoupling is built-in. Let's code it up: \u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"step-1-announce-our-editing\" href=\"#step-1-announce-our-editing\"\u003e\n  \u003c/a\u003e\n  Step 1 - Announce our Editing\n\u003c/h2\u003e\n\n\u003cp\u003eThe one change to an existing component we must make is to get our \u003ccode\u003eMessageComposer\u003c/code\u003e\u003cbr\u003e\nto emit \u003cstrong\u003emessage/edit/me\u003c/strong\u003e:\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight diff\"\u003e\u003ccode\u003e\u003cspan class=\"err\"\u003e\n\n\u003c/span\u003e\u003cspan class=\"p\"\u003econst MessageComposer = ({ pendingMessage }) =\u0026gt; {\n\u003c/span\u003e\u003cspan class=\"err\"\u003e\n\u003c/span\u003e  const handleChange = (e) =\u0026gt; {\n    setPendingMessage(e.target.value);\n\u003cspan class=\"gi\"\u003e+    trigger(\"message/edit/me\")\n\u003c/span\u003e  };\n\u003cspan class=\"err\"\u003e\n\u003c/span\u003e};\n\u003cspan class=\"err\"\u003e\n\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eThis component does no debouncing/throttling, nor should it. A \u003ccode\u003eMessageComposer\u003c/code\u003e should not need to know who wants to know that we have edited. This is the separation of concerns a Pub-Sub or Actor model can afford us, and it leads to highly flexible components that don't get more complicated as the number of listeners grows. \u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"step-21-forward-our-editing-throttled\" href=\"#step-21-forward-our-editing-throttled\"\u003e\n  \u003c/a\u003e\n  Step 2.1 — Forward our Editing (throttled)\n\u003c/h2\u003e\n\n\u003cp\u003eNow in the \u003ccode\u003eWebSocketService\u003c/code\u003e we decide not to put every \u003cstrong\u003emessage/edit/me\u003c/strong\u003e event on the wire, by throttling to 1000 msec, while remapping the message type to \u003cstrong\u003emessage/edit/UID\u003c/strong\u003e which is the format other clients will expect.\u003c/p\u003e\n\n\u003cp\u003eBut before you go reaching for your favorite \u003ccode\u003ethrottle\u003c/code\u003e implementation, let me ask - are you sure of whether it's throttle or debounce? Or leading-edge/trailing-edge?\u003c/p\u003e\n\n\u003cp\u003eI could never remember those very well, so I broke things down into their basics. What we mean in this case is that for a second after sending a typing notification we should not send another. This can be broken down into two parts.\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003eQ: What is the task to be done in response to an event?\u003c/em\u003e \u003cbr\u003e\nA: Call \u003ccode\u003esocket.emit\u003c/code\u003e , then wait 1000msec\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003eQ: Does the task run again even if it is running already?\u003c/em\u003e\u003cbr\u003e\nA: Nope. The new task is ignored/not started if an existing task is running.\u003c/p\u003e\n\n\u003cp\u003eThe first part is defined by what we return from the listener function. The \u003ccode\u003econcat\u003c/code\u003e operator from RxJS can combine any Observables, so we pass it a couple of Observables made by polyrhythm's \u003ccode\u003eafter\u003c/code\u003e function. The first is the synchronous call to \u003ccode\u003esocket.emit\u003c/code\u003e, wrapped in an Observable with no delay. The next is the 1000 msec wait, which doesn't need a return value.\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\n\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eafter\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003epolyrhythm\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eWebSocketService\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e({\u003c/span\u003e \u003cspan class=\"nx\"\u003emyID\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003etypingForwarder\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003elisten\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003emessage/edit/me\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003econcat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n      \u003cspan class=\"nf\"\u003eafter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003esocket\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eemit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eevent\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e`message/edit/\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003emyID\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e \u003cspan class=\"p\"\u003e})),\u003c/span\u003e\n      \u003cspan class=\"nf\"\u003eafter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1000\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e),\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"na\"\u003emode\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eignore\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e...\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn \u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003etypingForwarder\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eunsubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eThe part about how the listener invocations are combined, is specified in the 3rd argument to \u003ccode\u003elisten\u003c/code\u003e. Any listener execution can be combined with any existing execution according to 1 of 5 modes. We choose the \u003cstrong\u003eignore\u003c/strong\u003e mode, so if its' the second time within 1000 msec we see \u003cstrong\u003emessage/edit/me\u003c/strong\u003e, we ignore sending the \u003cstrong\u003emessage/edit/UID\u003c/strong\u003e event over the wire. See how easy it is to map this code onto the language of the requirements given to us:\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eUpon editing, send the \u003cstrong\u003emessage/edit\u003c/strong\u003e event right away, but don't send again for the 1000 msec following.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"step-22-listen-for-others-edits\" href=\"#step-22-listen-for-others-edits\"\u003e\n  \u003c/a\u003e\n  Step 2.2 — Listen for Other's Edits\n\u003c/h2\u003e\n\n\u003cp\u003eThe other half of the typing messages will be that others will put their messages on the wire in a similarly throttled fashion, and we should have those events \u003ccode\u003etrigger\u003c/code\u003e-ed for us to respond to as well.\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight diff\"\u003e\u003ccode\u003e\u003cspan class=\"err\"\u003e\n\n\u003c/span\u003e\u003cspan class=\"p\"\u003econst WebSocketService = ({ myID }) =\u0026gt; {\n\u003c/span\u003e...\n\u003cspan class=\"gd\"\u003e-    if (type.startsWith(\"message/from/\") {\n\u003c/span\u003e\u003cspan class=\"gi\"\u003e+    if (type.startsWith(\"message/from/\") ||\n+        type.startsWith(\"message/edit/\")) {\n\u003c/span\u003e        trigger(type, payload); \n      }\n    });\n\u003cspan class=\"err\"\u003e\n\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003ch2\u003e\n  \u003ca name=\"step-3-show-the-typing-indicator-with-autohide\" href=\"#step-3-show-the-typing-indicator-with-autohide\"\u003e\n  \u003c/a\u003e\n  Step 3 — Show the Typing Indicator, With Auto-Hide\n\u003c/h2\u003e\n\n\u003cp\u003eLets add a component to \u003ccode\u003eApp\u003c/code\u003e called \u003ccode\u003eTypingIndicator\u003c/code\u003e which will listen to these events, and show or hide the typing indicator under the chat log.\u003c/p\u003e\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight diff\"\u003e\u003ccode\u003e\u003cspan class=\"err\"\u003e\n\n\u003c/span\u003e\u003cspan class=\"p\"\u003econst App = () =\u0026gt; {\n\u003c/span\u003e    ...\n    return \u0026lt;\u0026gt;\n    \u0026lt;ChatLog messages={messages} /\u0026gt;\n\u003cspan class=\"gi\"\u003e+    \u0026lt;TypingIndicator/\u0026gt;\n\u003c/span\u003e    \u0026lt;MessageComposer/\u0026gt;\n    \u0026lt;WebsocketService /\u0026gt;\n    \u0026lt;/\u0026gt;\n}\n\u003cspan class=\"err\"\u003e\n\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eYou may think the TypingIndicator just has to listen for these \u003cstrong\u003emessage/edit\u003c/strong\u003e events, but there are a lot of details. We need to turn off the typing indicator after some time if we haven't heard another \u003cstrong\u003emessage/edit\u003c/strong\u003e. If we receive a \u003cstrong\u003emessage/from\u003c/strong\u003e event then we should turn off the typing indicator.\u003c/p\u003e\n\n\u003cp\u003eIn summary:\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e\n\nTyping Indicator\n  Showing\n    - Shows when other has typed\n  Hiding\n    - Hides when other hasn't typed in 5 seconds\n    - Hides when other's message is received\n\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eFor auto-hiding, we'll use a similar pattern of returning an Observable of what should happen. But the concurrency mode called \u003cstrong\u003ereplace\u003c/strong\u003e (like the beloved RxJS \u003ccode\u003eswitchMap\u003c/code\u003e ) will be the one we'll use.\u003c/p\u003e\n\n\u003cp\u003eWe ask the same event-listener questions as before:\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003eQ: What is the task to be done in response to an event?\u003c/em\u003e \u003cbr\u003e\nA: Show the typing indicator, then hide it after 5000msec.\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003eQ: Does the task run again even if it is running already?\u003c/em\u003e\u003cbr\u003e\nA: Yep. The existing autoTimeout is canceled, and a new one is begun, effectively replacing the old timeout.\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\n\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003econcat\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eafter\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003euseListener\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003epolyrhythm\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eTypingIndicator\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e({\u003c/span\u003e \u003cspan class=\"nx\"\u003etimeout\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e5000\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"nx\"\u003eisTyping\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003esetTyping\u003c/span\u003e \u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003euseState\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eautoTimeoutTyper\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003econcat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eafter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003esetTyping\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e)),\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eafter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003etimeout\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003esetTyping\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n  \u003cspan class=\"nf\"\u003euseListener\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sr\"\u003e/message\u003c/span\u003e\u003cspan class=\"se\"\u003e\\/\u003c/span\u003e\u003cspan class=\"sr\"\u003eedit\u003c/span\u003e\u003cspan class=\"se\"\u003e\\/(?!\u003c/span\u003e\u003cspan class=\"sr\"\u003eme\u003c/span\u003e\u003cspan class=\"se\"\u003e)\u003c/span\u003e\u003cspan class=\"sr\"\u003e/\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eautoTimeoutTyper\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"na\"\u003emode\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ereplace\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n  \u003cspan class=\"nf\"\u003euseListener\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sr\"\u003e/message\u003c/span\u003e\u003cspan class=\"se\"\u003e\\/\u003c/span\u003e\u003cspan class=\"sr\"\u003efrom/\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003esetTyping\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e  \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003eisTyping\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003ediv\u003c/span\u003e \u003cspan class=\"nx\"\u003eclassName\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003echat-message__typing\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eWe return an Observable that is the \u003ccode\u003econcat\u003c/code\u003e-enation (aka sequencing) of an immediate Observable and a deferred one. Like before these are both created, using the \u003ccode\u003eafter\u003c/code\u003e utility function which creates a synchronous or asynchronous Observable (\u003ca href=\"https://github.com/deanius/polyrhythm/blob/main/src/utils.ts#L22\" target=\"_blank\" rel=\"noopener noreferrer\"\u003edocs\u003c/a\u003e), depending on its first argument.\u003c/p\u003e\n\n\u003cp\u003eEach new triggering of the autoTimeout sequence due to an event matching \u003cstrong\u003emessage/edit/UID\u003c/strong\u003e aborts the previous one, due to the line \u003ccode\u003e{ mode: 'replace' }\u003c/code\u003e. With this option, the listener behaves similarly to the RxJS \u003ccode\u003eswitchMap\u003c/code\u003e operator, but in declarative form. \u003c/p\u003e\n\n\u003cp\u003eWith that, we have implemented all of our requirements and have a fully functioning chat app! \u003ca href=\"https://codesandbox.io/s/poly-chat-imw2z\" target=\"_blank\" rel=\"noopener noreferrer\"\u003eCodeSandbox here\u003c/a\u003e.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"event-graph\" href=\"#event-graph\"\u003e\n  \u003c/a\u003e\n  Event Graph\n\u003c/h2\u003e\n\n\u003cp\u003eThe thing that makes Event Driven Development different is its focus on cause-and-effect mappings. \u003cem\u003e\"When this, do that\"\u003c/em\u003e It's useful even before you know what your state will look like, because its closely aligned to your requirements and acceptance criteria, not the implementation of it.\u003c/p\u003e\n\n\u003cp\u003eSee how the event graph - which we can produce even before writing a line of code — tells a lot about the architecture of the system, and can be used to vet requirements and acceptance criteria against.\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fs3.amazonaws.com%2Fwww.deanius.com%2FChatUIEventGraph.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fs3.amazonaws.com%2Fwww.deanius.com%2FChatUIEventGraph.png\" alt=\"Event Grammar\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003eBTW I highly recommend you check out the fine MermaidJS Live Editor, which allows you to produce event graphs like this with a very straightforward language (\u003ca href=\"https://bit.ly/2DqSig0\" target=\"_blank\" rel=\"noopener noreferrer\"\u003eview source\u003c/a\u003e)\u003c/em\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"next-steps\" href=\"#next-steps\"\u003e\n  \u003c/a\u003e\n  next() steps\n\u003c/h1\u003e\n\n\u003cp\u003eNow you've seen how to build a really cool Chat UI that handled growing new async requirements without destabilizing existing components. It lowered boilerplate, used a concise API, and has very low coupling, while being immune to memoization and prop-drilling complexities.\u003c/p\u003e\n\n\u003cp\u003eI hope you've enjoyed learning about the event bus/polyrhythm coding style. If you've got any questions, ask me on twitter at \u003ca href=\"https://twitter.com/deaniusdev\" target=\"_blank\" rel=\"noopener noreferrer\"\u003e@deaniusdev\u003c/a\u003e \u003c/p\u003e\n\n\u003cp\u003eEnjoy polyrhythm-ing your async 🎵🎶 !\u003c/p\u003e\n\n\u003cp\u003eDean\u003c/p\u003e\n\n\u003cp\u003ePS If you'd like to use Redux Observable, Redux Saga, Mobx or another library that does similar things to this, then go right ahead. They inspired this library and I continue to learn a great deal from what they do. \u003c/p\u003e\n\n","published":true,"published_from_feed":false,"show_comments":true,"slug":"building-a-chat-with-typing-indicator-in-rxjs-and-polyrhythm-1bgh","social_image":null,"title":"Building a Chat with Typing Indicator in React, RxJS and polyrhythm","video":null,"video_code":null},{"created_at":"2020-10-26T14:05:32.006Z","crossposted_at":null,"edited_at":"2021-01-20T21:27:25.690Z","last_comment_at":"2024-03-28T07:57:11.784Z","published_at":"2020-10-26T14:05:31.983Z","canonical_url":null,"feed_source_url":null,"video_closed_caption_track_url":null,"video_source_url":null,"video_thumbnail_url":null,"body_markdown":"---\ntitle: Easier Promise Code with Promise Composition\npublished: true\ncover_image: https://images.unsplash.com/photo-1543839482-a95d35fc5a77?ixlib=rb-1.2.1\u0026ixid=eyJhcHBfaWQiOjEyMDd9\u0026auto=format\u0026fit=crop\u0026w=975\u0026q=80\ndescription: Compose within Promises, and don't create additional sources of truth, whenever possible.\ntags: async, Promises, callbacks, JavaScript\n---\n_TL;DR Compose within Promises, and don't create additional sources of truth, whenever possible._\n\nAs a solution to Callback Hell, Promises were my new hotness for a while. I gave talks on them - while juggling, even, because— concurrency 🤣 ([Youtube](https://www.youtube.com/watch?v=dyz3tAI6GaI\u0026t=37)).\n\nI had a situation recently where I had two Promises. As we know with async, any order of completion that is possible will happen eventually - and so I had to write code that ran only if they completed in a certain order. Speficially, if `hasClosed` fulfilled before `hasEnded`.\n\n```js\nconst hasClosed = new Promise(resolve =\u003e req.on('close', event =\u003e resolve('closed')));\nconst hasEnded = new Promise(resolve =\u003e req.on('end', event =\u003e resolve('ended')));\n```\n\nAssuming the event object had a `type` property of \"close\" or \"end\", to run code only in a close-before-end circumstance is:\n\n```js\nPromise.race([ hasClosed, hasEnded ]).then(firstToResolve =\u003e {\n  if (firstToResolve === 'closed') {\n    // handle early shutdown\n  }\n})\n```\n\nBut, since Promises are relatively new to many developers still, their existing experience with and preference for local variables may have them 'storing' the result of a Promise in a local variable outside the Promise chain. One thought might be to handle the closed-before-end case like the following:\n\n```js\nlet clientEnded = false;\n​\n  req.on(\"end\", () =\u003e {\n    clientEnded = true;\n  });\n​\n  const clientClosed = new Promise((resolve) =\u003e\n    req.on(\"close\", () =\u003e {\n      if (!clientEnded) {\n        resolve();\n      }\n    })\n  );\n  \n  clientClosed.then(/* handle early shutdown */);\n```\n\nThere's a clear increase in code. And more concerning to comprehensibility- the depth of the code nesting got way deeper. But if it's so much harder to read, and write, why is this the way many good developers would write this code today?\n\nI think it's because the basic constructs of JavaScript, those things we depend on like `if` statements - _don't work with Promises_! And they don't have to - JavaScript was made in 1995, and didn't get Promises until 2015. So you have to play by post-2015 JavaScript rules to use Promises effectively.\n\n_\"And why is the code bloat a problem - tests are showing its passing, and it's not inefficient at runtime, maybe even a tick or two faster.\"_\n\nIt's a problem of maintainability. Two Promises, to be raced using the local variable way, exploded the code from 4 to 12 lines (counting non-white-space only). Imagine when you have to combine a 3rd variable - what's going to cause the most pain: the time it takes you to add it, its impact on future changability, or the challenging of hunting down edge cases when the events can occur in `3! = 3*2*1 = 6` ways now, and your local variables get updated when you dont expect.\n\nCompose within Promises, and don't create additional sources of truth, whenever possible.\n\n## Conclusion\n\nPromises are still valuable tools, still a huge improvement over callbacks, but composing directly with them, or with [Observables, a Superset of Promises](https://dev.to/deanius/observably-better-than-promises-4pmf) will lead to cleaner code that is grows beautifully, and has fewer corners for edge cases to hide.\n","cached_tag_list":"async, promises, callbacks, javascript","cached_user_name":"Dean Radcliffe","cached_user_username":"deanius","comments_count":1,"description":"Compose within Promises, and don't create additional sources of truth, whenever possible.","main_image":"https://images.unsplash.com/photo-1543839482-a95d35fc5a77?ixlib=rb-1.2.1\u0026ixid=eyJhcHBfaWQiOjEyMDd9\u0026auto=format\u0026fit=crop\u0026w=975\u0026q=80","main_image_background_hex_color":"#dddddd","path":"/deanius/easier-promise-code-with-promise-composition-48kj","public_reactions_count":6,"processed_html":"\u003cp\u003e\u003cem\u003eTL;DR Compose within Promises, and don't create additional sources of truth, whenever possible.\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003eAs a solution to Callback Hell, Promises were my new hotness for a while. I gave talks on them - while juggling, even, because— concurrency 🤣 (\u003ca href=\"https://www.youtube.com/watch?v=dyz3tAI6GaI\u0026amp;t=37\"\u003eYoutube\u003c/a\u003e).\u003c/p\u003e\n\n\u003cp\u003eI had a situation recently where I had two Promises. As we know with async, any order of completion that is possible will happen eventually - and so I had to write code that ran only if they completed in a certain order. Speficially, if \u003ccode\u003ehasClosed\u003c/code\u003e fulfilled before \u003ccode\u003ehasEnded\u003c/code\u003e.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ehasClosed\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nb\"\u003ePromise\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eresolve\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eon\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eclose\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eevent\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003eresolve\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eclosed\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e)));\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ehasEnded\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nb\"\u003ePromise\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eresolve\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eon\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eend\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eevent\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003eresolve\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eended\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e)));\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eAssuming the event object had a \u003ccode\u003etype\u003c/code\u003e property of \"close\" or \"end\", to run code only in a close-before-end circumstance is:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"nb\"\u003ePromise\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003erace\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e \u003cspan class=\"nx\"\u003ehasClosed\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ehasEnded\u003c/span\u003e \u003cspan class=\"p\"\u003e]).\u003c/span\u003e\u003cspan class=\"nx\"\u003ethen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003efirstToResolve\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003efirstToResolve\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eclosed\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// handle early shutdown\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eBut, since Promises are relatively new to many developers still, their existing experience with and preference for local variables may have them 'storing' the result of a Promise in a local variable outside the Promise chain. One thought might be to handle the closed-before-end case like the following:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003eclientEnded\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"err\"\u003e​\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eon\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eend\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eclientEnded\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003cspan class=\"err\"\u003e​\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eclientClosed\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nb\"\u003ePromise\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"nx\"\u003eresolve\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003ereq\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eon\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eclose\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"nx\"\u003eclientEnded\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003eresolve\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n  \u003cspan class=\"nx\"\u003eclientClosed\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ethen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"cm\"\u003e/* handle early shutdown */\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eThere's a clear increase in code. And more concerning to comprehensibility- the depth of the code nesting got way deeper. But if it's so much harder to read, and write, why is this the way many good developers would write this code today?\u003c/p\u003e\n\n\u003cp\u003eI think it's because the basic constructs of JavaScript, those things we depend on like \u003ccode\u003eif\u003c/code\u003e statements - \u003cem\u003edon't work with Promises\u003c/em\u003e! And they don't have to - JavaScript was made in 1995, and didn't get Promises until 2015. So you have to play by post-2015 JavaScript rules to use Promises effectively.\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003e\"And why is the code bloat a problem - tests are showing its passing, and it's not inefficient at runtime, maybe even a tick or two faster.\"\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003eIt's a problem of maintainability. Two Promises, to be raced using the local variable way, exploded the code from 4 to 12 lines (counting non-white-space only). Imagine when you have to combine a 3rd variable - what's going to cause the most pain: the time it takes you to add it, its impact on future changability, or the challenging of hunting down edge cases when the events can occur in \u003ccode\u003e3! = 3*2*1 = 6\u003c/code\u003e ways now, and your local variables get updated when you dont expect.\u003c/p\u003e\n\n\u003cp\u003eCompose within Promises, and don't create additional sources of truth, whenever possible.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"conclusion\" href=\"#conclusion\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Conclusion\n\u003c/h2\u003e\n\n\u003cp\u003ePromises are still valuable tools, still a huge improvement over callbacks, but composing directly with them, or with \u003ca href=\"https://dev.to/deanius/observably-better-than-promises-4pmf\"\u003eObservables, a Superset of Promises\u003c/a\u003e will lead to cleaner code that is grows beautifully, and has fewer corners for edge cases to hide.\u003c/p\u003e\n\n","published":true,"published_from_feed":false,"show_comments":true,"slug":"easier-promise-code-with-promise-composition-48kj","social_image":null,"title":"Easier Promise Code with Promise Composition","video":null,"video_code":null},{"created_at":"2020-10-29T12:11:13.038Z","crossposted_at":null,"edited_at":"2021-10-18T22:22:55.625Z","last_comment_at":"2020-10-29T14:48:29.812Z","published_at":"2020-10-29T14:48:29.812Z","canonical_url":null,"feed_source_url":null,"video_closed_caption_track_url":null,"video_source_url":null,"video_thumbnail_url":null,"body_markdown":"---\ntitle: From Events, to Observables, and to Events Again!\npublished: true\ntags: rxjs, react, angular\ncover_image: https://images.unsplash.com/photo-1449247709967-d4461a6a6103?ixlib=rb-1.2.1\u0026ixid=eyJhcHBfaWQiOjEyMDd9\u0026auto=format\u0026fit=crop\u0026w=1951\u0026q=80\n---\n\nI was reading the fine post [About SwitchMap and Friends](https://dev.to/rxjs/about-switchmap-and-friends-2jmm) by Jan-Niklas Wortmann. And this quote about switchMap reminded me how hard it is to understand Observables for beginners:\n\n\u003e A higher-order operator is handling an Observable of Observables.\n\nPerfectly clear right? At least its not as bad as this one from the `switchMap` documentation itself:\n\n\u003e [switchMap] projects each source value to an Observable which is merged in the output Observable, emitting values only from the most recently projected Observable.\n\nWhile all the descriptions of these and other RxJS operators are accurate, they fail to evoke a real feeling for _when_ and _why_ to use them. It is this reason that I made RxJS on-board-ability a central theme of my talk at RxJSLive 2019, and why I created the library [`polyrhythm`](https://github.com/deanius/polyrhythm) to help get common Reactive/Observable tasks done _more simply_.\n\nLet's understand `switchMap` and it's workings from the standpoint of events and handlers.\n\n\n---\n\n# RxJS - noise = events\n\n![search gif](https://p61.f2.n0.cdn.getcloudapp.com/items/Qwu0P495/Screen%20Recording%202020-09-22%20at%2002.28.58%20PM.gif?source=viewer\u0026v=98630333c05bb55e294c442dbd85d2ef)\n\nSearching — a search box with suggestions — is one of the most common uses for `switchMap`. You do an AJAX lookup on changes to the search input. Let's ignore debouncing for now, and say in non-technical language that you want to shutdown the old search (and its xhr) when the new one begins.\n\nHere is `polyrhtyhm` code that makes the form run:\n\n```js\n\u003cinput id=\"search-text\" onchange=\"trigger('search/change')\"\u003e\n\nfunction ajaxToResult$({ payload: { text }})) =\u003e {\n    return ajax$(`search?q=${text}`).pipe(tap(searchResult =\u003e {\n        updateUI(searchResult);\n    });\n}\n\nlisten('search/change', ajaxToResult$, { mode: 'replace' });\n```\n\nIn response to DOM change events, we create events of type `search/change`, putting them onto an event bus with `trigger`. The function `ajaxToResult$` returns an async Observable of 1) the xhr 2) a call to the `updateUI` function which does something with the result. This function is the same kind of function you'd pass to `switchMap`, except that it is expecting an event with `type` and `payload` fields.\n\nThis function `ajaxToResult$` runs upon every event. But what if it's already running you ask? The mode 'replace' instructs the Listener to do what `switchMap` does, cancel the existing and start a new `ajaxToResult` Observable. The timing, and ultimate behavior is still as shown below, where you can see the \"replace\" occurring as the green-diamond-producer is replaced with a yellow diamond producer.\n\n![](https://res.cloudinary.com/practicaldev/image/fetch/s--zyDfK4i3--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://raw.githubusercontent.com/rxjs-blog/blog/master/blog-posts/about-switchmap-and-friends/assets/switchMap-marble-diagram.jpg)\n\n# Observables - Same, Just Different\n\nWith an Observable-only implementation, the same pieces are there, but in a different combination.\n\nFirst you have your search-change events as part of an Observable. Then you'll create the \"outer\" Observable, `switchMap`ing to ajaxResults. Then you call subscribe.\n\n```js\nconst searchChange$ = fromEvent(searchText, \"change\");\nconst outer$ = searchChange$.pipe(switchMap(ajaxToResult$));\nouter$.subscribe();\n// TODO what's a better name for outer$ here?\n```\n\nThis code works, but I don't like a few things about its readability.\n\nThe concurrency operator is buried within a chain of code. And I don't like having to create, and thus name, and subscribe to the outer observable. Search changes and searches themselves being merged in one object feels like unnecessary coupling.\n\nThe polyrhtyhm version will pass the same unit tests, and run just as fast. Why impose a high burden of readability if you don't have to?\n\n## Triggerable\n\nThe great thing about listeners is they don't care from where their events come—this is a major form of decoupling.\n\nSuppose I had my `searchChange$` in an Observable already - I could fire them off as named events:\n\n```js\nsearchChange$.subscribe(({ target }) =\u003e\n  trigger(\"search/change\", { text: target.value })\n);\n```\n\nAnd my listener would run the same. The listener is not tied up with the triggerer (the event producer).\nNamed events of your own design are the glue that hold your app together, not brittle coupling of JS objects, or reliance on any particular framework.\n\n# Decoupling, Separation of concerns\n\nHow many times have you changed an RxJS operator because you didn't choose the correct one on the first try? It happens to us all! Wouldn't it be nice if it were a) easier to change to the new one and b) more readable once you've changed it. No more sending your colleagues and yourself to the RxJS documentation when you can't remember if `switchMap` or `exhaustMap` is the one which replaces the old ajax. The word \"replace\" should be sufficient, hidden behind whatever constant you like, or chosen from the TypeScript enum.\n\nListeners are the logical unit to apply concurrency, and keep themselves decoupled from the Observable of triggering events. With polyrhythm you don't ever have an Observable of Observables, you have events and listeners. And it _just works_, and scales up to rather large apps with webs of dozens of events and listeners. It's in production, and tested, so use it if it makes sense for your team.\n\n# Conclusion\n\nUsing RxJS with its operators directly is not wrong, but if you can have clearer code by shredding outer Observables into events, and putting Listeners in charge of result mapping, then you're on easy street! Yes, I made that sentence sound ridiculous on purpose - but now, you understand it - AND the sentences I first mentioned above ;)\n\nDean\n\n---\nIf you're still reading, these supplemental diagrams will help explain:\n\n\n### Async Is Just Math 🤓 (Combinatorics!)\n\nI believe the concurrency modes offered by RxJS operators are a subset of a universal concept. Its as though inside of `switchMap` lives a reducer looking like this.\n\n```js\n(oldSubscription, newObservable$) =\u003e {\n  oldSubscription.unsubscribe();\n  return newObservable$.subscribe();\n};\n```\n\nAnd each operator has a similar thing inside. Because there are 4 total combinations of whether you're \"ending the old\" or \"starting the new\", there are 4 RxJS operators, right? (_Quiz: can you name them?_)\n\nActually there are 5 possibilities shown below, and RxJS covers 4 of them.\n\n![async matrix rxjs](https://p61.f2.n0.cdn.getcloudapp.com/items/bLuwyrDN/Image%202020-10-29%20at%209.23.18%20AM.png?source=viewer\u0026v=4f83f473f14ee9dd31fe04b2f5996b48)\n\nSo of course I wrote and exported an operator from polyrhythm to fill this hole, called [`toggleMap`](https://github.com/deanius/polyrhythm/blob/main/src/toggleMap.ts). Not so much due to overwhelming demand, as for my own OCD for symmetry :)\n\n![async matrix](https://p61.f2.n0.cdn.getcloudapp.com/items/rRuomvXB/Image%202020-10-29%20at%209.22.48%20AM.png?source=viewer\u0026v=87acf238d876dceb018e3c2a8b84112c)\n\n### Async is Musical\n\nIf Observables were audio, their overlap would look like this:\n\n![Polyrhythm Concurrency Modes](https://s3.amazonaws.com/www.deanius.com/ConcurModes2.png)\n\nWhen building UI, I find that 80% of user expectations can be fulfilled just by choosing the correct mode (another 10% with some debouncing thrown in there).\n\nSo Im happy to use Observables, and refer to these concurrency modes/operators by their Polyrhythm names, instead of their RxJS names. I'm happy for RxJS for having brought them to my attention, but I no longer thrill to see their names in my codebase.\n\n","cached_tag_list":"rxjs, react, angular","cached_user_name":"Dean Radcliffe","cached_user_username":"deanius","comments_count":0,"description":"I was reading the fine post About SwitchMap and Friends by Jan-Niklas Wortmann. And this quote about...","main_image":"https://images.unsplash.com/photo-1449247709967-d4461a6a6103?ixlib=rb-1.2.1\u0026ixid=eyJhcHBfaWQiOjEyMDd9\u0026auto=format\u0026fit=crop\u0026w=1951\u0026q=80","main_image_background_hex_color":"#dddddd","path":"/deanius/never-use-the-wrong-rxjs-operator-again-by-never-using-one-again-1j90","public_reactions_count":8,"processed_html":"\u003cp\u003eI was reading the fine post \u003ca href=\"https://dev.to/rxjs/about-switchmap-and-friends-2jmm\"\u003eAbout SwitchMap and Friends\u003c/a\u003e by Jan-Niklas Wortmann. And this quote about switchMap reminded me how hard it is to understand Observables for beginners:\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eA higher-order operator is handling an Observable of Observables.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003ePerfectly clear right? At least its not as bad as this one from the \u003ccode\u003eswitchMap\u003c/code\u003e documentation itself:\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e[switchMap] projects each source value to an Observable which is merged in the output Observable, emitting values only from the most recently projected Observable.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eWhile all the descriptions of these and other RxJS operators are accurate, they fail to evoke a real feeling for \u003cem\u003ewhen\u003c/em\u003e and \u003cem\u003ewhy\u003c/em\u003e to use them. It is this reason that I made RxJS on-board-ability a central theme of my talk at RxJSLive 2019, and why I created the library \u003ca href=\"https://github.com/deanius/polyrhythm\" target=\"_blank\" rel=\"noopener noreferrer\"\u003e\u003ccode\u003epolyrhythm\u003c/code\u003e\u003c/a\u003e to help get common Reactive/Observable tasks done \u003cem\u003emore simply\u003c/em\u003e.\u003c/p\u003e\n\n\u003cp\u003eLet's understand \u003ccode\u003eswitchMap\u003c/code\u003e and it's workings from the standpoint of events and handlers.\u003c/p\u003e\n\n\n\u003chr\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"rxjs-noise-events\" href=\"#rxjs-noise-events\"\u003e\n  \u003c/a\u003e\n  RxJS - noise = events\n\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fp61.f2.n0.cdn.getcloudapp.com%2Fitems%2FQwu0P495%2FScreen%2520Recording%25202020-09-22%2520at%252002.28.58%2520PM.gif%3Fsource%3Dviewer%26v%3D98630333c05bb55e294c442dbd85d2ef\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fp61.f2.n0.cdn.getcloudapp.com%2Fitems%2FQwu0P495%2FScreen%2520Recording%25202020-09-22%2520at%252002.28.58%2520PM.gif%3Fsource%3Dviewer%26v%3D98630333c05bb55e294c442dbd85d2ef\" alt=\"search gif\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eSearching — a search box with suggestions — is one of the most common uses for \u003ccode\u003eswitchMap\u003c/code\u003e. You do an AJAX lookup on changes to the search input. Let's ignore debouncing for now, and say in non-technical language that you want to shutdown the old search (and its xhr) when the new one begins.\u003c/p\u003e\n\n\u003cp\u003eHere is \u003ccode\u003epolyrhtyhm\u003c/code\u003e code that makes the form run:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003einput\u003c/span\u003e \u003cspan class=\"nx\"\u003eid\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003esearch-text\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e \u003cspan class=\"nx\"\u003eonchange\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003etrigger('search/change')\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003eajaxToResult$\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e \u003cspan class=\"na\"\u003epayload\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003etext\u003c/span\u003e \u003cspan class=\"p\"\u003e}}))\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003eajax\u003c/span\u003e\u003cspan class=\"nf\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`search?q=\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nf\"\u003epipe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003etap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003esearchResult\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eupdateUI\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003esearchResult\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"nf\"\u003elisten\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003esearch/change\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eajaxToResult$\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"na\"\u003emode\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ereplace\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eIn response to DOM change events, we create events of type \u003ccode\u003esearch/change\u003c/code\u003e, putting them onto an event bus with \u003ccode\u003etrigger\u003c/code\u003e. The function \u003ccode\u003eajaxToResult$\u003c/code\u003e returns an async Observable of 1) the xhr 2) a call to the \u003ccode\u003eupdateUI\u003c/code\u003e function which does something with the result. This function is the same kind of function you'd pass to \u003ccode\u003eswitchMap\u003c/code\u003e, except that it is expecting an event with \u003ccode\u003etype\u003c/code\u003e and \u003ccode\u003epayload\u003c/code\u003e fields.\u003c/p\u003e\n\n\u003cp\u003eThis function \u003ccode\u003eajaxToResult$\u003c/code\u003e runs upon every event. But what if it's already running you ask? The mode 'replace' instructs the Listener to do what \u003ccode\u003eswitchMap\u003c/code\u003e does, cancel the existing and start a new \u003ccode\u003eajaxToResult\u003c/code\u003e Observable. The timing, and ultimate behavior is still as shown below, where you can see the \"replace\" occurring as the green-diamond-producer is replaced with a yellow diamond producer.\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fres.cloudinary.com%2Fpracticaldev%2Fimage%2Ffetch%2Fs--zyDfK4i3--%2Fc_limit%252Cf_auto%252Cfl_progressive%252Cq_auto%252Cw_880%2Fhttps%3A%2F%2Fraw.githubusercontent.com%2Frxjs-blog%2Fblog%2Fmaster%2Fblog-posts%2Fabout-switchmap-and-friends%2Fassets%2FswitchMap-marble-diagram.jpg\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fres.cloudinary.com%2Fpracticaldev%2Fimage%2Ffetch%2Fs--zyDfK4i3--%2Fc_limit%252Cf_auto%252Cfl_progressive%252Cq_auto%252Cw_880%2Fhttps%3A%2F%2Fraw.githubusercontent.com%2Frxjs-blog%2Fblog%2Fmaster%2Fblog-posts%2Fabout-switchmap-and-friends%2Fassets%2FswitchMap-marble-diagram.jpg\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"observables-same-just-different\" href=\"#observables-same-just-different\"\u003e\n  \u003c/a\u003e\n  Observables - Same, Just Different\n\u003c/h1\u003e\n\n\u003cp\u003eWith an Observable-only implementation, the same pieces are there, but in a different combination.\u003c/p\u003e\n\n\u003cp\u003eFirst you have your search-change events as part of an Observable. Then you'll create the \"outer\" Observable, \u003ccode\u003eswitchMap\u003c/code\u003eing to ajaxResults. Then you call subscribe.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003esearchChange$\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003efromEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003esearchText\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003echange\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eouter$\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003esearchChange$\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003epipe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003eswitchMap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eajaxToResult$\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003cspan class=\"nx\"\u003eouter$\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// TODO what's a better name for outer$ here?\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eThis code works, but I don't like a few things about its readability.\u003c/p\u003e\n\n\u003cp\u003eThe concurrency operator is buried within a chain of code. And I don't like having to create, and thus name, and subscribe to the outer observable. Search changes and searches themselves being merged in one object feels like unnecessary coupling.\u003c/p\u003e\n\n\u003cp\u003eThe polyrhtyhm version will pass the same unit tests, and run just as fast. Why impose a high burden of readability if you don't have to?\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"triggerable\" href=\"#triggerable\"\u003e\n  \u003c/a\u003e\n  Triggerable\n\u003c/h2\u003e\n\n\u003cp\u003eThe great thing about listeners is they don't care from where their events come—this is a major form of decoupling.\u003c/p\u003e\n\n\u003cp\u003eSuppose I had my \u003ccode\u003esearchChange$\u003c/code\u003e in an Observable already - I could fire them off as named events:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003esearchChange$\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(({\u003c/span\u003e \u003cspan class=\"nx\"\u003etarget\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nf\"\u003etrigger\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003esearch/change\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"na\"\u003etext\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003etarget\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003evalue\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eAnd my listener would run the same. The listener is not tied up with the triggerer (the event producer).\u003cbr\u003e\nNamed events of your own design are the glue that hold your app together, not brittle coupling of JS objects, or reliance on any particular framework.\u003c/p\u003e\n\u003ch1\u003e\n  \u003ca name=\"decoupling-separation-of-concerns\" href=\"#decoupling-separation-of-concerns\"\u003e\n  \u003c/a\u003e\n  Decoupling, Separation of concerns\n\u003c/h1\u003e\n\n\u003cp\u003eHow many times have you changed an RxJS operator because you didn't choose the correct one on the first try? It happens to us all! Wouldn't it be nice if it were a) easier to change to the new one and b) more readable once you've changed it. No more sending your colleagues and yourself to the RxJS documentation when you can't remember if \u003ccode\u003eswitchMap\u003c/code\u003e or \u003ccode\u003eexhaustMap\u003c/code\u003e is the one which replaces the old ajax. The word \"replace\" should be sufficient, hidden behind whatever constant you like, or chosen from the TypeScript enum.\u003c/p\u003e\n\n\u003cp\u003eListeners are the logical unit to apply concurrency, and keep themselves decoupled from the Observable of triggering events. With polyrhythm you don't ever have an Observable of Observables, you have events and listeners. And it \u003cem\u003ejust works\u003c/em\u003e, and scales up to rather large apps with webs of dozens of events and listeners. It's in production, and tested, so use it if it makes sense for your team.\u003c/p\u003e\n\u003ch1\u003e\n  \u003ca name=\"conclusion\" href=\"#conclusion\"\u003e\n  \u003c/a\u003e\n  Conclusion\n\u003c/h1\u003e\n\n\u003cp\u003eUsing RxJS with its operators directly is not wrong, but if you can have clearer code by shredding outer Observables into events, and putting Listeners in charge of result mapping, then you're on easy street! Yes, I made that sentence sound ridiculous on purpose - but now, you understand it - AND the sentences I first mentioned above ;)\u003c/p\u003e\n\n\u003cp\u003eDean\u003c/p\u003e\n\n\u003chr\u003e\n\n\u003cp\u003eIf you're still reading, these supplemental diagrams will help explain:\u003c/p\u003e\n\u003ch3\u003e\n  \u003ca name=\"async-is-just-math-combinatorics\" href=\"#async-is-just-math-combinatorics\"\u003e\n  \u003c/a\u003e\n  Async Is Just Math 🤓 (Combinatorics!)\n\u003c/h3\u003e\n\n\u003cp\u003eI believe the concurrency modes offered by RxJS operators are a subset of a universal concept. Its as though inside of \u003ccode\u003eswitchMap\u003c/code\u003e lives a reducer looking like this.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eoldSubscription\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003enewObservable$\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eoldSubscription\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eunsubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003enewObservable$\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eAnd each operator has a similar thing inside. Because there are 4 total combinations of whether you're \"ending the old\" or \"starting the new\", there are 4 RxJS operators, right? (\u003cem\u003eQuiz: can you name them?\u003c/em\u003e)\u003c/p\u003e\n\n\u003cp\u003eActually there are 5 possibilities shown below, and RxJS covers 4 of them.\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fp61.f2.n0.cdn.getcloudapp.com%2Fitems%2FbLuwyrDN%2FImage%25202020-10-29%2520at%25209.23.18%2520AM.png%3Fsource%3Dviewer%26v%3D4f83f473f14ee9dd31fe04b2f5996b48\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fp61.f2.n0.cdn.getcloudapp.com%2Fitems%2FbLuwyrDN%2FImage%25202020-10-29%2520at%25209.23.18%2520AM.png%3Fsource%3Dviewer%26v%3D4f83f473f14ee9dd31fe04b2f5996b48\" alt=\"async matrix rxjs\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eSo of course I wrote and exported an operator from polyrhythm to fill this hole, called \u003ca href=\"https://github.com/deanius/polyrhythm/blob/main/src/toggleMap.ts\" target=\"_blank\" rel=\"noopener noreferrer\"\u003e\u003ccode\u003etoggleMap\u003c/code\u003e\u003c/a\u003e. Not so much due to overwhelming demand, as for my own OCD for symmetry :)\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fp61.f2.n0.cdn.getcloudapp.com%2Fitems%2FrRuomvXB%2FImage%25202020-10-29%2520at%25209.22.48%2520AM.png%3Fsource%3Dviewer%26v%3D87acf238d876dceb018e3c2a8b84112c\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fp61.f2.n0.cdn.getcloudapp.com%2Fitems%2FrRuomvXB%2FImage%25202020-10-29%2520at%25209.22.48%2520AM.png%3Fsource%3Dviewer%26v%3D87acf238d876dceb018e3c2a8b84112c\" alt=\"async matrix\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n  \u003ca name=\"async-is-musical\" href=\"#async-is-musical\"\u003e\n  \u003c/a\u003e\n  Async is Musical\n\u003c/h3\u003e\n\n\u003cp\u003eIf Observables were audio, their overlap would look like this:\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fs3.amazonaws.com%2Fwww.deanius.com%2FConcurModes2.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fs3.amazonaws.com%2Fwww.deanius.com%2FConcurModes2.png\" alt=\"Polyrhythm Concurrency Modes\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eWhen building UI, I find that 80% of user expectations can be fulfilled just by choosing the correct mode (another 10% with some debouncing thrown in there).\u003c/p\u003e\n\n\u003cp\u003eSo Im happy to use Observables, and refer to these concurrency modes/operators by their Polyrhythm names, instead of their RxJS names. I'm happy for RxJS for having brought them to my attention, but I no longer thrill to see their names in my codebase.\u003c/p\u003e\n\n","published":true,"published_from_feed":false,"show_comments":true,"slug":"never-use-the-wrong-rxjs-operator-again-by-never-using-one-again-1j90","social_image":null,"title":"From Events, to Observables, and to Events Again!","video":null,"video_code":null},{"created_at":"2020-12-11T10:25:14.985Z","crossposted_at":null,"edited_at":"2020-12-11T10:26:13.605Z","last_comment_at":"2020-12-12T19:35:41.469Z","published_at":"2020-12-11T10:25:49.843Z","canonical_url":null,"feed_source_url":null,"video_closed_caption_track_url":null,"video_source_url":null,"video_thumbnail_url":null,"body_markdown":"---\ntitle: Boilerplate - the Angular vs React difference\npublished: true\ndescription: \ntags: React, Angular, FP\n//cover_image: https://direct_url_to_image.jpg\n---\n\nIn React - a component is a function that returns a DOM tree (possibly by calling other component-functions). To test the function, you call it with different arguments, and assert different results.\n\nIn Angular, a component is a class, with a decorator and a corresponding module, which must be registered by some other component's module, and whose dependencies are injected via a constructor (whew - say that twice!) It's a class, but you never call new yourself on the component in prod code or tests. To test an Angular component involves setting up mock providers, repeating some of the registration of imports/declarations etc so that the test environment (or Storybook) satisfies all the same things the prod code has.\n\nThe difference is the amount of boilerplate.\n\nBoilerplate/configuration is not code you step through, or write 'from the head' or test-drive - it's stuff you trial-and-error your way through, with manuals and examples. A part of every coders job, yes, but hopefully a decreasing amount over time. Boilerplate gives you a low BizCode-to-FrameworkCode ratio, and leaves BizCode coupled tightly to the framework. I wrote some Angular tests where I manually new-ed up a component. They didn't get me very far.\n\nI think this difference is why React is eating the world - the mental model is simple enough yet composes arbitrarily, and you can do amazing things with it. There are fewer concepts to wire together in tests and code to simply get the return value of a function merged into the DOM. I'm not crapping on Angular or those who like it - it's powerful and opinionated. But newer frameworks (React, Vue, Svelte) area generally simpler, and that's a trend that won't likely reverse, imho. So let's hop the next bus out of boilerplate-town - we won't miss it.","cached_tag_list":"react, angular, functional","cached_user_name":"Dean Radcliffe","cached_user_username":"deanius","comments_count":2,"description":"In React - a component is a function that returns a DOM tree (possibly by calling other component-fun...","main_image":null,"main_image_background_hex_color":"#dddddd","path":"/deanius/boilerplate-the-angular-vs-react-difference-2cbk","public_reactions_count":2,"processed_html":"\u003cp\u003eIn React - a component is a function that returns a DOM tree (possibly by calling other component-functions). To test the function, you call it with different arguments, and assert different results.\u003c/p\u003e\n\n\u003cp\u003eIn Angular, a component is a class, with a decorator and a corresponding module, which must be registered by some other component's module, and whose dependencies are injected via a constructor (whew - say that twice!) It's a class, but you never call new yourself on the component in prod code or tests. To test an Angular component involves setting up mock providers, repeating some of the registration of imports/declarations etc so that the test environment (or Storybook) satisfies all the same things the prod code has.\u003c/p\u003e\n\n\u003cp\u003eThe difference is the amount of boilerplate.\u003c/p\u003e\n\n\u003cp\u003eBoilerplate/configuration is not code you step through, or write 'from the head' or test-drive - it's stuff you trial-and-error your way through, with manuals and examples. A part of every coders job, yes, but hopefully a decreasing amount over time. Boilerplate gives you a low BizCode-to-FrameworkCode ratio, and leaves BizCode coupled tightly to the framework. I wrote some Angular tests where I manually new-ed up a component. They didn't get me very far.\u003c/p\u003e\n\n\u003cp\u003eI think this difference is why React is eating the world - the mental model is simple enough yet composes arbitrarily, and you can do amazing things with it. There are fewer concepts to wire together in tests and code to simply get the return value of a function merged into the DOM. I'm not crapping on Angular or those who like it - it's powerful and opinionated. But newer frameworks (React, Vue, Svelte) area generally simpler, and that's a trend that won't likely reverse, imho. So let's hop the next bus out of boilerplate-town - we won't miss it.\u003c/p\u003e\n\n","published":true,"published_from_feed":false,"show_comments":true,"slug":"boilerplate-the-angular-vs-react-difference-2cbk","social_image":null,"title":"Boilerplate - the Angular vs React difference","video":null,"video_code":null},{"created_at":"2020-12-31T07:37:48.848Z","crossposted_at":null,"edited_at":null,"last_comment_at":"2024-07-03T03:02:35.445Z","published_at":"2020-12-31T07:37:48.819Z","canonical_url":null,"feed_source_url":null,"video_closed_caption_track_url":null,"video_source_url":null,"video_thumbnail_url":null,"body_markdown":"---\ntitle: 25 Years of Software Developer Lessons Learned\npublished: true\ndescription: lessons learned\ntags: career, imposter, javascript, reflection\ncover_image: https://images.unsplash.com/photo-1555597673-b21d5c935865?ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D\u0026ixlib=rb-1.2.1\u0026auto=format\u0026fit=crop\u0026w=1952\u0026q=80\n---\n\nIn January 1996 I set foot in my first web development job - an internship with Cybermundi.es during my Study Abroad semester in Madrid through Boston University. In January 2021, with a few interruptions of \"funemployment\", I'll have spent 25 years within the web development field. Between developing, teaching, consulting, and sabbatical, I am grateful for what it's taught me, and I have great hopes for the next 20 years.\nThe real story about these past 25 years is that - most of the things I thought would be true about my career at this point - aren't in fact true! This post is about those realizations.\n\nI can't say I've 'found my place' in the field any more now than in my first 5 years. I can't say I've eliminated Imposter Syndrome, or reached a place where I'm secure that I can't be fired, let go, or not hired. I'm not close to an early retirement. I am more humble about my ability to keep up with the pace of technological change.\n\nAnd here are the biggest misconceptions I've been disabused of along the way:\n\nAt year 3 I thought physical discomfort from having a desk job was inevitable. It turns out it can be systematically eliminated with exercise and ergonomics— in fact it must be if you are to have any longevity in this field.\n\nAt year 4 I thought I'd rotate my career wildly every 4 years. It turns out starting at the bottom in a new field, once you have some capital/skills in one field, is not very easy. Pay cuts are no fun.\n\nAt year 6 I thought I'd pulled an hourly rate I'd never see the equal of. While there are ups and downs, and that was relatively high, there's no ceiling, especially when focusing on in-demand skills. There's always something you could learn to make more if you want.\n\nAt year 7, then again at year 22, I thought I'd become a developer-trainer - primarily a teacher not a maker. It turns out while immensely rewarding, teaching has demands I've not yet been able to conquer sufficiently. I now seek the learning/teaching element within the relationships and many benefits I have as a developer.\n\nAt year 10, I thought Object Oriented Programming was the pinnacle in terms of architecture. I now feel that LISP and Functional Programming is more fundamental, and ultimately more expressive.\n\nAt year 13 I thought Ruby was the way I'd want to code forever. It turns out having code running in a browser, widely available, is more important than having a precise syntax/runtime DX, and I'm all in on JS now.\n\nAt year 17 I thought I'd taken my last development job and might become a yoga instructor. See that point about starting at the bottom in a new field, with less pay.\n\nAt year 19 I thought I'd be in business for myself forever. It turns out the complicated tax situation, and changing teams often grew old and I began to seek stability by year 22.\n\nAt year 21 I thought mental health took care of itself. It turns out it needs care and feeding like all worthwhile endeavors.\n\nAt year 23 I thought I'd joined my last full-time development job. A layoff from that job led me to begin the one I have now, which I have no intentions of leaving.\n\nAnd I'm sure more misconceptions will continue to get stripped away as the years pile on, which I look forward to!\n\n---\n\nAs I step into year 25 as a coder (0-based index), my coding approaches are generally the same—just a bit faster, a bit more knowledgeable, and a lot more humble about what I don't know. \n\nThe most surprising thing about where I'm at is how my career has fueled growth in non-career areas. I am entirely transformed in ways my 20 year old self would be delighted to see. I've always found the demands of this career have left time, money, and curiosity for skill development outside of work. I play several instruments now, including one of my own design, well enough to play with others or for audiences. I ride 100 km bike rides. I play with my kids for hours, and teach them as much as I can. I ski with my wife down Colorado black-diamond slopes above 15,000 feet. Life has been good to me. 🙏\n\nMy next 20 years will be themed around bringing those outside-of-career investments back toward my career. I am taking the discipline and goal-setting from my athletic endeavors, the precision and pattern from my musical hobbies, and the social and development from my life as dad and husband, and bring them all to bear on making my career an even better place to be for me and those around me.\n\nI will work on adapting in ever more dynamic ways, to the externalities that change this field constantly. I will take inspiration from colleagues, people who think differently than me, and who challenge me. I will seek the experiences that offer me the feedback I need to continue to be who I want to be.\n\nThat's what 25 years of being a professional software developer has taught me, and why I'm more excitedly going into the next 20 than ever. Happy 2021 y'all - what are your intentions for your development careers, let me know!\n\n","cached_tag_list":"career, imposter, javascript, reflection","cached_user_name":"Dean Radcliffe","cached_user_username":"deanius","comments_count":1,"description":"lessons learned","main_image":"https://images.unsplash.com/photo-1555597673-b21d5c935865?ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D\u0026ixlib=rb-1.2.1\u0026auto=format\u0026fit=crop\u0026w=1952\u0026q=80","main_image_background_hex_color":"#dddddd","path":"/deanius/25-years-of-software-developer-lessons-learned-2m0d","public_reactions_count":50,"processed_html":"\u003cp\u003eIn January 1996 I set foot in my first web development job - an internship with Cybermundi.es during my Study Abroad semester in Madrid through Boston University. In January 2021, with a few interruptions of \"funemployment\", I'll have spent 25 years within the web development field. Between developing, teaching, consulting, and sabbatical, I am grateful for what it's taught me, and I have great hopes for the next 20 years.\u003cbr\u003e\nThe real story about these past 25 years is that - most of the things I thought would be true about my career at this point - aren't in fact true! This post is about those realizations.\u003c/p\u003e\n\n\u003cp\u003eI can't say I've 'found my place' in the field any more now than in my first 5 years. I can't say I've eliminated Imposter Syndrome, or reached a place where I'm secure that I can't be fired, let go, or not hired. I'm not close to an early retirement. I am more humble about my ability to keep up with the pace of technological change.\u003c/p\u003e\n\n\u003cp\u003eAnd here are the biggest misconceptions I've been disabused of along the way:\u003c/p\u003e\n\n\u003cp\u003eAt year 3 I thought physical discomfort from having a desk job was inevitable. It turns out it can be systematically eliminated with exercise and ergonomics— in fact it must be if you are to have any longevity in this field.\u003c/p\u003e\n\n\u003cp\u003eAt year 4 I thought I'd rotate my career wildly every 4 years. It turns out starting at the bottom in a new field, once you have some capital/skills in one field, is not very easy. Pay cuts are no fun.\u003c/p\u003e\n\n\u003cp\u003eAt year 6 I thought I'd pulled an hourly rate I'd never see the equal of. While there are ups and downs, and that was relatively high, there's no ceiling, especially when focusing on in-demand skills. There's always something you could learn to make more if you want.\u003c/p\u003e\n\n\u003cp\u003eAt year 7, then again at year 22, I thought I'd become a developer-trainer - primarily a teacher not a maker. It turns out while immensely rewarding, teaching has demands I've not yet been able to conquer sufficiently. I now seek the learning/teaching element within the relationships and many benefits I have as a developer.\u003c/p\u003e\n\n\u003cp\u003eAt year 10, I thought Object Oriented Programming was the pinnacle in terms of architecture. I now feel that LISP and Functional Programming is more fundamental, and ultimately more expressive.\u003c/p\u003e\n\n\u003cp\u003eAt year 13 I thought Ruby was the way I'd want to code forever. It turns out having code running in a browser, widely available, is more important than having a precise syntax/runtime DX, and I'm all in on JS now.\u003c/p\u003e\n\n\u003cp\u003eAt year 17 I thought I'd taken my last development job and might become a yoga instructor. See that point about starting at the bottom in a new field, with less pay.\u003c/p\u003e\n\n\u003cp\u003eAt year 19 I thought I'd be in business for myself forever. It turns out the complicated tax situation, and changing teams often grew old and I began to seek stability by year 22.\u003c/p\u003e\n\n\u003cp\u003eAt year 21 I thought mental health took care of itself. It turns out it needs care and feeding like all worthwhile endeavors.\u003c/p\u003e\n\n\u003cp\u003eAt year 23 I thought I'd joined my last full-time development job. A layoff from that job led me to begin the one I have now, which I have no intentions of leaving.\u003c/p\u003e\n\n\u003cp\u003eAnd I'm sure more misconceptions will continue to get stripped away as the years pile on, which I look forward to!\u003c/p\u003e\n\n\n\u003chr\u003e\n\n\u003cp\u003eAs I step into year 25 as a coder (0-based index), my coding approaches are generally the same—just a bit faster, a bit more knowledgeable, and a lot more humble about what I don't know. \u003c/p\u003e\n\n\u003cp\u003eThe most surprising thing about where I'm at is how my career has fueled growth in non-career areas. I am entirely transformed in ways my 20 year old self would be delighted to see. I've always found the demands of this career have left time, money, and curiosity for skill development outside of work. I play several instruments now, including one of my own design, well enough to play with others or for audiences. I ride 100 km bike rides. I play with my kids for hours, and teach them as much as I can. I ski with my wife down Colorado black-diamond slopes above 15,000 feet. Life has been good to me. 🙏\u003c/p\u003e\n\n\u003cp\u003eMy next 20 years will be themed around bringing those outside-of-career investments back toward my career. I am taking the discipline and goal-setting from my athletic endeavors, the precision and pattern from my musical hobbies, and the social and development from my life as dad and husband, and bring them all to bear on making my career an even better place to be for me and those around me.\u003c/p\u003e\n\n\u003cp\u003eI will work on adapting in ever more dynamic ways, to the externalities that change this field constantly. I will take inspiration from colleagues, people who think differently than me, and who challenge me. I will seek the experiences that offer me the feedback I need to continue to be who I want to be.\u003c/p\u003e\n\n\u003cp\u003eThat's what 25 years of being a professional software developer has taught me, and why I'm more excitedly going into the next 20 than ever. Happy 2021 y'all - what are your intentions for your development careers, let me know!\u003c/p\u003e\n\n","published":true,"published_from_feed":false,"show_comments":true,"slug":"25-years-of-software-developer-lessons-learned-2m0d","social_image":null,"title":"25 Years of Software Developer Lessons Learned","video":null,"video_code":null},{"created_at":"2021-01-19T15:04:23.632Z","crossposted_at":null,"edited_at":"2021-01-19T15:05:46.167Z","last_comment_at":"2021-01-19T15:04:23.609Z","published_at":"2021-01-19T15:04:23.609Z","canonical_url":null,"feed_source_url":null,"video_closed_caption_track_url":null,"video_source_url":null,"video_thumbnail_url":null,"body_markdown":"---\ntitle: To Squash Race Conditions, Stop Paying The Async Tax\npublished: true\ndescription: What race conditions are, how they occur, and whether there is a general purpose fix for them\ntags: async, JavaScript, RxJS, Angular\ncover_image: https://images.unsplash.com/photo-1505166065723-bae088a12fc4?ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D\u0026ixlib=rb-1.2.1\u0026auto=format\u0026fit=crop\u0026w=2547\u0026q=80\n---\n\n\"Race conditions\" in programming are a common cause of user-reported bugs. Just as costly to organizations and development teams, their fixes are a common cause of complexity and unmaintainable code that produces more edge cases and bugs. What race conditions are, how they occur, and whether there is a general purpose fix for them is what we will explore, defining the term Async Tax to capture the price we pay when changing code from sync to async. Then we'll point toward a better future where we don't pay such a tax.\n\n## What is Asynchronous Code?\nThe climate in which race conditions appear is any time a system allows for concurrent operations. In JavaScript this means wherever you have code that executes asynchronous operations - AJAX, callback, setTimeout, permission granting, etc..\n\nAn asynchronous operation is defined as code whose start time and end time are separated; they are not the same, not _synchronous_. Generally speaking the precise duration of async code is not knowable in advance. The general thought is that this nondeterminism is to blame for race conditions. It goes deeper than that though, so let's dive in.\n\n## What are Race Conditions?\nA Race Condition is a situation where one asynchronous operation occurs sooner or later than expected, leading code to encounter an environment it didn't expect - a connection had already closed, a piece of state was not there, the component was unmounted, etc..\n\n## Why are Race Conditions So Hard To Prevent?\n\nTwo asynchronous operations can be visualized as two lines along an axis of time. Here are two async operations 'x' and 'y', and the possible ways they could overlap in time.\n\n```\n   ---\u003e 𝓉𝒾𝓂𝑒  \n   x------x       x-------x      x----x      x--x    \n     y------y       y---y     y-----y     y-------y  \n```\n\nWhile the program may have expected, and coded, for the first possible overlap, and one of the other overlaps may be explicitly forbidden, or tested for, either of the others could occur at runtime unexpectedly and cause an error, which would be called a race condition.\n\nThe number of possibile overlaps are exponential in the number of operations - 2 overlaps have 4 possibilities, 3 have 8, 10 have 1,024... a weighty burden on the programmer to have to cover each one with tests.\n\nAsync operations take something that was a point on a timeline, and stretch it into a line, overlapping with other lines in inconcievable ways. Imagine a drawing tool that can manipulate circular shapes, and test for their overlap. How many ways can 3 circles overlap?\n\n![](https://i.ytimg.com/vi/bRIL9kMJJSc/maxresdefault.jpg)\n\nIf you're like me you were surprised at the number of combinations. And if you're like me, building this tool, you probably would have explicitly tested about 3 or 4 at most. Yet there are 14. And that's just with 3 shapes. Exponentials grow very very fast. We need ways of taming them.\n\n### The Async Tax\n\nThese days, it's painful and damaging to an application when you implement a feature in a way that requires something that was was once sync to become async. I call this damage 'paying the Async Tax'.\n\nImagine a function `t` that once returned a translated string `(key) =\u003e i18n.t(key)`. Now it  needs to use a  translation layer that may or may not have been loaded, so it'll depend on a Promise, and now return a `Promise\u003cstring\u003e` instead of a `string`. `(key) =\u003e i18n.then(lang =\u003e lang.t(key))`. Sure async/await can help you change the function's internals minimally, but how much will the function's immediate caller need to change? How much rewriting of tests? \n\n\n```js\n// How would you change this to use `i18n.t1` `i18n.t2` ?\nconst label = `\u003clabel\u003e${i18n.t('title')}\u003c/label\u003e`\n\nconst i18n = {\n  t: (key) =\u003e syncTranslate(key),\n  // t1 and t2 are two equivalent async forms\n  t1: async (key) =\u003e (await asyncLib()).syncTranslate(key),\n  t2: (key) =\u003e asyncLib().then(lib =\u003e lib.syncTranslate(key))\n}\n```\n\nAsync/await doesn't pay down the async tax, it makes it easier to forget you're paying it. What's needed is a better abstraction - one that sits high enough that changing from sync to async (or vice versa!) is just a one line change.\n\nIn concretion, one such solution is called Observables, and is implemented by the RxJS library. Another is called Sagas, and is implemented by Redux Saga. Both of these allow for changes to code that don't incur the Async Tax. Yes, you read that right - there are coding techniques available today that you could be using to not pay the Async Tax!\n\n# What To Do ?\n\nI want to write a follow up to this, including a true story of a one-line change from a sync to an async operation—with zero impact to tests. But I need some pointers to what would interest you. \n\nPlease like, or discuss your thoughts below to show me what you're interested in, and how to target it. At work, we're still honing our ability to eliminate the sources of the Async Tax that remain. But generally, I believe a discussion about this is to the wider benefit of the community. I've written JavaScript since its beginning in 1996, and I've never been more excited about the **UI-framework agnostic** ways to write tight async code without race conditions. So I'll spill the beans, you just gotta ask!\n\n\u003e Disclaimer: So much so that I've written a library [`polyrhythm`](https://github.com/deanius/polyrhythm) to deliver Observable's capabilities in as maintainer-friendly a manner as possible, free from cryptic operators, deeply-nested Observables, and cumbersome management of Subscription objects.\n\n","cached_tag_list":"async, javascript, rxjs, angular","cached_user_name":"Dean Radcliffe","cached_user_username":"deanius","comments_count":0,"description":"What race conditions are, how they occur, and whether there is a general purpose fix for them","main_image":"https://images.unsplash.com/photo-1505166065723-bae088a12fc4?ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D\u0026ixlib=rb-1.2.1\u0026auto=format\u0026fit=crop\u0026w=2547\u0026q=80","main_image_background_hex_color":"#dddddd","path":"/deanius/to-squash-race-conditions-stop-paying-the-async-tax-g8c","public_reactions_count":2,"processed_html":"\u003cp\u003e\"Race conditions\" in programming are a common cause of user-reported bugs. Just as costly to organizations and development teams, their fixes are a common cause of complexity and unmaintainable code that produces more edge cases and bugs. What race conditions are, how they occur, and whether there is a general purpose fix for them is what we will explore, defining the term Async Tax to capture the price we pay when changing code from sync to async. Then we'll point toward a better future where we don't pay such a tax.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"what-is-asynchronous-code\" href=\"#what-is-asynchronous-code\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  What is Asynchronous Code?\n\u003c/h2\u003e\n\n\u003cp\u003eThe climate in which race conditions appear is any time a system allows for concurrent operations. In JavaScript this means wherever you have code that executes asynchronous operations - AJAX, callback, setTimeout, permission granting, etc..\u003c/p\u003e\n\n\u003cp\u003eAn asynchronous operation is defined as code whose start time and end time are separated; they are not the same, not \u003cem\u003esynchronous\u003c/em\u003e. Generally speaking the precise duration of async code is not knowable in advance. The general thought is that this nondeterminism is to blame for race conditions. It goes deeper than that though, so let's dive in.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"what-are-race-conditions\" href=\"#what-are-race-conditions\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  What are Race Conditions?\n\u003c/h2\u003e\n\n\u003cp\u003eA Race Condition is a situation where one asynchronous operation occurs sooner or later than expected, leading code to encounter an environment it didn't expect - a connection had already closed, a piece of state was not there, the component was unmounted, etc..\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"why-are-race-conditions-so-hard-to-prevent\" href=\"#why-are-race-conditions-so-hard-to-prevent\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  Why are Race Conditions So Hard To Prevent?\n\u003c/h2\u003e\n\n\u003cp\u003eTwo asynchronous operations can be visualized as two lines along an axis of time. Here are two async operations 'x' and 'y', and the possible ways they could overlap in time.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e   ---\u0026gt; 𝓉𝒾𝓂𝑒  \n   x------x       x-------x      x----x      x--x    \n     y------y       y---y     y-----y     y-------y  \n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eWhile the program may have expected, and coded, for the first possible overlap, and one of the other overlaps may be explicitly forbidden, or tested for, either of the others could occur at runtime unexpectedly and cause an error, which would be called a race condition.\u003c/p\u003e\n\n\u003cp\u003eThe number of possibile overlaps are exponential in the number of operations - 2 overlaps have 4 possibilities, 3 have 8, 10 have 1,024... a weighty burden on the programmer to have to cover each one with tests.\u003c/p\u003e\n\n\u003cp\u003eAsync operations take something that was a point on a timeline, and stretch it into a line, overlapping with other lines in inconcievable ways. Imagine a drawing tool that can manipulate circular shapes, and test for their overlap. How many ways can 3 circles overlap?\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--PE6GJkoj--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.ytimg.com/vi/bRIL9kMJJSc/maxresdefault.jpg\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--PE6GJkoj--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://i.ytimg.com/vi/bRIL9kMJJSc/maxresdefault.jpg\" alt=\"\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eIf you're like me you were surprised at the number of combinations. And if you're like me, building this tool, you probably would have explicitly tested about 3 or 4 at most. Yet there are 14. And that's just with 3 shapes. Exponentials grow very very fast. We need ways of taming them.\u003c/p\u003e\n\n\u003ch3\u003e\n  \u003ca name=\"the-async-tax\" href=\"#the-async-tax\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  The Async Tax\n\u003c/h3\u003e\n\n\u003cp\u003eThese days, it's painful and damaging to an application when you implement a feature in a way that requires something that was was once sync to become async. I call this damage 'paying the Async Tax'.\u003c/p\u003e\n\n\u003cp\u003eImagine a function \u003ccode\u003et\u003c/code\u003e that once returned a translated string \u003ccode\u003e(key) =\u0026gt; i18n.t(key)\u003c/code\u003e. Now it  needs to use a  translation layer that may or may not have been loaded, so it'll depend on a Promise, and now return a \u003ccode\u003ePromise\u0026lt;string\u0026gt;\u003c/code\u003e instead of a \u003ccode\u003estring\u003c/code\u003e. \u003ccode\u003e(key) =\u0026gt; i18n.then(lang =\u0026gt; lang.t(key))\u003c/code\u003e. Sure async/await can help you change the function's internals minimally, but how much will the function's immediate caller need to change? How much rewriting of tests?\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// How would you change this to use `i18n.t1` `i18n.t2` ?\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003elabel\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e`\u0026lt;label\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003ei18n\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003et\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003etitle\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e)}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026lt;/label\u0026gt;`\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ei18n\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"na\"\u003et\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003esyncTranslate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e// t1 and t2 are two equivalent async forms\u003c/span\u003e\n  \u003cspan class=\"na\"\u003et1\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003easync\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eawait\u003c/span\u003e \u003cspan class=\"nx\"\u003easyncLib\u003c/span\u003e\u003cspan class=\"p\"\u003e()).\u003c/span\u003e\u003cspan class=\"nx\"\u003esyncTranslate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n  \u003cspan class=\"na\"\u003et2\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003easyncLib\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nx\"\u003ethen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003elib\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003elib\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esyncTranslate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ekey\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eAsync/await doesn't pay down the async tax, it makes it easier to forget you're paying it. What's needed is a better abstraction - one that sits high enough that changing from sync to async (or vice versa!) is just a one line change.\u003c/p\u003e\n\n\u003cp\u003eIn concretion, one such solution is called Observables, and is implemented by the RxJS library. Another is called Sagas, and is implemented by Redux Saga. Both of these allow for changes to code that don't incur the Async Tax. Yes, you read that right - there are coding techniques available today that you could be using to not pay the Async Tax!\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"what-to-do-\" href=\"#what-to-do-\" class=\"anchor\"\u003e\n  \u003c/a\u003e\n  What To Do ?\n\u003c/h1\u003e\n\n\u003cp\u003eI want to write a follow up to this, including a true story of a one-line change from a sync to an async operation—with zero impact to tests. But I need some pointers to what would interest you. \u003c/p\u003e\n\n\u003cp\u003ePlease like, or discuss your thoughts below to show me what you're interested in, and how to target it. At work, we're still honing our ability to eliminate the sources of the Async Tax that remain. But generally, I believe a discussion about this is to the wider benefit of the community. I've written JavaScript since its beginning in 1996, and I've never been more excited about the \u003cstrong\u003eUI-framework agnostic\u003c/strong\u003e ways to write tight async code without race conditions. So I'll spill the beans, you just gotta ask!\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eDisclaimer: So much so that I've written a library \u003ca href=\"https://github.com/deanius/polyrhythm\"\u003e\u003ccode\u003epolyrhythm\u003c/code\u003e\u003c/a\u003e to deliver Observable's capabilities in as maintainer-friendly a manner as possible, free from cryptic operators, deeply-nested Observables, and cumbersome management of Subscription objects.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n","published":true,"published_from_feed":false,"show_comments":true,"slug":"to-squash-race-conditions-stop-paying-the-async-tax-g8c","social_image":null,"title":"To Squash Race Conditions, Stop Paying The Async Tax","video":null,"video_code":null},{"created_at":"2021-05-21T16:48:08.028Z","crossposted_at":null,"edited_at":"2021-05-21T19:35:24.704Z","last_comment_at":"2021-05-21T16:48:08.001Z","published_at":"2021-05-21T16:48:08.001Z","canonical_url":null,"feed_source_url":null,"video_closed_caption_track_url":null,"video_source_url":null,"video_thumbnail_url":null,"body_markdown":"---\ntitle: How to Use Component-level Cancelation in React (Promises, RxJS or Redux Query)\npublished: true\ndescription: Learn how to cancel effects when the components that triggered them unmount.\ntags: react, redux, RxJS\ncover_image: https://images.unsplash.com/photo-1520606393001-b816ded9caac?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8\u0026ixlib=rb-1.2.1\u0026auto=format\u0026fit=crop\u0026w=2100\u0026q=80\n---\n\n## Motivation\n\nCancelation is first and foremost a User Experience issue. Users will perceive apps to be more responsive when resources like the network are freed up to be used by the task at hand. Cancelation is also a way to improve the experience of users on slower connections, so increases your app's reach.\n\nThe pictures below show how a search results page stops consuming network usage when it is unmounted (and how incremental rendering helps show results sooner- the topic of a future post)\n\nWith cancelation, and incremental delivery:\n\n![](https://s3.amazonaws.com/www.deanius.com/graphql-rates-observable-unmount.gif)\n\n\nNo cancelation (and no incremental delivery):\n![](https://s3.amazonaws.com/www.deanius.com/graphql-rates-apollo-unmount.gif)\n\n\n\"But how often will this matter?\" is a question you might ask. That will depend on your user demographics and their connectivity, of course. But you needn't wait for complaints to arrive to build in a sensible principle. \n\n## Comparisons \nCancelation wasn't always an afterthought. The first web browsers had a big red 'STOP' button so that users could cancel slow-loading pages at any time. \n\n![Netscape 1.0, my first browser on a mac](https://s3.amazonaws.com/www.deanius.com/netscape-stop-button.png)\n\nAs the SPA era began, about 10 years later, several things became casualties as far as User Experience (UX). Yes, \"the back button broke\". But also - now that request-making and asynchronous processes were no longer tied to that big red button, fire-and-forget AJAX became the norm. Browsers stopped showing a Stop button (does yours have one?), and developers stopped treating cancelation like it was critical to good UX. But it still is.\n\nImagine if operating systems didn't cancel child processes by default! Web development only differs by degree from that.\n\n![Operating Systems Cancel Hierarchically](https://s3.amazonaws.com/www.deanius.com/activity-monitor-by-hierarchy-process.png)\n\n\n# Code Examples With React Hooks\n\nSo how does one achieve component-level cancelation in React with hooks? We'll explore several technologies' answers to this, in the context of a real-world example. Let's say we have a component that presents a list of possible appointment times, and uses a hook called `useAppointments` to query a back-end via AJAX for whether the chosen time is available. Stripped of UI details, it would look like this:\n\n```js\nfunction AppointmentChooser() {\n   const { beginTime, setBeginTime, isAvailable } = useAppointments();\n   return \u003c\u003e\n      \u003cselect\n        onChange={(e) =\u003e setBeginTime(e.target.value)}\u003e\n        \u003c!-- time options --\u003e\n      \u003c/select\u003e\n      \u003cspan\u003e{beginTime} { isAvailable ? \"✅\" : \"🚫\" }\n   \u003c/\u003e\n}\n```\n\nOur goal will be that any effects this component triggers will be shutdown when this appointment chooser unmounts.\n\n# Style 1 — Vanilla JS, no cancelation\n\nHere's how we might implement `useAppointments` without regard to cancelation:\n\n```js\nexport function useAppointments() {\n  const [beginTime, _setBeginTime] = useState('');\n  const [isAvailable, setIsAvailable] = useState\u003cnull | 'loading' | true | false\u003e(null);\n\n  function setBeginTime(time: string) {\n    setIsAvailable('loading');\n    _setBeginTime(time);\n    \n    fetch(`https://httpbin.org/delay/5?t=${time}`)\n      .then(({ isAvailable }) =\u003e {\n        setIsAvailable(isAvailable);\n      });\n  };\n  return { beginTime, setBeginTime, isAvailable };\n}\n```\n\nThe job of the hook's `setBeginTime` function is to 1) set the `beginTime` in local state, 2) set the availability to `'loading'` 3) perform the fetch, and 4) set the availability asynchronously with the result of the fetch. This function `setBeginTime` is what we will focus on as we show differing implementations. \n\n# Style 1.1 — Vanilla JS: Promise + AbortController\n\nIn 2018 the `AbortController` abstraction was introduced for canceling *some* Promises.  An example of a hook that uses an AbortController on each request, and cancels the fetch upon on unmount is shown below. \n\n```js\nexport function useAppointments() {\n  const [beginTime, _setBeginTime] = useState('');\n  const [isAvailable, setIsAvailable] = useState\u003cnull | 'loading' | true | false\u003e(null);\n\n  const ac = useRef\u003cAbortController\u003e(null);\n  useEffect(() =\u003e () =\u003e ac.current.abort(), []);\n\n  function setBeginTime(time: string) {\n    setIsAvailable('loading');\n    _setBeginTime(time);\n\n    ac.current = new AbortController();\n    \n    fetch(`https://httpbin.org/delay/${delay}?t=${time}`, {\n      signal: ac.current.signal,\n    }).then(\n      () =\u003e {\n        setIsAvailable(true);\n      },\n      (ex: DOMException) =\u003e {\n        if (ex.name === 'AbortError') {\n  \t\t  // not an exception\n          setIsAvailable(null);\n        } else { throw ex }\n      }\n    );\n  };\n  return { beginTime, setBeginTime, isAvailable };\n}\n```\n\nWow, that's a lot of code. We have to hold refs for AbortController instances. We have to use the cryptic React-hook-specific syntax to invoke cancelation, which reads, \"on unmount, abort the current request\".\n\n   `useEffect(() =\u003e () =\u003e ac.current.abort(), [])` \n\nAnd then we have the exception-handling code. An aborted Promise is treated as an exception which generally will you will generally want to distinguish from a real exception like a `501` server error.\n\nThis code achieves cancelation-on-unmount with only Vanilla JS, but are there libraries we can use to have a simpler implementation?\n\nA library exists that generalizes cancelable async processes, and will let us apply more concurrency options as transparently as cancelation. Let's see how RxJS, familiar to Angular users, approaches cancelation.\n\n# Style 2 — RxJS + useEffect\n\nIn 2012, before Promises were even integrated into JavaScript, the ReactiveX project (now known as RxJS) introduced an inherently cancelable datatype - `Observable`. While Observable is more commonly known for its use as an asynchronous Stream, every Observable ever made is cancelable. Because of this, there will be far less code to cancel an Observable than a Promise.\n\nThe general strategy is to wrap the begin and end operations in an RxJS Observable explicitly, and return that Observable to a hook that will call `.subscribe()` on it, and call `.unsubscribe()`  on it when unmounted.\n\n```js\nimport { Subscription } from 'rxjs';\nimport { ajax } from 'rxjs/ajax';\nimport { tap } from 'rxjs/operators';\n\nexport function useAppointments() {\n  const [beginTime, _setBeginTime] = useState('');\n  const [isAvailable, setIsAvailable] = useState\u003cnull | 'loading' | true | false\u003e(null);\n  const process = useRef\u003cSubscription\u003e(null);\n  useEffect(() =\u003e () =\u003e process.current.unsubscribe(), []);\n  \n  function setBeginTime(time: string) {\n    setIsAvailable('loading');\n    _setBeginTime(time);\n    \n    process.current = ajax\n      .getJSON(`https://httpbin.org/delay/5?t=${time}`)\n      .pipe(tap({ isAvailable }) =\u003e {\n        setIsAvailable(isAvailable);\n      }))\n      .subscribe();\n  };\n  return { beginTime, setBeginTime, isAvailable };\n}\n```\n\nLike the AbortController example, we need a `ref` to keep track of the cancelation variable. But in this case it is a Subscription, not an AbortController, and cancelation function is `unsubscribe()`, not `abort()`. `ajax.getJSON()` creates the Observable, which represents *but does not start* the AJAX call, and `.subscribe()` begins the call, and returns the Subscription which is how we cancel. The `pipe(tap(..))` construct updates the local state by calling `setIsAvailable` once a value is available from the request.\n\nThe main increase in clarity here comes from the fact that unsubscribing from an Observable (or technically, from its Subscription) is not considered an exception, so that code disappears! But we still rely on managing an extra object - the Subscription - in order to provide cancelation. Let's now make those subscription objects disappear.\n\n# Style 3 - RxJS + useCancelableEffect\n\nThe `polyrhythm` library, introduced in 2018, lowers the learning curve and amount of code required to use RxJS. The companion library `polyrhythm-react` exports hooks for using it in a React context. Let's see how its `useCancelableEffect` function can clean up our availability-querying hook:\n\n```js\nimport { useCancelableEffect } from 'polyrhythm-react';\nimport { ajax } from 'rxjs/ajax';\nimport { tap } from 'rxjs/operators';\n\nexport function useAppointments() {\n  const [beginTime, _setBeginTime] = useState('');\n  const [isAvailable, setIsAvailable] = useState\u003cnull | 'loading' | true | false\u003e(null);\n\n  const [queryAvailability] = useCancelableEffect((time: string) =\u003e {\n    return ajax\n      .getJSON(`https://httpbin.org/delay/5?t=${time}`)\n      .pipe(tap({ isAvailable }) =\u003e {\n        setIsAvailable(isAvailable);\n       }));\n  });\n  \n  function setBeginTime(time: string) {\n    setIsAvailable('loading');\n    _setBeginTime(time);\n\tqueryAvailability(time);    \n  };\n  return { beginTime, setBeginTime, isAvailable };\n}\n```\nThis is the shortest listing yet. We provide `useCancelableEffect` a function that converts a `time` to an Observable of the AJAX query for availability and state-updating. `useCancelableEffect` returns a tuple, the first item which is a triggering function, which we name `queryAvailability`. \n\nAfter updating local state in `setBeginTime`, we call `queryAvailability` to begin the AJAX, and if at any time the component unmounts, the AJAX call will terminate! The API to getting an Observable representing an AJAX request is very similar to getting a Promise for a request, but since Observables are inherently cancelable there's no extra AbortController. This results in less code overall.\n\nWe can further generalize the process of AJAX to include the loading state - which we don't want to leave displaying \"loading\" if the request has canceled. Here's how we use the Observable constructor directly to incorporate teardown into cancelation:\n\n```js\n\nimport { useCancelableEffect } from 'polyrhythm-react';\nimport { Observable } from 'rxjs';\nimport { ajax } from 'rxjs/ajax';\nimport { tap } from 'rxjs/operators';\n\nexport function useAppointments() {\n  const [beginTime, _setBeginTime] = useState('');\n  const [isAvailable, setIsAvailable] = useState\u003cnull | 'loading' | true | false\u003e(null);\n\n  const [setBeginTime] = useCancelableEffect((time: string) =\u003e {\n    return new Observable(observer =\u003e {\n      setIsAvailable('loading');\n      _setBeginTime(value);\n      \n      const query = ajax\n        .getJSON(`https://httpbin.org/delay/5?t=${time}`)\n        .pipe(tap({ isAvailable }) =\u003e {\n          setIsAvailable(isAvailable);\n         }));\n       \n      const ajax = query.subscribe({\n        complete() { observer.complete(); }\n      });\n      \n      return function teardown() {\n        ajax.unsubscribe();\n        setIsAvailable(null); // clear the loading state\n\t  }\n  });\n  \n  return { beginTime, setBeginTime, isAvailable };\n}\n```\nLike React's own `useEffect`, the returned value from the `new Observable` factory is a teardown function that is called upon unsubscribe. Upon teardown we should stop the AJAX, and revert the loading state to unknown aka `null`.  Upon starting the Observable, we simply need to set the loading state, and call `subscribe` to begin the AJAX. This way, a single Observable represents the entire process of AJAX, including its loading state. The argument to `subscribe` -containing `observer.complete()` - indicates that the completion of the AJAX should mark the end of the entire Observable. This just illustrates one way to compose Observable behavior with cancelation, and is not meant to be prescriptive for all cases.\n\nThis technique generalizes far beyond AJAX, and makes RxJS a real workhorse. For example, to fire-off an auto-canceling Observable that uses the browser's [Speech API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Speech_API/Using_the_Web_Speech_API):\n\n```js\nconst [speakIt] = useCancelableEffect(() =\u003e new Observable(() =\u003e {\n  const words = `Checking availability for ${time}`;\n  speechSynthesis.speak(new SpeechSynthesisUtterance(words));\n\n  return () =\u003e {\n    window.speechSynthesis.cancel();\n  };\n});)\n```\n\nThe ability to bundle cancelation with creation ultimately leads to optimally performant code, with fewer edge cases, and less scattering of logic. This is why RxJS is useful on the front-end, back-end, and is one of the most downloaded packages on NPM (over 2x that of React!)\n\n# Bonus — RxJS Operators via hooks\n\nNote that in the examples above, the code assumes that there will be no overlapping requests. But in real life, if a user isn't getting a speedy response for one appointment time, they may choose another, and bugs will result!\n\nRxJS provides operators to deal with the concurrency issue, but in fact RxJS users' most frequent sources of confusion are is how to choose and use operators. \n\nFor your convenience, all of the operators of RxJS have hooks in `polyrhythm-react` which let you control timing with precision (this  will be elaborated in a future post).\n\n|  polyrhythm-react | RxJS  |\n|--|--|\n| useCancelableEffect/useASAPEffect | mergeMap  |\n| useQueuedEffect | concatMap  |\n| useRestartingEffect | switchMap  |\n| useThrottledEffect | exhaustMap  |\n\n---\n# Summary\n\nIt's a best practice all over the web development stack to tie processes to the things that need them, so they tear down automatically. On the back-end, don't do work for a client who's disconnected. On the front-end, when a component that just mounted did a thing, and the user navigated to a new route that causes an unmount.\n\nThe idea of the API to the hook remaining the same, while cancelation is used internally is the best-practice way to integrate cancelable processes to React. Whether you obtain that result with Redux Query, RxJS or custom hooks is up to you. But your users and support teams want you to reduce issues that can be fixed by cancelation. And development is easier when concurrency options prevent race conditions, which canceling enables. Now you have an array of tools to help improve User Experience.\n\nHappy canceling!\n\n\n# Bonus - Redux Query useRequest\n\nIf the process we want to be cancelable is an AJAX request made with Redux Query, there is a hook that can help us. But first let's remind ourselves how a non-cancelable Redux Query hook looks.\n\nIn order to move the `isAvailable` field to be controlled by R/Q, we introduce a queryConfig `apptQueryConfig` that specifies where to locate the state in Redux, and a selector `selectApptAvailability` that finds that state. In prod code, maybe we'd move the state field of `beginTime` up to the Redux store, and out of this component as well, but for demo purposes we'll leave it.\n\nSo, for non-cancelable Redux Query we'd have:\n\n```js\nimport { useDispatch, useSelector } from 'react-redux';\nimport { requestAsync } from 'redux-query';\nimport { apptQueryConfig, selectAvailability } from './appointments';\n\nexport function useAppointments() {\n  const dispatch = useDispatch();\n  const [beginTime, _setBeginTime] = useState('');\n  const isAvailable = useSelector(selectApptAvailability);\n  // state as before ...\n  \n  function setBeginTime(time: string) {\n    setIsAvailable('loading');\n    _setBeginTime(time);\n    // add time to the queryConfig\n    const queryConfig = apptQueryConfig(time);\n    // perform the lookup\n    dispatch(requestAsync());\n  }  \n  return { beginTime, setBeginTime, isAvailable };\n}\n```\n\nAfter adding time to the queryConfig, it is a simple `dispatch` of a `requestAsync` action which begins the AJAX, and resolves `isAvailable`. How do we make it cancelable? There's a Redux Query hook for that: `useRequest`. With `useRequest`, we get cancelation almost 'for free'. According to R/Q docs:\n\n\u003e When the associated component unmounts and there is a request in-flight, then a  [`cancelQuery`](https://amplitude.github.io/redux-query/docs/redux-actions#cancelquery)  action will be dispatched which will attempt to abort the network request.\n\nSo we have the following:\n\n```js\nimport { useSelector } from 'react-redux';\nimport { useRequest } from 'redux-query-react';\nimport { apptQueryConfig, selectAvailability } from './appointments';\n\nexport function useAppointments() {\n  const [beginTime, _setBeginTime] = useState('');\n  const isAvailable = useSelector(selectApptAvailability);\n  // state as before ...\n   \n  const queryConfig = useMemo(() =\u003e {\n    return beginTime ? apptQueryConfig(beginTime) : null;\n  }, [beginTime]);\n  useRequest(queryConfig);\n  \n  function setBeginTime(time: string) {\n    setIsAvailable('loading');\n    _setBeginTime(time);\n    // R/Q auto-updates on changes of `beginTime`\n  }\n\n  return { beginTime, setBeginTime, isAvailable };\n}\n```\nNice! We have a queryConfig that is a memoized version of `beginTime`.  The queryConfig must be `null` when `beginTime` is not yet set, to accommodate the first render, since the user has not yet provided a time.  It is this config that we pass to `useRequest`, and cancelation happens behind the scene, easy peasy!\n\nIt's no surprise a popular library like Redux Query accounts for the cases of cancelation. In addition, can you see how it solves the multiple request problem? According to its docs:\n\n\u003e If there is a previously-issued request that is still in-flight, then a [`cancelQuery`](https://amplitude.github.io/redux-query/docs/redux-actions#cancelquery) action will be dispatched which will attempt to abort the network request.\n\nIn other words, when the user changes their mind and selects a new appointment time, all the network bandwidth goes toward the NEW appointment time- the previous one is canceled since we won't display its result anyway! This is the bedrock of good UX, and it reduces edge cases as well. We won't elaborate on concurrency here—a future post will. For now, note that cancelation isn't just useful for unmounting, but also for eliminating race conditions caused by previous requests completing *after* newer ones.\n\n","cached_tag_list":"react, redux, rxjs","cached_user_name":"Dean Radcliffe","cached_user_username":"deanius","comments_count":0,"description":"Learn how to cancel effects when the components that triggered them unmount.","main_image":"https://images.unsplash.com/photo-1520606393001-b816ded9caac?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8\u0026ixlib=rb-1.2.1\u0026auto=format\u0026fit=crop\u0026w=2100\u0026q=80","main_image_background_hex_color":"#dddddd","path":"/deanius/how-to-use-component-level-cancelation-in-react-promises-rxjs-or-redux-query-58ib","public_reactions_count":5,"processed_html":"\u003ch2\u003e\n  \u003ca name=\"motivation\" href=\"#motivation\"\u003e\n  \u003c/a\u003e\n  Motivation\n\u003c/h2\u003e\n\n\u003cp\u003eCancelation is first and foremost a User Experience issue. Users will perceive apps to be more responsive when resources like the network are freed up to be used by the task at hand. Cancelation is also a way to improve the experience of users on slower connections, so increases your app's reach.\u003c/p\u003e\n\n\u003cp\u003eThe pictures below show how a search results page stops consuming network usage when it is unmounted (and how incremental rendering helps show results sooner- the topic of a future post)\u003c/p\u003e\n\n\u003cp\u003eWith cancelation, and incremental delivery:\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fs3.amazonaws.com%2Fwww.deanius.com%2Fgraphql-rates-observable-unmount.gif\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fs3.amazonaws.com%2Fwww.deanius.com%2Fgraphql-rates-observable-unmount.gif\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eNo cancelation (and no incremental delivery):\u003cbr\u003e\n\u003ca href=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fs3.amazonaws.com%2Fwww.deanius.com%2Fgraphql-rates-apollo-unmount.gif\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fs3.amazonaws.com%2Fwww.deanius.com%2Fgraphql-rates-apollo-unmount.gif\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\"But how often will this matter?\" is a question you might ask. That will depend on your user demographics and their connectivity, of course. But you needn't wait for complaints to arrive to build in a sensible principle. \u003c/p\u003e\n\u003ch2\u003e\n  \u003ca name=\"comparisons\" href=\"#comparisons\"\u003e\n  \u003c/a\u003e\n  Comparisons\n\u003c/h2\u003e\n\n\u003cp\u003eCancelation wasn't always an afterthought. The first web browsers had a big red 'STOP' button so that users could cancel slow-loading pages at any time. \u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fs3.amazonaws.com%2Fwww.deanius.com%2Fnetscape-stop-button.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fs3.amazonaws.com%2Fwww.deanius.com%2Fnetscape-stop-button.png\" alt=\"Netscape 1.0, my first browser on a mac\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eAs the SPA era began, about 10 years later, several things became casualties as far as User Experience (UX). Yes, \"the back button broke\". But also - now that request-making and asynchronous processes were no longer tied to that big red button, fire-and-forget AJAX became the norm. Browsers stopped showing a Stop button (does yours have one?), and developers stopped treating cancelation like it was critical to good UX. But it still is.\u003c/p\u003e\n\n\u003cp\u003eImagine if operating systems didn't cancel child processes by default! Web development only differs by degree from that.\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fs3.amazonaws.com%2Fwww.deanius.com%2Factivity-monitor-by-hierarchy-process.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fs3.amazonaws.com%2Fwww.deanius.com%2Factivity-monitor-by-hierarchy-process.png\" alt=\"Operating Systems Cancel Hierarchically\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003ch1\u003e\n  \u003ca name=\"code-examples-with-react-hooks\" href=\"#code-examples-with-react-hooks\"\u003e\n  \u003c/a\u003e\n  Code Examples With React Hooks\n\u003c/h1\u003e\n\n\u003cp\u003eSo how does one achieve component-level cancelation in React with hooks? We'll explore several technologies' answers to this, in the context of a real-world example. Let's say we have a component that presents a list of possible appointment times, and uses a hook called \u003ccode\u003euseAppointments\u003c/code\u003e to query a back-end via AJAX for whether the chosen time is available. Stripped of UI details, it would look like this:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003eAppointmentChooser\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n   \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003ebeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003esetBeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eisAvailable\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003euseAppointments\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n   \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eselect\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003eonChange\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003esetBeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etarget\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e)}\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"c\"\u003e\u0026lt;!--\u003c/span\u003e \u003cspan class=\"nx\"\u003etime\u003c/span\u003e \u003cspan class=\"nx\"\u003eoptions\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u0026gt;\u003c/span\u003e\n      \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"sr\"\u003e/select\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026gt;\n\u003c/span\u003e      \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003espan\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003ebeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eisAvailable\u003c/span\u003e \u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e✅\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e🚫\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n   \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"sr\"\u003e/\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026gt;\n\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eOur goal will be that any effects this component triggers will be shutdown when this appointment chooser unmounts.\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"style-1-vanilla-js-no-cancelation\" href=\"#style-1-vanilla-js-no-cancelation\"\u003e\n  \u003c/a\u003e\n  Style 1 — Vanilla JS, no cancelation\n\u003c/h1\u003e\n\n\u003cp\u003eHere's how we might implement \u003ccode\u003euseAppointments\u003c/code\u003e without regard to cancelation:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eexport\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003euseAppointments\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003ebeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e_setBeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003euseState\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e''\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003eisAvailable\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003esetIsAvailable\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003euseState\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kc\"\u003enull\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eloading\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n  \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003esetBeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003esetIsAvailable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eloading\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003e_setBeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"nf\"\u003efetch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`https://httpbin.org/delay/5?t=\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ethen\u003c/span\u003e\u003cspan class=\"p\"\u003e(({\u003c/span\u003e \u003cspan class=\"nx\"\u003eisAvailable\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003esetIsAvailable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eisAvailable\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003ebeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003esetBeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eisAvailable\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eThe job of the hook's \u003ccode\u003esetBeginTime\u003c/code\u003e function is to 1) set the \u003ccode\u003ebeginTime\u003c/code\u003e in local state, 2) set the availability to \u003ccode\u003e'loading'\u003c/code\u003e 3) perform the fetch, and 4) set the availability asynchronously with the result of the fetch. This function \u003ccode\u003esetBeginTime\u003c/code\u003e is what we will focus on as we show differing implementations. \u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"style-11-vanilla-js-promise-abortcontroller\" href=\"#style-11-vanilla-js-promise-abortcontroller\"\u003e\n  \u003c/a\u003e\n  Style 1.1 — Vanilla JS: Promise + AbortController\n\u003c/h1\u003e\n\n\u003cp\u003eIn 2018 the \u003ccode\u003eAbortController\u003c/code\u003e abstraction was introduced for canceling \u003cem\u003esome\u003c/em\u003e Promises.  An example of a hook that uses an AbortController on each request, and cancels the fetch upon on unmount is shown below.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eexport\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003euseAppointments\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003ebeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e_setBeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003euseState\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e''\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003eisAvailable\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003esetIsAvailable\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003euseState\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kc\"\u003enull\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eloading\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eac\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003euseRef\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eAbortController\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"nf\"\u003euseEffect\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003eac\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eabort\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"p\"\u003e[]);\u003c/span\u003e\n\n  \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003esetBeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003esetIsAvailable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eloading\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003e_setBeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003eac\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecurrent\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nc\"\u003eAbortController\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n    \u003cspan class=\"nf\"\u003efetch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`https://httpbin.org/delay/\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003edelay\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e?t=\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"na\"\u003esignal\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eac\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esignal\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}).\u003c/span\u003e\u003cspan class=\"nf\"\u003ethen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003esetIsAvailable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eex\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eDOMException\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif \u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eex\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ename\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eAbortError\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n          \u003cspan class=\"c1\"\u003e// not an exception\u003c/span\u003e\n          \u003cspan class=\"nf\"\u003esetIsAvailable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"nx\"\u003eex\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003ebeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003esetBeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eisAvailable\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eWow, that's a lot of code. We have to hold refs for AbortController instances. We have to use the cryptic React-hook-specific syntax to invoke cancelation, which reads, \"on unmount, abort the current request\".\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003euseEffect(() =\u0026gt; () =\u0026gt; ac.current.abort(), [])\u003c/code\u003e \u003c/p\u003e\n\n\u003cp\u003eAnd then we have the exception-handling code. An aborted Promise is treated as an exception which generally will you will generally want to distinguish from a real exception like a \u003ccode\u003e501\u003c/code\u003e server error.\u003c/p\u003e\n\n\u003cp\u003eThis code achieves cancelation-on-unmount with only Vanilla JS, but are there libraries we can use to have a simpler implementation?\u003c/p\u003e\n\n\u003cp\u003eA library exists that generalizes cancelable async processes, and will let us apply more concurrency options as transparently as cancelation. Let's see how RxJS, familiar to Angular users, approaches cancelation.\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"style-2-rxjs-useeffect\" href=\"#style-2-rxjs-useeffect\"\u003e\n  \u003c/a\u003e\n  Style 2 — RxJS + useEffect\n\u003c/h1\u003e\n\n\u003cp\u003eIn 2012, before Promises were even integrated into JavaScript, the ReactiveX project (now known as RxJS) introduced an inherently cancelable datatype - \u003ccode\u003eObservable\u003c/code\u003e. While Observable is more commonly known for its use as an asynchronous Stream, every Observable ever made is cancelable. Because of this, there will be far less code to cancel an Observable than a Promise.\u003c/p\u003e\n\n\u003cp\u003eThe general strategy is to wrap the begin and end operations in an RxJS Observable explicitly, and return that Observable to a hook that will call \u003ccode\u003e.subscribe()\u003c/code\u003e on it, and call \u003ccode\u003e.unsubscribe()\u003c/code\u003e  on it when unmounted.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eSubscription\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003erxjs\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eajax\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003erxjs/ajax\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003etap\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003erxjs/operators\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eexport\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003euseAppointments\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003ebeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e_setBeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003euseState\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e''\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003eisAvailable\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003esetIsAvailable\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003euseState\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kc\"\u003enull\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eloading\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eprocess\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003euseRef\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eSubscription\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"nf\"\u003euseEffect\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003eprocess\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eunsubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"p\"\u003e[]);\u003c/span\u003e\n\n  \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003esetBeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003esetIsAvailable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eloading\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003e_setBeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003eprocess\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecurrent\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eajax\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003egetJSON\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`https://httpbin.org/delay/5?t=\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003epipe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003etap\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e \u003cspan class=\"nx\"\u003eisAvailable\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003esetIsAvailable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eisAvailable\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e}))\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003ebeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003esetBeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eisAvailable\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eLike the AbortController example, we need a \u003ccode\u003eref\u003c/code\u003e to keep track of the cancelation variable. But in this case it is a Subscription, not an AbortController, and cancelation function is \u003ccode\u003eunsubscribe()\u003c/code\u003e, not \u003ccode\u003eabort()\u003c/code\u003e. \u003ccode\u003eajax.getJSON()\u003c/code\u003e creates the Observable, which represents \u003cem\u003ebut does not start\u003c/em\u003e the AJAX call, and \u003ccode\u003e.subscribe()\u003c/code\u003e begins the call, and returns the Subscription which is how we cancel. The \u003ccode\u003epipe(tap(..))\u003c/code\u003e construct updates the local state by calling \u003ccode\u003esetIsAvailable\u003c/code\u003e once a value is available from the request.\u003c/p\u003e\n\n\u003cp\u003eThe main increase in clarity here comes from the fact that unsubscribing from an Observable (or technically, from its Subscription) is not considered an exception, so that code disappears! But we still rely on managing an extra object - the Subscription - in order to provide cancelation. Let's now make those subscription objects disappear.\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"style-3-rxjs-usecancelableeffect\" href=\"#style-3-rxjs-usecancelableeffect\"\u003e\n  \u003c/a\u003e\n  Style 3 - RxJS + useCancelableEffect\n\u003c/h1\u003e\n\n\u003cp\u003eThe \u003ccode\u003epolyrhythm\u003c/code\u003e library, introduced in 2018, lowers the learning curve and amount of code required to use RxJS. The companion library \u003ccode\u003epolyrhythm-react\u003c/code\u003e exports hooks for using it in a React context. Let's see how its \u003ccode\u003euseCancelableEffect\u003c/code\u003e function can clean up our availability-querying hook:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003euseCancelableEffect\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003epolyrhythm-react\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eajax\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003erxjs/ajax\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003etap\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003erxjs/operators\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eexport\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003euseAppointments\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003ebeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e_setBeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003euseState\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e''\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003eisAvailable\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003esetIsAvailable\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003euseState\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kc\"\u003enull\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eloading\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003equeryAvailability\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003euseCancelableEffect\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"nx\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003eajax\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003egetJSON\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`https://httpbin.org/delay/5?t=\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003epipe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003etap\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e \u003cspan class=\"nx\"\u003eisAvailable\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003esetIsAvailable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eisAvailable\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n       \u003cspan class=\"p\"\u003e}));\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n  \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003esetBeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003esetIsAvailable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eloading\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003e_setBeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003equeryAvailability\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e    \n  \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003ebeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003esetBeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eisAvailable\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eThis is the shortest listing yet. We provide \u003ccode\u003euseCancelableEffect\u003c/code\u003e a function that converts a \u003ccode\u003etime\u003c/code\u003e to an Observable of the AJAX query for availability and state-updating. \u003ccode\u003euseCancelableEffect\u003c/code\u003e returns a tuple, the first item which is a triggering function, which we name \u003ccode\u003equeryAvailability\u003c/code\u003e. \u003c/p\u003e\n\n\u003cp\u003eAfter updating local state in \u003ccode\u003esetBeginTime\u003c/code\u003e, we call \u003ccode\u003equeryAvailability\u003c/code\u003e to begin the AJAX, and if at any time the component unmounts, the AJAX call will terminate! The API to getting an Observable representing an AJAX request is very similar to getting a Promise for a request, but since Observables are inherently cancelable there's no extra AbortController. This results in less code overall.\u003c/p\u003e\n\n\u003cp\u003eWe can further generalize the process of AJAX to include the loading state - which we don't want to leave displaying \"loading\" if the request has canceled. Here's how we use the Observable constructor directly to incorporate teardown into cancelation:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003euseCancelableEffect\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003epolyrhythm-react\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eObservable\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003erxjs\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eajax\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003erxjs/ajax\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003etap\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003erxjs/operators\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eexport\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003euseAppointments\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003ebeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e_setBeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003euseState\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e''\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003eisAvailable\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003esetIsAvailable\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003euseState\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kc\"\u003enull\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eloading\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"kc\"\u003efalse\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003esetBeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003euseCancelableEffect\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"nx\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nc\"\u003eObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eobserver\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nf\"\u003esetIsAvailable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eloading\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n      \u003cspan class=\"nf\"\u003e_setBeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n      \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003equery\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eajax\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003egetJSON\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`https://httpbin.org/delay/5?t=\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003epipe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003etap\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e \u003cspan class=\"nx\"\u003eisAvailable\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n          \u003cspan class=\"nf\"\u003esetIsAvailable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eisAvailable\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n         \u003cspan class=\"p\"\u003e}));\u003c/span\u003e\n\n      \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eajax\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003equery\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003esubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003ecomplete\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eobserver\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ecomplete\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n      \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003eteardown\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003eajax\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eunsubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003esetIsAvailable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// clear the loading state\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003ebeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003esetBeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eisAvailable\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eLike React's own \u003ccode\u003euseEffect\u003c/code\u003e, the returned value from the \u003ccode\u003enew Observable\u003c/code\u003e factory is a teardown function that is called upon unsubscribe. Upon teardown we should stop the AJAX, and revert the loading state to unknown aka \u003ccode\u003enull\u003c/code\u003e.  Upon starting the Observable, we simply need to set the loading state, and call \u003ccode\u003esubscribe\u003c/code\u003e to begin the AJAX. This way, a single Observable represents the entire process of AJAX, including its loading state. The argument to \u003ccode\u003esubscribe\u003c/code\u003e -containing \u003ccode\u003eobserver.complete()\u003c/code\u003e - indicates that the completion of the AJAX should mark the end of the entire Observable. This just illustrates one way to compose Observable behavior with cancelation, and is not meant to be prescriptive for all cases.\u003c/p\u003e\n\n\u003cp\u003eThis technique generalizes far beyond AJAX, and makes RxJS a real workhorse. For example, to fire-off an auto-canceling Observable that uses the browser's \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/Web_Speech_API/Using_the_Web_Speech_API\" target=\"_blank\" rel=\"noopener noreferrer\"\u003eSpeech API\u003c/a\u003e:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003espeakIt\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003euseCancelableEffect\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nc\"\u003eObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ewords\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e`Checking availability for \u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003espeechSynthesis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003espeak\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nc\"\u003eSpeechSynthesisUtterance\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ewords\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003ereturn \u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nb\"\u003ewindow\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003espeechSynthesis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ecancel\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eThe ability to bundle cancelation with creation ultimately leads to optimally performant code, with fewer edge cases, and less scattering of logic. This is why RxJS is useful on the front-end, back-end, and is one of the most downloaded packages on NPM (over 2x that of React!)\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"bonus-rxjs-operators-via-hooks\" href=\"#bonus-rxjs-operators-via-hooks\"\u003e\n  \u003c/a\u003e\n  Bonus — RxJS Operators via hooks\n\u003c/h1\u003e\n\n\u003cp\u003eNote that in the examples above, the code assumes that there will be no overlapping requests. But in real life, if a user isn't getting a speedy response for one appointment time, they may choose another, and bugs will result!\u003c/p\u003e\n\n\u003cp\u003eRxJS provides operators to deal with the concurrency issue, but in fact RxJS users' most frequent sources of confusion are is how to choose and use operators. \u003c/p\u003e\n\n\u003cp\u003eFor your convenience, all of the operators of RxJS have hooks in \u003ccode\u003epolyrhythm-react\u003c/code\u003e which let you control timing with precision (this  will be elaborated in a future post).\u003c/p\u003e\n\n\u003cdiv class=\"table-wrapper-paragraph\"\u003e\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003epolyrhythm-react\u003c/th\u003e\n\u003cth\u003eRxJS\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003euseCancelableEffect/useASAPEffect\u003c/td\u003e\n\u003ctd\u003emergeMap\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003euseQueuedEffect\u003c/td\u003e\n\u003ctd\u003econcatMap\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003euseRestartingEffect\u003c/td\u003e\n\u003ctd\u003eswitchMap\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003euseThrottledEffect\u003c/td\u003e\n\u003ctd\u003eexhaustMap\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\u003c/div\u003e\n\n\n\u003chr\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"summary\" href=\"#summary\"\u003e\n  \u003c/a\u003e\n  Summary\n\u003c/h1\u003e\n\n\u003cp\u003eIt's a best practice all over the web development stack to tie processes to the things that need them, so they tear down automatically. On the back-end, don't do work for a client who's disconnected. On the front-end, when a component that just mounted did a thing, and the user navigated to a new route that causes an unmount.\u003c/p\u003e\n\n\u003cp\u003eThe idea of the API to the hook remaining the same, while cancelation is used internally is the best-practice way to integrate cancelable processes to React. Whether you obtain that result with Redux Query, RxJS or custom hooks is up to you. But your users and support teams want you to reduce issues that can be fixed by cancelation. And development is easier when concurrency options prevent race conditions, which canceling enables. Now you have an array of tools to help improve User Experience.\u003c/p\u003e\n\n\u003cp\u003eHappy canceling!\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"bonus-redux-query-userequest\" href=\"#bonus-redux-query-userequest\"\u003e\n  \u003c/a\u003e\n  Bonus - Redux Query useRequest\n\u003c/h1\u003e\n\n\u003cp\u003eIf the process we want to be cancelable is an AJAX request made with Redux Query, there is a hook that can help us. But first let's remind ourselves how a non-cancelable Redux Query hook looks.\u003c/p\u003e\n\n\u003cp\u003eIn order to move the \u003ccode\u003eisAvailable\u003c/code\u003e field to be controlled by R/Q, we introduce a queryConfig \u003ccode\u003eapptQueryConfig\u003c/code\u003e that specifies where to locate the state in Redux, and a selector \u003ccode\u003eselectApptAvailability\u003c/code\u003e that finds that state. In prod code, maybe we'd move the state field of \u003ccode\u003ebeginTime\u003c/code\u003e up to the Redux store, and out of this component as well, but for demo purposes we'll leave it.\u003c/p\u003e\n\n\u003cp\u003eSo, for non-cancelable Redux Query we'd have:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003euseDispatch\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003euseSelector\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ereact-redux\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003erequestAsync\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eredux-query\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eapptQueryConfig\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eselectAvailability\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e./appointments\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eexport\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003euseAppointments\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003edispatch\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003euseDispatch\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003ebeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e_setBeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003euseState\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e''\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eisAvailable\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003euseSelector\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eselectApptAvailability\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e// state as before ...\u003c/span\u003e\n\n  \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003esetBeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003esetIsAvailable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eloading\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003e_setBeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// add time to the queryConfig\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003equeryConfig\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003eapptQueryConfig\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// perform the lookup\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003edispatch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nf\"\u003erequestAsync\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e  \n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003ebeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003esetBeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eisAvailable\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eAfter adding time to the queryConfig, it is a simple \u003ccode\u003edispatch\u003c/code\u003e of a \u003ccode\u003erequestAsync\u003c/code\u003e action which begins the AJAX, and resolves \u003ccode\u003eisAvailable\u003c/code\u003e. How do we make it cancelable? There's a Redux Query hook for that: \u003ccode\u003euseRequest\u003c/code\u003e. With \u003ccode\u003euseRequest\u003c/code\u003e, we get cancelation almost 'for free'. According to R/Q docs:\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eWhen the associated component unmounts and there is a request in-flight, then a  \u003ca href=\"https://amplitude.github.io/redux-query/docs/redux-actions#cancelquery\" target=\"_blank\" rel=\"noopener noreferrer\"\u003e\u003ccode\u003ecancelQuery\u003c/code\u003e\u003c/a\u003e  action will be dispatched which will attempt to abort the network request.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eSo we have the following:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003euseSelector\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ereact-redux\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003euseRequest\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eredux-query-react\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eapptQueryConfig\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eselectAvailability\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e./appointments\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eexport\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003euseAppointments\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003ebeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e_setBeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003euseState\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e''\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eisAvailable\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003euseSelector\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eselectApptAvailability\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e// state as before ...\u003c/span\u003e\n\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003equeryConfig\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003euseMemo\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003ebeginTime\u003c/span\u003e \u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"nf\"\u003eapptQueryConfig\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ebeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e},\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003ebeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n  \u003cspan class=\"nf\"\u003euseRequest\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003equeryConfig\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n  \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003esetBeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003esetIsAvailable\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eloading\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003e_setBeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// R/Q auto-updates on changes of `beginTime`\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003ebeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003esetBeginTime\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eisAvailable\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eNice! We have a queryConfig that is a memoized version of \u003ccode\u003ebeginTime\u003c/code\u003e.  The queryConfig must be \u003ccode\u003enull\u003c/code\u003e when \u003ccode\u003ebeginTime\u003c/code\u003e is not yet set, to accommodate the first render, since the user has not yet provided a time.  It is this config that we pass to \u003ccode\u003euseRequest\u003c/code\u003e, and cancelation happens behind the scene, easy peasy!\u003c/p\u003e\n\n\u003cp\u003eIt's no surprise a popular library like Redux Query accounts for the cases of cancelation. In addition, can you see how it solves the multiple request problem? According to its docs:\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eIf there is a previously-issued request that is still in-flight, then a \u003ca href=\"https://amplitude.github.io/redux-query/docs/redux-actions#cancelquery\" target=\"_blank\" rel=\"noopener noreferrer\"\u003e\u003ccode\u003ecancelQuery\u003c/code\u003e\u003c/a\u003e action will be dispatched which will attempt to abort the network request.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eIn other words, when the user changes their mind and selects a new appointment time, all the network bandwidth goes toward the NEW appointment time- the previous one is canceled since we won't display its result anyway! This is the bedrock of good UX, and it reduces edge cases as well. We won't elaborate on concurrency here—a future post will. For now, note that cancelation isn't just useful for unmounting, but also for eliminating race conditions caused by previous requests completing \u003cem\u003eafter\u003c/em\u003e newer ones.\u003c/p\u003e\n\n","published":true,"published_from_feed":false,"show_comments":true,"slug":"how-to-use-component-level-cancelation-in-react-promises-rxjs-or-redux-query-58ib","social_image":null,"title":"How to Use Component-level Cancelation in React (Promises, RxJS or Redux Query)","video":null,"video_code":null},{"created_at":"2021-07-03T04:10:44.940Z","crossposted_at":null,"edited_at":"2023-09-20T16:54:44.872Z","last_comment_at":"2021-07-03T04:19:50.904Z","published_at":"2021-07-03T04:19:50.904Z","canonical_url":null,"feed_source_url":null,"video_closed_caption_track_url":null,"video_source_url":null,"video_thumbnail_url":null,"body_markdown":"---\ntitle: The Thresholds of Perception in UX \npublished: true\ndescription: In this article we'll focus on the time constants that define various milestones in human perception.\ntags: ux, animation, async\ncover_image: https://images.unsplash.com/photo-1508962061361-bcb4d4c477f8?ixlib=rb-1.2.1\u0026ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8\u0026auto=format\u0026fit=crop\u0026w=1050\u0026q=80\n---\n\nThere hasn't been a front-end codebase I've been in that isn't peppered with constants related to time. Common cases include `debounce(fn, 250)` - but, why 250? We'll focus here on the thresholds of the human experience that these times relate to. We'll build a timeline of durations as they relate to the human senses of sight, hearing and touch. Next we'll tell the story of what happens as those events unfold. First the reference table:\n\n# Table of perceivable durations\nTL;DR The human sense that is most capable of distinguishing small amounts of time is our hearing, even more than the sense of touch. Visually we can be slower than we realize, as our brain is adept at telling us a story about what we are seeing. The time scale:\n\n10 ms - Audio unison. Frame paint (with 6 ms room to paint)\n16 ms - 1 animation frame (60 FPS)\n25 ms - Monitor paint time (LCD), haptic response, audio chorus\n42 ms - 1 movie frame (24 FPS)\n50 ms - Tactility threshold\n100 ms - Audio echo (at 60 feet)\n150 ms - 1 blink of an eye (or 1 keystroke at 90 wpm)\n200 ms - Short animation. 1 keystroke at 60 wpm\n250 ms - 1 keystroke at 48 wpm\n330 ms - 1 keystroke at 38 wpm (mobile)\n400 ms - Long animation\n500 ms - 1 beat of techno (120 bpm)\n1000 ms - 1 contiguous thought\n2000 ms - Target web page load time p90\n4000 ms - 1 deep breath.\n6000 ms - A spoken sentence (15 words @150wpm).\n8000 ms - Needs a progress bar\n10000 ms - User lost\n\nI feel like the most important numbers are 10 ms - the time to shoot for for smoothest animation, 150 ms - the time it takes to blink, 200 and 400 ms - the time for short and long animations. And 1000 ms - the time at which ones' mind starts to wander without feedback. Times above that, when they can't be avoided, must be supplemented with feedback providers that update within one of the lower time durations.\n\n---\n\n## 10 ms\nThere's effectively no perceivable audible separation between an audio signal and one delayed 10 ms. Visually this is not a perceivable delay. To ensure smooth animation, leaving room for painting, shoot for 10ms.\n\n## 16 ms\nAnimators and game players know 16 ms well. At 16 ms per frame, you achieve 60 FPS (frames per second). 60 FPS is a good benchmark for animation, and is more than sufficient to ensure a visual perception of smooth motion. If an application doesn't complete its work to compute and paint the next frame in 16 ms, a frame is said to be \"dropped\". Dropped frames create unsmooth motion and animation.\n\n## 25 ms\nAt 25 ms, we have the time it takes to hear the 'click' of a mechanical keyboard - pretty instantaneous, which is why we love it. At this duration of separation audio signals create \"chorus\" - a thickening of the sound. LCD monitors took this long to alter a pixel.\n\n## 42 ms\nAt 42 ms, we have the venerable frame rate of 24 FPS film. This frame rate was used for everything of the first 100 years of cinema- until digital. It is enshrined in history, and a kind of upper bound on what looks smooth.\n\n## 50 ms\nAt 50 ms, we have the threshold where haptic feedback ceases to feel immediate, and more like an echo. Stay within 50 ms when users need to feel 'in touch'.\n\n## 100 ms\n100 ms is a well studied threshold, the threshold of 'immediacy'. It's the duration of an echo from a wall 18m (60 feet) away. See the Nielsen study on the Powers of 10 in UX for more.\n\n---\n\n# UX Thresholds \nThe previous values are more or less splitting hairs, as 100 ms feels more-or-less immediate, via any sense. The higher durations are all in the perceivable zone, and are established as thresholds to stay under, when adjusting your UX intentionally.\n\n## 150 ms\n150 ms - Literally the blink of an eye, in the faster half of the population (400ms is not an uncommon blink duration). Very little visually perceived delay, though audible as a thickened chorus.\n\n## 200 ms\n200 ms - The recommended duration for a 'short animation'. It's slightly longer than the blink of an eye. So it's likely to be perceived, if only subliminally. When proper easing is used, 200 ms can be very pleasant, feeling polished but not intrusive. 200 ms is also the time it takes for a typist at 60 WPM to type a keystroke, so Web Forms should ensure their work is done within 200 ms to not impede typing. \n\n## 250 ms\n250 ms - A minimal debounce duration. A typist at 48 WPM is fully debounced by this interval. But studied input rates are lower on mobile - about 38 WPM on average - so consider your audience.\n\n## 330 ms\n330 ms - The ideal debounce duration in my opinion - a fine default. Fully debounces many mobile users at 38 WPM. Feels like a pause - but no more.\n\n## 400 ms\n400 ms - If short animation durations are 200 ms, then twice that is a long animation. If animating across a larger portion of the screen / field of view, then using a long animation makes sense.\n\n## 500 ms\n500 ms - The duration of a beat in a dance song played at 120 BPM (beats per minute). In other words, forming a pleasant 'pulse', feeling separate, but related.\n\n## 1,000 ms\n1000 ms - The duration of one thought. Subjective, you might think. But the Nielsen study defines it as the amount of time it takes the user to be snapped out of their current thought, and into wondering \"what is happening?\", consciously or not. Bearable, but not pleasing.\n\n## 2,000 ms\n2000 ms - How long a web page can take to load, and still feel reasonable. A duration an interstitial page can take and still feel short. Rhythms that are separated by 2 seconds (eg 30 BPM and lower) cease to be perceivable as rhythms, and more like distinct sounds\n\n## 4,000 ms\n4000 ms - One deep breath. When a user experiences frustration and sighs, the inhale and exhale takes around 4000 ms. To provide a response within it is to not make the user too angry, but you're starting to lose the fight for users' attention.\n\n## 6,000 ms\n6000 ms - An average sentence of this complexity will take a speaker about 6 seconds to speak. Also - remember Vine videos?\n\n## 8,000 ms\n8,000 ms - This is the current average human attention span. A progress bar, or interstitial is certainly needed to hold a user's attention as long.  According to studies, this average is down from 10 or 12 seconds a couple decades ago. \n\n## 10,000 ms\n10,000 ms - The longest a user will stay on a page without seeing progress. Enough time to completely break a user's flow. \n\n--- \n## References\n* 3 important UX limits -https://www.nngroup.com/articles/response-times-3-\n* The Ultimate Animation Guide - https://uxdesign.cc/the-ultimate-guide-to-proper-use-of-animation-in-ux-10bd98614fa9\nimportant-limits/\n* The 8 Second Rule - https://uxdesign.cc/the-8-second-rule-ef2a60c5813c\n* The Slowest Music - https://www.youtube.com/watch?v=afhSDK5DJqA\n\n---\n# Wrapping Up\n\nThat concludes our tour up the scale of human perception and attention. If you want programmatic access to these (in TypeScript or JavaScript), they are available [on Github](https://github.com/deanrad/rxfx/blob/main/perception/src/constants.ts), as part of a suite of tools called 𝗥𝘅𝑓𝑥. Just `import { THRESHOLD } from '@rxfx/perception'` and control timing exactly to make your users, and other developers happy!\n","cached_tag_list":"ux, animation, async","cached_user_name":"Dean Radcliffe","cached_user_username":"deanius","comments_count":0,"description":"In this article we'll focus on the time constants that define various milestones in human perception.","main_image":"https://images.unsplash.com/photo-1508962061361-bcb4d4c477f8?ixlib=rb-1.2.1\u0026ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8\u0026auto=format\u0026fit=crop\u0026w=1050\u0026q=80","main_image_background_hex_color":"#dddddd","path":"/deanius/the-thresholds-of-perception-in-ux-435g","public_reactions_count":3,"processed_html":"\u003cp\u003eThere hasn't been a front-end codebase I've been in that isn't peppered with constants related to time. Common cases include \u003ccode\u003edebounce(fn, 250)\u003c/code\u003e - but, why 250? We'll focus here on the thresholds of the human experience that these times relate to. We'll build a timeline of durations as they relate to the human senses of sight, hearing and touch. Next we'll tell the story of what happens as those events unfold. First the reference table:\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"table-of-perceivable-durations\" href=\"#table-of-perceivable-durations\"\u003e\n  \u003c/a\u003e\n  Table of perceivable durations\n\u003c/h1\u003e\n\n\u003cp\u003eTL;DR The human sense that is most capable of distinguishing small amounts of time is our hearing, even more than the sense of touch. Visually we can be slower than we realize, as our brain is adept at telling us a story about what we are seeing. The time scale:\u003c/p\u003e\n\n\u003cp\u003e10 ms - Audio unison. Frame paint (with 6 ms room to paint)\u003cbr\u003e\n16 ms - 1 animation frame (60 FPS)\u003cbr\u003e\n25 ms - Monitor paint time (LCD), haptic response, audio chorus\u003cbr\u003e\n42 ms - 1 movie frame (24 FPS)\u003cbr\u003e\n50 ms - Tactility threshold\u003cbr\u003e\n100 ms - Audio echo (at 60 feet)\u003cbr\u003e\n150 ms - 1 blink of an eye (or 1 keystroke at 90 wpm)\u003cbr\u003e\n200 ms - Short animation. 1 keystroke at 60 wpm\u003cbr\u003e\n250 ms - 1 keystroke at 48 wpm\u003cbr\u003e\n330 ms - 1 keystroke at 38 wpm (mobile)\u003cbr\u003e\n400 ms - Long animation\u003cbr\u003e\n500 ms - 1 beat of techno (120 bpm)\u003cbr\u003e\n1000 ms - 1 contiguous thought\u003cbr\u003e\n2000 ms - Target web page load time p90\u003cbr\u003e\n4000 ms - 1 deep breath.\u003cbr\u003e\n6000 ms - A spoken sentence (15 words @150wpm).\u003cbr\u003e\n8000 ms - Needs a progress bar\u003cbr\u003e\n10000 ms - User lost\u003c/p\u003e\n\n\u003cp\u003eI feel like the most important numbers are 10 ms - the time to shoot for for smoothest animation, 150 ms - the time it takes to blink, 200 and 400 ms - the time for short and long animations. And 1000 ms - the time at which ones' mind starts to wander without feedback. Times above that, when they can't be avoided, must be supplemented with feedback providers that update within one of the lower time durations.\u003c/p\u003e\n\n\n\u003chr\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"10-ms\" href=\"#10-ms\"\u003e\n  \u003c/a\u003e\n  10 ms\n\u003c/h2\u003e\n\n\u003cp\u003eThere's effectively no perceivable audible separation between an audio signal and one delayed 10 ms. Visually this is not a perceivable delay. To ensure smooth animation, leaving room for painting, shoot for 10ms.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"16-ms\" href=\"#16-ms\"\u003e\n  \u003c/a\u003e\n  16 ms\n\u003c/h2\u003e\n\n\u003cp\u003eAnimators and game players know 16 ms well. At 16 ms per frame, you achieve 60 FPS (frames per second). 60 FPS is a good benchmark for animation, and is more than sufficient to ensure a visual perception of smooth motion. If an application doesn't complete its work to compute and paint the next frame in 16 ms, a frame is said to be \"dropped\". Dropped frames create unsmooth motion and animation.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"25-ms\" href=\"#25-ms\"\u003e\n  \u003c/a\u003e\n  25 ms\n\u003c/h2\u003e\n\n\u003cp\u003eAt 25 ms, we have the time it takes to hear the 'click' of a mechanical keyboard - pretty instantaneous, which is why we love it. At this duration of separation audio signals create \"chorus\" - a thickening of the sound. LCD monitors took this long to alter a pixel.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"42-ms\" href=\"#42-ms\"\u003e\n  \u003c/a\u003e\n  42 ms\n\u003c/h2\u003e\n\n\u003cp\u003eAt 42 ms, we have the venerable frame rate of 24 FPS film. This frame rate was used for everything of the first 100 years of cinema- until digital. It is enshrined in history, and a kind of upper bound on what looks smooth.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"50-ms\" href=\"#50-ms\"\u003e\n  \u003c/a\u003e\n  50 ms\n\u003c/h2\u003e\n\n\u003cp\u003eAt 50 ms, we have the threshold where haptic feedback ceases to feel immediate, and more like an echo. Stay within 50 ms when users need to feel 'in touch'.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"100-ms\" href=\"#100-ms\"\u003e\n  \u003c/a\u003e\n  100 ms\n\u003c/h2\u003e\n\n\u003cp\u003e100 ms is a well studied threshold, the threshold of 'immediacy'. It's the duration of an echo from a wall 18m (60 feet) away. See the Nielsen study on the Powers of 10 in UX for more.\u003c/p\u003e\n\n\n\u003chr\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"ux-thresholds\" href=\"#ux-thresholds\"\u003e\n  \u003c/a\u003e\n  UX Thresholds\n\u003c/h1\u003e\n\n\u003cp\u003eThe previous values are more or less splitting hairs, as 100 ms feels more-or-less immediate, via any sense. The higher durations are all in the perceivable zone, and are established as thresholds to stay under, when adjusting your UX intentionally.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"150-ms\" href=\"#150-ms\"\u003e\n  \u003c/a\u003e\n  150 ms\n\u003c/h2\u003e\n\n\u003cp\u003e150 ms - Literally the blink of an eye, in the faster half of the population (400ms is not an uncommon blink duration). Very little visually perceived delay, though audible as a thickened chorus.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"200-ms\" href=\"#200-ms\"\u003e\n  \u003c/a\u003e\n  200 ms\n\u003c/h2\u003e\n\n\u003cp\u003e200 ms - The recommended duration for a 'short animation'. It's slightly longer than the blink of an eye. So it's likely to be perceived, if only subliminally. When proper easing is used, 200 ms can be very pleasant, feeling polished but not intrusive. 200 ms is also the time it takes for a typist at 60 WPM to type a keystroke, so Web Forms should ensure their work is done within 200 ms to not impede typing. \u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"250-ms\" href=\"#250-ms\"\u003e\n  \u003c/a\u003e\n  250 ms\n\u003c/h2\u003e\n\n\u003cp\u003e250 ms - A minimal debounce duration. A typist at 48 WPM is fully debounced by this interval. But studied input rates are lower on mobile - about 38 WPM on average - so consider your audience.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"330-ms\" href=\"#330-ms\"\u003e\n  \u003c/a\u003e\n  330 ms\n\u003c/h2\u003e\n\n\u003cp\u003e330 ms - The ideal debounce duration in my opinion - a fine default. Fully debounces many mobile users at 38 WPM. Feels like a pause - but no more.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"400-ms\" href=\"#400-ms\"\u003e\n  \u003c/a\u003e\n  400 ms\n\u003c/h2\u003e\n\n\u003cp\u003e400 ms - If short animation durations are 200 ms, then twice that is a long animation. If animating across a larger portion of the screen / field of view, then using a long animation makes sense.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"500-ms\" href=\"#500-ms\"\u003e\n  \u003c/a\u003e\n  500 ms\n\u003c/h2\u003e\n\n\u003cp\u003e500 ms - The duration of a beat in a dance song played at 120 BPM (beats per minute). In other words, forming a pleasant 'pulse', feeling separate, but related.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"1000-ms\" href=\"#1000-ms\"\u003e\n  \u003c/a\u003e\n  1,000 ms\n\u003c/h2\u003e\n\n\u003cp\u003e1000 ms - The duration of one thought. Subjective, you might think. But the Nielsen study defines it as the amount of time it takes the user to be snapped out of their current thought, and into wondering \"what is happening?\", consciously or not. Bearable, but not pleasing.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"2000-ms\" href=\"#2000-ms\"\u003e\n  \u003c/a\u003e\n  2,000 ms\n\u003c/h2\u003e\n\n\u003cp\u003e2000 ms - How long a web page can take to load, and still feel reasonable. A duration an interstitial page can take and still feel short. Rhythms that are separated by 2 seconds (eg 30 BPM and lower) cease to be perceivable as rhythms, and more like distinct sounds\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"4000-ms\" href=\"#4000-ms\"\u003e\n  \u003c/a\u003e\n  4,000 ms\n\u003c/h2\u003e\n\n\u003cp\u003e4000 ms - One deep breath. When a user experiences frustration and sighs, the inhale and exhale takes around 4000 ms. To provide a response within it is to not make the user too angry, but you're starting to lose the fight for users' attention.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"6000-ms\" href=\"#6000-ms\"\u003e\n  \u003c/a\u003e\n  6,000 ms\n\u003c/h2\u003e\n\n\u003cp\u003e6000 ms - An average sentence of this complexity will take a speaker about 6 seconds to speak. Also - remember Vine videos?\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"8000-ms\" href=\"#8000-ms\"\u003e\n  \u003c/a\u003e\n  8,000 ms\n\u003c/h2\u003e\n\n\u003cp\u003e8,000 ms - This is the current average human attention span. A progress bar, or interstitial is certainly needed to hold a user's attention as long.  According to studies, this average is down from 10 or 12 seconds a couple decades ago. \u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"10000-ms\" href=\"#10000-ms\"\u003e\n  \u003c/a\u003e\n  10,000 ms\n\u003c/h2\u003e\n\n\u003cp\u003e10,000 ms - The longest a user will stay on a page without seeing progress. Enough time to completely break a user's flow. \u003c/p\u003e\n\n\n\u003chr\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"references\" href=\"#references\"\u003e\n  \u003c/a\u003e\n  References\n\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e3 important UX limits -\u003ca href=\"https://www.nngroup.com/articles/response-times-3-\"\u003ehttps://www.nngroup.com/articles/response-times-3-\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eThe Ultimate Animation Guide - \u003ca href=\"https://uxdesign.cc/the-ultimate-guide-to-proper-use-of-animation-in-ux-10bd98614fa9\"\u003ehttps://uxdesign.cc/the-ultimate-guide-to-proper-use-of-animation-in-ux-10bd98614fa9\u003c/a\u003e\nimportant-limits/\u003c/li\u003e\n\u003cli\u003eThe 8 Second Rule - \u003ca href=\"https://uxdesign.cc/the-8-second-rule-ef2a60c5813c\"\u003ehttps://uxdesign.cc/the-8-second-rule-ef2a60c5813c\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003eThe Slowest Music - \u003ca href=\"https://www.youtube.com/watch?v=afhSDK5DJqA\"\u003ehttps://www.youtube.com/watch?v=afhSDK5DJqA\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\n\u003chr\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"wrapping-up\" href=\"#wrapping-up\"\u003e\n  \u003c/a\u003e\n  Wrapping Up\n\u003c/h1\u003e\n\n\u003cp\u003eThat concludes our tour up the scale of human perception and attention. If you want programmatic access to these (in TypeScript or JavaScript), they are available \u003ca href=\"https://github.com/deanrad/rxfx/blob/main/perception/src/constants.ts\"\u003eon Github\u003c/a\u003e, as part of a suite of tools called 𝗥𝘅𝑓𝑥. Just \u003ccode\u003eimport { THRESHOLD } from '@rxfx/perception'\u003c/code\u003e and control timing exactly to make your users, and other developers happy!\u003c/p\u003e\n\n","published":true,"published_from_feed":false,"show_comments":true,"slug":"the-thresholds-of-perception-in-ux-435g","social_image":null,"title":"The Thresholds of Perception in UX","video":null,"video_code":null},{"created_at":"2021-09-07T19:19:08.152Z","crossposted_at":null,"edited_at":"2023-02-01T15:26:08.750Z","last_comment_at":"2021-09-10T19:55:47.135Z","published_at":"2021-09-10T19:55:47.135Z","canonical_url":null,"feed_source_url":null,"video_closed_caption_track_url":null,"video_source_url":null,"video_thumbnail_url":null,"body_markdown":"---\ntitle: From RxJS to 𝗥𝘅𝑓𝑥, building an Event Bus for reliable async on any platform.\npublished: true\ndescription:\ntags: RxJS, eventbus, cqrs, pubsub\ncover_image: https://www.sarathi.org/images/articles/telegraph-operator.jpg\n---\n\n\n\u003c!--\nUpdate: Even more type-safety explained in [the next post in the Omnibus series!](https://dev.to/deanius/how-to-use-type-guards-for-type-safe-events-in-typescript-3bap)\n--\u003e\n\n## Intro\n\nIn the This Dot Labs post titled \n[How To Implement An Event Bus in Typescript](https://www.thisdot.co/blog/how-to-implement-an-event-bus-in-typescript), Luis Aviles showed us a type-safe implementation of an event bus. He also did a great job elaborating on how and when you can one: for reliable passing of information around an application, and triggering effects in a framework-free way that works, _with or without a DOM, in Node, or React Native_!  𝗥𝘅𝑓𝑥 can be the platform for async and data-sharing that does not dictate the rest of your application structure.\n\nFor a React application I was developing, my team could realize benefits of less prop-drilling by using a bus. So, I thought that with Luis' article as a reference, I might detail how an implementation might go, from scratch, starting only with an RxJS Subject. The code below gives only a glimpse of what an event bus can do, and weighs in at only 6Kb!\n\nSo let's dive in!\n\n## Instance management\nAn event bus will frequently be a singleton object within an app. To manage a singleton instance, we _could_ write typical OO singleton code.\n\n```ts\nexport class EventBus {\n  private static instance?: EventBus = undefined;\n\n  private constructor() {}\n\n  public static getInstance(): EventBus {\n    if (this.instance === undefined) {\n      this.instance = new EventBus();\n    }\n\n    return this.instance;\n  }\n}\n```\nThen the usage of it everywhere would look like:\n```ts\nEventBus.getInstance().some-method()\n```\nBut that's a bit verbose. Let's instead use the ES2015 module system to export a single object from a `bus.ts` file\n\n```ts\n// bus.ts\nexport const bus = EventBus.getInstance()\n```\nand then callers could simply do:\n\n```ts\nimport { bus } from './bus'\nbus.some_method()\n```\n\nNo matter from which file you import `bus`, you get the same reference, so we are effectively using the module system to enforce a single reference without complicating callers.\n\nNow, what should callers have as the interface to our EventBus?\n\n## To listen or not to listen?\n\nEvent Buses implement the pub-sub (publish-subscribe) metaphor, so there are two sides to them. First we'll create a fresh API for for the side that responds to events. In Luis' article, the method name was `register`. In the DOM, you listen for events with `addEventListener`. Let's shorten that to just `listen`. Let's assume strings are on the bus for now, and assume that TypeScript knows this. When the `bus` is in scope we have:\n\n```ts\nbus.listen(\n  item =\u003e item.startsWith('hello-'),\n  (item) =\u003e {\n     const who = item.replace('hello-','');\n     console.log('Hello '+ who);\n  }\n);\n```\n\nThe first argument is a function that returns true or false - called a Predicate. A predicate function is the most flexible way to match an item, and allows for any synchronous function which returns a Boolean. Here we use the nice string method `startsWith`, from ES2015. Never again do we have to test with `indexOf`, whew! Now let's see how to put an event on the bus.\n\n## Trigger Me!\n\nWhile `dispatch` is a popular term from Redux (and the DOM) for sending an action, it's definition implies an action is _directed_ at something or someone. However, the essence of an event bus is that the sender of an event doesn't know who or what is listening. So let's name our method for sending an _undirected_ event `trigger`.\n\nThe argument to trigger should be the type of item the bus allows. Assuming the bus instance was already typed to `string`, then the code to trigger is simply:\n\n```ts\nbus.trigger('hello-dave');\n```\n\nNotice you don't have to provide a type argument at the moment of triggering, because the bus knows it. Now- what about when a listener needs to be unregistered?\n\n## Will You Stop Listening, Already?\nJust as the DOM has `removeEventListener`, an Event Bus should be able to stop listening - for cleanup purposes at least. In Luis' article, he demonstrated a style of un-listening like this:\n\n```ts\nconst registry = EventBus.getInstance().register(matcher, fn);\nregistry.unregister();\n```\n\nIt's an improvement over `removeEventListener` because the return value lets you cancel without the original arguments. I like how it resembles getting a Subscription object from an RxJS Observable, on which you can call `unsubscribe`. So in our example, let's actually return a Subscription:\n\n```ts\nconst listener:Subscription = bus.listen(matcher, fn);\nlistener.unsubscribe();\n```\n\nThis gives us some things for free such as a `.closed` property on `listener`, and the ability to shut down several listeners at once by creating an aggregate Subscription via `Subscription#add`. Since a  Subscription object can represent any process that can be shut down, it's actually a great fit for a listener that can be shut down to stop listening.\n\n## Implementation\nAlthough a production-ready library that implements this pattern is at [`@rxfx/bus`](https://github.com/deanrad/rxfx/tree/main/bus),  the code that implements only what's shown in this article is simply this:\n\n```ts\nclass Bus\u003cT\u003e {\n  private events: Subject\u003cT\u003e;\n  constructor() {\n    this.events = new Subject();\n  }\n  listen(matcher: Predicate\u003cT\u003e, handler: (item: T) =\u003e void): Subscription {\n    return this.events\n      .asObservable()\n      .pipe(filter(matcher), tap(handler))\n      .subscribe();\n  }\n  trigger(item: T) {\n    this.events.next(item);\n  }\n}\nexport const bus = new Bus\u003cstring\u003e();\n// now bus.listen / bus.trigger\n```\n\nPlay with a working version of this in the [𝗥𝘅𝑓𝑥 Repl at Repl.it](https://replit.com/@deanius/Hello-World-rxfxbus)\n\n## Next Steps\n\nTo truly be useful, an event bus needs:\n- True error isolation (between listeners, between triggerers and listeners)\n- Async listeners which return Promises or Observables\n- The ability to re-trigger from listeners' results\n- The ability to queue, or otherwise deal with listeners that overlap\n- To be able to tie listeners to component lifetimes as in React \n- A way to validate what events are allowed on the bus at runtime\n \n You can read about them more in the documentation and source  on [Github](https://github.com/deanrad/rxfx/tree/main/bus).\n\nI hope you enjoyed seeing this use of Typescript to create a powerful, simple Event Bus, with a friendly and interoperable API. Let me know what more you'd like an Event Bus to do for you!","cached_tag_list":"rxjs, eventbus, cqrs, pubsub","cached_user_name":"Dean Radcliffe","cached_user_username":"deanius","comments_count":0,"description":"Intro   In the This Dot Labs post titled  How To Implement An Event Bus in Typescript, Luis...","main_image":"https://www.sarathi.org/images/articles/telegraph-operator.jpg","main_image_background_hex_color":"#dddddd","path":"/deanius/a-typesafe-event-bus-with-rxjs-5972","public_reactions_count":12,"processed_html":"\u003ch2\u003e\n  \u003ca name=\"intro\" href=\"#intro\"\u003e\n  \u003c/a\u003e\n  Intro\n\u003c/h2\u003e\n\n\u003cp\u003eIn the This Dot Labs post titled \u003cbr\u003e\n\u003ca href=\"https://www.thisdot.co/blog/how-to-implement-an-event-bus-in-typescript\"\u003eHow To Implement An Event Bus in Typescript\u003c/a\u003e, Luis Aviles showed us a type-safe implementation of an event bus. He also did a great job elaborating on how and when you can one: for reliable passing of information around an application, and triggering effects in a framework-free way that works, \u003cem\u003ewith or without a DOM, in Node, or React Native\u003c/em\u003e!  𝗥𝘅𝑓𝑥 can be the platform for async and data-sharing that does not dictate the rest of your application structure.\u003c/p\u003e\n\n\u003cp\u003eFor a React application I was developing, my team could realize benefits of less prop-drilling by using a bus. So, I thought that with Luis' article as a reference, I might detail how an implementation might go, from scratch, starting only with an RxJS Subject. The code below gives only a glimpse of what an event bus can do, and weighs in at only 6Kb!\u003c/p\u003e\n\n\u003cp\u003eSo let's dive in!\u003c/p\u003e\n\u003ch2\u003e\n  \u003ca name=\"instance-management\" href=\"#instance-management\"\u003e\n  \u003c/a\u003e\n  Instance management\n\u003c/h2\u003e\n\n\u003cp\u003eAn event bus will frequently be a singleton object within an app. To manage a singleton instance, we \u003cem\u003ecould\u003c/em\u003e write typical OO singleton code.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eexport\u003c/span\u003e \u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eEventBus\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"nx\"\u003einstance\u003c/span\u003e\u003cspan class=\"p\"\u003e?:\u003c/span\u003e \u003cspan class=\"nx\"\u003eEventBus\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003eundefined\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"kd\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"nx\"\u003egetInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e \u003cspan class=\"nx\"\u003eEventBus\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einstance\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"kc\"\u003eundefined\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einstance\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eEventBus\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003einstance\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eThen the usage of it everywhere would look like:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003eEventBus\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nx\"\u003esome\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003emethod\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eBut that's a bit verbose. Let's instead use the ES2015 module system to export a single object from a \u003ccode\u003ebus.ts\u003c/code\u003e file\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// bus.ts\u003c/span\u003e\n\u003cspan class=\"k\"\u003eexport\u003c/span\u003e \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ebus\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eEventBus\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eand then callers could simply do:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003ebus\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e./bus\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\n\u003cspan class=\"nx\"\u003ebus\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esome_method\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eNo matter from which file you import \u003ccode\u003ebus\u003c/code\u003e, you get the same reference, so we are effectively using the module system to enforce a single reference without complicating callers.\u003c/p\u003e\n\n\u003cp\u003eNow, what should callers have as the interface to our EventBus?\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"to-listen-or-not-to-listen\" href=\"#to-listen-or-not-to-listen\"\u003e\n  \u003c/a\u003e\n  To listen or not to listen?\n\u003c/h2\u003e\n\n\u003cp\u003eEvent Buses implement the pub-sub (publish-subscribe) metaphor, so there are two sides to them. First we'll create a fresh API for for the side that responds to events. In Luis' article, the method name was \u003ccode\u003eregister\u003c/code\u003e. In the DOM, you listen for events with \u003ccode\u003eaddEventListener\u003c/code\u003e. Let's shorten that to just \u003ccode\u003elisten\u003c/code\u003e. Let's assume strings are on the bus for now, and assume that TypeScript knows this. When the \u003ccode\u003ebus\u003c/code\u003e is in scope we have:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003ebus\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elisten\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eitem\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estartsWith\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ehello-\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n     \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ewho\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ereplace\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ehello-\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"dl\"\u003e''\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n     \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eHello \u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nx\"\u003ewho\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eThe first argument is a function that returns true or false - called a Predicate. A predicate function is the most flexible way to match an item, and allows for any synchronous function which returns a Boolean. Here we use the nice string method \u003ccode\u003estartsWith\u003c/code\u003e, from ES2015. Never again do we have to test with \u003ccode\u003eindexOf\u003c/code\u003e, whew! Now let's see how to put an event on the bus.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"trigger-me\" href=\"#trigger-me\"\u003e\n  \u003c/a\u003e\n  Trigger Me!\n\u003c/h2\u003e\n\n\u003cp\u003eWhile \u003ccode\u003edispatch\u003c/code\u003e is a popular term from Redux (and the DOM) for sending an action, it's definition implies an action is \u003cem\u003edirected\u003c/em\u003e at something or someone. However, the essence of an event bus is that the sender of an event doesn't know who or what is listening. So let's name our method for sending an \u003cem\u003eundirected\u003c/em\u003e event \u003ccode\u003etrigger\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eThe argument to trigger should be the type of item the bus allows. Assuming the bus instance was already typed to \u003ccode\u003estring\u003c/code\u003e, then the code to trigger is simply:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003ebus\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etrigger\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ehello-dave\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eNotice you don't have to provide a type argument at the moment of triggering, because the bus knows it. Now- what about when a listener needs to be unregistered?\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"will-you-stop-listening-already\" href=\"#will-you-stop-listening-already\"\u003e\n  \u003c/a\u003e\n  Will You Stop Listening, Already?\n\u003c/h2\u003e\n\n\u003cp\u003eJust as the DOM has \u003ccode\u003eremoveEventListener\u003c/code\u003e, an Event Bus should be able to stop listening - for cleanup purposes at least. In Luis' article, he demonstrated a style of un-listening like this:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eregistry\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eEventBus\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nx\"\u003eregister\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ematcher\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003efn\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"nx\"\u003eregistry\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eunregister\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eIt's an improvement over \u003ccode\u003eremoveEventListener\u003c/code\u003e because the return value lets you cancel without the original arguments. I like how it resembles getting a Subscription object from an RxJS Observable, on which you can call \u003ccode\u003eunsubscribe\u003c/code\u003e. So in our example, let's actually return a Subscription:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003elistener\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"nx\"\u003eSubscription\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ebus\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elisten\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ematcher\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003efn\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"nx\"\u003elistener\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eunsubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eThis gives us some things for free such as a \u003ccode\u003e.closed\u003c/code\u003e property on \u003ccode\u003elistener\u003c/code\u003e, and the ability to shut down several listeners at once by creating an aggregate Subscription via \u003ccode\u003eSubscription#add\u003c/code\u003e. Since a  Subscription object can represent any process that can be shut down, it's actually a great fit for a listener that can be shut down to stop listening.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"implementation\" href=\"#implementation\"\u003e\n  \u003c/a\u003e\n  Implementation\n\u003c/h2\u003e\n\n\u003cp\u003eAlthough a production-ready library that implements this pattern is at \u003ca href=\"https://github.com/deanrad/rxfx/tree/main/bus\"\u003e\u003ccode\u003e@rxfx/bus\u003c/code\u003e\u003c/a\u003e,  the code that implements only what's shown in this article is simply this:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eBus\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eT\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"na\"\u003eevents\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eSubject\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eT\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eevents\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eSubject\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003elisten\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"na\"\u003ematcher\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003ePredicate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eT\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"na\"\u003ehandler\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"na\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"nx\"\u003eSubscription\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eevents\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003easObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epipe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003efilter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ematcher\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"nx\"\u003etap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ehandler\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003etrigger\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"na\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eevents\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003enext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"k\"\u003eexport\u003c/span\u003e \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ebus\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eBus\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kr\"\u003estring\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// now bus.listen / bus.trigger\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003ePlay with a working version of this in the \u003ca href=\"https://replit.com/@deanius/Hello-World-rxfxbus\"\u003e𝗥𝘅𝑓𝑥 Repl at Repl.it\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"next-steps\" href=\"#next-steps\"\u003e\n  \u003c/a\u003e\n  Next Steps\n\u003c/h2\u003e\n\n\u003cp\u003eTo truly be useful, an event bus needs:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eTrue error isolation (between listeners, between triggerers and listeners)\u003c/li\u003e\n\u003cli\u003eAsync listeners which return Promises or Observables\u003c/li\u003e\n\u003cli\u003eThe ability to re-trigger from listeners' results\u003c/li\u003e\n\u003cli\u003eThe ability to queue, or otherwise deal with listeners that overlap\u003c/li\u003e\n\u003cli\u003eTo be able to tie listeners to component lifetimes as in React \u003c/li\u003e\n\u003cli\u003eA way to validate what events are allowed on the bus at runtime\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eYou can read about them more in the documentation and source  on \u003ca href=\"https://github.com/deanrad/rxfx/tree/main/bus\"\u003eGithub\u003c/a\u003e.\u003c/p\u003e\n\n\u003cp\u003eI hope you enjoyed seeing this use of Typescript to create a powerful, simple Event Bus, with a friendly and interoperable API. Let me know what more you'd like an Event Bus to do for you!\u003c/p\u003e\n\n","published":true,"published_from_feed":false,"show_comments":true,"slug":"a-typesafe-event-bus-with-rxjs-5972","social_image":null,"title":"From RxJS to 𝗥𝘅𝑓𝑥, building an Event Bus for reliable async on any platform.","video":null,"video_code":null},{"created_at":"2021-12-24T14:59:25.490Z","crossposted_at":null,"edited_at":null,"last_comment_at":"2021-12-24T14:59:25.467Z","published_at":"2021-12-24T14:59:25.467Z","canonical_url":null,"feed_source_url":null,"video_closed_caption_track_url":null,"video_source_url":null,"video_thumbnail_url":null,"body_markdown":"---\ntitle: How to Use Type Guards for Type-Safe Events in TypeScript\npublished: true\ndescription: Learn how type guards/predicates work in TypeScript in general, then apply it to the Omnibus event bus library\ntags: events, typescript, redux, FSA\ncover_image: https://images.unsplash.com/photo-1523286853180-6cc0906b101d?ixlib=rb-1.2.1\u0026ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8\u0026auto=format\u0026fit=crop\u0026w=774\u0026q=80\n---\n\nFiltering a large set down to an interesting subset is one of the most common things we do in computing - it saves users time! In TodoMVC, for example, the set of active todos is a subset of all TODOs.\n\nHowever, In TypeScript, when the subset is of a more specific type, it's not automatic that the subset is of the narrowed type. A particular example we will show in this post: when an event bus is known to have Flux Standard Actions, and we have listeners registered for certain actions, we want type-safety within those listeners! Let's see how type guards/predicates work in TypeScript in general, then apply it to the Omnibus event bus library.\n\n## TypeScript Docs Zoo Example\nLet's take an example from the TypeScript docs to get started.\nIn this example, to get an array of `Fish` out of an array of multiple animals, we have a filter function `isFish` that can create the subset.\n\n```ts\nconst zoo: (Fish | Bird)[] = [...];\nconst fishes: Fish[] = zoo.filter(isFish) as Fish[];\n```\n\nSee that `as Fish[]` at the end? That's what we had to add to get type safety on the filtered array of fish. This explicit cast of type is necessary if the implementation of the `isFish` function returns only a boolean. But there's a way to tell TypeScript that we'll only return true from `isFish` for objects which are of type `Fish`.  The way we do that is with a \"type predicate\", or \"user-defined typeguard\" ([docs](https://www.typescriptlang.org/docs/handbook/2/narrowing.html#using-type-predicates)). Here's how it looks with a type guard:\n\n```ts\nfunction isFish(pet: Fish | Bird): pet is Fish {\n  return (pet as Fish).swim !== undefined;\n}\nconst fishes: Fish[] = zoo.filter(isFish)\n```\nWhen the return type of `isFish` is `pet is Fish`, we get type-safety on the array of fish - and anywhere else we'd use this predicate! This type of implicit typing is better for reading and maintaining the code, and many functions exported by libraries will do this for you..\n\n---\n## An Event Bus of Flux Standard Actions\nNow how does this apply to an Event Bus? An event bus is similar to an Array, over time. Our particular event bus [Omnibus]() is a wrapper around an RxJS Subject, with a slightly different API. You `trigger` and `listen` rather than `next` and `subscribe`. One excellent use of an Event Bus is to replace Redux middleware, like Redux Saga or Redux-Observable. A bus may carry any type, but for now let's assume it's duck-typing Redux, carrying only Flux Standard Actions. \n\nOur scenario will use the bus for a typeahead search - like for querying an AJAX endpoint. Our bus will have a listener for `Action\u003cSearchRequest\u003e`, and the listener will trigger actions of type `Action\u003cSearchResult\u003e` back onto the bus. Our search may return many values  - one `SearchRequest` potentially triggering many `SearchResult` actions.  With explicit typing:\n\n```ts\ninterface SearchRequest { query: string }\ninterface SearchResult { result: string }\n\nconst bus = new Omnibus\u003cAction\u003cany\u003e\u003e();\n\nbus.listen\u003cAction\u003cSearchRequest\u003e, Action\u003cSearchResult\u003e\u003e(\n   (action) =\u003e (action.type === 'search/request'),\n   ({ payload }) =\u003e { /* TODO use payload.query */\n```\nIn the predicate function we know only that we have an `Action\u003cany\u003e` - so that it can test any bus item. The listener is explicitly typed so it knows it has a `SearchRequest`\n\nTo continue started we'll need an endpoint. To work with Omnibus, it will return an Observable of `SearchResult` from a query `string`.\n\n```ts\nimport { from } from 'rxjs';\nconst searchEndpoint : Observable\u003cSearchResult\u003e = (query: string) =\u003e from([\n  {result: 'abba'},\n  {result: 'apple'}\n]);\n```\n\nWe'll also be packaging results into Flux Standard Actions with the `typescript-fsa` library, so let's use action creators for those types:\n\n```ts\nconst searchAction = actionCreatorFactory('search');\nconst searchRequestCreator = searchAction\u003cSearchRequest\u003e('request');\nconst resultCreator = searchAction\u003cSearchResult\u003e('result');\n```\n\nThese give us ways to create, and detect actions with a specified type. So let's wire them up.\n\n## Event Bus Types - Part 2\nNow, can we use implicit typing like the Fish/Zoo example above? We want the listener to know what type its action is, so that TypeScript can know that a `query` property will be its event's payload. In other words, we'd like the type of the handler's argument to be narrowed by the predicate. What must the signature of `listen` be to allow this? \n\nWe could try an explicit SubType type parameter:\n\n```ts\npublic listen\u003cSubType extends TBusItem\u003e(\n  predicate: (item: TBusItem) =\u003e boolean,\n  handler: (item: SubType) =\u003e { ... }\n```\n\nBut that would make us specify the SubType explicitly—it would not take advantage of type guards. Can it be more like our `isFish` function? One little change, and the answer is yes. Here's the type-guarded version:\n\n```ts\npublic listen\u003cTMatchType extends TBusItem = TBusItem\u003e(\n  predicate: (i: TBusItem) =\u003e i is TMatchType,\n  handler: (i: TMatchType) =\u003e { /* ... */ }\n```\nIt allows for implicit typing by defaulting the `TMatchType` to the supertype of all bus items. Yet, if a predicate narrows the type, our handler will act as if its argument of that narrowed type.\n\nHow do we put it all together? Thankfully, the `.match` function on  `searchRequestCreator` provides a type predicate, not just a boolean return value! So when we plug it in, all the stars align:\n\n```ts\nbus.listen(\n  searchRequestCreator.match,\n  (({ payload: { query } }) =\u003e   // we have .query!\n     searchEndpoint(query).pipe(\n       tap(result =\u003e {\n         bus.trigger(resultCreator(result))\n       )\n     )\n)\n```\n\nWe have a type-safe action in our listener now! I don't believe we need to type the return value of the listener - the bus will accept anything that is an `Action\u003cany\u003e`, so we could even return action of many types. But if we wanted to we could specify `listen\u003cSearchResult\u003e` just to ensure we don't introduce an action we weren't expecting..\n\n---\n\n## Wrap Up\n\nApplications like Event Buses and Array filtering often cause you to lose some or all of type-safety. But with type predicates / type guards, it doesn't have to be this way. Enjoy stronger and more implicit typing by using them. And remember, explicit types are more expensive to write and maintain, so you can use the lint rule `no-inferrable-types` ([link](https://palantir.github.io/tslint/rules/no-inferrable-types/)), and further take extra syntax/noise out of your way!\n\n---\nReferences\nhttps://www.typescriptlang.org/docs/handbook/2/narrowing.html#using-type-predicates","cached_tag_list":"events, typescript, redux, fsa","cached_user_name":"Dean Radcliffe","cached_user_username":"deanius","comments_count":0,"description":"Learn how type guards/predicates work in TypeScript in general, then apply it to the Omnibus event bus library","main_image":"https://images.unsplash.com/photo-1523286853180-6cc0906b101d?ixlib=rb-1.2.1\u0026ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8\u0026auto=format\u0026fit=crop\u0026w=774\u0026q=80","main_image_background_hex_color":"#dddddd","path":"/deanius/how-to-use-type-guards-for-type-safe-events-in-typescript-3bap","public_reactions_count":8,"processed_html":"\u003cp\u003eFiltering a large set down to an interesting subset is one of the most common things we do in computing - it saves users time! In TodoMVC, for example, the set of active todos is a subset of all TODOs.\u003c/p\u003e\n\n\u003cp\u003eHowever, In TypeScript, when the subset is of a more specific type, it's not automatic that the subset is of the narrowed type. A particular example we will show in this post: when an event bus is known to have Flux Standard Actions, and we have listeners registered for certain actions, we want type-safety within those listeners! Let's see how type guards/predicates work in TypeScript in general, then apply it to the Omnibus event bus library.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"typescript-docs-zoo-example\" href=\"#typescript-docs-zoo-example\"\u003e\n  \u003c/a\u003e\n  TypeScript Docs Zoo Example\n\u003c/h2\u003e\n\n\u003cp\u003eLet's take an example from the TypeScript docs to get started.\u003cbr\u003e\nIn this example, to get an array of \u003ccode\u003eFish\u003c/code\u003e out of an array of multiple animals, we have a filter function \u003ccode\u003eisFish\u003c/code\u003e that can create the subset.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ezoo\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eFish\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"nx\"\u003eBird\u003c/span\u003e\u003cspan class=\"p\"\u003e)[]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[...];\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003efishes\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eFish\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ezoo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003efilter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eisFish\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"nx\"\u003eFish\u003c/span\u003e\u003cspan class=\"p\"\u003e[];\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eSee that \u003ccode\u003eas Fish[]\u003c/code\u003e at the end? That's what we had to add to get type safety on the filtered array of fish. This explicit cast of type is necessary if the implementation of the \u003ccode\u003eisFish\u003c/code\u003e function returns only a boolean. But there's a way to tell TypeScript that we'll only return true from \u003ccode\u003eisFish\u003c/code\u003e for objects which are of type \u003ccode\u003eFish\u003c/code\u003e.  The way we do that is with a \"type predicate\", or \"user-defined typeguard\" (\u003ca href=\"https://www.typescriptlang.org/docs/handbook/2/narrowing.html#using-type-predicates\"\u003edocs\u003c/a\u003e). Here's how it looks with a type guard:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003eisFish\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003epet\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eFish\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"nx\"\u003eBird\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"nx\"\u003epet\u003c/span\u003e \u003cspan class=\"k\"\u003eis\u003c/span\u003e \u003cspan class=\"nx\"\u003eFish\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003epet\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"nx\"\u003eFish\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003eswim\u003c/span\u003e \u003cspan class=\"o\"\u003e!==\u003c/span\u003e \u003cspan class=\"kc\"\u003eundefined\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003efishes\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eFish\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ezoo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003efilter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eisFish\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eWhen the return type of \u003ccode\u003eisFish\u003c/code\u003e is \u003ccode\u003epet is Fish\u003c/code\u003e, we get type-safety on the array of fish - and anywhere else we'd use this predicate! This type of implicit typing is better for reading and maintaining the code, and many functions exported by libraries will do this for you..\u003c/p\u003e\n\n\n\u003chr\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"an-event-bus-of-flux-standard-actions\" href=\"#an-event-bus-of-flux-standard-actions\"\u003e\n  \u003c/a\u003e\n  An Event Bus of Flux Standard Actions\n\u003c/h2\u003e\n\n\u003cp\u003eNow how does this apply to an Event Bus? An event bus is similar to an Array, over time. Our particular event bus \u003ca href=\"\"\u003eOmnibus\u003c/a\u003e is a wrapper around an RxJS Subject, with a slightly different API. You \u003ccode\u003etrigger\u003c/code\u003e and \u003ccode\u003elisten\u003c/code\u003e rather than \u003ccode\u003enext\u003c/code\u003e and \u003ccode\u003esubscribe\u003c/code\u003e. One excellent use of an Event Bus is to replace Redux middleware, like Redux Saga or Redux-Observable. A bus may carry any type, but for now let's assume it's duck-typing Redux, carrying only Flux Standard Actions. \u003c/p\u003e\n\n\u003cp\u003eOur scenario will use the bus for a typeahead search - like for querying an AJAX endpoint. Our bus will have a listener for \u003ccode\u003eAction\u0026lt;SearchRequest\u0026gt;\u003c/code\u003e, and the listener will trigger actions of type \u003ccode\u003eAction\u0026lt;SearchResult\u0026gt;\u003c/code\u003e back onto the bus. Our search may return many values  - one \u003ccode\u003eSearchRequest\u003c/code\u003e potentially triggering many \u003ccode\u003eSearchResult\u003c/code\u003e actions.  With explicit typing:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"kr\"\u003einterface\u003c/span\u003e \u003cspan class=\"nx\"\u003eSearchRequest\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nl\"\u003equery\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kr\"\u003estring\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"kr\"\u003einterface\u003c/span\u003e \u003cspan class=\"nx\"\u003eSearchResult\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nl\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kr\"\u003estring\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ebus\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eOmnibus\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eAction\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kr\"\u003eany\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003ebus\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elisten\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eAction\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eSearchRequest\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eAction\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eSearchResult\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eaction\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"kd\"\u003etype\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003esearch/request\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n   \u003cspan class=\"p\"\u003e({\u003c/span\u003e \u003cspan class=\"nx\"\u003epayload\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"cm\"\u003e/* TODO use payload.query */\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eIn the predicate function we know only that we have an \u003ccode\u003eAction\u0026lt;any\u0026gt;\u003c/code\u003e - so that it can test any bus item. The listener is explicitly typed so it knows it has a \u003ccode\u003eSearchRequest\u003c/code\u003e\u003c/p\u003e\n\n\u003cp\u003eTo continue started we'll need an endpoint. To work with Omnibus, it will return an Observable of \u003ccode\u003eSearchResult\u003c/code\u003e from a query \u003ccode\u003estring\u003c/code\u003e.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003erxjs\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003esearchEndpoint\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eObservable\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eSearchResult\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003equery\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kr\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"na\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eabba\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"na\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eapple\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eWe'll also be packaging results into Flux Standard Actions with the \u003ccode\u003etypescript-fsa\u003c/code\u003e library, so let's use action creators for those types:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003esearchAction\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eactionCreatorFactory\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003esearch\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003esearchRequestCreator\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003esearchAction\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eSearchRequest\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003erequest\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eresultCreator\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003esearchAction\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eSearchResult\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eresult\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eThese give us ways to create, and detect actions with a specified type. So let's wire them up.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"event-bus-types-part-2\" href=\"#event-bus-types-part-2\"\u003e\n  \u003c/a\u003e\n  Event Bus Types - Part 2\n\u003c/h2\u003e\n\n\u003cp\u003eNow, can we use implicit typing like the Fish/Zoo example above? We want the listener to know what type its action is, so that TypeScript can know that a \u003ccode\u003equery\u003c/code\u003e property will be its event's payload. In other words, we'd like the type of the handler's argument to be narrowed by the predicate. What must the signature of \u003ccode\u003elisten\u003c/code\u003e be to allow this? \u003c/p\u003e\n\n\u003cp\u003eWe could try an explicit SubType type parameter:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nx\"\u003elisten\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eSubType\u003c/span\u003e \u003cspan class=\"kd\"\u003eextends\u003c/span\u003e \u003cspan class=\"nx\"\u003eTBusItem\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003epredicate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eTBusItem\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003eboolean\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003ehandler\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eSubType\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e...\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eBut that would make us specify the SubType explicitly—it would not take advantage of type guards. Can it be more like our \u003ccode\u003eisFish\u003c/code\u003e function? One little change, and the answer is yes. Here's the type-guarded version:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"nx\"\u003elisten\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eTMatchType\u003c/span\u003e \u003cspan class=\"kd\"\u003eextends\u003c/span\u003e \u003cspan class=\"nx\"\u003eTBusItem\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eTBusItem\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003epredicate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eTBusItem\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"k\"\u003eis\u003c/span\u003e \u003cspan class=\"nx\"\u003eTMatchType\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003ehandler\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eTMatchType\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"cm\"\u003e/* ... */\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eIt allows for implicit typing by defaulting the \u003ccode\u003eTMatchType\u003c/code\u003e to the supertype of all bus items. Yet, if a predicate narrows the type, our handler will act as if its argument of that narrowed type.\u003c/p\u003e\n\n\u003cp\u003eHow do we put it all together? Thankfully, the \u003ccode\u003e.match\u003c/code\u003e function on  \u003ccode\u003esearchRequestCreator\u003c/code\u003e provides a type predicate, not just a boolean return value! So when we plug it in, all the stars align:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003ebus\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elisten\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003esearchRequestCreator\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ematch\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e(({\u003c/span\u003e \u003cspan class=\"na\"\u003epayload\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003equery\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e   \u003cspan class=\"c1\"\u003e// we have .query!\u003c/span\u003e\n     \u003cspan class=\"nx\"\u003esearchEndpoint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003equery\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003epipe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n       \u003cspan class=\"nx\"\u003etap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eresult\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n         \u003cspan class=\"nx\"\u003ebus\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etrigger\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eresultCreator\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eresult\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n       \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n     \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eWe have a type-safe action in our listener now! I don't believe we need to type the return value of the listener - the bus will accept anything that is an \u003ccode\u003eAction\u0026lt;any\u0026gt;\u003c/code\u003e, so we could even return action of many types. But if we wanted to we could specify \u003ccode\u003elisten\u0026lt;SearchResult\u0026gt;\u003c/code\u003e just to ensure we don't introduce an action we weren't expecting..\u003c/p\u003e\n\n\n\u003chr\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"wrap-up\" href=\"#wrap-up\"\u003e\n  \u003c/a\u003e\n  Wrap Up\n\u003c/h2\u003e\n\n\u003cp\u003eApplications like Event Buses and Array filtering often cause you to lose some or all of type-safety. But with type predicates / type guards, it doesn't have to be this way. Enjoy stronger and more implicit typing by using them. And remember, explicit types are more expensive to write and maintain, so you can use the lint rule \u003ccode\u003eno-inferrable-types\u003c/code\u003e (\u003ca href=\"https://palantir.github.io/tslint/rules/no-inferrable-types/\"\u003elink\u003c/a\u003e), and further take extra syntax/noise out of your way!\u003c/p\u003e\n\n\n\u003chr\u003e\n\n\u003cp\u003eReferences\u003cbr\u003e\n\u003ca href=\"https://www.typescriptlang.org/docs/handbook/2/narrowing.html#using-type-predicates\"\u003ehttps://www.typescriptlang.org/docs/handbook/2/narrowing.html#using-type-predicates\u003c/a\u003e\u003c/p\u003e\n\n","published":true,"published_from_feed":false,"show_comments":true,"slug":"how-to-use-type-guards-for-type-safe-events-in-typescript-3bap","social_image":null,"title":"How to Use Type Guards for Type-Safe Events in TypeScript","video":null,"video_code":null},{"created_at":"2022-03-06T19:05:51.035Z","crossposted_at":null,"edited_at":"2022-03-07T20:27:15.317Z","last_comment_at":"2022-10-18T10:43:07.950Z","published_at":"2022-03-06T19:06:26.765Z","canonical_url":null,"feed_source_url":null,"video_closed_caption_track_url":null,"video_source_url":null,"video_thumbnail_url":null,"body_markdown":"---\ntitle: Kata, Bunkai and Testing\npublished: true\ndescription: The karate method of \"Bunkai\" can be applied to our software practice. By focusing **both** on testing and prod code we improve both sides of our practice.\ntags: testing, TDD, kata, karate\ncover_image: https://images.unsplash.com/photo-1555597673-b21d5c935865?ixlib=rb-1.2.1\u0026ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8\u0026auto=format\u0026fit=crop\u0026w=1744\u0026q=80\n---\n\n## Kata\n\u003e Kata (martial arts): A detailed, choreographed sequence of movements, blocks, strikes and footwork, executed without a partner. Kata are used as a mnemonic device for a series of techniques, flowed together.\n\n## Bunkai\n\u003e Bunkai (分解) in Japanese, literally meaning \"analysis\" or \"disassembly\" is used in Japanese martial arts to describe the process of extracting fighting techniques from the movements of a **kata**.\n\n## Kata in the Karate Kid (and Cobra Kai)\n\nIn the 1989 film Karate Kid, Mr. Miyagi has Daniel-san practice cleaning the dojo as part of his training. You may recall the \"wax-on, wax-off\" lesson. This introduced Daniel to a technique, or fragment of a kata. For the longest time Daniel didn't know if he was doing it right. Then Mr. Miyagi throws a punch at him - and his body reacts with the technique he rehearsed. \"Wax on\" - and he deflects the punch automatically! This illustrates the power of intentional practice - which by analogy we will extend to writing production code as its own kind of fight.\n\n## Kata in Karate\nA karate class usually has a group kata practice toward its end. The time before is spent focusing on individual techniques, often practiced with partners. This helps establish the building blocks of the kata.\n\nA belt promotion depends, among other things, on satisfactory demonstration of that belt's entire kata. This ensures that all the techniques associated with that belt level are demonstrated by the student. Thus the number of demonstrable katas is one measure of a student's skill level. The first 10 levels up to 1st degree black have widely varying kata, ensuring each level adds to the student's skill.\n\n## \"Code\" Kata\n\nCode Kata is the rehearsal of specific coding problems, and I've definitely seen workshops built on it. Sites like Project Euler and Code Warrior provide simple problems where you can focus on honing individual skills. I suggest at least trying them. Many coders think it's pointless to solve 'simple' problems, and thus miss the opportunity to develop the \"wax on wax off\" kind of mastery that comes only from repetition.\n\n## Testing as Bunkai\n\nThe analogy of kata to production code is pretty interesting. Both are composed of smaller building blocks. Both are complex and take time to get right. Kata, like production code, are what get people promotions and recognition. But bunkai, like testing, is the counterpoint is needed to develop them.\n\nHow bunkai develops kata is like this: To practice a kata's block/punch combination, your partner will throw an attack. When you respond to the attack, you practice the kata's technique _in the context of its intended application_. \n\n_In this way, the bunkai is the ***reason*** for the kata._ Exactly as test-first development 'throws the first punch' and puts pressure on the code to respond correctly!\n\nKata that are not practiced against opponents' bunkai seldom have the snap or polish they could have. Could the same be true about code that is not robustly tested?\n\n## Tests Shape Code as Testing Shapes Developers.\n\nWhat if I said, \"I think 50/50 is a good theoretical split of time focused on tests/prod code\". Would that be an uncomfortable thought to you? If so-why? It could be that you haven't figured out how to turn its benefits to your favor. Perhaps doing an 'analysis' aka bunkai will help.\n\nIf you believe testing is less than 50% important, consider a thought experiment: Imagine a machine, or an AI, that could spit out source code, which you could quickly test whether that source code satisfied the test suite or not. You might not know or care what the code looks like, you just know it does *what you specified in the test suite!* Programmers may become replaceable, but those who write the specifications (aka tests) can't be replaced! Investing in those skills just seems smart to me.\n\n---\n\nIn summary, testing is an \"analysis\" or \"disassembly\" of production-ready code, as bunkai is for kata in karate. When there are complementary evolutionary pressures, it results in growth on both sides. Anyway its secretly fun! If you've never written a failing test first, then made it pass, you are missing out on one of the great satisfactions of programming. To have pairing sessions where someone 'tests' and another codes - aka \"ping-pong\" style 🏓 - is simply delightful.\n \nLet testing do for your software practice what bunkai does for kata in karate. Enjoy crane-kicking your way to success!\n\n---\n\n_A Personal note: My adult karate path began in 2010 when my friend Hope gave me a gift certificate for a membership at her karate dojo. Though I saw her achieve 1st black belt, mental health and depression issues claimed her before her time. This one is for mental health awareness—and Hope._","cached_tag_list":"testing, tdd, kata, karate","cached_user_name":"Dean Radcliffe","cached_user_username":"deanius","comments_count":1,"description":"The karate method of \"Bunkai\" can be applied to our software practice. By focusing **both** on testing and prod code we improve both sides of our practice.","main_image":"https://images.unsplash.com/photo-1555597673-b21d5c935865?ixlib=rb-1.2.1\u0026ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8\u0026auto=format\u0026fit=crop\u0026w=1744\u0026q=80","main_image_background_hex_color":"#dddddd","path":"/deanius/kata-bunkai-and-testing-261h","public_reactions_count":2,"processed_html":"\u003ch2\u003e\n  \u003ca name=\"kata\" href=\"#kata\"\u003e\n  \u003c/a\u003e\n  Kata\n\u003c/h2\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eKata (martial arts): A detailed, choreographed sequence of movements, blocks, strikes and footwork, executed without a partner. Kata are used as a mnemonic device for a series of techniques, flowed together.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"bunkai\" href=\"#bunkai\"\u003e\n  \u003c/a\u003e\n  Bunkai\n\u003c/h2\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eBunkai (分解) in Japanese, literally meaning \"analysis\" or \"disassembly\" is used in Japanese martial arts to describe the process of extracting fighting techniques from the movements of a \u003cstrong\u003ekata\u003c/strong\u003e.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"kata-in-the-karate-kid-and-cobra-kai\" href=\"#kata-in-the-karate-kid-and-cobra-kai\"\u003e\n  \u003c/a\u003e\n  Kata in the Karate Kid (and Cobra Kai)\n\u003c/h2\u003e\n\n\u003cp\u003eIn the 1989 film Karate Kid, Mr. Miyagi has Daniel-san practice cleaning the dojo as part of his training. You may recall the \"wax-on, wax-off\" lesson. This introduced Daniel to a technique, or fragment of a kata. For the longest time Daniel didn't know if he was doing it right. Then Mr. Miyagi throws a punch at him - and his body reacts with the technique he rehearsed. \"Wax on\" - and he deflects the punch automatically! This illustrates the power of intentional practice - which by analogy we will extend to writing production code as its own kind of fight.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"kata-in-karate\" href=\"#kata-in-karate\"\u003e\n  \u003c/a\u003e\n  Kata in Karate\n\u003c/h2\u003e\n\n\u003cp\u003eA karate class usually has a group kata practice toward its end. The time before is spent focusing on individual techniques, often practiced with partners. This helps establish the building blocks of the kata.\u003c/p\u003e\n\n\u003cp\u003eA belt promotion depends, among other things, on satisfactory demonstration of that belt's entire kata. This ensures that all the techniques associated with that belt level are demonstrated by the student. Thus the number of demonstrable katas is one measure of a student's skill level. The first 10 levels up to 1st degree black have widely varying kata, ensuring each level adds to the student's skill.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"code-kata\" href=\"#code-kata\"\u003e\n  \u003c/a\u003e\n  \"Code\" Kata\n\u003c/h2\u003e\n\n\u003cp\u003eCode Kata is the rehearsal of specific coding problems, and I've definitely seen workshops built on it. Sites like Project Euler and Code Warrior provide simple problems where you can focus on honing individual skills. I suggest at least trying them. Many coders think it's pointless to solve 'simple' problems, and thus miss the opportunity to develop the \"wax on wax off\" kind of mastery that comes only from repetition.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"testing-as-bunkai\" href=\"#testing-as-bunkai\"\u003e\n  \u003c/a\u003e\n  Testing as Bunkai\n\u003c/h2\u003e\n\n\u003cp\u003eThe analogy of kata to production code is pretty interesting. Both are composed of smaller building blocks. Both are complex and take time to get right. Kata, like production code, are what get people promotions and recognition. But bunkai, like testing, is the counterpoint is needed to develop them.\u003c/p\u003e\n\n\u003cp\u003eHow bunkai develops kata is like this: To practice a kata's block/punch combination, your partner will throw an attack. When you respond to the attack, you practice the kata's technique \u003cem\u003ein the context of its intended application\u003c/em\u003e. \u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003eIn this way, the bunkai is the \u003cstrong\u003e\u003cem\u003ereason\u003c/em\u003e\u003c/strong\u003e for the kata.\u003c/em\u003e Exactly as test-first development 'throws the first punch' and puts pressure on the code to respond correctly!\u003c/p\u003e\n\n\u003cp\u003eKata that are not practiced against opponents' bunkai seldom have the snap or polish they could have. Could the same be true about code that is not robustly tested?\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"tests-shape-code-as-testing-shapes-developers\" href=\"#tests-shape-code-as-testing-shapes-developers\"\u003e\n  \u003c/a\u003e\n  Tests Shape Code as Testing Shapes Developers.\n\u003c/h2\u003e\n\n\u003cp\u003eWhat if I said, \"I think 50/50 is a good theoretical split of time focused on tests/prod code\". Would that be an uncomfortable thought to you? If so-why? It could be that you haven't figured out how to turn its benefits to your favor. Perhaps doing an 'analysis' aka bunkai will help.\u003c/p\u003e\n\n\u003cp\u003eIf you believe testing is less than 50% important, consider a thought experiment: Imagine a machine, or an AI, that could spit out source code, which you could quickly test whether that source code satisfied the test suite or not. You might not know or care what the code looks like, you just know it does \u003cem\u003ewhat you specified in the test suite!\u003c/em\u003e Programmers may become replaceable, but those who write the specifications (aka tests) can't be replaced! Investing in those skills just seems smart to me.\u003c/p\u003e\n\n\n\u003chr\u003e\n\n\u003cp\u003eIn summary, testing is an \"analysis\" or \"disassembly\" of production-ready code, as bunkai is for kata in karate. When there are complementary evolutionary pressures, it results in growth on both sides. Anyway its secretly fun! If you've never written a failing test first, then made it pass, you are missing out on one of the great satisfactions of programming. To have pairing sessions where someone 'tests' and another codes - aka \"ping-pong\" style 🏓 - is simply delightful.\u003c/p\u003e\n\n\u003cp\u003eLet testing do for your software practice what bunkai does for kata in karate. Enjoy crane-kicking your way to success!\u003c/p\u003e\n\n\n\u003chr\u003e\n\n\u003cp\u003e\u003cem\u003eA Personal note: My adult karate path began in 2010 when my friend Hope gave me a gift certificate for a membership at her karate dojo. Though I saw her achieve 1st black belt, mental health and depression issues claimed her before her time. This one is for mental health awareness—and Hope.\u003c/em\u003e\u003c/p\u003e\n\n","published":true,"published_from_feed":false,"show_comments":true,"slug":"kata-bunkai-and-testing-261h","social_image":null,"title":"Kata, Bunkai and Testing","video":null,"video_code":null},{"created_at":"2022-05-20T13:37:39.872Z","crossposted_at":null,"edited_at":"2024-01-22T17:33:25.320Z","last_comment_at":"2024-01-04T10:57:00.973Z","published_at":"2022-05-20T15:02:58.365Z","canonical_url":null,"feed_source_url":null,"video_closed_caption_track_url":null,"video_source_url":null,"video_thumbnail_url":null,"body_markdown":"---\ntitle: How an Interview Convinced Me to Use 𝗥𝘅𝑓𝑥 and RxJS for Effect Management in React\npublished: true\ndescription:\ntags: rxjs, rxfx, JavaScript, React\ncover_image: https://images.unsplash.com/photo-1574720187210-421b34c9cf01?ixlib=rb-1.2.1\u0026raw_url=true\u0026q=80\u0026fm=jpg\u0026crop=entropy\u0026cs=tinysrgb\u0026ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8\u0026auto=format\u0026fit=crop\u0026w=1064\n---\n\nEdit: Here is [part 2](https://dev.to/deanius/excellent-effect-management-in-react-with-and-rxjs-35cn) of this series.\n\nNote: Some images refer to the library's old name \"Omnibus-RxJS\" and have not been updated to 𝗥𝘅𝑓𝑥.\n\n## An Interview Like No Other\n\nIt was a front-end React UI developer interview which began like any other. But unlike others, by the end of it I'd learned enough to change my whole approach to data-fetching, or maybe to async programming in general.\n\nI was the interviewer for a 60 minutes live-coding interview. The goal was to build a simple React GUI that could fetch a random GIF. We assumed any candidate who reached this round could do async data-fetching in React. But we wanted to learn how a candidate thought about front-end problems in general. We were looking for some insight that we didn't already have. And in this candidate— call them **Chris** - we found it :)\n\nI handed Chris the paper with the requirements for their live-coding interview.\n\n## Getting Acquainted\n\nThe requirements contained an image of what was to be built in the interview.\n\n![empty template](https://s3.amazonaws.com/www.deanius.com/kitty-factory-intro.png)\n\n![Implement a React UI that loads a random GIF upon the click of a button Respond to and display any errors that occur Implement a cancel button](https://s3.amazonaws.com/www.deanius.com/GIF-fetcher-challenge.jpg?n)\n\nChris asked a few questions:\n\n_\"Does it have to be cats, or will any GIF do?\"_\n\n\"Ha!\" I said. \"You can choose any GIF you want, but we've provided a function to get cats.\"\n\n```ts\nconst fetchRandomGif = () =\u003e\n  fetch(\"https://api.thecatapi.com/v1/images/search\", {\n    headers: { \"x-api-key\": \"blah-blah\" },\n  })\n    .then((res) =\u003e res.json())\n    .then((data) =\u003e data[0].url);\n```\n\n_\"Can I use any libraries?\"_ was Chris's next question. I replied: \"Do you think one is needed for this app?\"\n\n_\"Well, we need a cancel button... And I find Observables make for cleaner, less error-prone code around cancelation.\"_\n\nThis took me by surprise. I only knew of one cancelation tool, AbortControllers, and Chris pinpointed my frustrations with them - that they're easy to forget, don't compose well, and obscure the logic of the happy path.\n\nI said, \"yes you can use a library, but you must be able to explain what it is doing, and justify its contribution to the bundle size.\"\n\nChris chimed up with, _\"Sounds good— shall we get to work then?\"_\n\n---\n\n## 𝗥𝘅𝑓𝑥—An Odd Choice of Library\n\nChris started by creating a new file, naming it `gifService.ts`. I gently inquired why they made a separate file instead of coding into the provided React component.\n\n_\"React is the view layer, this is- well, a service layer. Easier to test with no React dependencies. Can I proceed?\"_\n\n\"Go for it,\" I said. Chris wrote the following as though from memory, and in TypeScript, but I'll post just the JS here.\n\n```js\nimport { Bus } from \"@rxfx/bus\";\nimport { createService } from \"@rxfx/service\";\nimport { fetchRandomGif } from \"./prebuilt-for-candidate\";\nconst bus = new Bus();\nbus.spy(console.log);\n\nexport const gifService = createService(\"gif\", bus, () =\u003e fetchRandomGif);\n```\n\nI said - Ok, now what is this library doing?\n\n_\"Have you used Redux Saga, createAsyncThunk, or other async middleware? 𝗥𝘅𝑓𝑥 is a drop-in replacement, at less than half the bundle size. The bus receives events, which the service will put onto the bus as the effect starts, provides data, etc.\"_\n\nI knew Redux Saga. I said \"The `fetchRandomGif` function - it's not written as a generator function or a saga, it just returns a Promise. Is that going to be compatible with your bus?\"\n\n_\"Yep, no problem. It can do Promises, Observables, iterables. It's just RxJS underneath._\n\n_If you've ever been frustrated using React Context or prop-drilling to share data across an app, a `bus` is a framework-free way to do the same. It's so easy I don't know why it's not built into every app!\"_\n\nI did have prop-drilling and React Context issues, and I saw how events being visible to any part of the app by default would result in less code. That satisfied me of their choice, and I asked Chris to continue.\n\n## The State Model and Reducer\n\n_\"Great— now let's start on our state model. It looks like there's only one field we need in state - the URL of the current image - is that right?\"_\n\nI said \"Are you forgetting the loading and error states?\"\n\n_\"One nice thing about an 𝗥𝘅𝑓𝑥 service is your state model doesn't need to include loading and error. You get into trouble when you mix transient fields like `loading` and `error` into state fields that you may want to persist for longer - like across sessions. Separate things that change at different rates, right?\"_\n\nI had just dealt with a bug where a `loading` state loaded from local storage with a value of `true` - the spinner spun but nothing was happening. It occurred to me it was not really DRY to have a state field that isn't a direct reflection of whether a process is actually running, so I was ready to see it in action.\n\n_\"We still need to see loading and error in the UI, but let's go ahead with a loading-free reducer.\"_\n\nThe reducer looked like this:\n\n```js\nconst initialState = {\n  url: \"\",\n};\n\nexport const gifReducer = (state = initialState, e = {}) =\u003e {\n  switch (e.type) {\n    case \"gif/next\":\n      return { ...state, url: e.payload };\n    default:\n      return state;\n  }\n};\n```\n\nI noticed the strings in the `case` statements, and I said \"These look like Redux Toolkit conventions, but with different names - where do they come from?\"\n\n_\"Fair question. A service has a standard set of actions, based on Observable life-cycle events. The `next` event delivers data, `error` an error, and `started` indicates a search began. There are typesafe versions of these too, do you want me to use them?\"_\n\nI said, \"Let's skip that for now and get our data in the UI.\"\n\n_\"Cool. Then let's add the reducer to our service.\"_\n\nChris changed the line to create the service ever-so-slightly, by adding the reducer.\n\n```diff\n- createService('gif', bus, () =\u003e fetchRandomGif);\n+ createService('gif', bus, () =\u003e fetchRandomGif, () =\u003e gifReducer);\n```\n\n_\"And now let's bring state into our UI\"_.\n\n## UI Updates\n\nChris typed the following in a flurry of keystrokes..\n\n```js\nimport { gifService } from \"./services/gifService\";\nimport { useService } from \"@rxfx/react\";\n\nfunction CatFetcher() {\n  const { state, request } = useService(gifService);\n  const { url } = state;\n\n  \u003cimg src={url} alt=\"Animal GIF\" /\u003e\n  \u003cbutton onClick={() =\u003e request()}/\u003e\n```\n\nI said \"Let me get caught up. Through the `useService` hook, we have a reference to the state produced by the reducer. And we have a function with which to request the effect, which changes the state?\n\n_\"Yeah, precisely!\"_\n\n![template with cat](https://s3.amazonaws.com/www.deanius.com/cat-load-no-loading.gif)\n\nIt worked great— on the happy path. Now what about errors, I asked.\n\n## Errors\n\nChris hacked a thrown error into the fetch endpoint. Then captured a `currentError` field from the hook. Then used it in React to show the message.\n\n```diff\n-  const { state, request } = useService(gifService);\n+  const { state, request, currentError } = useService(gifService);\n```\n\n```tsx\n\u003cdiv className=\"error\"\u003e{currentError}\u003c/div\u003e\n```\n\nI tested that when an error was shown in the GIF fetcher, the error display _just worked_. And it was cleared automatically on the next click. I guess that's why the field is named \"currentError\"—once a new one begins there _is no current error_. A nice convenience.\n\n![template with error](https://s3.amazonaws.com/www.deanius.com/cat-error.png)\n\nAfter it had shown an error, it resumed future fetches just fine. I said to Chris \"You pulled that off nicely. But since you left `loading` out of your state, how will we display that?\"\n\n## Loading State\n\nWhile the GIF is loading, let's change the text \"Fetch Cat\" to \"Fetching..\"\n\nChris captured the `isActive` field from the `useService` hook return value.\n\n```diff\n-  const { ... currentError } = useService(gifService);\n+  const { ... currentError, isActive } = useService(gifService);\n```\n\n```tsx\n\u003cbutton onClick={() =\u003e gifService()}\u003e\n  {isLoading ? \"Fetching.\" : \"Fetch Cat\"}\n  {/* Fetch Cat */}\n  \u003cHourglassSpinner show={isLoading} /\u003e\n\u003c/button\u003e\n```\n\nThat `isActive` variable - the hook just knows that a fetch is active?\n\n_\"Sure does. The service knows when it's doing work. It keeps a count of `gif/started` and `gif/complete` events and emits `true` when the count is `\u003e 0` and `false` otherwise.\"_\n\nI pretty much decided Chris had passed the interview, but to throw a challenge I asked about cancelation.\n\n## Cancelation and The Finished Product\n\nI'd shipped many apps without cancelation before, especially before Abort Controllers. But I knew that to do top-notch UX, one had to be able to cancel effects to free up resources.\n\nI asked how we could cancel a load while in progress. Chris added a Cancel button to the form, and I stepped out of the room for a second.\n\n```html\n\u003cbutton onClick={() =\u003e gifService.cancelCurrent()}\u003eCancel\u003c/button\u003e\n```\n\nWhen I returned, I opened up DevTools, and clicked Fetch Cat. I clicked Cancel, and BOOM, a canceled XHR on `/search`!\n\n![cat loading fixed](https://s3.amazonaws.com/www.deanius.com/cat-cancel-api.jpg)\n\nChris showed the new fetchRandomGif function - which looked like the Promise-based version. \n\n```ts\nimport { ajax } from \"rxjs/ajax\";\n\nconst fetchRandomGif = () =\u003e ajax.getJSON({\n    url: \"https://api.thecatapi.com/v1/images/search\",\n  }).pipe(\n    map((r) =\u003e r.response[0].url)\n);\n```\n\nSeeing this, I asked, \"So the service can just cancel this AJAX, even without an AbortController?\"\n\n_\"Cancelation is automatic- as long as the endpoint returns an Observable. It's crazy - every Observable since 2012 is cancelable, and yet today we have just Promises. It's nice that in 𝗥𝘅𝑓𝑥 you can return a `Promise` to start, and an Observable when you implement cancelation.\"_\n\nThis was great. I made a mental note: Suggest the whole team learn about Observables and this API around them. Promises being run-to-complete by default started to look like a very bad idea, especially when it was easy as this to swap a non-cancelable AJAX with a cancelable one.\n\n## A Mysterious Departure\n\nChris had exceeded expectations on the first 3 mandatory points of the challenge. I wanted to hire, so I moved on to Chris's questions. We talked pleasantly, then when we were standing up to say goodbye, curiosity got the best of me, and I asked one more technical question:\n\n\"Just curious- but how would you handle a click while a GIF was already loading? Something like XState?\"\n\nChris lifted their backpack to their shoulder and smiled.\n\n_\"Oh, the 𝗥𝘅𝑓𝑥 service has that covered too. Just change the call to `createService` to `createQueueingService` and you're covered. I'll send you a CodeSandbox of it later today so you can try it out.\"_\n\nAnd with that, Chris was gone. And my learning into RxJS and 𝗥𝘅𝑓𝑥 had just begun.\n\n---\n\n## Author's Note\n\nHere's the [CodeSandbox](https://codesandbox.io/s/rxfx-service-example-data-fetcher-nweq0h) of the Cat Fetcher.\n\nAs you may have guessed, this was a fictitious story, written by me, Dean, the author of 𝗥𝘅𝑓𝑥 packages. I must stress that 𝗥𝘅𝑓𝑥 was not designed to handle interview problems, but real world ones! And it has been deployed to production in various forms for 4 years, solving problems like dynamic forms, 60FPS animation, Web Sockets and many more. I hope you will give it a look, and let me know what you think!\n\nAnd soon there will be Part 2 where we address timeouts, maintaining the loading state until the bytes of the image have arrived, and other subtleties of data fetching.\n\n-- Dean\n\nUpdate: Here is [part 2!](https://dev.to/deanius/excellent-effect-management-in-react-with-and-rxjs-35cn)\n","cached_tag_list":"rxjs, rxfx, javascript, react","cached_user_name":"Dean Radcliffe","cached_user_username":"deanius","comments_count":0,"description":"Edit: Here is part 2 of this series.  Note: Some images refer to the library's old name...","main_image":"https://images.unsplash.com/photo-1574720187210-421b34c9cf01?ixlib=rb-1.2.1\u0026raw_url=true\u0026q=80\u0026fm=jpg\u0026crop=entropy\u0026cs=tinysrgb\u0026ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8\u0026auto=format\u0026fit=crop\u0026w=1064","main_image_background_hex_color":"#dddddd","path":"/deanius/how-an-interview-convinced-me-to-use-an-event-bus-for-rxjs-in-react-396l","public_reactions_count":11,"processed_html":"\u003cp\u003eEdit: Here is \u003ca href=\"https://dev.to/deanius/excellent-effect-management-in-react-with-and-rxjs-35cn\"\u003epart 2\u003c/a\u003e of this series.\u003c/p\u003e\n\n\u003cp\u003eNote: Some images refer to the library's old name \"Omnibus-RxJS\" and have not been updated to 𝗥𝘅𝑓𝑥.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"an-interview-like-no-other\" href=\"#an-interview-like-no-other\"\u003e\n  \u003c/a\u003e\n  An Interview Like No Other\n\u003c/h2\u003e\n\n\u003cp\u003eIt was a front-end React UI developer interview which began like any other. But unlike others, by the end of it I'd learned enough to change my whole approach to data-fetching, or maybe to async programming in general.\u003c/p\u003e\n\n\u003cp\u003eI was the interviewer for a 60 minutes live-coding interview. The goal was to build a simple React GUI that could fetch a random GIF. We assumed any candidate who reached this round could do async data-fetching in React. But we wanted to learn how a candidate thought about front-end problems in general. We were looking for some insight that we didn't already have. And in this candidate— call them \u003cstrong\u003eChris\u003c/strong\u003e - we found it :)\u003c/p\u003e\n\n\u003cp\u003eI handed Chris the paper with the requirements for their live-coding interview.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"getting-acquainted\" href=\"#getting-acquainted\"\u003e\n  \u003c/a\u003e\n  Getting Acquainted\n\u003c/h2\u003e\n\n\u003cp\u003eThe requirements contained an image of what was to be built in the interview.\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fs3.amazonaws.com%2Fwww.deanius.com%2Fkitty-factory-intro.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fs3.amazonaws.com%2Fwww.deanius.com%2Fkitty-factory-intro.png\" alt=\"empty template\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fs3.amazonaws.com%2Fwww.deanius.com%2FGIF-fetcher-challenge.jpg%3Fn\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fs3.amazonaws.com%2Fwww.deanius.com%2FGIF-fetcher-challenge.jpg%3Fn\" alt=\"Implement a React UI that loads a random GIF upon the click of a button Respond to and display any errors that occur Implement a cancel button\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eChris asked a few questions:\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003e\"Does it have to be cats, or will any GIF do?\"\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003e\"Ha!\" I said. \"You can choose any GIF you want, but we've provided a function to get cats.\"\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003efetchRandomGif\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"nf\"\u003efetch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003ehttps://api.thecatapi.com/v1/images/search\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eheaders\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003ex-api-key\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eblah-blah\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ethen\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"nx\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003eres\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ejson\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ethen\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"nx\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nx\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003e\u003cem\u003e\"Can I use any libraries?\"\u003c/em\u003e was Chris's next question. I replied: \"Do you think one is needed for this app?\"\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003e\"Well, we need a cancel button... And I find Observables make for cleaner, less error-prone code around cancelation.\"\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003eThis took me by surprise. I only knew of one cancelation tool, AbortControllers, and Chris pinpointed my frustrations with them - that they're easy to forget, don't compose well, and obscure the logic of the happy path.\u003c/p\u003e\n\n\u003cp\u003eI said, \"yes you can use a library, but you must be able to explain what it is doing, and justify its contribution to the bundle size.\"\u003c/p\u003e\n\n\u003cp\u003eChris chimed up with, \u003cem\u003e\"Sounds good— shall we get to work then?\"\u003c/em\u003e\u003c/p\u003e\n\n\n\u003chr\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"%F0%9D%97%A5%F0%9D%98%85%F0%9D%91%93%F0%9D%91%A5an-odd-choice-of-library\" href=\"#%F0%9D%97%A5%F0%9D%98%85%F0%9D%91%93%F0%9D%91%A5an-odd-choice-of-library\"\u003e\n  \u003c/a\u003e\n  𝗥𝘅𝑓𝑥—An Odd Choice of Library\n\u003c/h2\u003e\n\n\u003cp\u003eChris started by creating a new file, naming it \u003ccode\u003egifService.ts\u003c/code\u003e. I gently inquired why they made a separate file instead of coding into the provided React component.\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003e\"React is the view layer, this is- well, a service layer. Easier to test with no React dependencies. Can I proceed?\"\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003e\"Go for it,\" I said. Chris wrote the following as though from memory, and in TypeScript, but I'll post just the JS here.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eBus\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e@rxfx/bus\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003ecreateService\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e@rxfx/service\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003efetchRandomGif\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e./prebuilt-for-candidate\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ebus\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nc\"\u003eBus\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"nx\"\u003ebus\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003espy\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eexport\u003c/span\u003e \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003egifService\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003ecreateService\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003egif\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ebus\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003efetchRandomGif\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eI said - Ok, now what is this library doing?\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003e\"Have you used Redux Saga, createAsyncThunk, or other async middleware? 𝗥𝘅𝑓𝑥 is a drop-in replacement, at less than half the bundle size. The bus receives events, which the service will put onto the bus as the effect starts, provides data, etc.\"\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003eI knew Redux Saga. I said \"The \u003ccode\u003efetchRandomGif\u003c/code\u003e function - it's not written as a generator function or a saga, it just returns a Promise. Is that going to be compatible with your bus?\"\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003e\"Yep, no problem. It can do Promises, Observables, iterables. It's just RxJS underneath.\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003eIf you've ever been frustrated using React Context or prop-drilling to share data across an app, a \u003ccode\u003ebus\u003c/code\u003e is a framework-free way to do the same. It's so easy I don't know why it's not built into every app!\"\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003eI did have prop-drilling and React Context issues, and I saw how events being visible to any part of the app by default would result in less code. That satisfied me of their choice, and I asked Chris to continue.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"the-state-model-and-reducer\" href=\"#the-state-model-and-reducer\"\u003e\n  \u003c/a\u003e\n  The State Model and Reducer\n\u003c/h2\u003e\n\n\u003cp\u003e\u003cem\u003e\"Great— now let's start on our state model. It looks like there's only one field we need in state - the URL of the current image - is that right?\"\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003eI said \"Are you forgetting the loading and error states?\"\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003e\"One nice thing about an 𝗥𝘅𝑓𝑥 service is your state model doesn't need to include loading and error. You get into trouble when you mix transient fields like \u003ccode\u003eloading\u003c/code\u003e and \u003ccode\u003eerror\u003c/code\u003e into state fields that you may want to persist for longer - like across sessions. Separate things that change at different rates, right?\"\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003eI had just dealt with a bug where a \u003ccode\u003eloading\u003c/code\u003e state loaded from local storage with a value of \u003ccode\u003etrue\u003c/code\u003e - the spinner spun but nothing was happening. It occurred to me it was not really DRY to have a state field that isn't a direct reflection of whether a process is actually running, so I was ready to see it in action.\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003e\"We still need to see loading and error in the UI, but let's go ahead with a loading-free reducer.\"\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003eThe reducer looked like this:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003einitialState\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eexport\u003c/span\u003e \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003egifReducer\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003estate\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003einitialState\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ee\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{})\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eswitch \u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003egif/next\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e...\u003c/span\u003e\u003cspan class=\"nx\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epayload\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n    \u003cspan class=\"nl\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eI noticed the strings in the \u003ccode\u003ecase\u003c/code\u003e statements, and I said \"These look like Redux Toolkit conventions, but with different names - where do they come from?\"\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003e\"Fair question. A service has a standard set of actions, based on Observable life-cycle events. The \u003ccode\u003enext\u003c/code\u003e event delivers data, \u003ccode\u003eerror\u003c/code\u003e an error, and \u003ccode\u003estarted\u003c/code\u003e indicates a search began. There are typesafe versions of these too, do you want me to use them?\"\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003eI said, \"Let's skip that for now and get our data in the UI.\"\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003e\"Cool. Then let's add the reducer to our service.\"\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003eChris changed the line to create the service ever-so-slightly, by adding the reducer.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight diff\"\u003e\u003ccode\u003e\u003cspan class=\"gd\"\u003e- createService('gif', bus, () =\u0026gt; fetchRandomGif);\n\u003c/span\u003e\u003cspan class=\"gi\"\u003e+ createService('gif', bus, () =\u0026gt; fetchRandomGif, () =\u0026gt; gifReducer);\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003e\u003cem\u003e\"And now let's bring state into our UI\"\u003c/em\u003e.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"ui-updates\" href=\"#ui-updates\"\u003e\n  \u003c/a\u003e\n  UI Updates\n\u003c/h2\u003e\n\n\u003cp\u003eChris typed the following in a flurry of keystrokes..\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003egifService\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e./services/gifService\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003euseService\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e@rxfx/react\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003eCatFetcher\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003erequest\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nf\"\u003euseService\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003egifService\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eurl\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eimg\u003c/span\u003e \u003cspan class=\"nx\"\u003esrc\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"nx\"\u003ealt\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eAnimal GIF\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003ebutton\u003c/span\u003e \u003cspan class=\"nx\"\u003eonClick\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\u003cspan class=\"sr\"\u003e/\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026gt;\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eI said \"Let me get caught up. Through the \u003ccode\u003euseService\u003c/code\u003e hook, we have a reference to the state produced by the reducer. And we have a function with which to request the effect, which changes the state?\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003e\"Yeah, precisely!\"\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fs3.amazonaws.com%2Fwww.deanius.com%2Fcat-load-no-loading.gif\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fs3.amazonaws.com%2Fwww.deanius.com%2Fcat-load-no-loading.gif\" alt=\"template with cat\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eIt worked great— on the happy path. Now what about errors, I asked.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"errors\" href=\"#errors\"\u003e\n  \u003c/a\u003e\n  Errors\n\u003c/h2\u003e\n\n\u003cp\u003eChris hacked a thrown error into the fetch endpoint. Then captured a \u003ccode\u003ecurrentError\u003c/code\u003e field from the hook. Then used it in React to show the message.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight diff\"\u003e\u003ccode\u003e\u003cspan class=\"gd\"\u003e-  const { state, request } = useService(gifService);\n\u003c/span\u003e\u003cspan class=\"gi\"\u003e+  const { state, request, currentError } = useService(gifService);\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight tsx\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003ediv\u003c/span\u003e \u003cspan class=\"na\"\u003eclassName\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"error\"\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003ecurrentError\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003ediv\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eI tested that when an error was shown in the GIF fetcher, the error display \u003cem\u003ejust worked\u003c/em\u003e. And it was cleared automatically on the next click. I guess that's why the field is named \"currentError\"—once a new one begins there \u003cem\u003eis no current error\u003c/em\u003e. A nice convenience.\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fs3.amazonaws.com%2Fwww.deanius.com%2Fcat-error.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fs3.amazonaws.com%2Fwww.deanius.com%2Fcat-error.png\" alt=\"template with error\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eAfter it had shown an error, it resumed future fetches just fine. I said to Chris \"You pulled that off nicely. But since you left \u003ccode\u003eloading\u003c/code\u003e out of your state, how will we display that?\"\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"loading-state\" href=\"#loading-state\"\u003e\n  \u003c/a\u003e\n  Loading State\n\u003c/h2\u003e\n\n\u003cp\u003eWhile the GIF is loading, let's change the text \"Fetch Cat\" to \"Fetching..\"\u003c/p\u003e\n\n\u003cp\u003eChris captured the \u003ccode\u003eisActive\u003c/code\u003e field from the \u003ccode\u003euseService\u003c/code\u003e hook return value.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight diff\"\u003e\u003ccode\u003e\u003cspan class=\"gd\"\u003e-  const { ... currentError } = useService(gifService);\n\u003c/span\u003e\u003cspan class=\"gi\"\u003e+  const { ... currentError, isActive } = useService(gifService);\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight tsx\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003ebutton\u003c/span\u003e \u003cspan class=\"na\"\u003eonClick\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003egifService\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eisLoading\u003c/span\u003e \u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eFetching.\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eFetch Cat\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"cm\"\u003e/* Fetch Cat */\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nc\"\u003eHourglassSpinner\u003c/span\u003e \u003cspan class=\"na\"\u003eshow\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"si\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eisLoading\u003c/span\u003e\u003cspan class=\"si\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e/\u0026gt;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003ebutton\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eThat \u003ccode\u003eisActive\u003c/code\u003e variable - the hook just knows that a fetch is active?\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003e\"Sure does. The service knows when it's doing work. It keeps a count of \u003ccode\u003egif/started\u003c/code\u003e and \u003ccode\u003egif/complete\u003c/code\u003e events and emits \u003ccode\u003etrue\u003c/code\u003e when the count is \u003ccode\u003e\u0026gt; 0\u003c/code\u003e and \u003ccode\u003efalse\u003c/code\u003e otherwise.\"\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003eI pretty much decided Chris had passed the interview, but to throw a challenge I asked about cancelation.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"cancelation-and-the-finished-product\" href=\"#cancelation-and-the-finished-product\"\u003e\n  \u003c/a\u003e\n  Cancelation and The Finished Product\n\u003c/h2\u003e\n\n\u003cp\u003eI'd shipped many apps without cancelation before, especially before Abort Controllers. But I knew that to do top-notch UX, one had to be able to cancel effects to free up resources.\u003c/p\u003e\n\n\u003cp\u003eI asked how we could cancel a load while in progress. Chris added a Cancel button to the form, and I stepped out of the room for a second.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight html\"\u003e\u003ccode\u003e\u003cspan class=\"nt\"\u003e\u0026lt;button\u003c/span\u003e \u003cspan class=\"na\"\u003eonClick=\u003c/span\u003e\u003cspan class=\"s\"\u003e{()\u003c/span\u003e \u003cspan class=\"err\"\u003e=\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026gt;\u003c/span\u003e gifService.cancelCurrent()}\u0026gt;Cancel\u003cspan class=\"nt\"\u003e\u0026lt;/button\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eWhen I returned, I opened up DevTools, and clicked Fetch Cat. I clicked Cancel, and BOOM, a canceled XHR on \u003ccode\u003e/search\u003c/code\u003e!\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fs3.amazonaws.com%2Fwww.deanius.com%2Fcat-cancel-api.jpg\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fs3.amazonaws.com%2Fwww.deanius.com%2Fcat-cancel-api.jpg\" alt=\"cat loading fixed\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eChris showed the new fetchRandomGif function - which looked like the Promise-based version.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eajax\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003erxjs/ajax\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003efetchRandomGif\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003eajax\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003egetJSON\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003ehttps://api.thecatapi.com/v1/images/search\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}).\u003c/span\u003e\u003cspan class=\"nf\"\u003epipe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003emap\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"nx\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eresponse\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e].\u003c/span\u003e\u003cspan class=\"nx\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eSeeing this, I asked, \"So the service can just cancel this AJAX, even without an AbortController?\"\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003e\"Cancelation is automatic- as long as the endpoint returns an Observable. It's crazy - every Observable since 2012 is cancelable, and yet today we have just Promises. It's nice that in 𝗥𝘅𝑓𝑥 you can return a \u003ccode\u003ePromise\u003c/code\u003e to start, and an Observable when you implement cancelation.\"\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003eThis was great. I made a mental note: Suggest the whole team learn about Observables and this API around them. Promises being run-to-complete by default started to look like a very bad idea, especially when it was easy as this to swap a non-cancelable AJAX with a cancelable one.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"a-mysterious-departure\" href=\"#a-mysterious-departure\"\u003e\n  \u003c/a\u003e\n  A Mysterious Departure\n\u003c/h2\u003e\n\n\u003cp\u003eChris had exceeded expectations on the first 3 mandatory points of the challenge. I wanted to hire, so I moved on to Chris's questions. We talked pleasantly, then when we were standing up to say goodbye, curiosity got the best of me, and I asked one more technical question:\u003c/p\u003e\n\n\u003cp\u003e\"Just curious- but how would you handle a click while a GIF was already loading? Something like XState?\"\u003c/p\u003e\n\n\u003cp\u003eChris lifted their backpack to their shoulder and smiled.\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003e\"Oh, the 𝗥𝘅𝑓𝑥 service has that covered too. Just change the call to \u003ccode\u003ecreateService\u003c/code\u003e to \u003ccode\u003ecreateQueueingService\u003c/code\u003e and you're covered. I'll send you a CodeSandbox of it later today so you can try it out.\"\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003eAnd with that, Chris was gone. And my learning into RxJS and 𝗥𝘅𝑓𝑥 had just begun.\u003c/p\u003e\n\n\n\u003chr\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"authors-note\" href=\"#authors-note\"\u003e\n  \u003c/a\u003e\n  Author's Note\n\u003c/h2\u003e\n\n\u003cp\u003eHere's the \u003ca href=\"https://codesandbox.io/s/rxfx-service-example-data-fetcher-nweq0h\" target=\"_blank\" rel=\"noopener noreferrer\"\u003eCodeSandbox\u003c/a\u003e of the Cat Fetcher.\u003c/p\u003e\n\n\u003cp\u003eAs you may have guessed, this was a fictitious story, written by me, Dean, the author of 𝗥𝘅𝑓𝑥 packages. I must stress that 𝗥𝘅𝑓𝑥 was not designed to handle interview problems, but real world ones! And it has been deployed to production in various forms for 4 years, solving problems like dynamic forms, 60FPS animation, Web Sockets and many more. I hope you will give it a look, and let me know what you think!\u003c/p\u003e\n\n\u003cp\u003eAnd soon there will be Part 2 where we address timeouts, maintaining the loading state until the bytes of the image have arrived, and other subtleties of data fetching.\u003c/p\u003e\n\n\u003cp\u003e-- Dean\u003c/p\u003e\n\n\u003cp\u003eUpdate: Here is \u003ca href=\"https://dev.to/deanius/excellent-effect-management-in-react-with-and-rxjs-35cn\"\u003epart 2!\u003c/a\u003e\u003c/p\u003e\n\n","published":true,"published_from_feed":false,"show_comments":true,"slug":"how-an-interview-convinced-me-to-use-an-event-bus-for-rxjs-in-react-396l","social_image":null,"title":"How an Interview Convinced Me to Use 𝗥𝘅𝑓𝑥 and RxJS for Effect Management in React","video":null,"video_code":null},{"created_at":"2022-09-20T04:34:20.734Z","crossposted_at":null,"edited_at":"2022-09-20T19:49:24.743Z","last_comment_at":"2022-09-20T04:34:20.717Z","published_at":"2022-09-20T04:34:20.717Z","canonical_url":null,"feed_source_url":null,"video_closed_caption_track_url":null,"video_source_url":null,"video_thumbnail_url":null,"body_markdown":"---\ntitle: Ordering Event Bus Events with RxJS and concatMap\npublished: true\ndescription: Stack-based recursion can introduce event-ordering issues that RxJS concatMap can fix.\ntags: RxJS, async, operators, eventbus\ncover_image: https://images.unsplash.com/photo-1583078379333-e34d6569c406?ixlib=rb-1.2.1\u0026ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8\u0026auto=format\u0026fit=crop\u0026w=774\u0026q=80\n---\n\nAn Event Bus can help our app by providing a single source of truth for the relative timing of events. If `trigger('B')`  follows `trigger('A')` , then we we expect listeners will receive events in `A, B` order. Any other order would certainly lead to bugs.\n\nStrangely enough, with a simple implementation of an Event Bus in RxJS (a Subject, and some Observers that `tap` in a function), one can accidentally introduce a bug in which listeners don't hear events in the same order! Both the buses Luis Aviles made  [here](https://www.thisdot.co/blog/how-to-implement-an-event-bus-in-typescript) and the one I built in [this post](https://dev.to/deanius/a-typesafe-event-bus-with-rxjs-5972) suffer from this bug. In this post we will use `concatMap` to fix that, learning the \"Return The Work\" principle of Observables.\n\n## Your Thoughts?\nThe library that implements this bus fully today is called `omnibus-rxjs`. I'm thinking of putting it up as `@rxfx/bus`, and extracting out a family of libraries under that namespace. Which name do you like? Leave a comment below.\n\n---\n\n## Trigger and Listen\nIn [part 1](https://dev.to/deanius/a-typesafe-event-bus-with-rxjs-5972) we constructed an Event Bus that let us:\n\n1.  Call  `bus.trigger`  to trigger an event to the bus\n2.  Use `bus.listen` to register a function to be run on matching events.\n\nOn this bus, what happens if a handler function run by `bus.listen` contains a call to `bus.trigger`? Could this confuse the event ordering?\n\n```js\nbus.listen(\n  (item) =\u003e item === \"hello-dave\",\n  () =\u003e { bus.trigger(\"hello-HAL\") }\n);\n```\n\nOn the surface there's nothing suspicious here. And to review our bus code at this point, it's nothing more than this:\n\n```js\nclass Bus\u003cT\u003e {\n  private events: Subject\u003cT\u003e;\n  constructor() {\n    this.events = new Subject();\n  }\n  listen(matcher: Predicate\u003cT\u003e, handler: (item: T) =\u003e void): Subscription {\n    return this.events\n      .asObservable()\n      .pipe(filter(matcher), tap(handler))\n      .subscribe();\n  }\n  trigger(item: T) {\n    this.events.next(item);\n  }\n}\n```\n\nSo, assuming 3 events are triggered, how could 2 listeners disagree on what order the events arrived?\n\n```js\n// Listener 1 heard: [\"hello-world\", \"hello-Dave\", \"hello-HAL\"]\n// Listener 2 heard: [\"hello-world\", \"hello-HAL\", \"hello-Dave\"]\n```\n\n## The Stack is The Culprit\nJavaScript is a stack-based language, where each synchronous function call begins and ends inside its parents'. How is this relevant? Allow me to illustrate..\n\nSuppose there are 3 listeners on a bus carrying strings. First we create a logger called L1. Then our 'Dave listener' which will re-trigger. Then another logger called L2 will be attached. If we fire an event that re-triggers, like `\"hello-dave\"`, this shows the sequence of calls to the listeners that results in the problem:\n\n```js\n trigger('hello-Dave')\n  - L1 listener\n  - Dave listener\n     - trigger('hello-HAL')\n\t    - L1 listener\n\t    - L2 listener\n  - L2 listener\n```\n\nAt runtime, the `trigger('hello-HAL')` from inside the \"Dave\" listener started firing each matching listener sequentially. But L2 hadn't yet processed `hello-Dave`, so L2 sees `hello-HAL` even before `hello-Dave`. This is what we want to prevent. Our answer will be to not begin the re-triggering immediately, but to \"Return the Work\"\n\n## Observables - Units of Work\n\nOf all the definitions of Observables out there, the one I like is that an Observable represents the potential for some work to be done, or resource to be used. Like the command-line string `ls -l` encodes the *potential* of a memory-occupying, data-emitting process. So wherever you did work immediately before, you can now do it in an Observable. Like React VDOM is for DOM elements, Observables are to effects.\n\nNow, if we have a stream of these work Observables, we can strictly serialize them with the RxJS operator `concatMap`.\n\n## The Fix \nIf you suspected some kind of queueing was the solution you're right. But if you didn't know about`concatMap`, you may have imagined building some data structure to hold the queue. But the `concatMap` operator actually does this internally already. Let's give our bus an RxJS  `Subject`  for the triggerings we want to serialize.\n\n```diff\nclass Bus\u003cT\u003e {\n  private events: Subject\u003cT\u003e;\n+  private triggerings: Subject\u003cObservable\u003cvoid\u003e\u003e;\n\n  constructor() {\n    this.events = new Subject();\n+    this.triggerings = new Subject();\n+    this.triggerings.pipe(\n+      concatMap((t) =\u003e t)\n+    ).subscribe();\n  }\n}\n```\nWhen the constructor is run, the `triggerings`Subject begins listening for work items—Observables—which it passes to `concatMap` to execute only serially. Now, we change the implementation of `trigger` to push one of these work items to that Subject:\n\n```diff\n  trigger(item: T) {\n-    this.events.next(item);  \n+    this.triggerings.next(\n+      new Observable((notify) =\u003e {\n+        this.events.next(item);\n+        notify.complete();\n+      })\n+    );\n  }\n```\nThe Observable's work is to run each listener for the item completely and synchronously with `events.next(item)`, and only then call `notify.complete()`.\n\nAnd voila! `concatMap` can serialize the calls now! We no longer violate causality, and our logs show each listener agrees on the same event ordering.\n\n```\n// Listener 1 heard: [\"hello-world\", \"hello-Dave\", \"hello-HAL\"]\n// Listener 2 heard: [\"hello-world\", \"hello-Dave\", \"hello-HAL\"]\n```\n\nAnd we can see this is because triggerings—the execution of those Observables—always finishes notifying listeners for one event before processing the next one.\n\n```js\n trigger('hello-dave')\n  - L1 listener\n  - Dave listener (queues hello HAL)\n  - L2 listener\n trigger('hello-HAL')\n  - L1 listener\n  - L2 listener\n```\n\n## Decoupling For The Win\n\nWhere we're going with this bus is to make it usable for a Pub-Sub implementation. This bug we just fixed was a kind of coupling, where \"Dave listener\" was interfering with L2's event order. This is normal when making sync calls in a stack-based language, but we can bring order back to it again with RxJS.\n\nNow that we've decoupled this runtime behavior of listeners from each other, it's time to look at another important way listeners should be decoupled: errors. And that will be the topic of the next post.\n\n## Links\n- [CodeSandbox with error](https://codesandbox.io/s/minibus-2-sequence-error-1f1enf?file=/src/index.ts)\n- [CodeSandbox, fixed with `concatMap`](https://codesandbox.io/s/minibus-3-sequence-fixed-w2jv53?file=/src/bus.ts)\n\n\n\n","cached_tag_list":"rxjs, async, operators, eventbus","cached_user_name":"Dean Radcliffe","cached_user_username":"deanius","comments_count":0,"description":"Stack-based recursion can introduce event-ordering issues that RxJS concatMap can fix.","main_image":"https://images.unsplash.com/photo-1583078379333-e34d6569c406?ixlib=rb-1.2.1\u0026ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8\u0026auto=format\u0026fit=crop\u0026w=774\u0026q=80","main_image_background_hex_color":"#dddddd","path":"/deanius/ordering-event-bus-events-with-rxjs-and-concatmap-mik","public_reactions_count":6,"processed_html":"\u003cp\u003eAn Event Bus can help our app by providing a single source of truth for the relative timing of events. If \u003ccode\u003etrigger('B')\u003c/code\u003e  follows \u003ccode\u003etrigger('A')\u003c/code\u003e , then we we expect listeners will receive events in \u003ccode\u003eA, B\u003c/code\u003e order. Any other order would certainly lead to bugs.\u003c/p\u003e\n\n\u003cp\u003eStrangely enough, with a simple implementation of an Event Bus in RxJS (a Subject, and some Observers that \u003ccode\u003etap\u003c/code\u003e in a function), one can accidentally introduce a bug in which listeners don't hear events in the same order! Both the buses Luis Aviles made  \u003ca href=\"https://www.thisdot.co/blog/how-to-implement-an-event-bus-in-typescript\"\u003ehere\u003c/a\u003e and the one I built in \u003ca href=\"https://dev.to/deanius/a-typesafe-event-bus-with-rxjs-5972\"\u003ethis post\u003c/a\u003e suffer from this bug. In this post we will use \u003ccode\u003econcatMap\u003c/code\u003e to fix that, learning the \"Return The Work\" principle of Observables.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"your-thoughts\" href=\"#your-thoughts\"\u003e\n  \u003c/a\u003e\n  Your Thoughts?\n\u003c/h2\u003e\n\n\u003cp\u003eThe library that implements this bus fully today is called \u003ccode\u003eomnibus-rxjs\u003c/code\u003e. I'm thinking of putting it up as \u003ccode\u003e@rxfx/bus\u003c/code\u003e, and extracting out a family of libraries under that namespace. Which name do you like? Leave a comment below.\u003c/p\u003e\n\n\n\u003chr\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"trigger-and-listen\" href=\"#trigger-and-listen\"\u003e\n  \u003c/a\u003e\n  Trigger and Listen\n\u003c/h2\u003e\n\n\u003cp\u003eIn \u003ca href=\"https://dev.to/deanius/a-typesafe-event-bus-with-rxjs-5972\"\u003epart 1\u003c/a\u003e we constructed an Event Bus that let us:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e Call  \u003ccode\u003ebus.trigger\u003c/code\u003e  to trigger an event to the bus\u003c/li\u003e\n\u003cli\u003e Use \u003ccode\u003ebus.listen\u003c/code\u003e to register a function to be run on matching events.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eOn this bus, what happens if a handler function run by \u003ccode\u003ebus.listen\u003c/code\u003e contains a call to \u003ccode\u003ebus.trigger\u003c/code\u003e? Could this confuse the event ordering?\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003ebus\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elisten\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003eitem\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003ehello-dave\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003ebus\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etrigger\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003ehello-HAL\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eOn the surface there's nothing suspicious here. And to review our bus code at this point, it's nothing more than this:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eBus\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eT\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kr\"\u003eprivate\u003c/span\u003e \u003cspan class=\"na\"\u003eevents\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eSubject\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eT\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eevents\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eSubject\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003elisten\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"na\"\u003ematcher\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003ePredicate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eT\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"na\"\u003ehandler\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"na\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"nx\"\u003eSubscription\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eevents\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003easObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epipe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003efilter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ematcher\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"nx\"\u003etap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ehandler\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003etrigger\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"na\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eevents\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003enext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eSo, assuming 3 events are triggered, how could 2 listeners disagree on what order the events arrived?\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"c1\"\u003e// Listener 1 heard: [\"hello-world\", \"hello-Dave\", \"hello-HAL\"]\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// Listener 2 heard: [\"hello-world\", \"hello-HAL\", \"hello-Dave\"]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003ch2\u003e\n  \u003ca name=\"the-stack-is-the-culprit\" href=\"#the-stack-is-the-culprit\"\u003e\n  \u003c/a\u003e\n  The Stack is The Culprit\n\u003c/h2\u003e\n\n\u003cp\u003eJavaScript is a stack-based language, where each synchronous function call begins and ends inside its parents'. How is this relevant? Allow me to illustrate..\u003c/p\u003e\n\n\u003cp\u003eSuppose there are 3 listeners on a bus carrying strings. First we create a logger called L1. Then our 'Dave listener' which will re-trigger. Then another logger called L2 will be attached. If we fire an event that re-triggers, like \u003ccode\u003e\"hello-dave\"\u003c/code\u003e, this shows the sequence of calls to the listeners that results in the problem:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e \u003cspan class=\"nx\"\u003etrigger\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ehello-Dave\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"nx\"\u003eL1\u003c/span\u003e \u003cspan class=\"nx\"\u003elistener\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"nx\"\u003eDave\u003c/span\u003e \u003cspan class=\"nx\"\u003elistener\u003c/span\u003e\n     \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"nx\"\u003etrigger\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ehello-HAL\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"nx\"\u003eL1\u003c/span\u003e \u003cspan class=\"nx\"\u003elistener\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"nx\"\u003eL2\u003c/span\u003e \u003cspan class=\"nx\"\u003elistener\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"nx\"\u003eL2\u003c/span\u003e \u003cspan class=\"nx\"\u003elistener\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eAt runtime, the \u003ccode\u003etrigger('hello-HAL')\u003c/code\u003e from inside the \"Dave\" listener started firing each matching listener sequentially. But L2 hadn't yet processed \u003ccode\u003ehello-Dave\u003c/code\u003e, so L2 sees \u003ccode\u003ehello-HAL\u003c/code\u003e even before \u003ccode\u003ehello-Dave\u003c/code\u003e. This is what we want to prevent. Our answer will be to not begin the re-triggering immediately, but to \"Return the Work\"\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"observables-units-of-work\" href=\"#observables-units-of-work\"\u003e\n  \u003c/a\u003e\n  Observables - Units of Work\n\u003c/h2\u003e\n\n\u003cp\u003eOf all the definitions of Observables out there, the one I like is that an Observable represents the potential for some work to be done, or resource to be used. Like the command-line string \u003ccode\u003els -l\u003c/code\u003e encodes the \u003cem\u003epotential\u003c/em\u003e of a memory-occupying, data-emitting process. So wherever you did work immediately before, you can now do it in an Observable. Like React VDOM is for DOM elements, Observables are to effects.\u003c/p\u003e\n\n\u003cp\u003eNow, if we have a stream of these work Observables, we can strictly serialize them with the RxJS operator \u003ccode\u003econcatMap\u003c/code\u003e.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"the-fix\" href=\"#the-fix\"\u003e\n  \u003c/a\u003e\n  The Fix\n\u003c/h2\u003e\n\n\u003cp\u003eIf you suspected some kind of queueing was the solution you're right. But if you didn't know about\u003ccode\u003econcatMap\u003c/code\u003e, you may have imagined building some data structure to hold the queue. But the \u003ccode\u003econcatMap\u003c/code\u003e operator actually does this internally already. Let's give our bus an RxJS  \u003ccode\u003eSubject\u003c/code\u003e  for the triggerings we want to serialize.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight diff\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003eclass Bus\u0026lt;T\u0026gt; {\n\u003c/span\u003e  private events: Subject\u0026lt;T\u0026gt;;\n\u003cspan class=\"gi\"\u003e+  private triggerings: Subject\u0026lt;Observable\u0026lt;void\u0026gt;\u0026gt;;\n\u003c/span\u003e\n  constructor() {\n    this.events = new Subject();\n\u003cspan class=\"gi\"\u003e+    this.triggerings = new Subject();\n+    this.triggerings.pipe(\n+      concatMap((t) =\u0026gt; t)\n+    ).subscribe();\n\u003c/span\u003e  }\n\u003cspan class=\"err\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eWhen the constructor is run, the \u003ccode\u003etriggerings\u003c/code\u003eSubject begins listening for work items—Observables—which it passes to \u003ccode\u003econcatMap\u003c/code\u003e to execute only serially. Now, we change the implementation of \u003ccode\u003etrigger\u003c/code\u003e to push one of these work items to that Subject:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight diff\"\u003e\u003ccode\u003e  trigger(item: T) {\n\u003cspan class=\"gd\"\u003e-    this.events.next(item);  \n\u003c/span\u003e\u003cspan class=\"gi\"\u003e+    this.triggerings.next(\n+      new Observable((notify) =\u0026gt; {\n+        this.events.next(item);\n+        notify.complete();\n+      })\n+    );\n\u003c/span\u003e  }\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eThe Observable's work is to run each listener for the item completely and synchronously with \u003ccode\u003eevents.next(item)\u003c/code\u003e, and only then call \u003ccode\u003enotify.complete()\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eAnd voila! \u003ccode\u003econcatMap\u003c/code\u003e can serialize the calls now! We no longer violate causality, and our logs show each listener agrees on the same event ordering.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e// Listener 1 heard: [\"hello-world\", \"hello-Dave\", \"hello-HAL\"]\n// Listener 2 heard: [\"hello-world\", \"hello-Dave\", \"hello-HAL\"]\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eAnd we can see this is because triggerings—the execution of those Observables—always finishes notifying listeners for one event before processing the next one.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e \u003cspan class=\"nx\"\u003etrigger\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ehello-dave\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"nx\"\u003eL1\u003c/span\u003e \u003cspan class=\"nx\"\u003elistener\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"nx\"\u003eDave\u003c/span\u003e \u003cspan class=\"nx\"\u003elistener\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003equeues\u003c/span\u003e \u003cspan class=\"nx\"\u003ehello\u003c/span\u003e \u003cspan class=\"nx\"\u003eHAL\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"nx\"\u003eL2\u003c/span\u003e \u003cspan class=\"nx\"\u003elistener\u003c/span\u003e\n \u003cspan class=\"nx\"\u003etrigger\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ehello-HAL\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"nx\"\u003eL1\u003c/span\u003e \u003cspan class=\"nx\"\u003elistener\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"nx\"\u003eL2\u003c/span\u003e \u003cspan class=\"nx\"\u003elistener\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003ch2\u003e\n  \u003ca name=\"decoupling-for-the-win\" href=\"#decoupling-for-the-win\"\u003e\n  \u003c/a\u003e\n  Decoupling For The Win\n\u003c/h2\u003e\n\n\u003cp\u003eWhere we're going with this bus is to make it usable for a Pub-Sub implementation. This bug we just fixed was a kind of coupling, where \"Dave listener\" was interfering with L2's event order. This is normal when making sync calls in a stack-based language, but we can bring order back to it again with RxJS.\u003c/p\u003e\n\n\u003cp\u003eNow that we've decoupled this runtime behavior of listeners from each other, it's time to look at another important way listeners should be decoupled: errors. And that will be the topic of the next post.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"links\" href=\"#links\"\u003e\n  \u003c/a\u003e\n  Links\n\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://codesandbox.io/s/minibus-2-sequence-error-1f1enf?file=/src/index.ts\"\u003eCodeSandbox with error\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://codesandbox.io/s/minibus-3-sequence-fixed-w2jv53?file=/src/bus.ts\"\u003eCodeSandbox, fixed with \u003ccode\u003econcatMap\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n","published":true,"published_from_feed":false,"show_comments":true,"slug":"ordering-event-bus-events-with-rxjs-and-concatmap-mik","social_image":null,"title":"Ordering Event Bus Events with RxJS and concatMap","video":null,"video_code":null},{"created_at":"2022-10-14T21:09:59.339Z","crossposted_at":null,"edited_at":null,"last_comment_at":"2022-10-17T19:43:09.486Z","published_at":"2022-10-17T19:43:09.486Z","canonical_url":null,"feed_source_url":null,"video_closed_caption_track_url":null,"video_source_url":null,"video_thumbnail_url":null,"body_markdown":"---\ntitle: 𝗥𝘅𝑓𝑥 - A productivity layer around RxJS.\npublished: true\ndescription: RxJS and Observables, solve 2 problems that every dev has, and now you can interface with it through a simpler API with 𝗥𝘅𝑓𝑥.\ntags: RxJS, RxFx, eventbus, pubsub\ncover_image: https://www.sarathi.org/images/articles/telegraph-operator.jpg\n---\n\nRxJS and Observables solve 2 problems that every front-end dev has: Tuning async code for performance and eliminating race conditions for optimal UX.\n\nIn this post, we'll deep-dive into building an example with the two main abstractions for async in 𝗥𝘅𝑓𝑥: the bus listener, and the service.\n\n# Example: Swipe To Refresh\n\n*Obective:* Build a \"Swipe To Refresh\" UX widget with an 𝗥𝘅𝑓𝑥 event bus from [`@rxfx/bus`](https://github.com/deanrad/rxfx/tree/main/bus), and a service on that bus from [`@rxfx/service`](https://github.com/deanrad/rxfx/tree/main/service). \n\n_(A complete version is here [on StackBlitz](https://stackblitz.com/edit/rxjs-refresh-jg6uy6?devtoolsheight=40\u0026file=README.md,index.ts), and built incrementally [on GitHub](https://github.com/deanrad/rxfx-example-swipe-to-refresh-blitz/pull/15/files))_\n\n# What We'll Build\n\nA drag-and-drop UI widget that can trigger a refresh.\n\n![](https://s3.amazonaws.com/www.deanius.com/rxfx-swipe-to-refresh-demo.gif)\n\nThe requirements are:\n - The dot is draggable\n - The dot triggers a refresh when it overlaps the darker dot.\n - The dot's position resets upon refresh or release.\n - The time displays 1 second after a refresh\n - During time refresh, no other refreshes can begin, and the dot is not draggable.\n\n# Overview\n\nThis widget will be made from two async 'containers' which we'll develop separately:\n\n- The time 'endpoint' (simulated)\n- The draggable refresh dot\n\nThen to cap it all off, we'll trigger the Time Listener when the Pointer Service is ready, no problem!\n\n\u003e One decision criteria for whether to use a listener on an `@rxfx/bus` or an `@rxfx/service` is whether we need to know when the service is 'active'. Changing the dot's appearance while dragging is such a use case. To start with, we'll make the mouse-dragger a full service, and the time 'endpoint' a simple listener, and go from there!\n\n## Setup / Organization\n\nWe're starting with a styled HTML document, and a module of DOM mutating functions. We'll place these in `services/DOM`. Our time lookup will go in `services/time`, and our pointer service in `services/pointer`. A bus will connect all of these, allowing for centralized logging, error handling, etc.\n\n## Install The Bus\nThe bus is like a `Subject`, on which `next` is renamed to `trigger`, and `listenBlocking(cond, handler)` is a shortcut for `subject.asObservable().pipe(filter(cond), exhaustMap(handler))`. It comes pre-wired in a single import.\n\nUnderstanding that, let's declare a bus that accepts strings, and listen for those to implement the refresh side\n\n```\nconst bus = new Bus\u003cstring\u003e();\n```\n\n# The Time Listener\n\n[PR containing Just Time Listener Code](https://github.com/deanrad/rxfx-example-swipe-to-refresh-blitz/pull/16)\n\n## A delayed value with `@rxfx/after`\n\nThe original Swipe-To-Refresh demo on [LearnRxjs.io](https://www.learnrxjs.io/learn-rxjs/recipes/swipe-to-refresh) demo uses no fewer than 4 functions to create a delayed time endpoint: `of`, `delay`, `pipe` and `tap`. \n\nWe can declare a fake value using `after` from `@rxfx/after` with only one. Depending on whether we want the time computed at the beginning or the end, we can call `after` with either a value or a function.\n\n```js\nconst fakeDateNow = after(2000, Date.now()) // \nconst fakeDateAtEnd = after(2000, () =\u003e Date.now()) // \n\nconst fakeEndpoint = () =\u003e fakeDateAtEnd;\n```\n\n## On request, call the time 'endpoint'\nNow, we'll create a bus listener to respond with the fake data. Suppose the initiation of the time lookup is to begin when an item equal to `time/request` goes on the bus.\n\n```js\nbus.listen(event =\u003e event === `time/request`, () =\u003e fakeEndpoint())\n```\n\nWe intentionally return the deferred value of the date from the handler. This would work whether the return value was a Promise or an RxJS Observable. Since `after` is an Observable, thus lazy, we return it to the bus so that it can call `.subscribe()` on it. But we don't want to subscribe to a new delayed date if one is pending already, so let's solve that.\n\n## Don't refresh while already refreshing\n\nUsing the console, we see that calling `bus.trigger(TIME_REQUEST)` twice results in double loading messages. \n\nTo adjust this In raw RxJS we would `pipe` something through an `exhaustMap`, but we can skip those imports.\n\nIn contrast to `bus#listen`, `bus#listenBlocking` takes the same arguments, but runs the effect with `exhaustMap` semantics. We just do:\n\n```diff\n- bus.listen(\n+ bus.listenBlocking(\n  event =\u003e event === `time/request`, \n  () =\u003e fakeEndpoint()\n)\n```\nEven if our UI will disable things, this makes the intention clear to those reading it. Now lets see these results in the DOM!\n\n## On reponse, update the DOM\n\nWe have a couple of wrapper functions around our DOM mutation functions, called `handleRequestBegin` and `handleRequestDone`, which will update the DOM with the text `...loading...`, or the new date, respectively. \n\nTo recap, the arguments to `listen*` are:\n  - **cause** - the condition that will cause the effect\n  - **effect** - the side-effecting function to call\n\nand to this we'll now add:  \n  - **reactions** - callbacks that will react to life-cycle events of the Effect.\n\nThis `observer` will be `tap`-ped in without us needing to import `tap`, `finalize`, or others.\n\n```js\nconst handleRequestBegin = () =\u003e {\n  console.log('loading...');\n  setData('loading...');\n};\n\nbus.listen(\n  (e) =\u003e e === TIME_REQUEST,\n  () =\u003e fakeResponse,\n  {\n    subscribe: handleRequestBegin,\n    next: handleRequestDone,\n  }\n);\n```\n\n## Time Listener Complete!\nThis completes our time listener! Whenever anyone calls `trigger(TIME_REQUEST)`, the time will go in the DOM with **Blocking** behavior. We've cut out a lot of operators at this point, but we can do more.\n\nLet's build the Swipe-To-Refresh pointer functionality out of the higher-level 𝗥𝘅𝑓𝑥 building block - the `@rxfx/service`, akin to `createAsyncThunk` or NgRx, and continue to drop operators.\n\n# Pointer Service\n\n[PR containing Just Pointer Service Code](https://github.com/deanrad/rxfx-example-swipe-to-refresh-blitz/pull/18)\n\nWe expect our Pointer Service to implement dragging our UI element under the pointer, then trigger the time listener. To create the service we need to know what kinds of \"requests\" it can get - in this case the string \"up\" or \"down\". We want its responses to be a stream of `number`s - the `clientY` field of each `pointer/move` it sees. And its errors are the normal type `Error`.\n\n```js\nexport const pointerService = createService\n  \u003c'up' | 'down', number, Error\u003e\n ('pointer', bus, () =\u003e mouseMoveYs)\n\nconst mouseMoveYs: Observable\u003cnumber\u003e = () =\u003e null\n```\n\nThe arguments are the namespace, for logging purposes, the bus on which it will put responses, and the effect. The effect will return an Observable of responses, and these will go onto our bus as they occur.\n\n## DOM listeners talk to the Pointer service\nNow we can add DOM listeners that will pass the service the string 'up' or 'down'.\n\n```js\nconst sendDown = (e: Event) =\u003e {\n  e.preventDefault();\n  pointerService.request('down');\n};\nconst sendUp = (e: Event) =\u003e {\n  e.preventDefault();\n  pointerService.request('up');\n};\n\nexport const connectDOMEventsToPointerService = () =\u003e {\n  document.addEventListener(POINTER_EVENTS.DOWN, sendDown);\n  document.addEventListener(POINTER_EVENTS.UP, sendUp);\n};\n```\n\nWe'll write a `disconnectDOMEventsFromPointerService` function as well, not shown here. First - let's specify this service's effect and its responses.\n\n## On down, moves become responses (until up)\nFirst, let's ensure we're `spy`ing on all bus events so we can see what's going on even before we hook it up to the UI.\n \nNow, import `fromEvent` and `map` from RxJS..\n\n```js\nconst mouseMoveYs: Observable\u003cnumber\u003e = () =\u003e {\n  return fromEvent(document, 'pointer/move').pipe(\n    map(ev: MouseEvent =\u003e ev.clientY)\n  )\n}\n```\n\nTry pressing the mouse down, and notice how as you move the pointer, the console will stream with:\n\n```js\n{type: 'pointer/next', payload: 10}\n{type: 'pointer/next', payload: 11}\n```\nNow, we add in cancelation with `takeUntil`.\n\n```js\nconst mouseMoveYs: Observable\u003cnumber\u003e = () =\u003e {\n  return fromEvent(document, 'pointer/move').pipe(\n    map(ev: MouseEvent =\u003e ev.clientY),\n    takeUntil(fromEvent(document, 'pointer/up'))\n  )\n}\n```\n\nWe're using operators, but only for their intended purposes. Now, when it comes to updating the DOM, our `service` gives us choices and modularity that raw RxJS doesn't.\n\n## Dot follows pointer / is dragged\nWe established that `pointerService` has responses that are of type `number`, right? And we have a `setRefreshPos` function that changes the DOM position of the refresh dot. So all we need is:\n\n```js\npointerService.responses.subscribe((r) =\u003e setRefreshPos(r.payload));\n```\n\nWhile the pointerService effect returned raw numbers, the `@rxfx/service` bundled them into the Flux Standard Actions. We retrieve the raw `number` from their `payload` - and yes, TypeScript would have helped you see that :)\n\nWhat's nice about adding dragging this way is that it doesn't `tap` into one giant chain. The Dot position is a subscriber - a _follower_ of those pointer/moves. This helps us keep things separated, like ...\n\n## On cancel (or complete), reset the dot's DOM position\n\nWe'd like, once we've stopped dragging, for the refresh dot to return to its initial position. As you saw in the console, once the `pointer/up` event occurred, a `pointer/complete` event was also seen.\n\nWe can hook off of this `pointer/complete` event to call `resetRefresh`:\n\n```js\nbus\n  .query(pointerService.actions.complete.match)\n  .subscribe(() =\u003e resetRefresh());\n```\n\nWe are filtering the bus down to all `pointer/complete` events, and each one causes a `resetRefresh`. We query the bus since these events are not part of the stream of `pointerService.responses`.\n\nNow let's hook up our final part, the refresh!\n\n## On move, if far enough, cancel drag and trigger the time refresh\n\nWe can listen to our service's responses as a stream, and if we exceed the Y threshold to trigger the refresh, we can reset the refresh button by canceling it. \n\n```js\npointerService.responses.subscribe(({ payload: y }) =\u003e {\n  if (isPastThreshold(y)) {\n    pointerService.cancelCurrent();\n    bus.trigger(TIME_REQUEST);\n  }\n});\n```\n\nOur pointer will return to the starting point, because the `pointer/complete` event will fire upon `cancelCurrent()`. And we'll no longer be draggging the dot until the next `pointer/down`. Lastly, we've triggered our time listener with that event of `TIME_REQUEST`, so everything is working!\n\n## Bonus: during drag, change appearances.\n\nI wouldn't want to miss describing one of the great features of `@rxfx/service` - the `isActive` Observable that lets you react to one of its effects being active. Just watch how we can make it easier on the eye!\n\n```js\npointerService.isActive.subscribe((isActive) =\u003e {\n  const method = isActive ? 'add' : 'remove';\n  document.getElementById('refresh').classList[method]('isDragging');\n});\n\n```\n\n## While refreshing, the dot is not draggable\n\nWe built our Pointer Service and Time Listener to not know about each other—initially. Now that we want to do something while the Time Listener is active, we could re-write it as a service and subscribe to its `isActive` property as we could for the Pointer Service.\n\nBut since we already have functions in the Time Listener's Observer we can use those to stop sending events to the Pointer Service.\n\n```js\nconst handleRequestBegin = () =\u003e {\n  console.log('loading...');\n+ disconnectDOMEventsFromPointerService();\n  setData('loading...');\n};\n```\n\nNow, as our _coup-de-grâce_, we have implemented a form of blocking mode by hand to complete our widget! \n\n[PR of Pointer Service](https://github.com/deanrad/rxfx-example-swipe-to-refresh-blitz/pull/18/files)\n\n[PR of entire demo](https://github.com/deanrad/rxfx-example-swipe-to-refresh-blitz/pull/15/files)\n\n# Summary\n\nWe used fewer individual RxJS operators to build the 𝗥𝘅𝑓𝑥 way than with raw RxJS. The service and listener concepts let us apply operators without creating a giant chain. Features are added separately, with little interference to each other.\n\nWith 𝗥𝘅𝑓𝑥 your app is mostly a list of tuples of:\n\n```\n[cause1, effect1, reactions1[]]\n[cause2, effect2, reactions2[]]\n```\n\nYour app grows in a maintainable and performant fashion — at least, it has for me. You can also use it to create Observables of state from triggered events, and a lot of other fun things. Pub-Sub is a great paradigm for rapid and modular app building.\n\nEnjoy building and listening!\n\n𝗥𝘅𝑓𝑥 Creator, Dean Radcliffe","cached_tag_list":"rxjs, rxfx, eventbus, pubsub","cached_user_name":"Dean Radcliffe","cached_user_username":"deanius","comments_count":0,"description":"RxJS and Observables, solve 2 problems that every dev has, and now you can interface with it through a simpler API with 𝗥𝘅𝑓𝑥.","main_image":"https://www.sarathi.org/images/articles/telegraph-operator.jpg","main_image_background_hex_color":"#dddddd","path":"/deanius/-a-productivity-layer-around-rxjs-2igi","public_reactions_count":1,"processed_html":"\u003cp\u003eRxJS and Observables solve 2 problems that every front-end dev has: Tuning async code for performance and eliminating race conditions for optimal UX.\u003c/p\u003e\n\n\u003cp\u003eIn this post, we'll deep-dive into building an example with the two main abstractions for async in 𝗥𝘅𝑓𝑥: the bus listener, and the service.\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"example-swipe-to-refresh\" href=\"#example-swipe-to-refresh\"\u003e\n  \u003c/a\u003e\n  Example: Swipe To Refresh\n\u003c/h1\u003e\n\n\u003cp\u003e\u003cem\u003eObective:\u003c/em\u003e Build a \"Swipe To Refresh\" UX widget with an 𝗥𝘅𝑓𝑥 event bus from \u003ca href=\"https://github.com/deanrad/rxfx/tree/main/bus\"\u003e\u003ccode\u003e@rxfx/bus\u003c/code\u003e\u003c/a\u003e, and a service on that bus from \u003ca href=\"https://github.com/deanrad/rxfx/tree/main/service\"\u003e\u003ccode\u003e@rxfx/service\u003c/code\u003e\u003c/a\u003e. \u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003e(A complete version is here \u003ca href=\"https://stackblitz.com/edit/rxjs-refresh-jg6uy6?devtoolsheight=40\u0026amp;file=README.md,index.ts\"\u003eon StackBlitz\u003c/a\u003e, and built incrementally \u003ca href=\"https://github.com/deanrad/rxfx-example-swipe-to-refresh-blitz/pull/15/files\"\u003eon GitHub\u003c/a\u003e)\u003c/em\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"what-well-build\" href=\"#what-well-build\"\u003e\n  \u003c/a\u003e\n  What We'll Build\n\u003c/h1\u003e\n\n\u003cp\u003eA drag-and-drop UI widget that can trigger a refresh.\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--JVxNeaUv--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://s3.amazonaws.com/www.deanius.com/rxfx-swipe-to-refresh-demo.gif\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--JVxNeaUv--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://s3.amazonaws.com/www.deanius.com/rxfx-swipe-to-refresh-demo.gif\" alt=\"\" loading=\"lazy\" width=\"256\" height=\"156\" data-animated=\"true\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eThe requirements are:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eThe dot is draggable\u003c/li\u003e\n\u003cli\u003eThe dot triggers a refresh when it overlaps the darker dot.\u003c/li\u003e\n\u003cli\u003eThe dot's position resets upon refresh or release.\u003c/li\u003e\n\u003cli\u003eThe time displays 1 second after a refresh\u003c/li\u003e\n\u003cli\u003eDuring time refresh, no other refreshes can begin, and the dot is not draggable.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"overview\" href=\"#overview\"\u003e\n  \u003c/a\u003e\n  Overview\n\u003c/h1\u003e\n\n\u003cp\u003eThis widget will be made from two async 'containers' which we'll develop separately:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eThe time 'endpoint' (simulated)\u003c/li\u003e\n\u003cli\u003eThe draggable refresh dot\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eThen to cap it all off, we'll trigger the Time Listener when the Pointer Service is ready, no problem!\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eOne decision criteria for whether to use a listener on an \u003ccode\u003e@rxfx/bus\u003c/code\u003e or an \u003ccode\u003e@rxfx/service\u003c/code\u003e is whether we need to know when the service is 'active'. Changing the dot's appearance while dragging is such a use case. To start with, we'll make the mouse-dragger a full service, and the time 'endpoint' a simple listener, and go from there!\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"setup-organization\" href=\"#setup-organization\"\u003e\n  \u003c/a\u003e\n  Setup / Organization\n\u003c/h2\u003e\n\n\u003cp\u003eWe're starting with a styled HTML document, and a module of DOM mutating functions. We'll place these in \u003ccode\u003eservices/DOM\u003c/code\u003e. Our time lookup will go in \u003ccode\u003eservices/time\u003c/code\u003e, and our pointer service in \u003ccode\u003eservices/pointer\u003c/code\u003e. A bus will connect all of these, allowing for centralized logging, error handling, etc.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"install-the-bus\" href=\"#install-the-bus\"\u003e\n  \u003c/a\u003e\n  Install The Bus\n\u003c/h2\u003e\n\n\u003cp\u003eThe bus is like a \u003ccode\u003eSubject\u003c/code\u003e, on which \u003ccode\u003enext\u003c/code\u003e is renamed to \u003ccode\u003etrigger\u003c/code\u003e, and \u003ccode\u003elistenBlocking(cond, handler)\u003c/code\u003e is a shortcut for \u003ccode\u003esubject.asObservable().pipe(filter(cond), exhaustMap(handler))\u003c/code\u003e. It comes pre-wired in a single import.\u003c/p\u003e\n\n\u003cp\u003eUnderstanding that, let's declare a bus that accepts strings, and listen for those to implement the refresh side\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003econst bus = new Bus\u0026lt;string\u0026gt;();\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003ch1\u003e\n  \u003ca name=\"the-time-listener\" href=\"#the-time-listener\"\u003e\n  \u003c/a\u003e\n  The Time Listener\n\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/deanrad/rxfx-example-swipe-to-refresh-blitz/pull/16\"\u003ePR containing Just Time Listener Code\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"a-delayed-value-with-raw-rxfxafter-endraw-\" href=\"#a-delayed-value-with-raw-rxfxafter-endraw-\"\u003e\n  \u003c/a\u003e\n  A delayed value with \u003ccode\u003e@rxfx/after\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003eThe original Swipe-To-Refresh demo on \u003ca href=\"https://www.learnrxjs.io/learn-rxjs/recipes/swipe-to-refresh\"\u003eLearnRxjs.io\u003c/a\u003e demo uses no fewer than 4 functions to create a delayed time endpoint: \u003ccode\u003eof\u003c/code\u003e, \u003ccode\u003edelay\u003c/code\u003e, \u003ccode\u003epipe\u003c/code\u003e and \u003ccode\u003etap\u003c/code\u003e. \u003c/p\u003e\n\n\u003cp\u003eWe can declare a fake value using \u003ccode\u003eafter\u003c/code\u003e from \u003ccode\u003e@rxfx/after\u003c/code\u003e with only one. Depending on whether we want the time computed at the beginning or the end, we can call \u003ccode\u003eafter\u003c/code\u003e with either a value or a function.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003efakeDateNow\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eafter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e2000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003eDate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003enow\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e \u003cspan class=\"c1\"\u003e// \u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003efakeDateAtEnd\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eafter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e2000\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nb\"\u003eDate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003enow\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e \u003cspan class=\"c1\"\u003e// \u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003efakeEndpoint\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003efakeDateAtEnd\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003ch2\u003e\n  \u003ca name=\"on-request-call-the-time-endpoint\" href=\"#on-request-call-the-time-endpoint\"\u003e\n  \u003c/a\u003e\n  On request, call the time 'endpoint'\n\u003c/h2\u003e\n\n\u003cp\u003eNow, we'll create a bus listener to respond with the fake data. Suppose the initiation of the time lookup is to begin when an item equal to \u003ccode\u003etime/request\u003c/code\u003e goes on the bus.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003ebus\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elisten\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eevent\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003eevent\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"s2\"\u003e`time/request`\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003efakeEndpoint\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eWe intentionally return the deferred value of the date from the handler. This would work whether the return value was a Promise or an RxJS Observable. Since \u003ccode\u003eafter\u003c/code\u003e is an Observable, thus lazy, we return it to the bus so that it can call \u003ccode\u003e.subscribe()\u003c/code\u003e on it. But we don't want to subscribe to a new delayed date if one is pending already, so let's solve that.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"dont-refresh-while-already-refreshing\" href=\"#dont-refresh-while-already-refreshing\"\u003e\n  \u003c/a\u003e\n  Don't refresh while already refreshing\n\u003c/h2\u003e\n\n\u003cp\u003eUsing the console, we see that calling \u003ccode\u003ebus.trigger(TIME_REQUEST)\u003c/code\u003e twice results in double loading messages. \u003c/p\u003e\n\n\u003cp\u003eTo adjust this In raw RxJS we would \u003ccode\u003epipe\u003c/code\u003e something through an \u003ccode\u003eexhaustMap\u003c/code\u003e, but we can skip those imports.\u003c/p\u003e\n\n\u003cp\u003eIn contrast to \u003ccode\u003ebus#listen\u003c/code\u003e, \u003ccode\u003ebus#listenBlocking\u003c/code\u003e takes the same arguments, but runs the effect with \u003ccode\u003eexhaustMap\u003c/code\u003e semantics. We just do:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight diff\"\u003e\u003ccode\u003e\u003cspan class=\"gd\"\u003e- bus.listen(\n\u003c/span\u003e\u003cspan class=\"gi\"\u003e+ bus.listenBlocking(\n\u003c/span\u003e  event =\u0026gt; event === `time/request`, \n  () =\u0026gt; fakeEndpoint()\n\u003cspan class=\"err\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eEven if our UI will disable things, this makes the intention clear to those reading it. Now lets see these results in the DOM!\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"on-reponse-update-the-dom\" href=\"#on-reponse-update-the-dom\"\u003e\n  \u003c/a\u003e\n  On reponse, update the DOM\n\u003c/h2\u003e\n\n\u003cp\u003eWe have a couple of wrapper functions around our DOM mutation functions, called \u003ccode\u003ehandleRequestBegin\u003c/code\u003e and \u003ccode\u003ehandleRequestDone\u003c/code\u003e, which will update the DOM with the text \u003ccode\u003e...loading...\u003c/code\u003e, or the new date, respectively. \u003c/p\u003e\n\n\u003cp\u003eTo recap, the arguments to \u003ccode\u003elisten*\u003c/code\u003e are:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003cstrong\u003ecause\u003c/strong\u003e - the condition that will cause the effect\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003eeffect\u003c/strong\u003e - the side-effecting function to call\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eand to this we'll now add:  \u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003cstrong\u003ereactions\u003c/strong\u003e - callbacks that will react to life-cycle events of the Effect.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eThis \u003ccode\u003eobserver\u003c/code\u003e will be \u003ccode\u003etap\u003c/code\u003e-ped in without us needing to import \u003ccode\u003etap\u003c/code\u003e, \u003ccode\u003efinalize\u003c/code\u003e, or others.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ehandleRequestBegin\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eloading...\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003esetData\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eloading...\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003ebus\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elisten\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003ee\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"nx\"\u003eTIME_REQUEST\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003efakeResponse\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"na\"\u003esubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003ehandleRequestBegin\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"na\"\u003enext\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003ehandleRequestDone\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003ch2\u003e\n  \u003ca name=\"time-listener-complete\" href=\"#time-listener-complete\"\u003e\n  \u003c/a\u003e\n  Time Listener Complete!\n\u003c/h2\u003e\n\n\u003cp\u003eThis completes our time listener! Whenever anyone calls \u003ccode\u003etrigger(TIME_REQUEST)\u003c/code\u003e, the time will go in the DOM with \u003cstrong\u003eBlocking\u003c/strong\u003e behavior. We've cut out a lot of operators at this point, but we can do more.\u003c/p\u003e\n\n\u003cp\u003eLet's build the Swipe-To-Refresh pointer functionality out of the higher-level 𝗥𝘅𝑓𝑥 building block - the \u003ccode\u003e@rxfx/service\u003c/code\u003e, akin to \u003ccode\u003ecreateAsyncThunk\u003c/code\u003e or NgRx, and continue to drop operators.\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"pointer-service\" href=\"#pointer-service\"\u003e\n  \u003c/a\u003e\n  Pointer Service\n\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/deanrad/rxfx-example-swipe-to-refresh-blitz/pull/18\"\u003ePR containing Just Pointer Service Code\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eWe expect our Pointer Service to implement dragging our UI element under the pointer, then trigger the time listener. To create the service we need to know what kinds of \"requests\" it can get - in this case the string \"up\" or \"down\". We want its responses to be a stream of \u003ccode\u003enumber\u003c/code\u003es - the \u003ccode\u003eclientY\u003c/code\u003e field of each \u003ccode\u003epointer/move\u003c/code\u003e it sees. And its errors are the normal type \u003ccode\u003eError\u003c/code\u003e.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eexport\u003c/span\u003e \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003epointerService\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ecreateService\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eup\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003edown\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003enumber\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003eError\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003epointer\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ebus\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003emouseMoveYs\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003emouseMoveYs\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eObservable\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003enumber\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"kc\"\u003enull\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eThe arguments are the namespace, for logging purposes, the bus on which it will put responses, and the effect. The effect will return an Observable of responses, and these will go onto our bus as they occur.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"dom-listeners-talk-to-the-pointer-service\" href=\"#dom-listeners-talk-to-the-pointer-service\"\u003e\n  \u003c/a\u003e\n  DOM listeners talk to the Pointer service\n\u003c/h2\u003e\n\n\u003cp\u003eNow we can add DOM listeners that will pass the service the string 'up' or 'down'.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003esendDown\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epreventDefault\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003epointerService\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003edown\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003esendUp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epreventDefault\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003epointerService\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eup\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eexport\u003c/span\u003e \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003econnectDOMEventsToPointerService\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eaddEventListener\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ePOINTER_EVENTS\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eDOWN\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003esendDown\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eaddEventListener\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ePOINTER_EVENTS\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eUP\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003esendUp\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eWe'll write a \u003ccode\u003edisconnectDOMEventsFromPointerService\u003c/code\u003e function as well, not shown here. First - let's specify this service's effect and its responses.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"on-down-moves-become-responses-until-up\" href=\"#on-down-moves-become-responses-until-up\"\u003e\n  \u003c/a\u003e\n  On down, moves become responses (until up)\n\u003c/h2\u003e\n\n\u003cp\u003eFirst, let's ensure we're \u003ccode\u003espy\u003c/code\u003eing on all bus events so we can see what's going on even before we hook it up to the UI.\u003c/p\u003e\n\n\u003cp\u003eNow, import \u003ccode\u003efromEvent\u003c/code\u003e and \u003ccode\u003emap\u003c/code\u003e from RxJS..\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003emouseMoveYs\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eObservable\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003enumber\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003efromEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003epointer/move\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003epipe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003emap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"na\"\u003eev\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eMouseEvent\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003eev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eclientY\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eTry pressing the mouse down, and notice how as you move the pointer, the console will stream with:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nl\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003epointer/next\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003epayload\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"na\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003epointer/next\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"na\"\u003epayload\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e11\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eNow, we add in cancelation with \u003ccode\u003etakeUntil\u003c/code\u003e.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003emouseMoveYs\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eObservable\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003enumber\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003efromEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003epointer/move\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003epipe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003emap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"na\"\u003eev\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eMouseEvent\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003eev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eclientY\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003etakeUntil\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003efromEvent\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003epointer/up\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eWe're using operators, but only for their intended purposes. Now, when it comes to updating the DOM, our \u003ccode\u003eservice\u003c/code\u003e gives us choices and modularity that raw RxJS doesn't.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"dot-follows-pointer-is-dragged\" href=\"#dot-follows-pointer-is-dragged\"\u003e\n  \u003c/a\u003e\n  Dot follows pointer / is dragged\n\u003c/h2\u003e\n\n\u003cp\u003eWe established that \u003ccode\u003epointerService\u003c/code\u003e has responses that are of type \u003ccode\u003enumber\u003c/code\u003e, right? And we have a \u003ccode\u003esetRefreshPos\u003c/code\u003e function that changes the DOM position of the refresh dot. So all we need is:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003epointerService\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eresponses\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"nx\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003esetRefreshPos\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epayload\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eWhile the pointerService effect returned raw numbers, the \u003ccode\u003e@rxfx/service\u003c/code\u003e bundled them into the Flux Standard Actions. We retrieve the raw \u003ccode\u003enumber\u003c/code\u003e from their \u003ccode\u003epayload\u003c/code\u003e - and yes, TypeScript would have helped you see that :)\u003c/p\u003e\n\n\u003cp\u003eWhat's nice about adding dragging this way is that it doesn't \u003ccode\u003etap\u003c/code\u003e into one giant chain. The Dot position is a subscriber - a \u003cem\u003efollower\u003c/em\u003e of those pointer/moves. This helps us keep things separated, like ...\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"on-cancel-or-complete-reset-the-dots-dom-position\" href=\"#on-cancel-or-complete-reset-the-dots-dom-position\"\u003e\n  \u003c/a\u003e\n  On cancel (or complete), reset the dot's DOM position\n\u003c/h2\u003e\n\n\u003cp\u003eWe'd like, once we've stopped dragging, for the refresh dot to return to its initial position. As you saw in the console, once the \u003ccode\u003epointer/up\u003c/code\u003e event occurred, a \u003ccode\u003epointer/complete\u003c/code\u003e event was also seen.\u003c/p\u003e\n\n\u003cp\u003eWe can hook off of this \u003ccode\u003epointer/complete\u003c/code\u003e event to call \u003ccode\u003eresetRefresh\u003c/code\u003e:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003ebus\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003equery\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003epointerService\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eactions\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecomplete\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ematch\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003eresetRefresh\u003c/span\u003e\u003cspan class=\"p\"\u003e());\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eWe are filtering the bus down to all \u003ccode\u003epointer/complete\u003c/code\u003e events, and each one causes a \u003ccode\u003eresetRefresh\u003c/code\u003e. We query the bus since these events are not part of the stream of \u003ccode\u003epointerService.responses\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eNow let's hook up our final part, the refresh!\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"on-move-if-far-enough-cancel-drag-and-trigger-the-time-refresh\" href=\"#on-move-if-far-enough-cancel-drag-and-trigger-the-time-refresh\"\u003e\n  \u003c/a\u003e\n  On move, if far enough, cancel drag and trigger the time refresh\n\u003c/h2\u003e\n\n\u003cp\u003eWe can listen to our service's responses as a stream, and if we exceed the Y threshold to trigger the refresh, we can reset the refresh button by canceling it.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003epointerService\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eresponses\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(({\u003c/span\u003e \u003cspan class=\"na\"\u003epayload\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003ey\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eisPastThreshold\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003epointerService\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecancelCurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003ebus\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etrigger\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eTIME_REQUEST\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eOur pointer will return to the starting point, because the \u003ccode\u003epointer/complete\u003c/code\u003e event will fire upon \u003ccode\u003ecancelCurrent()\u003c/code\u003e. And we'll no longer be draggging the dot until the next \u003ccode\u003epointer/down\u003c/code\u003e. Lastly, we've triggered our time listener with that event of \u003ccode\u003eTIME_REQUEST\u003c/code\u003e, so everything is working!\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"bonus-during-drag-change-appearances\" href=\"#bonus-during-drag-change-appearances\"\u003e\n  \u003c/a\u003e\n  Bonus: during drag, change appearances.\n\u003c/h2\u003e\n\n\u003cp\u003eI wouldn't want to miss describing one of the great features of \u003ccode\u003e@rxfx/service\u003c/code\u003e - the \u003ccode\u003eisActive\u003c/code\u003e Observable that lets you react to one of its effects being active. Just watch how we can make it easier on the eye!\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003epointerService\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eisActive\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"nx\"\u003eisActive\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003emethod\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eisActive\u003c/span\u003e \u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eadd\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eremove\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetElementById\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003erefresh\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003eclassList\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003emethod\u003c/span\u003e\u003cspan class=\"p\"\u003e](\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eisDragging\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003ch2\u003e\n  \u003ca name=\"while-refreshing-the-dot-is-not-draggable\" href=\"#while-refreshing-the-dot-is-not-draggable\"\u003e\n  \u003c/a\u003e\n  While refreshing, the dot is not draggable\n\u003c/h2\u003e\n\n\u003cp\u003eWe built our Pointer Service and Time Listener to not know about each other—initially. Now that we want to do something while the Time Listener is active, we could re-write it as a service and subscribe to its \u003ccode\u003eisActive\u003c/code\u003e property as we could for the Pointer Service.\u003c/p\u003e\n\n\u003cp\u003eBut since we already have functions in the Time Listener's Observer we can use those to stop sending events to the Pointer Service.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ehandleRequestBegin\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eloading...\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nx\"\u003edisconnectDOMEventsFromPointerService\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003esetData\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eloading...\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eNow, as our \u003cem\u003ecoup-de-grâce\u003c/em\u003e, we have implemented a form of blocking mode by hand to complete our widget! \u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/deanrad/rxfx-example-swipe-to-refresh-blitz/pull/18/files\"\u003ePR of Pointer Service\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/deanrad/rxfx-example-swipe-to-refresh-blitz/pull/15/files\"\u003ePR of entire demo\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n  \u003ca name=\"summary\" href=\"#summary\"\u003e\n  \u003c/a\u003e\n  Summary\n\u003c/h1\u003e\n\n\u003cp\u003eWe used fewer individual RxJS operators to build the 𝗥𝘅𝑓𝑥 way than with raw RxJS. The service and listener concepts let us apply operators without creating a giant chain. Features are added separately, with little interference to each other.\u003c/p\u003e\n\n\u003cp\u003eWith 𝗥𝘅𝑓𝑥 your app is mostly a list of tuples of:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight plaintext\"\u003e\u003ccode\u003e[cause1, effect1, reactions1[]]\n[cause2, effect2, reactions2[]]\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eYour app grows in a maintainable and performant fashion — at least, it has for me. You can also use it to create Observables of state from triggered events, and a lot of other fun things. Pub-Sub is a great paradigm for rapid and modular app building.\u003c/p\u003e\n\n\u003cp\u003eEnjoy building and listening!\u003c/p\u003e\n\n\u003cp\u003e𝗥𝘅𝑓𝑥 Creator, Dean Radcliffe\u003c/p\u003e\n\n","published":true,"published_from_feed":false,"show_comments":true,"slug":"-a-productivity-layer-around-rxjs-2igi","social_image":null,"title":"𝗥𝘅𝑓𝑥 - A productivity layer around RxJS.","video":null,"video_code":null},{"created_at":"2022-10-31T14:28:24.004Z","crossposted_at":null,"edited_at":"2023-03-19T16:22:48.474Z","last_comment_at":"2022-10-31T14:28:23.988Z","published_at":"2022-10-31T14:28:23.988Z","canonical_url":null,"feed_source_url":null,"video_closed_caption_track_url":null,"video_source_url":null,"video_thumbnail_url":null,"body_markdown":"---\ntitle: RxJS - I Have A Bone To Pick With You\npublished: true\ndescription: How the new library 𝗥𝘅𝑓𝑥 adds convenience to using RxJS\ntags: rxjs, rxfx, angluar, observables\ncover_image: https://images.unsplash.com/photo-1530210124550-912dc1381cb8?ixlib=rb-4.0.3\u0026ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8\u0026auto=format\u0026fit=crop\u0026w=2070\u0026q=80\n# Use a ratio of 100:42 for best results.\n# published_at: 2022-10-31 14:18 +0000\n---\n\nRxJS, there are some things I really love about you, but I think I'm falling for someone new - [𝗥𝘅𝑓𝑥](https://github.com/deanrad/rxfx/tree/main/bus)\n\nYour popularity— You have more downloads a month than React and Angular combined.\n\nYour maturity— You're a ripe 13 years old. Forever in technology time, and 3 years older than Promises, even.\n\nYour utility— For eliminating race conditions, all forms of timing control, and resource management— you have no equal.\n\nBut RxJS— with all this time you've been around, how come everybody doesn't know that you're the best already? How did you let React become the biggest framework, with useEffect and its quirks, and not even have them build upon you - the best choice available at the time? Now there are all these React developers out there who don't know the joy and power of working with you, RxJS. \n\nBut I know you're thinking what React did can't be your fault right? I mean - your documentation is perfect right? No friction to onboarding at-all, right... \n\nSo to help you out, I'm going to tell you about your DevRel issues (DevRel) and how to fix them. To start, you gotta do something about your...\n\n## Confusing Concurrency Docs\n\nYour documentation for your `*Map` operators is tragically hard to read. In the v6 docs you say `exhaustMap`:\n\n\u003e Projects each source value to an Observable which is merged in the output Observable only if the previous projected Observable has completed. \n\nSo, a previously running ~~Observable~~ Subscription **blocks** others from starting, you mean.\n\nYou could have called it something resembling **Blocking**. \n\nYour concurrency operators (`mergeMap`, `concatMap`, `switchMap`, and `exhaustMap`) focus on the notifications themselves, instead of the concurrency strategy that produces them.\n\nThis mapping operator could be illustrated by a picture:\n\n![Blocking Concurrency Mode](https://s3.amazonaws.com/www.deanius.com/rxfx/mode-blocking.png)\n\nOr the family of all of them illustrated as cards with common names and use cases.\n\n![RxFx cards](https://s3.amazonaws.com/www.deanius.com/cards-4-all.png)\n\nThat will straighten out your comprehensability issue around these operators.\n\n## Observable vs Subscription Confusion\n\nDevelopers who understand Promises often fail to realize that an Observable is doing nothing without a Subscription. This is what makes an Observable not something you can `await`.\n\nBut RxJS, you sometimes fail to differentiate sufficiently between an Observable and a Subscription in the docs! When the `exhaustMap` docs said: _\"only if the previous projected Observable has completed\"_ - that should have said _\"the previously running Subscription has completed\"_. Observables are templates for work. Only subscriptions can deliver values.\n\nI don't think calling an Observable multicast helps either. An Observable, being like a command, can be executed several times - we dont say that the command is multicasting to its executions. \n\nI don't like calling an Observable a 'stream' of notifications either - it may not have any! I prefer to say that an Observable is a template for creating a process - containing a start function and a cleanup function.\n\nSo - terminology is confusing. But it's also unclear where to split up a big chain of Observables.\n\n## App Partitioning / Where to Call Subscribe\n\nSome schools of RxJS believe in constructing a giant chain of Observables, with some higher-order ones in the middle, and calling `.subscribe()` once at the end of it only. The [Swipe-To-Refresh example from LearnRxJS.io](https://www.learnrxjs.io/learn-rxjs/recipes/swipe-to-refresh) does this.\n\n![swipe to refresh demo](https://drive.google.com/uc?export=view\u0026id=1BLA2TcAhjwtodkcnsJ8e91ckrvurqkEv)\n\nCheck out its code on [StackBlitz](https://stackblitz.com/edit/rxjs-refresh?devtoolsheight=40\u0026file=index.ts). I don't know what you thought separation of concerns was supposed to be - but I don't think that is it. \n\nWhat _are_ good practices, when combining Observables, especially higher-order ones? If operators are the individual words of your code paragraphs, what does a sentence-level structure look like? If we had that it might help us solve...\n\n## Operator Soup\nThe [Swipe-To-Refresh example from LearnRxJS.io](https://www.learnrxjs.io/learn-rxjs/recipes/swipe-to-refresh) starts out with 19 imported operators and functions with raw RxJS. With 𝗥𝘅𝑓𝑥 you implement _the same functionality_ with 6. That's 66% less you have to fit into your mind at once, 13 fewer operators to understand.\n\nSome of this comes from demo sites wanting to show all operators in use. But it's not uncommon to find a ton of operators in real RxJS production code. While each one is purposeful, their many combinations can be confusing.\n\nIf we could use fewer operators, we would have less code, and not suffer from as many...\n\n## Errors \nThis is already a well covered topic, RxJS. But you already know it's a source of pain and confusion. Recent changes have helped producers interfere with each other less, but the risk of `UnhandledRejectionError` bringing down a process is still large. \n\nWhy can't we specify 'containers' that can individually terminate on error, without risk to the overall process?\n\nYou see, we need some help, RxjS.\n\n## Solution - 𝗥𝘅𝑓𝑥\n\nWhen a community and library are mature enough, some \"contrib\" library emerges that the community puts its best value-add goodies in. That is what 𝗥𝘅𝑓𝑥 aims to be. \n\n𝗥𝘅𝑓𝑥 is RxJS \"The Good Parts\". With infinite expansion possibilities via 'raw' RxJS.\n\nProblems like Confusing Docs, Observable vs Subscription Confusion, App partitioning, and Operator Soup, and even Errors are reduced when 𝗥𝘅𝑓𝑥 is your interface to RxJS. \n\nThink of 𝗥𝘅𝑓𝑥 as sugar around an RxJS `Subject` that acts as an event bus. Each subscriber we call a \"listener\", and it is a concurrency-controlled, independent Subscription that is error-isolated from all others.\n\nBasically, this means you can get more done with less skipping the several years you need to be fluent in RxJS.\n\n\n\n## Case Study— RxJS [Swipe-To-Refresh Demo](https://stackblitz.com/edit/rxjs-refresh?devtoolsheight=40\u0026file=index.ts) \n\nThe [Swipe-To-Refresh Demo](https://stackblitz.com/edit/rxjs-refresh?devtoolsheight=40\u0026file=index.ts) starts out with 19 imported operators and functions with raw RxJS. In 𝗥𝘅𝑓𝑥 - it needs only 6.\n\nI'll dissect and rebuild it in my [next post](https://dev.to/deanius/-a-productivity-layer-around-rxjs-2igi) :)\n\n## Links\n- [𝗥𝘅𝑓𝑥 Bus Readme](https://github.com/deanrad/rxfx/tree/main/bus)\n- [Swipe-To-Refresh commit-by-commit](https://github.com/deanrad/rxfx-example-swipe-to-refresh-blitz/pulls)\n- [𝗥𝘅𝑓𝑥 Examples](https://codesandbox.io/search?query=rxfx\u0026page=1\u0026configure%5BhitsPerPage%5D=12\u0026refinementList%5Bnpm_dependencies.dependency%5D%5B0%5D=%40rxfx%2Fbus\u0026refinementList%5Bnpm_dependencies.dependency%5D%5B1%5D=%40rxfx%2Fservice)\n- [𝗥𝘅𝑓𝑥 Minimal Repl on Repl.it](https://replit.com/@deanius/Hello-World-rxfxbus#index.js)\n\n---\n\n","cached_tag_list":"rxjs, rxfx, angluar, observables","cached_user_name":"Dean Radcliffe","cached_user_username":"deanius","comments_count":0,"description":"How the new library 𝗥𝘅𝑓𝑥 adds convenience to using RxJS","main_image":"https://images.unsplash.com/photo-1530210124550-912dc1381cb8?ixlib=rb-4.0.3\u0026ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8\u0026auto=format\u0026fit=crop\u0026w=2070\u0026q=80","main_image_background_hex_color":"#dddddd","path":"/deanius/rxjs-i-have-a-bone-to-pick-with-you-31nb","public_reactions_count":0,"processed_html":"\u003cp\u003eRxJS, there are some things I really love about you, but I think I'm falling for someone new - \u003ca href=\"https://github.com/deanrad/rxfx/tree/main/bus\"\u003e𝗥𝘅𝑓𝑥\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eYour popularity— You have more downloads a month than React and Angular combined.\u003c/p\u003e\n\n\u003cp\u003eYour maturity— You're a ripe 13 years old. Forever in technology time, and 3 years older than Promises, even.\u003c/p\u003e\n\n\u003cp\u003eYour utility— For eliminating race conditions, all forms of timing control, and resource management— you have no equal.\u003c/p\u003e\n\n\u003cp\u003eBut RxJS— with all this time you've been around, how come everybody doesn't know that you're the best already? How did you let React become the biggest framework, with useEffect and its quirks, and not even have them build upon you - the best choice available at the time? Now there are all these React developers out there who don't know the joy and power of working with you, RxJS. \u003c/p\u003e\n\n\u003cp\u003eBut I know you're thinking what React did can't be your fault right? I mean - your documentation is perfect right? No friction to onboarding at-all, right... \u003c/p\u003e\n\n\u003cp\u003eSo to help you out, I'm going to tell you about your DevRel issues (DevRel) and how to fix them. To start, you gotta do something about your...\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"confusing-concurrency-docs\" href=\"#confusing-concurrency-docs\"\u003e\n  \u003c/a\u003e\n  Confusing Concurrency Docs\n\u003c/h2\u003e\n\n\u003cp\u003eYour documentation for your \u003ccode\u003e*Map\u003c/code\u003e operators is tragically hard to read. In the v6 docs you say \u003ccode\u003eexhaustMap\u003c/code\u003e:\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eProjects each source value to an Observable which is merged in the output Observable only if the previous projected Observable has completed. \u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eSo, a previously running \u003cdel\u003eObservable\u003c/del\u003e Subscription \u003cstrong\u003eblocks\u003c/strong\u003e others from starting, you mean.\u003c/p\u003e\n\n\u003cp\u003eYou could have called it something resembling \u003cstrong\u003eBlocking\u003c/strong\u003e. \u003c/p\u003e\n\n\u003cp\u003eYour concurrency operators (\u003ccode\u003emergeMap\u003c/code\u003e, \u003ccode\u003econcatMap\u003c/code\u003e, \u003ccode\u003eswitchMap\u003c/code\u003e, and \u003ccode\u003eexhaustMap\u003c/code\u003e) focus on the notifications themselves, instead of the concurrency strategy that produces them.\u003c/p\u003e\n\n\u003cp\u003eThis mapping operator could be illustrated by a picture:\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--53RFcfW5--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://s3.amazonaws.com/www.deanius.com/rxfx/mode-blocking.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--53RFcfW5--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://s3.amazonaws.com/www.deanius.com/rxfx/mode-blocking.png\" alt=\"Blocking Concurrency Mode\" loading=\"lazy\" width=\"456\" height=\"160\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eOr the family of all of them illustrated as cards with common names and use cases.\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--FB6hMuo8--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://s3.amazonaws.com/www.deanius.com/cards-4-all.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--FB6hMuo8--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://s3.amazonaws.com/www.deanius.com/cards-4-all.png\" alt=\"RxFx cards\" loading=\"lazy\" width=\"880\" height=\"838\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eThat will straighten out your comprehensability issue around these operators.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"observable-vs-subscription-confusion\" href=\"#observable-vs-subscription-confusion\"\u003e\n  \u003c/a\u003e\n  Observable vs Subscription Confusion\n\u003c/h2\u003e\n\n\u003cp\u003eDevelopers who understand Promises often fail to realize that an Observable is doing nothing without a Subscription. This is what makes an Observable not something you can \u003ccode\u003eawait\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eBut RxJS, you sometimes fail to differentiate sufficiently between an Observable and a Subscription in the docs! When the \u003ccode\u003eexhaustMap\u003c/code\u003e docs said: \u003cem\u003e\"only if the previous projected Observable has completed\"\u003c/em\u003e - that should have said \u003cem\u003e\"the previously running Subscription has completed\"\u003c/em\u003e. Observables are templates for work. Only subscriptions can deliver values.\u003c/p\u003e\n\n\u003cp\u003eI don't think calling an Observable multicast helps either. An Observable, being like a command, can be executed several times - we dont say that the command is multicasting to its executions. \u003c/p\u003e\n\n\u003cp\u003eI don't like calling an Observable a 'stream' of notifications either - it may not have any! I prefer to say that an Observable is a template for creating a process - containing a start function and a cleanup function.\u003c/p\u003e\n\n\u003cp\u003eSo - terminology is confusing. But it's also unclear where to split up a big chain of Observables.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"app-partitioning-where-to-call-subscribe\" href=\"#app-partitioning-where-to-call-subscribe\"\u003e\n  \u003c/a\u003e\n  App Partitioning / Where to Call Subscribe\n\u003c/h2\u003e\n\n\u003cp\u003eSome schools of RxJS believe in constructing a giant chain of Observables, with some higher-order ones in the middle, and calling \u003ccode\u003e.subscribe()\u003c/code\u003e once at the end of it only. The \u003ca href=\"https://www.learnrxjs.io/learn-rxjs/recipes/swipe-to-refresh\"\u003eSwipe-To-Refresh example from LearnRxJS.io\u003c/a\u003e does this.\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--mcxOeLhD--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://drive.google.com/uc%3Fexport%3Dview%26id%3D1BLA2TcAhjwtodkcnsJ8e91ckrvurqkEv\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--mcxOeLhD--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://drive.google.com/uc%3Fexport%3Dview%26id%3D1BLA2TcAhjwtodkcnsJ8e91ckrvurqkEv\" alt=\"swipe to refresh demo\" loading=\"lazy\" width=\"\" height=\"\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eCheck out its code on \u003ca href=\"https://stackblitz.com/edit/rxjs-refresh?devtoolsheight=40\u0026amp;file=index.ts\"\u003eStackBlitz\u003c/a\u003e. I don't know what you thought separation of concerns was supposed to be - but I don't think that is it. \u003c/p\u003e\n\n\u003cp\u003eWhat \u003cem\u003eare\u003c/em\u003e good practices, when combining Observables, especially higher-order ones? If operators are the individual words of your code paragraphs, what does a sentence-level structure look like? If we had that it might help us solve...\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"operator-soup\" href=\"#operator-soup\"\u003e\n  \u003c/a\u003e\n  Operator Soup\n\u003c/h2\u003e\n\n\u003cp\u003eThe \u003ca href=\"https://www.learnrxjs.io/learn-rxjs/recipes/swipe-to-refresh\"\u003eSwipe-To-Refresh example from LearnRxJS.io\u003c/a\u003e starts out with 19 imported operators and functions with raw RxJS. With 𝗥𝘅𝑓𝑥 you implement \u003cem\u003ethe same functionality\u003c/em\u003e with 6. That's 66% less you have to fit into your mind at once, 13 fewer operators to understand.\u003c/p\u003e\n\n\u003cp\u003eSome of this comes from demo sites wanting to show all operators in use. But it's not uncommon to find a ton of operators in real RxJS production code. While each one is purposeful, their many combinations can be confusing.\u003c/p\u003e\n\n\u003cp\u003eIf we could use fewer operators, we would have less code, and not suffer from as many...\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"errors\" href=\"#errors\"\u003e\n  \u003c/a\u003e\n  Errors\n\u003c/h2\u003e\n\n\u003cp\u003eThis is already a well covered topic, RxJS. But you already know it's a source of pain and confusion. Recent changes have helped producers interfere with each other less, but the risk of \u003ccode\u003eUnhandledRejectionError\u003c/code\u003e bringing down a process is still large. \u003c/p\u003e\n\n\u003cp\u003eWhy can't we specify 'containers' that can individually terminate on error, without risk to the overall process?\u003c/p\u003e\n\n\u003cp\u003eYou see, we need some help, RxjS.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"solution-%F0%9D%97%A5%F0%9D%98%85%F0%9D%91%93%F0%9D%91%A5\" href=\"#solution-%F0%9D%97%A5%F0%9D%98%85%F0%9D%91%93%F0%9D%91%A5\"\u003e\n  \u003c/a\u003e\n  Solution - 𝗥𝘅𝑓𝑥\n\u003c/h2\u003e\n\n\u003cp\u003eWhen a community and library are mature enough, some \"contrib\" library emerges that the community puts its best value-add goodies in. That is what 𝗥𝘅𝑓𝑥 aims to be. \u003c/p\u003e\n\n\u003cp\u003e𝗥𝘅𝑓𝑥 is RxJS \"The Good Parts\". With infinite expansion possibilities via 'raw' RxJS.\u003c/p\u003e\n\n\u003cp\u003eProblems like Confusing Docs, Observable vs Subscription Confusion, App partitioning, and Operator Soup, and even Errors are reduced when 𝗥𝘅𝑓𝑥 is your interface to RxJS. \u003c/p\u003e\n\n\u003cp\u003eThink of 𝗥𝘅𝑓𝑥 as sugar around an RxJS \u003ccode\u003eSubject\u003c/code\u003e that acts as an event bus. Each subscriber we call a \"listener\", and it is a concurrency-controlled, independent Subscription that is error-isolated from all others.\u003c/p\u003e\n\n\u003cp\u003eBasically, this means you can get more done with less skipping the several years you need to be fluent in RxJS.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"case-study-rxjs-swipetorefresh-demo\" href=\"#case-study-rxjs-swipetorefresh-demo\"\u003e\n  \u003c/a\u003e\n  Case Study— RxJS \u003ca href=\"https://stackblitz.com/edit/rxjs-refresh?devtoolsheight=40\u0026amp;file=index.ts\"\u003eSwipe-To-Refresh Demo\u003c/a\u003e\n\u003c/h2\u003e\n\n\u003cp\u003eThe \u003ca href=\"https://stackblitz.com/edit/rxjs-refresh?devtoolsheight=40\u0026amp;file=index.ts\"\u003eSwipe-To-Refresh Demo\u003c/a\u003e starts out with 19 imported operators and functions with raw RxJS. In 𝗥𝘅𝑓𝑥 - it needs only 6.\u003c/p\u003e\n\n\u003cp\u003eI'll dissect and rebuild it in my \u003ca href=\"https://dev.to/deanius/-a-productivity-layer-around-rxjs-2igi\"\u003enext post\u003c/a\u003e :)\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"links\" href=\"#links\"\u003e\n  \u003c/a\u003e\n  Links\n\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/deanrad/rxfx/tree/main/bus\"\u003e𝗥𝘅𝑓𝑥 Bus Readme\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/deanrad/rxfx-example-swipe-to-refresh-blitz/pulls\"\u003eSwipe-To-Refresh commit-by-commit\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://codesandbox.io/search?query=rxfx\u0026amp;page=1\u0026amp;configure%5BhitsPerPage%5D=12\u0026amp;refinementList%5Bnpm_dependencies.dependency%5D%5B0%5D=%40rxfx%2Fbus\u0026amp;refinementList%5Bnpm_dependencies.dependency%5D%5B1%5D=%40rxfx%2Fservice\"\u003e𝗥𝘅𝑓𝑥 Examples\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://replit.com/@deanius/Hello-World-rxfxbus#index.js\"\u003e𝗥𝘅𝑓𝑥 Minimal Repl on Repl.it\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\n\u003chr\u003e\n\n","published":true,"published_from_feed":false,"show_comments":true,"slug":"rxjs-i-have-a-bone-to-pick-with-you-31nb","social_image":null,"title":"RxJS - I Have A Bone To Pick With You","video":null,"video_code":null},{"created_at":"2022-11-13T08:38:08.531Z","crossposted_at":null,"edited_at":"2022-11-13T20:29:25.003Z","last_comment_at":"2022-11-13T08:38:08.518Z","published_at":"2022-11-13T08:38:08.518Z","canonical_url":null,"feed_source_url":null,"video_closed_caption_track_url":null,"video_source_url":null,"video_thumbnail_url":null,"body_markdown":"---\ntitle: The Radcliffe Concurrency Model\npublished: true\ndescription: A universal way of understanding how a computer resource—or person—can respond to interruption.\ntags: rxjs, rxfx, concurrency, javascript\ncover_image: https://images.unsplash.com/photo-1502144696405-e84600828d73?ixlib=rb-4.0.3\u0026ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8\u0026auto=format\u0026fit=crop\u0026w=687\u0026q=80\n---\n\nTL;DR The Radcliffe Concurrency Model is a way of understanding how a computer resource, or person responds to an interruption, which will help us understand multitasking in programming, and in life.\n\n![The Radcliffe Model of Concurrency](https://s3.amazonaws.com/www.deanius.com/RadcliffeConcurrencyModel.png)\n\nInterruptions are a fact of life. Nobody has the luxury of being able to single-task on each thing they start until its sweet completion. No— life is more like this: \n\n- Kid: \"Dad, I want a grilled cheese, please.\"\n- Dad: _starts making a grilled cheese sandwich..._\n- Kid: \"Dad, can I have chicken nuggets?\"\n\nWhen we ask what we would do as the dad, we are considering which one of our **Concurrency Strategies** should we use? We'll list these out shortly. But first - notice that although everyone makes these strategy choices - _nobody can quickly list what all the choices are!_ It's like we haven't studied this problem space well enough to pin down the options.\n\nSo we'll list the options-but first we'll see how much we need them, and how widely they apply, for developers and humans alike :)\n\n## A Lack of Shared Vocabulary Weighs Us Down\n\nIf you do something alot, it pays to have concise words to describe it. Some languages have many words for rain or snow or love. Resource schedulers like us need better conceptual tools as well.\n\nWhat I find today is that async programs —and the humans that make them— do **not** currently reflect the awareness of these modes. They seem to be a mix of defaulting into a strategy like **Immediate** , or using only what's _easiest_ in the features of our programming tools. But now, to be able to make clear, tiny-sized changes that fix timing behavior _declaratively_ is a game changer.\n\n## Interruptions Affect Computers, UX and People\n\nComputers too must decide what to do when they are busy and get a new request. A chain of coffeehouses has a Dropbox into which each coffehouse uploads its daily transactions as a CSV file. The server is now processing a file of 500 transactions, and a new, different file from the same coffeehouse gets dropped there. What should the server do?\n\nIn User Interface / UX these strategies must be chosen and used everywhere! A user begins one download while already downloading another. Or a Ring notification sound is triggered but another just started. Or a like button is clicked twice, or two like buttons in close succession. Or a remote control is slow to respond and you press the button again. _What should the app do?_\n\nFront-end development, back-end development, and every person you know depends upon selecting good Concurrency Strategies. Then, why don't we know what they are? Is there a listable set? There is, and the Radcliffe Model of Concurrency makes them available for our understanding, so that we can choose the correct one for each UX, or life situation.\n\n_(Also a JavaScript library [𝗥𝘅𝑓𝑥](https://github.com/deanrad/rxfx) makes them available to program with directly)_\n\n## Knowing Our Options is Empowering\n\nBefore they were called The Radcliffe Model, the Concurrency Strategies, _aka modes_, were cheekily called: _The 5 Kinds of Busy._ For the situation of the Dad making dinner, then given another request, the dad could:\n\n1. Start satisfying the 2nd request right away.\n1. Make it after the 1st request, to use the same pan.\n1. Stop the 1st request, make the 2nd instead.\n\nThe other two modes sound funny when applied to humans, but are still relevant sometimes!\n\n1. Ignore the 2nd request—basically the _\"Not Now\"_ response.\n1. Turn off the stove and just quit. \"I cant keep changing what I make for you— come back when you know what you want!\" (This has _never_ happened in the Radcliffe household! 😂)\n\nSo, it was out of necessity, that the Radcliffe Model was born!\n\n\n## The Radcliffe Model of Concurrency\n\nThe modes in the Radcliffe Model, in English are:\n\n- **Immediate**\n- **Queueing**\n- **Replacing**\n- **Blocking**\n- **Toggling**\n\n![The Radcliffe Model of Concurrency](https://s3.amazonaws.com/www.deanius.com/RadcliffeConcurrencyModel.png)\n\nI recognize these might not be the names you'd call these - you may have used `serial` and `parallel`, for either of the top 2 modes. Fine! But the value is not in what they are called, but the fact _that they are known as an entire set._ \n\nSometimes, trying to fulfill every request of you, as **Immediate** and **Queueing** modes do - stretches resources too thin. The **Blocking** mode may smartly reduce concurrency by favoring a prior request, just as an elevator that is already requested does nothing on subsequent calls to the same floor. The **Replacing** mode is seen in how one video playing replaces another when we browse a social site, or how your session timeout keeps starting over after activity. And **Toggling** is what a one-button power switch does - more on **Toggling** later.\n\nThe reason to learn this model is that getting a computer program, UX, or human behavior to be correct is often done simply by _choosing the best mode from the list!_\n\nI'll save an elaboration and derivation of each mode for another article. The graphic arranges them spatially to show how they relate, and at the end of the article are some trading-card-style images you can even print as a reference! (And play Oblique Strategies with them if you like) \n\n## Yes, Toggling is a Real Thing!\n\nSome of you inquire why **Toggling** is in this list, since it's actually a failure to do anything concurrent. That's true. Yet still - sometimes it is the called-for response to an interruption.\n\nSometimes the presence of a 2nd request - like a second nightly file put into the Dropbox on the same night - indicates an exception or error condition.\n\n**Toggle** and kin are analyzed more in the next post\n\n## Go Forth and Be Concurrent!\n\nYou can use this model to further your or your colleagues' understandings of multitasking strategies. Or if you program asynchronous systems like User Interfaces, you can use [𝗥𝘅𝑓𝑥](https://github.com/deanrad/rxfx/tree/main/bus), to have the easiest, framework-free async programming experience you could have.\n\nTo share it, just consult the [Attribution-Share-alike license](https://creativecommons.org/licenses/by-sa/4.0/), which generally says it is free to share,provided you attribute the author and maintain the same terms.\n\nFolks with translation skills - would you propose your languages' names for the modes in the comments?\n\nThanks, I'd love to hear how you've found this model to apply to you!\n\nDean Radcliffe ([@DeanDevDad](https://twitter.com/DeanDevDad))\n\n---\n\n![RxFx Strategy Cards](https://s3.amazonaws.com/www.deanius.com/cards-4-icons.png)","cached_tag_list":"rxjs, rxfx, concurrency, javascript","cached_user_name":"Dean Radcliffe","cached_user_username":"deanius","comments_count":0,"description":"A universal way of understanding how a computer resource—or person—can respond to interruption.","main_image":"https://images.unsplash.com/photo-1502144696405-e84600828d73?ixlib=rb-4.0.3\u0026ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8\u0026auto=format\u0026fit=crop\u0026w=687\u0026q=80","main_image_background_hex_color":"#dddddd","path":"/deanius/the-radcliffe-concurrency-model-3ll8","public_reactions_count":3,"processed_html":"\u003cp\u003eTL;DR The Radcliffe Concurrency Model is a way of understanding how a computer resource, or person responds to an interruption, which will help us understand multitasking in programming, and in life.\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--oMfNCFzo--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://s3.amazonaws.com/www.deanius.com/RadcliffeConcurrencyModel.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--oMfNCFzo--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://s3.amazonaws.com/www.deanius.com/RadcliffeConcurrencyModel.png\" alt=\"The Radcliffe Model of Concurrency\" loading=\"lazy\" width=\"880\" height=\"810\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eInterruptions are a fact of life. Nobody has the luxury of being able to single-task on each thing they start until its sweet completion. No— life is more like this: \u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eKid: \"Dad, I want a grilled cheese, please.\"\u003c/li\u003e\n\u003cli\u003eDad: \u003cem\u003estarts making a grilled cheese sandwich...\u003c/em\u003e\n\u003c/li\u003e\n\u003cli\u003eKid: \"Dad, can I have chicken nuggets?\"\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eWhen we ask what we would do as the dad, we are considering which one of our \u003cstrong\u003eConcurrency Strategies\u003c/strong\u003e should we use? We'll list these out shortly. But first - notice that although everyone makes these strategy choices - \u003cem\u003enobody can quickly list what all the choices are!\u003c/em\u003e It's like we haven't studied this problem space well enough to pin down the options.\u003c/p\u003e\n\n\u003cp\u003eSo we'll list the options-but first we'll see how much we need them, and how widely they apply, for developers and humans alike :)\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"a-lack-of-shared-vocabulary-weighs-us-down\" href=\"#a-lack-of-shared-vocabulary-weighs-us-down\"\u003e\n  \u003c/a\u003e\n  A Lack of Shared Vocabulary Weighs Us Down\n\u003c/h2\u003e\n\n\u003cp\u003eIf you do something alot, it pays to have concise words to describe it. Some languages have many words for rain or snow or love. Resource schedulers like us need better conceptual tools as well.\u003c/p\u003e\n\n\u003cp\u003eWhat I find today is that async programs —and the humans that make them— do \u003cstrong\u003enot\u003c/strong\u003e currently reflect the awareness of these modes. They seem to be a mix of defaulting into a strategy like \u003cstrong\u003eImmediate\u003c/strong\u003e , or using only what's \u003cem\u003eeasiest\u003c/em\u003e in the features of our programming tools. But now, to be able to make clear, tiny-sized changes that fix timing behavior \u003cem\u003edeclaratively\u003c/em\u003e is a game changer.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"interruptions-affect-computers-ux-and-people\" href=\"#interruptions-affect-computers-ux-and-people\"\u003e\n  \u003c/a\u003e\n  Interruptions Affect Computers, UX and People\n\u003c/h2\u003e\n\n\u003cp\u003eComputers too must decide what to do when they are busy and get a new request. A chain of coffeehouses has a Dropbox into which each coffehouse uploads its daily transactions as a CSV file. The server is now processing a file of 500 transactions, and a new, different file from the same coffeehouse gets dropped there. What should the server do?\u003c/p\u003e\n\n\u003cp\u003eIn User Interface / UX these strategies must be chosen and used everywhere! A user begins one download while already downloading another. Or a Ring notification sound is triggered but another just started. Or a like button is clicked twice, or two like buttons in close succession. Or a remote control is slow to respond and you press the button again. \u003cem\u003eWhat should the app do?\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003eFront-end development, back-end development, and every person you know depends upon selecting good Concurrency Strategies. Then, why don't we know what they are? Is there a listable set? There is, and the Radcliffe Model of Concurrency makes them available for our understanding, so that we can choose the correct one for each UX, or life situation.\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003e(Also a JavaScript library \u003ca href=\"https://github.com/deanrad/rxfx\"\u003e𝗥𝘅𝑓𝑥\u003c/a\u003e makes them available to program with directly)\u003c/em\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"knowing-our-options-is-empowering\" href=\"#knowing-our-options-is-empowering\"\u003e\n  \u003c/a\u003e\n  Knowing Our Options is Empowering\n\u003c/h2\u003e\n\n\u003cp\u003eBefore they were called The Radcliffe Model, the Concurrency Strategies, \u003cem\u003eaka modes\u003c/em\u003e, were cheekily called: \u003cem\u003eThe 5 Kinds of Busy.\u003c/em\u003e For the situation of the Dad making dinner, then given another request, the dad could:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eStart satisfying the 2nd request right away.\u003c/li\u003e\n\u003cli\u003eMake it after the 1st request, to use the same pan.\u003c/li\u003e\n\u003cli\u003eStop the 1st request, make the 2nd instead.\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eThe other two modes sound funny when applied to humans, but are still relevant sometimes!\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eIgnore the 2nd request—basically the \u003cem\u003e\"Not Now\"\u003c/em\u003e response.\u003c/li\u003e\n\u003cli\u003eTurn off the stove and just quit. \"I cant keep changing what I make for you— come back when you know what you want!\" (This has \u003cem\u003enever\u003c/em\u003e happened in the Radcliffe household! 😂)\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eSo, it was out of necessity, that the Radcliffe Model was born!\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"the-radcliffe-model-of-concurrency\" href=\"#the-radcliffe-model-of-concurrency\"\u003e\n  \u003c/a\u003e\n  The Radcliffe Model of Concurrency\n\u003c/h2\u003e\n\n\u003cp\u003eThe modes in the Radcliffe Model, in English are:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eImmediate\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eQueueing\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eReplacing\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eBlocking\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eToggling\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--oMfNCFzo--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://s3.amazonaws.com/www.deanius.com/RadcliffeConcurrencyModel.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--oMfNCFzo--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://s3.amazonaws.com/www.deanius.com/RadcliffeConcurrencyModel.png\" alt=\"The Radcliffe Model of Concurrency\" loading=\"lazy\" width=\"880\" height=\"810\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eI recognize these might not be the names you'd call these - you may have used \u003ccode\u003eserial\u003c/code\u003e and \u003ccode\u003eparallel\u003c/code\u003e, for either of the top 2 modes. Fine! But the value is not in what they are called, but the fact \u003cem\u003ethat they are known as an entire set.\u003c/em\u003e \u003c/p\u003e\n\n\u003cp\u003eSometimes, trying to fulfill every request of you, as \u003cstrong\u003eImmediate\u003c/strong\u003e and \u003cstrong\u003eQueueing\u003c/strong\u003e modes do - stretches resources too thin. The \u003cstrong\u003eBlocking\u003c/strong\u003e mode may smartly reduce concurrency by favoring a prior request, just as an elevator that is already requested does nothing on subsequent calls to the same floor. The \u003cstrong\u003eReplacing\u003c/strong\u003e mode is seen in how one video playing replaces another when we browse a social site, or how your session timeout keeps starting over after activity. And \u003cstrong\u003eToggling\u003c/strong\u003e is what a one-button power switch does - more on \u003cstrong\u003eToggling\u003c/strong\u003e later.\u003c/p\u003e\n\n\u003cp\u003eThe reason to learn this model is that getting a computer program, UX, or human behavior to be correct is often done simply by \u003cem\u003echoosing the best mode from the list!\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003eI'll save an elaboration and derivation of each mode for another article. The graphic arranges them spatially to show how they relate, and at the end of the article are some trading-card-style images you can even print as a reference! (And play Oblique Strategies with them if you like) \u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"yes-toggling-is-a-real-thing\" href=\"#yes-toggling-is-a-real-thing\"\u003e\n  \u003c/a\u003e\n  Yes, Toggling is a Real Thing!\n\u003c/h2\u003e\n\n\u003cp\u003eSome of you inquire why \u003cstrong\u003eToggling\u003c/strong\u003e is in this list, since it's actually a failure to do anything concurrent. That's true. Yet still - sometimes it is the called-for response to an interruption.\u003c/p\u003e\n\n\u003cp\u003eSometimes the presence of a 2nd request - like a second nightly file put into the Dropbox on the same night - indicates an exception or error condition.\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eToggle\u003c/strong\u003e and kin are analyzed more in the next post\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"go-forth-and-be-concurrent\" href=\"#go-forth-and-be-concurrent\"\u003e\n  \u003c/a\u003e\n  Go Forth and Be Concurrent!\n\u003c/h2\u003e\n\n\u003cp\u003eYou can use this model to further your or your colleagues' understandings of multitasking strategies. Or if you program asynchronous systems like User Interfaces, you can use \u003ca href=\"https://github.com/deanrad/rxfx/tree/main/bus\"\u003e𝗥𝘅𝑓𝑥\u003c/a\u003e, to have the easiest, framework-free async programming experience you could have.\u003c/p\u003e\n\n\u003cp\u003eTo share it, just consult the \u003ca href=\"https://creativecommons.org/licenses/by-sa/4.0/\"\u003eAttribution-Share-alike license\u003c/a\u003e, which generally says it is free to share,provided you attribute the author and maintain the same terms.\u003c/p\u003e\n\n\u003cp\u003eFolks with translation skills - would you propose your languages' names for the modes in the comments?\u003c/p\u003e\n\n\u003cp\u003eThanks, I'd love to hear how you've found this model to apply to you!\u003c/p\u003e\n\n\u003cp\u003eDean Radcliffe (\u003ca href=\"https://twitter.com/DeanDevDad\"\u003e@DeanDevDad\u003c/a\u003e)\u003c/p\u003e\n\n\n\u003chr\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--sXhucT2P--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://s3.amazonaws.com/www.deanius.com/cards-4-icons.png\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--sXhucT2P--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://s3.amazonaws.com/www.deanius.com/cards-4-icons.png\" alt=\"RxFx Strategy Cards\" loading=\"lazy\" width=\"880\" height=\"838\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n","published":true,"published_from_feed":false,"show_comments":true,"slug":"the-radcliffe-concurrency-model-3ll8","social_image":null,"title":"The Radcliffe Concurrency Model","video":null,"video_code":null},{"created_at":"2023-02-22T17:40:29.238Z","crossposted_at":null,"edited_at":null,"last_comment_at":"2023-03-17T19:45:28.488Z","published_at":"2023-03-17T19:45:28.488Z","canonical_url":null,"feed_source_url":null,"video_closed_caption_track_url":null,"video_source_url":null,"video_thumbnail_url":null,"body_markdown":"---\ntitle: Excellent Effect Management in React with 𝗥𝘅𝑓𝑥 and RxJS \npublished: true\ndescription: Learn How To Manage Effects with 𝗥𝘅𝑓𝑥, and Have a Framework-Independent Toolkit for Top-Notch UX\ntags: rxjs, rxfx, javascript, react\ncover_image: https://images.unsplash.com/photo-1574720187210-421b34c9cf01?ixlib=rb-1.2.1\u0026raw_url=true\u0026q=80\u0026fm=jpg\u0026crop=entropy\u0026cs=tinysrgb\u0026ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8\u0026auto=format\u0026fit=crop\u0026w=1064\n\n# Use a ratio of 100:42 for best results.\n# published_at: 2023-02-22 16:27 +0000\n---\n\nIn [Part 1](https://dev.to/deanius/how-an-interview-convinced-me-to-use-an-event-bus-for-rxjs-in-react-396l), I'd shared an interview that opened my mind to how, and why, to use 𝗥𝘅𝑓𝑥 in React. \n\nIn this final installment part we take the UX of the Cat Fetcher to the extreme by adding these features:\n\n- Preload images as a chained part of the `gifService`.\n- Cancel an image preload when canceled.\n- Send out Analytics events, without coupling to existing code.\n- Apply a timeout to the Ajax load and overall load. \n- Pad the loading spinner to a minimum duration.\n\nWe'll even build a cancelable image preloader along the way. So let's dive right in!\n\n---\n\n## Chained Loading Of the Image Bytes\n\nThere was an issue with our service. `isActive` would become `false` at the time where we knew the URL of the cat image-  but didn't yet have its bytes:\n\n![loading indicator analysis](https://s3.amazonaws.com/www.deanius.com/cat-loading-analysis.jpg)\n\nThis led to the loading indicator turning off, and the UI looks like it's doing nothing - until the image bytes arrive. And that image could take a while to load, if over a slow pipe!\n\n![template with loading state, with delay](https://s3.amazonaws.com/www.deanius.com/cat-loading-delay.gif)\n\n\n## Image Preloading\n\nThis old trick always worked to preload an image:\n\n```js\nfunction preloadImage(url) {\n  return new Promise((resolve) =\u003e {\n    const img = new Image();\n    img.onload = () =\u003e resolve(url);\n    img.src = url;\n  });\n}\n```\n\nThis is a Promise-returning function that resolves (with the img `url`) only once the image has loaded. Perfect! But how would we chain/compose that with the Observable? Simple - one line, like this:\n\n```diff\n  return\n     ajax.getJSON(\"https://api.thecatapi.com/v1/images/search\", {...})\n     .pipe(\n        map((data) =\u003e data[0].url),\n+        mergeMap(preloadImage)\n     );\n```\n\nPerfect! We've used the fact that a function which returns `Promise\u003cstring\u003e` can be composed onto an Observable with `mergeMap` - because a `Promise\u003cstring\u003e` is a subset of an `ObservableInput\u003cstring\u003e`. That's all we needed.\n\nBut for comparison purposes, and to get ready for cancelation, let's return an Observable instead:\n\n```js\nfunction preloadImage(url) {\n  return new Observable((notify) =\u003e {\n    const img = new Image();\n    img.onload = () =\u003e {\n      notify.next(url);\n      notify.complete();\n    };\n    img.src = url;\n  };\n};\n```\n\nSo we change our Promise-returning function into an Observable-returning one - sending out a single `next` notification (like a Promise's singular resolution) - followed by a single `complete` notification. Now we're ready for cancelation.\n\n## Cancelation\n\nThis chaining, or 'composition', is convenient, but not yet optimal. If a cancelation occurs while the image bytes are loading  - the loading of the image itself is not canceled. \n\n![not canceled](https://camo.githubusercontent.com/848f567ba25b79138ef70b1d7c7139645544ee3fc617d7adc13ffc4ddd0db617/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f7777772e6465616e6975732e636f6d2f6361742d726571756573742d32782d756e6d6f756e742d776974682d6c65616b732e676966)\n\nThe strength of the Observable is you can define one with any arbitrary cleanup/cancelation logic. For example, we started loading the gif into the DOM when we set the `src` property of an Image element. We could cancel the DOM's loading by switching the `src` property to an image that doesn't need downloading. The DOM would then cancel itself..\n\nLastly return a cancelation function:\n\n```diff\nfunction preloadImage(url) {\n  return new Observable((notify) =\u003e {\n    const img = new Image();\n    img.onload = () =\u003e {\n      notify.next(url);\n      notify.complete();\n    };\n    img.src = url;\n+\n+   return () =\u003e img.src = \"data:image/gif;base64,R0lGOD...Ow==\";\n  };\n};\n```\n\nNow, even when cancelation occurs during image bytes downloading, the Observable teardown can stop it mid-request! Cool and performant!\n\n![Cancelable Image Download](https://camo.githubusercontent.com/9ba133a6ba0b9fd0577fdadb87e43d0dc7e25ebf11fe8f63ef3bb7088f69478a/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f7777772e6465616e6975732e636f6d2f6361742d696d6167652d726571756573742d756e6d6f756e742d63616e63656c2d73746174657265636c61696d2e676966)\n\n## Other Subscribers - Analytics\n\nNow, a request arrives that we log clicks to the Analytics Service whenever the Fetch Cat button is pressed.\n\nYou might be wondering now whether the UI `onClick` handler, or the `gifService` Observable ought to change. 𝗥𝘅𝑓𝑥 says - change neither, they're done already! \n\nHandle it by observing the service's requests, and fiting off there:\n\n\n```js\nconst analyticsSender = gifService.observe({\n  request(){ logAnalytics('fetch cat clicked') }\n})\n// to turn off\n// analyticsSender.unsubscribe();\n```\n\nFor light-weight fire-and-forget functions you don't need to chain or concurrency-control, this mechanism will decouple sections of your codebase, and allow you to keep the code intact (and tests!) of existing components.\n\n## Timeouts\n\nUsers don't want to wait forever without feedback, and even a spinner gets old. In [this post](https://dev.to/deanius/the-thresholds-of-perception-in-ux-435g), I set out some thresholds that are handy to reference in timing constants - they are published in the `@rxfx/perception` library. Whatever values we choose, we need to pass them into code somewhere, and there are a few places this may happen.\n\nFor the AJAX to get the URL of the next cat image, we can specify a timeout directly in its options:\n\n```diff\nfunction fetchRandomGIF() {\n  return ajax({\n    url: \"https://api.thecatapi.com/v1/images/search\",\n+    timeout: TIMEOUTS.URL\n  }).pipe(\n```\n\nThe `gifService` will trigger a `gif/error` to the bus if it fails to get the url within that timeout. \n\nBut we must ask if overall our `gif/request` handler might exceed the user's patience. For that, we can wrap the handler in a `withTimeout` modifier from `@rxfx/service`.\n\n```diff\nexport const gifService = createQueueingService(\n  \"gif\", // namespace for actions requested,started,next,complete,error,etc\n  bus, // bus to read consequences and requests from\n-  fetchRandomGIF,\n+  timeoutHandler({ duration: TIMEOUTS.OVERALL }, fetchRandomGIF),\n  (ACTIONS) =\u003e gifReducer(ACTIONS) // the reducer to aggregate non-transient state\n);\n\n```\n\nThis way, our `gif/error` bus message and `currentError` property of the service will contain information about the timeout.\n\n## Fine-Tune Timing\n\nSo we handled what happens when the connection is too slow - and we ensured that users get feedback rather than wait forever. But can it ever trouble users if their connection is too fast? Imagine - a user performs 3 quick clicks to queue up 3 kitty downloads - and they could be displayed, and gone before they have a chance to be admired if they download too fast. Here we can pad the download with just another RxJS operator:\n\n```diff\nfunction fetchRandomGIF() {\n  return ajax({\n    url: \"https://api.thecatapi.com/v1/images/search\",\n    timeout: TIMEOUTS.URL\n  }).pipe(\n    mergeMap(preloadImage),\n+   padToTime(TIMEOUTS.KITTY_MINIMUM)\n  )\n}\n```\n\nWhile we may decide this amount of padding isn't necessary in every app, for these cute kitties it's probably worth it 😀 🐈 The lesson, of course, is that any RxJS or 𝗥𝘅𝑓𝑥 operator can be used to modify timing with usually no change to surrounding code - whether it's for timeout or time padding. This lets our UX be more intentional in its experience, and less vulnerable to random network conditions.\n\n----\n\n## Conclusion\n\nIf there's one thing this code example showed, it's that there's never anything as simple as 'async data fetching'. Timing, timeouts, cancelation, and chained and related effects are requirements that swiftly come on the heels of making a simple `fetch`. Excellence in UX depends upon handling these 'edge cases' in the very core of your product.\n\n𝗥𝘅𝑓𝑥 has the features you need so that the app can scale in functionality without ballooning in complexity.","cached_tag_list":"rxjs, rxfx, javascript, react","cached_user_name":"Dean Radcliffe","cached_user_username":"deanius","comments_count":0,"description":"Learn How To Manage Effects with 𝗥𝘅𝑓𝑥, and Have a Framework-Independent Toolkit for Top-Notch UX","main_image":"https://images.unsplash.com/photo-1574720187210-421b34c9cf01?ixlib=rb-1.2.1\u0026raw_url=true\u0026q=80\u0026fm=jpg\u0026crop=entropy\u0026cs=tinysrgb\u0026ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8\u0026auto=format\u0026fit=crop\u0026w=1064","main_image_background_hex_color":"#dddddd","path":"/deanius/excellent-effect-management-in-react-with-and-rxjs-35cn","public_reactions_count":0,"processed_html":"\u003cp\u003eIn \u003ca href=\"https://dev.to/deanius/how-an-interview-convinced-me-to-use-an-event-bus-for-rxjs-in-react-396l\"\u003ePart 1\u003c/a\u003e, I'd shared an interview that opened my mind to how, and why, to use 𝗥𝘅𝑓𝑥 in React. \u003c/p\u003e\n\n\u003cp\u003eIn this final installment part we take the UX of the Cat Fetcher to the extreme by adding these features:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003ePreload images as a chained part of the \u003ccode\u003egifService\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003eCancel an image preload when canceled.\u003c/li\u003e\n\u003cli\u003eSend out Analytics events, without coupling to existing code.\u003c/li\u003e\n\u003cli\u003eApply a timeout to the Ajax load and overall load. \u003c/li\u003e\n\u003cli\u003ePad the loading spinner to a minimum duration.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eWe'll even build a cancelable image preloader along the way. So let's dive right in!\u003c/p\u003e\n\n\n\u003chr\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"chained-loading-of-the-image-bytes\" href=\"#chained-loading-of-the-image-bytes\"\u003e\n  \u003c/a\u003e\n  Chained Loading Of the Image Bytes\n\u003c/h2\u003e\n\n\u003cp\u003eThere was an issue with our service. \u003ccode\u003eisActive\u003c/code\u003e would become \u003ccode\u003efalse\u003c/code\u003e at the time where we knew the URL of the cat image-  but didn't yet have its bytes:\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fs3.amazonaws.com%2Fwww.deanius.com%2Fcat-loading-analysis.jpg\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fs3.amazonaws.com%2Fwww.deanius.com%2Fcat-loading-analysis.jpg\" alt=\"loading indicator analysis\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eThis led to the loading indicator turning off, and the UI looks like it's doing nothing - until the image bytes arrive. And that image could take a while to load, if over a slow pipe!\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fs3.amazonaws.com%2Fwww.deanius.com%2Fcat-loading-delay.gif\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://media.dev.to/dynamic/image/width=800%2Cheight=%2Cfit=scale-down%2Cgravity=auto%2Cformat=auto/https%3A%2F%2Fs3.amazonaws.com%2Fwww.deanius.com%2Fcat-loading-delay.gif\" alt=\"template with loading state, with delay\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"image-preloading\" href=\"#image-preloading\"\u003e\n  \u003c/a\u003e\n  Image Preloading\n\u003c/h2\u003e\n\n\u003cp\u003eThis old trick always worked to preload an image:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003epreloadImage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nc\"\u003ePromise\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"nx\"\u003eresolve\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eimg\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nc\"\u003eImage\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eonload\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nf\"\u003eresolve\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esrc\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eThis is a Promise-returning function that resolves (with the img \u003ccode\u003eurl\u003c/code\u003e) only once the image has loaded. Perfect! But how would we chain/compose that with the Observable? Simple - one line, like this:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight diff\"\u003e\u003ccode\u003e  return\n     ajax.getJSON(\"https://api.thecatapi.com/v1/images/search\", {...})\n     .pipe(\n        map((data) =\u0026gt; data[0].url),\n\u003cspan class=\"gi\"\u003e+        mergeMap(preloadImage)\n\u003c/span\u003e     );\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003ePerfect! We've used the fact that a function which returns \u003ccode\u003ePromise\u0026lt;string\u0026gt;\u003c/code\u003e can be composed onto an Observable with \u003ccode\u003emergeMap\u003c/code\u003e - because a \u003ccode\u003ePromise\u0026lt;string\u0026gt;\u003c/code\u003e is a subset of an \u003ccode\u003eObservableInput\u0026lt;string\u0026gt;\u003c/code\u003e. That's all we needed.\u003c/p\u003e\n\n\u003cp\u003eBut for comparison purposes, and to get ready for cancelation, let's return an Observable instead:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nf\"\u003epreloadImage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nc\"\u003eObservable\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"nx\"\u003enotify\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eimg\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nc\"\u003eImage\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eonload\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003enotify\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003enext\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003enotify\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ecomplete\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eimg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esrc\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eurl\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eSo we change our Promise-returning function into an Observable-returning one - sending out a single \u003ccode\u003enext\u003c/code\u003e notification (like a Promise's singular resolution) - followed by a single \u003ccode\u003ecomplete\u003c/code\u003e notification. Now we're ready for cancelation.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"cancelation\" href=\"#cancelation\"\u003e\n  \u003c/a\u003e\n  Cancelation\n\u003c/h2\u003e\n\n\u003cp\u003eThis chaining, or 'composition', is convenient, but not yet optimal. If a cancelation occurs while the image bytes are loading  - the loading of the image itself is not canceled. \u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.githubusercontent.com/848f567ba25b79138ef70b1d7c7139645544ee3fc617d7adc13ffc4ddd0db617/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f7777772e6465616e6975732e636f6d2f6361742d726571756573742d32782d756e6d6f756e742d776974682d6c65616b732e676966\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://camo.githubusercontent.com/848f567ba25b79138ef70b1d7c7139645544ee3fc617d7adc13ffc4ddd0db617/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f7777772e6465616e6975732e636f6d2f6361742d726571756573742d32782d756e6d6f756e742d776974682d6c65616b732e676966\" alt=\"not canceled\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eThe strength of the Observable is you can define one with any arbitrary cleanup/cancelation logic. For example, we started loading the gif into the DOM when we set the \u003ccode\u003esrc\u003c/code\u003e property of an Image element. We could cancel the DOM's loading by switching the \u003ccode\u003esrc\u003c/code\u003e property to an image that doesn't need downloading. The DOM would then cancel itself..\u003c/p\u003e\n\n\u003cp\u003eLastly return a cancelation function:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight diff\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003efunction preloadImage(url) {\n\u003c/span\u003e  return new Observable((notify) =\u0026gt; {\n    const img = new Image();\n    img.onload = () =\u0026gt; {\n      notify.next(url);\n      notify.complete();\n    };\n    img.src = url;\n\u003cspan class=\"gi\"\u003e+\n+   return () =\u0026gt; img.src = \"data:image/gif;base64,R0lGOD...Ow==\";\n\u003c/span\u003e  };\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eNow, even when cancelation occurs during image bytes downloading, the Observable teardown can stop it mid-request! Cool and performant!\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.githubusercontent.com/9ba133a6ba0b9fd0577fdadb87e43d0dc7e25ebf11fe8f63ef3bb7088f69478a/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f7777772e6465616e6975732e636f6d2f6361742d696d6167652d726571756573742d756e6d6f756e742d63616e63656c2d73746174657265636c61696d2e676966\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://camo.githubusercontent.com/9ba133a6ba0b9fd0577fdadb87e43d0dc7e25ebf11fe8f63ef3bb7088f69478a/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f7777772e6465616e6975732e636f6d2f6361742d696d6167652d726571756573742d756e6d6f756e742d63616e63656c2d73746174657265636c61696d2e676966\" alt=\"Cancelable Image Download\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"other-subscribers-analytics\" href=\"#other-subscribers-analytics\"\u003e\n  \u003c/a\u003e\n  Other Subscribers - Analytics\n\u003c/h2\u003e\n\n\u003cp\u003eNow, a request arrives that we log clicks to the Analytics Service whenever the Fetch Cat button is pressed.\u003c/p\u003e\n\n\u003cp\u003eYou might be wondering now whether the UI \u003ccode\u003eonClick\u003c/code\u003e handler, or the \u003ccode\u003egifService\u003c/code\u003e Observable ought to change. 𝗥𝘅𝑓𝑥 says - change neither, they're done already! \u003c/p\u003e\n\n\u003cp\u003eHandle it by observing the service's requests, and fiting off there:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eanalyticsSender\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003egifService\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eobserve\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e\n  \u003cspan class=\"nf\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e(){\u003c/span\u003e \u003cspan class=\"nf\"\u003elogAnalytics\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003efetch cat clicked\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// to turn off\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// analyticsSender.unsubscribe();\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eFor light-weight fire-and-forget functions you don't need to chain or concurrency-control, this mechanism will decouple sections of your codebase, and allow you to keep the code intact (and tests!) of existing components.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"timeouts\" href=\"#timeouts\"\u003e\n  \u003c/a\u003e\n  Timeouts\n\u003c/h2\u003e\n\n\u003cp\u003eUsers don't want to wait forever without feedback, and even a spinner gets old. In \u003ca href=\"https://dev.to/deanius/the-thresholds-of-perception-in-ux-435g\"\u003ethis post\u003c/a\u003e, I set out some thresholds that are handy to reference in timing constants - they are published in the \u003ccode\u003e@rxfx/perception\u003c/code\u003e library. Whatever values we choose, we need to pass them into code somewhere, and there are a few places this may happen.\u003c/p\u003e\n\n\u003cp\u003eFor the AJAX to get the URL of the next cat image, we can specify a timeout directly in its options:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight diff\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003efunction fetchRandomGIF() {\n\u003c/span\u003e  return ajax({\n    url: \"https://api.thecatapi.com/v1/images/search\",\n\u003cspan class=\"gi\"\u003e+    timeout: TIMEOUTS.URL\n\u003c/span\u003e  }).pipe(\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eThe \u003ccode\u003egifService\u003c/code\u003e will trigger a \u003ccode\u003egif/error\u003c/code\u003e to the bus if it fails to get the url within that timeout. \u003c/p\u003e\n\n\u003cp\u003eBut we must ask if overall our \u003ccode\u003egif/request\u003c/code\u003e handler might exceed the user's patience. For that, we can wrap the handler in a \u003ccode\u003ewithTimeout\u003c/code\u003e modifier from \u003ccode\u003e@rxfx/service\u003c/code\u003e.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight diff\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003eexport const gifService = createQueueingService(\n\u003c/span\u003e  \"gif\", // namespace for actions requested,started,next,complete,error,etc\n  bus, // bus to read consequences and requests from\n\u003cspan class=\"gd\"\u003e-  fetchRandomGIF,\n\u003c/span\u003e\u003cspan class=\"gi\"\u003e+  timeoutHandler({ duration: TIMEOUTS.OVERALL }, fetchRandomGIF),\n\u003c/span\u003e  (ACTIONS) =\u0026gt; gifReducer(ACTIONS) // the reducer to aggregate non-transient state\n);\n\u003cspan class=\"err\"\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eThis way, our \u003ccode\u003egif/error\u003c/code\u003e bus message and \u003ccode\u003ecurrentError\u003c/code\u003e property of the service will contain information about the timeout.\u003c/p\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"finetune-timing\" href=\"#finetune-timing\"\u003e\n  \u003c/a\u003e\n  Fine-Tune Timing\n\u003c/h2\u003e\n\n\u003cp\u003eSo we handled what happens when the connection is too slow - and we ensured that users get feedback rather than wait forever. But can it ever trouble users if their connection is too fast? Imagine - a user performs 3 quick clicks to queue up 3 kitty downloads - and they could be displayed, and gone before they have a chance to be admired if they download too fast. Here we can pad the download with just another RxJS operator:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight diff\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003efunction fetchRandomGIF() {\n\u003c/span\u003e  return ajax({\n    url: \"https://api.thecatapi.com/v1/images/search\",\n    timeout: TIMEOUTS.URL\n  }).pipe(\n    mergeMap(preloadImage),\n\u003cspan class=\"gi\"\u003e+   padToTime(TIMEOUTS.KITTY_MINIMUM)\n\u003c/span\u003e  )\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eWhile we may decide this amount of padding isn't necessary in every app, for these cute kitties it's probably worth it 😀 🐈 The lesson, of course, is that any RxJS or 𝗥𝘅𝑓𝑥 operator can be used to modify timing with usually no change to surrounding code - whether it's for timeout or time padding. This lets our UX be more intentional in its experience, and less vulnerable to random network conditions.\u003c/p\u003e\n\n\n\u003chr\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"conclusion\" href=\"#conclusion\"\u003e\n  \u003c/a\u003e\n  Conclusion\n\u003c/h2\u003e\n\n\u003cp\u003eIf there's one thing this code example showed, it's that there's never anything as simple as 'async data fetching'. Timing, timeouts, cancelation, and chained and related effects are requirements that swiftly come on the heels of making a simple \u003ccode\u003efetch\u003c/code\u003e. Excellence in UX depends upon handling these 'edge cases' in the very core of your product.\u003c/p\u003e\n\n\u003cp\u003e𝗥𝘅𝑓𝑥 has the features you need so that the app can scale in functionality without ballooning in complexity.\u003c/p\u003e\n\n","published":true,"published_from_feed":false,"show_comments":true,"slug":"excellent-effect-management-in-react-with-and-rxjs-35cn","social_image":null,"title":"Excellent Effect Management in React with 𝗥𝘅𝑓𝑥 and RxJS","video":null,"video_code":null},{"created_at":"2023-03-20T17:45:01.180Z","crossposted_at":null,"edited_at":"2023-03-20T18:17:25.852Z","last_comment_at":"2023-03-20T18:14:06.331Z","published_at":"2023-03-20T18:14:06.331Z","canonical_url":null,"feed_source_url":null,"video_closed_caption_track_url":null,"video_source_url":null,"video_thumbnail_url":null,"body_markdown":"---\ntitle: How to use 𝗥𝘅𝑓𝑥 for a realistic user-typing simulation.\npublished: true\ndescription: A little math can simulate user interaction more accurately, with @rxfx/perception.\ntags: rxfx, RxJS, statistics\ncover_image: https://images.unsplash.com/photo-1634834787429-54f833042098?ixlib=rb-4.0.3\u0026ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8\u0026auto=format\u0026fit=crop\u0026w=2070\u0026q=80\n---\n\nHere we will use a couple of components from the 𝗥𝘅𝑓𝑥 toolkit to write some text into a textarea, much as a user would fill out a form.\n\nIf we use a library like `@testing-library/user-event`, we can automate typing into a field with a configurable delay between characters. However, real users don't type this way, they type in spurts, like this:\n\n![Realistic typing](https://dev-to-uploads.s3.amazonaws.com/uploads/articles/93n2mv1kv2yzf0sdox5f.gif)\n\nFilling out a form in a randomized way  will stress-test your form more realistically - some of the time (about 1/6 of the time) your user's consecutive key presses will be half the average duration. Particularly if you are using React controlled inputs, this can reveal stutter in the system that you would not have known about. Also, I find that lorem ipsum text is more pleasurable to see typed with randomized timing than at a uniform rate! But importantly, we don't want total randomness - we want it to hover *around* a certain given amount. \n\nSo let's bring together a few 𝗥𝘅𝑓𝑥 tools together in order to pull this off, we will:\n\n- Use a bus, typed for character events.\n- Trigger character events from a source text.\n- Create a listener that returns a time-deferred typing from a character event\n- Allow the bus to execute and sequence those time-deferred typings\n- Randomize the time amounts\n\nIn the final step, the code will change only by one line in order to switch to random from not random! Let's dive right in!\n\n[See the CodeSandbox](https://codesandbox.io/s/rxfx-example-poisson-process-typing-hncrl0)\n\nFirst, we can type the `defaultBus` from `@rxfx/bus`.\n\n```ts\nimport { defaultBus, Bus } from \"@rxfx/bus\";\nconst bus = defaultBus as Bus\u003cstring\u003e;\n```\n\nNext we'll use a good old-fashioned `for` loop to trigger an event for each character:\n\n```ts\nfor (let i = 0; i \u003c srcText?.length; i++) {\n  bus.trigger(srcText?.charAt(i));\n}\n```\n\nBuilding the listener will be tricky - first we know we can't have overlapping character typings - we want them serially. So we will create our listener with `bus.listenQueueing`. What will we return? We could have written any delayed Promise function and that would work, but the 𝗥𝘅𝑓𝑥 utility `after` is designed just for that.\n\n```ts\nimport { after } from \"@rxfx/after\";\n\nconst typer = bus.listenQueueing(\n  () =\u003e true, \n  (char) =\u003e {\n    return after(AVERAGE_DELAY, () =\u003e {\n      console.write(char);\n    });\n  }\n);\n```\n\nThis is our entire async behavior!  Those `after` values just queue up - they're lazy Observables. But let's not forget that final touch - the randomization.\n\nIn case you are thinking this will be very hard, never fear, 𝗥𝘅𝑓𝑥' `@rxfx/perception` exports a function that randomizes numbers given it, but in a way that the average is preserved. We just drop it in a place that used to have a constant, and we're good.\n\n```diff\n+ import { randomizePreservingAverage } from \"@rxfx/perception\";\n\n\nconst typer = bus.listenQueueing(\n  () =\u003e true, \n  (char) =\u003e {\n-    return after(AVERAGE_DELAY, () =\u003e {\n+    return after(randomizePreservingAverage(AVERAGE_DELAY), () =\u003e {\n      console.write(char);\n    });\n  }\n);\n```\n\nThere we go! A pseudo-human typist - something that will look good for chatbot responses, AI, Chat GPT - whatever!\n\nCheck out [the CodeSandbox](https://codesandbox.io/s/rxfx-example-poisson-process-typing-hncrl0) and then see how you can use, and enjoy using this.\n\n—𝗥𝘅𝑓𝑥\n\nPS How does `randomizePreserveAverage` work? One answer I could tell you is that it scales a number by the absolute value of a randomly chosen logarithm between 0 and 1. But a more intuitive way to say it is that it makes 1/3 of numbers larger, while 2/3 get smaller — given that a single doubling event requires two halving events to preserve the average.","cached_tag_list":"rxfx, rxjs, statistics","cached_user_name":"Dean Radcliffe","cached_user_username":"deanius","comments_count":0,"description":"A little math can simulate user interaction more accurately, with @rxfx/perception.","main_image":"https://images.unsplash.com/photo-1634834787429-54f833042098?ixlib=rb-4.0.3\u0026ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8\u0026auto=format\u0026fit=crop\u0026w=2070\u0026q=80","main_image_background_hex_color":"#dddddd","path":"/deanius/how-to-use-a-poisson-process-for-realistic-user-simulation-4aif","public_reactions_count":0,"processed_html":"\u003cp\u003eHere we will use a couple of components from the 𝗥𝘅𝑓𝑥 toolkit to write some text into a textarea, much as a user would fill out a form.\u003c/p\u003e\n\n\u003cp\u003eIf we use a library like \u003ccode\u003e@testing-library/user-event\u003c/code\u003e, we can automate typing into a field with a configurable delay between characters. However, real users don't type this way, they type in spurts, like this:\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s---pCxIe-3--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/93n2mv1kv2yzf0sdox5f.gif\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s---pCxIe-3--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/uploads/articles/93n2mv1kv2yzf0sdox5f.gif\" alt=\"Realistic typing\" loading=\"lazy\" width=\"133\" height=\"31\" data-animated=\"true\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eFilling out a form in a randomized way  will stress-test your form more realistically - some of the time (about 1/6 of the time) your user's consecutive key presses will be half the average duration. Particularly if you are using React controlled inputs, this can reveal stutter in the system that you would not have known about. Also, I find that lorem ipsum text is more pleasurable to see typed with randomized timing than at a uniform rate! But importantly, we don't want total randomness - we want it to hover \u003cem\u003earound\u003c/em\u003e a certain given amount. \u003c/p\u003e\n\n\u003cp\u003eSo let's bring together a few 𝗥𝘅𝑓𝑥 tools together in order to pull this off, we will:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eUse a bus, typed for character events.\u003c/li\u003e\n\u003cli\u003eTrigger character events from a source text.\u003c/li\u003e\n\u003cli\u003eCreate a listener that returns a time-deferred typing from a character event\u003c/li\u003e\n\u003cli\u003eAllow the bus to execute and sequence those time-deferred typings\u003c/li\u003e\n\u003cli\u003eRandomize the time amounts\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eIn the final step, the code will change only by one line in order to switch to random from not random! Let's dive right in!\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://codesandbox.io/s/rxfx-example-poisson-process-typing-hncrl0\"\u003eSee the CodeSandbox\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eFirst, we can type the \u003ccode\u003edefaultBus\u003c/code\u003e from \u003ccode\u003e@rxfx/bus\u003c/code\u003e.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003edefaultBus\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eBus\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e@rxfx/bus\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ebus\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003edefaultBus\u003c/span\u003e \u003cspan class=\"k\"\u003eas\u003c/span\u003e \u003cspan class=\"nx\"\u003eBus\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kr\"\u003estring\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eNext we'll use a good old-fashioned \u003ccode\u003efor\u003c/code\u003e loop to trigger an event for each character:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003elet\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"nx\"\u003esrcText\u003c/span\u003e\u003cspan class=\"p\"\u003e?.\u003c/span\u003e\u003cspan class=\"nx\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003ebus\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etrigger\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003esrcText\u003c/span\u003e\u003cspan class=\"p\"\u003e?.\u003c/span\u003e\u003cspan class=\"nx\"\u003echarAt\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eBuilding the listener will be tricky - first we know we can't have overlapping character typings - we want them serially. So we will create our listener with \u003ccode\u003ebus.listenQueueing\u003c/code\u003e. What will we return? We could have written any delayed Promise function and that would work, but the 𝗥𝘅𝑓𝑥 utility \u003ccode\u003eafter\u003c/code\u003e is designed just for that.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eafter\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e@rxfx/after\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003etyper\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ebus\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elistenQueueing\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \n  \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003echar\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003eafter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eAVERAGE_DELAY\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ewrite\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003echar\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eThis is our entire async behavior!  Those \u003ccode\u003eafter\u003c/code\u003e values just queue up - they're lazy Observables. But let's not forget that final touch - the randomization.\u003c/p\u003e\n\n\u003cp\u003eIn case you are thinking this will be very hard, never fear, 𝗥𝘅𝑓𝑥' \u003ccode\u003e@rxfx/perception\u003c/code\u003e exports a function that randomizes numbers given it, but in a way that the average is preserved. We just drop it in a place that used to have a constant, and we're good.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight diff\"\u003e\u003ccode\u003e\u003cspan class=\"gi\"\u003e+ import { randomizePreservingAverage } from \"@rxfx/perception\";\n\u003c/span\u003e\n\n\u003cspan class=\"p\"\u003econst typer = bus.listenQueueing(\n\u003c/span\u003e  () =\u0026gt; true, \n  (char) =\u0026gt; {\n\u003cspan class=\"gd\"\u003e-    return after(AVERAGE_DELAY, () =\u0026gt; {\n\u003c/span\u003e\u003cspan class=\"gi\"\u003e+    return after(randomizePreservingAverage(AVERAGE_DELAY), () =\u0026gt; {\n\u003c/span\u003e      console.write(char);\n    });\n  }\n\u003cspan class=\"err\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eThere we go! A pseudo-human typist - something that will look good for chatbot responses, AI, Chat GPT - whatever!\u003c/p\u003e\n\n\u003cp\u003eCheck out \u003ca href=\"https://codesandbox.io/s/rxfx-example-poisson-process-typing-hncrl0\"\u003ethe CodeSandbox\u003c/a\u003e and then see how you can use, and enjoy using this.\u003c/p\u003e\n\n\u003cp\u003e—𝗥𝘅𝑓𝑥\u003c/p\u003e\n\n\u003cp\u003ePS How does \u003ccode\u003erandomizePreserveAverage\u003c/code\u003e work? One answer I could tell you is that it scales a number by the absolute value of a randomly chosen logarithm between 0 and 1. But a more intuitive way to say it is that it makes 1/3 of numbers larger, while 2/3 get smaller — given that a single doubling event requires two halving events to preserve the average.\u003c/p\u003e\n\n","published":true,"published_from_feed":false,"show_comments":true,"slug":"how-to-use-a-poisson-process-for-realistic-user-simulation-4aif","social_image":null,"title":"How to use 𝗥𝘅𝑓𝑥 for a realistic user-typing simulation.","video":null,"video_code":null},{"created_at":"2023-07-11T22:01:47.366Z","crossposted_at":null,"edited_at":null,"last_comment_at":"2017-01-01T05:00:00.000Z","published_at":null,"canonical_url":null,"feed_source_url":null,"video_closed_caption_track_url":null,"video_source_url":null,"video_thumbnail_url":null,"body_markdown":"---\ntitle: Elderly and UX\npublished: false\ndescription: \ntags: \n# cover_image: https://direct_url_to_image.jpg\n# Use a ratio of 100:42 for best results.\n# published_at: 2023-07-11 00:12 +0000\n---\n\nThough the elderly account for a large percentage of the population, it is not widely understood how to accommodate their needs in the UX on websites and mobile devices. Guidelines that speak to typography, contrast, and accessibility (a11y) are a great start. But they don't address the specific concerns of the elderly, or more generally the less-coordinated, slower, or easily confused.\n\nIt's not surprising that we often fail to deliver products that the elderly can use with ease. Not every able-bodied person realizes how confusing an app can become when a user has placed an errant finger on a touchscreen, or when the app fails to show visual feedback in response to user actions. \n\nBut, with years of work and life experience dealing with the elderly population, I've distilled some principles that you, the JavaScript developer, can use to improve your interaction design. These tips will be a supplement to all of the issues like font size and accessibility Let's exemplify them, then see the coding tools - 𝗥𝘅𝑓𝑥 libraries - that can help you raise your code to these standards without losing focus on the path of the regular user. Grandparents deserve a great user experience too!\n\nHere are 5 principles which you should test any code for the elderly against before shipping:\n\n1. Does it show in-progress activity prominently, and include progress updates? This can answer the question \"Is it working?\" that a less-confident user often has after an interaction.\n1. Does it prevent concurrent requests, or allow them to proceed in the appropriate mode? Double-taps on buttons are common by those with less coordinated fingers, and should not ruin their experience.\n1. Does it allow for cancelation? If an operation is in progress, and the user made a mistake, or decide they can't wait that long, can they cancel it and return the app to a usable state?\n1. Does it use animation appropriately? Are techniques used to minimize jerkiness, and are the animations of an appropriate duration?\n1. Are errors, including timeouts, clear, and recoverable? Will the user feel helpless looking at an eternal loading spinner or have a more actionable path forward?\n\nLet's give these principles short names, for ease of reference, and dive right in!\n\n1. Activity and Progress\n1. Concurrency\n1. Cancelation\n1. Animation\n1. Errors and Timeouts\n\n## Activity and Progress\n## Concurrency\n## Cancelation\n## Animation\n## Errors and Timeouts\n","cached_tag_list":"","cached_user_name":"Dean Radcliffe","cached_user_username":"deanius","comments_count":0,"description":"Though the elderly account for a large percentage of the population, it is not widely understood how...","main_image":null,"main_image_background_hex_color":"#dddddd","path":"/deanius/test-2cgd-temp-slug-4417449","public_reactions_count":0,"processed_html":"\u003cp\u003eThough the elderly account for a large percentage of the population, it is not widely understood how to accommodate their needs in the UX on websites and mobile devices. Guidelines that speak to typography, contrast, and accessibility (a11y) are a great start. But they don't address the specific concerns of the elderly, or more generally the less-coordinated, slower, or easily confused.\u003c/p\u003e\n\n\u003cp\u003eIt's not surprising that we often fail to deliver products that the elderly can use with ease. Not every able-bodied person realizes how confusing an app can become when a user has placed an errant finger on a touchscreen, or when the app fails to show visual feedback in response to user actions. \u003c/p\u003e\n\n\u003cp\u003eBut, with years of work and life experience dealing with the elderly population, I've distilled some principles that you, the JavaScript developer, can use to improve your interaction design. These tips will be a supplement to all of the issues like font size and accessibility Let's exemplify them, then see the coding tools - 𝗥𝘅𝑓𝑥 libraries - that can help you raise your code to these standards without losing focus on the path of the regular user. Grandparents deserve a great user experience too!\u003c/p\u003e\n\n\u003cp\u003eHere are 5 principles which you should test any code for the elderly against before shipping:\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eDoes it show in-progress activity prominently, and include progress updates? This can answer the question \"Is it working?\" that a less-confident user often has after an interaction.\u003c/li\u003e\n\u003cli\u003eDoes it prevent concurrent requests, or allow them to proceed in the appropriate mode? Double-taps on buttons are common by those with less coordinated fingers, and should not ruin their experience.\u003c/li\u003e\n\u003cli\u003eDoes it allow for cancelation? If an operation is in progress, and the user made a mistake, or decide they can't wait that long, can they cancel it and return the app to a usable state?\u003c/li\u003e\n\u003cli\u003eDoes it use animation appropriately? Are techniques used to minimize jerkiness, and are the animations of an appropriate duration?\u003c/li\u003e\n\u003cli\u003eAre errors, including timeouts, clear, and recoverable? Will the user feel helpless looking at an eternal loading spinner or have a more actionable path forward?\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eLet's give these principles short names, for ease of reference, and dive right in!\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eActivity and Progress\u003c/li\u003e\n\u003cli\u003eConcurrency\u003c/li\u003e\n\u003cli\u003eCancelation\u003c/li\u003e\n\u003cli\u003eAnimation\u003c/li\u003e\n\u003cli\u003eErrors and Timeouts\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"activity-and-progress\" href=\"#activity-and-progress\"\u003e\n  \u003c/a\u003e\n  Activity and Progress\n\u003c/h2\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"concurrency\" href=\"#concurrency\"\u003e\n  \u003c/a\u003e\n  Concurrency\n\u003c/h2\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"cancelation\" href=\"#cancelation\"\u003e\n  \u003c/a\u003e\n  Cancelation\n\u003c/h2\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"animation\" href=\"#animation\"\u003e\n  \u003c/a\u003e\n  Animation\n\u003c/h2\u003e\n\n\u003ch2\u003e\n  \u003ca name=\"errors-and-timeouts\" href=\"#errors-and-timeouts\"\u003e\n  \u003c/a\u003e\n  Errors and Timeouts\n\u003c/h2\u003e\n\n","published":false,"published_from_feed":false,"show_comments":true,"slug":"test-2cgd-temp-slug-4417449","social_image":null,"title":"Elderly and UX","video":null,"video_code":null},{"created_at":"2023-11-15T21:20:27.898Z","crossposted_at":null,"edited_at":"2023-11-17T17:05:08.260Z","last_comment_at":"2023-11-15T21:20:27.728Z","published_at":"2023-11-15T21:20:27.728Z","canonical_url":null,"feed_source_url":null,"video_closed_caption_track_url":null,"video_source_url":null,"video_thumbnail_url":null,"body_markdown":"---\ntitle: Making Async, Animated Toasts with an RxFx Service\npublished: true\ndescription: \ntags: RxFx, RxJS, Redux, Async\ncover_image: https://images.unsplash.com/photo-1619095762086-66b82f914dcf?w=800\u0026auto=format\u0026fit=crop\u0026q=60\u0026ixlib=rb-4.0.3\u0026ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8dG9hc3R8ZW58MHx8MHx8fDA%3D\n# published_at: 2023-11-15 21:13 +0000\n---\n \n## A use case: A list of notifications\n\nOne time, I needed to code up a list of Notifications, commonly known as \"toasts\". These pop up for a user's attention, populated by an API or some event, and can be dismissed by the user. They may look like this:\n\n![notification list with fade](https://d2jksv3bi9fv68.cloudfront.net/rxfx/async-list-fade.gif)\n\n\nI wanted to build this in pure JS, but use it in React. At first I had an OOP model of it in mind- like this:\n\n```ts\nclass Notifications\u003cT\u003e {\n  private items: T[] = []\n  get items(): T[] { }\n\n  push(item: T){ }\n  remove(item: T){ }\n}\n```\n\nI wondered - could I use an object like this, in React, in such a way that whenever an item is added, the UI always displays the current `items`? It seemed this object model wasn't enough to support a fully reactive list. I didn't want to build this out of React state - I wanted my items in pure JS, so any file that wanted a real-time view of them could simply import and use them. I did not want to worry about Context, or ReactTransitionGroup, or any other view-layer-specific issues, just code in pure JS!\n\nI also wondered how to implement them with fade-in/fade-out, since it's definitely smoother and less confusing with a transition. \n\nI first tried to write an API like this, wrapping a hook around our object:\n\n```ts\nconst notifications = new Notifications\u003cstring\u003e;\nnotifications.push('Svelte')\n\nfunction Notifications() {\n  const items = useObject(notifications, 'items')\n  const addNew = () =\u003e notifications.push('RxFx')\n\n  return \u003col onClick={addNew}\u003e \n    { items.map(item =\u003e (\u003cli\u003e{ item }\u003c/li\u003e)) }\n  \u003c/ol\u003e\n}\n```\n\nI tried several times to implement this `useObject` hook, including polling `items`, but I was never happy with it. Particularly since it didn't address animation, and looked bad without it.\n\n![notification list with no fade](https://d2jksv3bi9fv68.cloudfront.net/rxfx/async-list-no-fade.gif)\n\n![notification list with fade](https://d2jksv3bi9fv68.cloudfront.net/rxfx/async-list-fade.gif)\n\nThen I found an object called a Service, from the `@rxfx/service` package. With a Service, I could have what I wanted, even queued animations! I only had to change the API from the `useObject` hook by a little bit:\n\n```ts\nconst notifications = new createAsyncListService\u003cstring\u003e();\nnotifications.request({ method: 'push', item: 'Svelte'})\n\nfunction Notifications() {\n  const { state: { items }} = useService(notifications)\n  const addNew = () =\u003e {\n    notifications.request({ method: 'push', item: 'RxFx'})\n  }\n\n  return \u003col onClick={addNew}\u003e \n    { items.map(item =\u003e (\u003cli\u003e{ item }\u003c/li\u003e)) }\n  \u003c/ol\u003e\n}\n```\n\nInstead of directly calling methods, I send objects with the method name into the service via its `request()` method. I invoke `useService` with a service you'll see defined shortly. Then I extract the state from the return value of `useService`, and pluck of its `items` field.\n\nTo ensure it was reactive, I wrote the `addNew` click handler to add an object on the fly. And did it update reactively? It did! Now, I had the reactive, async, animating list of my dreams!\n\nAnd so I thought I'd share how you can build this functionality in just a few lines of code with an RxFx service, ending up with framework free code you can use in any view layer from ReactNative to Angular to Svelte.\n\n### Defining the Service\n\nThe first thing to understand about an async list vs. an immediate synchronous list, is that items can be in a state of entering or leaving, as well as fully present. So the state model can not simply be a list of `items` as in the OOP model.\n\nThere are at least two ways a service could represent this state.\n\nOption 1 is that the state could contain a value ranging from 0 to 100, updated on every animation frame, representing how fully in the list the item was. So, for an appearing item in the list:\n\n```js\nitems: [\n  {\n    value: \"RxFx\"\n    percentComplete: 95\n  },\n]\n```\n\n`percentComplete` could be used to update DOM properties like `opacity`, or `height`. But this approach fails to make use of CSS' power to perform animations with just a class name. And it's also not clear whether the item is coming or going.\n\nOption 2 might be to model our state with `items`, but also with `entering` and `leaving`. Imagine we already had `'Svelte'` in the list, and pushed `'RxFx'`. The state would resemble this, until 'RxFx' is done animating in.\n\n```ts\n{\n  items: ['Svelte', 'RxFx'],\n  entering: ['RxFx'],\n  leaving: []\n}\n```\n\nThis is the state model RxFx' `createAsyncListService` supplies. Here's all we have to do to use it. We define the service like this:\n\n```ts\nimport { createAsyncListService } from \"@rxfx/service\";\n\nconst PER_ITEM_DELAY = 250;\nconst notifications = createAsyncListService\u003cstring\u003e(\n  \"list/notifications\",\n  PER_ITEM_DELAY\n);\n```\n\nThe (optional) arguments are a name for logging, which we'll see more of later. And a delay in milliseconds for each animation. \n\nNotice this service definition can and should live outside of any view component, it's just pure JavaScript! Let's see how to make our view layer react to it now.\n\n### Using the Service\n\nThanks to a utility from the `@rxfx/react` library called `useService`, the state of the service can be easily brought into the React view. This gives us arrays `items`, and `entering`, and we only need to check if an item is in `entering`, to assign a CSS class to it to fade it in. The component using the service looks like this:\n\n```ts\nfunction List() {\n  const {\n    state: { items, entering },\n  } = useService(notifications);\n\n  const addNew = () =\u003e {\n    notifications.request({ method: 'push', item: 'RxFx'})\n  }\n\n  return \u003col onClick={addNew}\u003e \n    { items.map((item) =\u003e {\n        const isEntering = entering.includes(item);\n        const className = isEntering ? \"item-entering\" : \"\";\n\n        return \u003cli className={className}\u003e{item}\u003c/li\u003e;\n      });\n    }\n  \u003c/ol\u003e\n}\n```\n\nYou are easily able to test that calling `addNew` adds an item to the service state, and React picks up on it right away. If you wanted to see every change of the service state, you could also send it to the console on every change with this:\n\n```ts\nnotifications.state.subscribe(console.log)\n```\n\nAnd if you wanted to see every lifecycle event of the service - you can use the fact that it's a listener on an RxFx event bus, and simply log all event bus events to the console:\n\n```ts\nimport { defaultBus } from '@rxfx/service'\n\ndefaultBus.spy(({ type, payload }) =\u003e console.log(type, payload))\n```\n\nThis makes debugging a breeze. Now, to finish things up, we just need some CSS to enable the fade, and voila, we're animating!\n\n```css\n@keyframes fadeIn {\n  0% { opacity: 0;  }\n  100% { opacity: 1;  }\n}\n\n.item-entering {\n  animation: fadeIn var(--per-item-delay);\n}\n```\n\nA finishing touch is to send the same `DELAY` we used in JavaScript into CSS, so the CSS animation and the service' delay are the same:\n\n```ts\ndocument\n  .querySelector(\"#root\")\n  .style.setProperty(\"--per-item-delay\", (PER_ITEM_DELAY / 1000) + 's');\n```\n\n(Thanks to David Khourshid of Stately AI for introducing me to CSS variables)\n\nNow, see the [CodeSandbox](https://codesandbox.io/p/sandbox/rxfx-asynclist-hdtsv5) for the working version.\n\n### Use `@rxfx/service` for all the things!\n\nIt turns out, this `@rxfx/service` container is useful for any async effect, from animation to AJAX. And it has a standard API: `.request()`, `.state.value`, and `.cancelCurrent()`, so you learn it once, and use it for many use cases. Even better, this code is directly usable in Svelte, or Angular or Vue, since it is pure JS/TS code with no view-layer dependencies!\n\nIt's built on RxJS, and in other articles I'll show you how other async situations can be handled easily by wrapping an effect in an `@rxfx/service`.\n\nHappy Notifying!\n\nPlease star [@rxfx/service on GitHub](https://github.com/deanrad/rxfx/tree/main/service)!\n\n### Appendix: Integrating with Redux\n\nMany times, the need for animation comes up after a basic non-animated solution is in place. This was the case for these notifications. The items were in a Redux store, a `dispatch` was used to put an item into the store, and a `useSelector` hook brought the items to the page. After we add the RxFx service to handle transitions - will we need to keep Redux?\n\nIn this app, in this particular case, we want to keep Redux informed of our list of notifications. We'll have the benefit of the Redux ecosystem, like Redux-Persist, to save and load the store to localStorage. \n\nSo, we'll use the service for its animation ability, and Redux for persistence of state.\n\n####  Inside a custom hook, make the service an intermediary\n\nInitially the Notifications component looked like this:\n\n```ts\nfunction Notifications() {\n  const { items, addNew, dismiss } = useNotifications();\n  /* render items */\n}\n```\n\nA custom hook `useNotifications` defined the API to notifications - you can retrieve `items`, or `addNew` or `dismiss`, and these were implemented by a selector, and sending dispatches.\n\n We can keep this API - but internally we want to make the service an intermediary.\n\n- Instead of dispatching, we'll make `request()` calls to the service\n- The `items` of our service are used to populate Redux\n- `items` can still come from Redux\n- We can get a class name for an item, based on the state of the service.\n\nWe'll add a `getClassName(item)` to the hook's return value, then get to work inside:\n\n#### Changing the custom hook\n\nInside the hook, `push` and `remove` performed dispatches, and `items` populated by a selector.\n\nInstead, now we'll change the dispatching functions to make `request()` of our service. This ensures our service is in charge of all changes to `items`. \n\nNext, we need to sync these items to Redux as they change. We'll use the power of RxJS to ensure that we have an Observable of only changes of `items`. This enables us to keep Redux free of any information like what is entering and leaving, and focus only on what should persist across sessions.\n\nThe finished useNotifications hook looks like this:\n\n```ts\nimport { map, distinctUntilChanged } from 'rxjs'\nimport { store } from './store'\nimport { notifications } from './services/notifications'\n\n// Sync to Redux\nnotifications.state.pipe(\n  map(state =\u003e state.items),\n  distinctUntilChanged()\n).subscribe(items =\u003e store.dispatch(setItems(items)))\n\nexport const useNotifications() {\n  const { state: { items, entering, leaving } } = useService(notifications);\n\n  function getClassName(item) {\n    /*  based on whether entering/leaving */\n  }\n\n  // Make changes first to our service\n  function addNew(item) {\n    notifications.request({ method: \"push\", item })\n  }\n  function dismiss(item) {\n    notifications.request({ method: \"remove\", item })\n  }\n\n  return { items, addNew, dismiss, getClassName }\n}\n```\n\nWith that, we now have the service as our source of truth for the state of the UI, and Redux is a persistence layer, with all the benefits of its DevTools and persistence layer. \n\n![notification list with Redux](https://d2jksv3bi9fv68.cloudfront.net/rxfx/async-list-redux.gif)\n\n\n\nSo, that's how we integrate. We let Redux do persistence, and let dynamic effects and animations live in a service, which is not persisted. A service will help you keep state fields like `loading` out of your stores. That's right - you don't need to track `loading` if you have a service! If you want to know whether the animation is running, you can pluck off the `isActive` field from the `useService` return value.","cached_tag_list":"rxfx, rxjs, redux, async","cached_user_name":"Dean Radcliffe","cached_user_username":"deanius","comments_count":0,"description":"A use case: A list of notifications   One time, I needed to code up a list of Notifications,...","main_image":"https://images.unsplash.com/photo-1619095762086-66b82f914dcf?w=800\u0026auto=format\u0026fit=crop\u0026q=60\u0026ixlib=rb-4.0.3\u0026ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8dG9hc3R8ZW58MHx8MHx8fDA%3D","main_image_background_hex_color":"#dddddd","path":"/deanius/reactive-objects-and-effects-with-an-rxfx-service-1b64","public_reactions_count":0,"processed_html":"\u003ch2\u003e\n  \u003ca name=\"a-use-case-a-list-of-notifications\" href=\"#a-use-case-a-list-of-notifications\"\u003e\n  \u003c/a\u003e\n  A use case: A list of notifications\n\u003c/h2\u003e\n\n\u003cp\u003eOne time, I needed to code up a list of Notifications, commonly known as \"toasts\". These pop up for a user's attention, populated by an API or some event, and can be dismissed by the user. They may look like this:\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--OYZWLe1_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_800/https://d2jksv3bi9fv68.cloudfront.net/rxfx/async-list-fade.gif\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--OYZWLe1_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_800/https://d2jksv3bi9fv68.cloudfront.net/rxfx/async-list-fade.gif\" alt=\"notification list with fade\" loading=\"lazy\" width=\"276\" height=\"264\" data-animated=\"true\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eI wanted to build this in pure JS, but use it in React. At first I had an OOP model of it in mind- like this:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eNotifications\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eT\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"na\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003eget\u003c/span\u003e \u003cspan class=\"nx\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e \u003cspan class=\"nx\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"nx\"\u003epush\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"na\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eremove\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"na\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e){\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eI wondered - could I use an object like this, in React, in such a way that whenever an item is added, the UI always displays the current \u003ccode\u003eitems\u003c/code\u003e? It seemed this object model wasn't enough to support a fully reactive list. I didn't want to build this out of React state - I wanted my items in pure JS, so any file that wanted a real-time view of them could simply import and use them. I did not want to worry about Context, or ReactTransitionGroup, or any other view-layer-specific issues, just code in pure JS!\u003c/p\u003e\n\n\u003cp\u003eI also wondered how to implement them with fade-in/fade-out, since it's definitely smoother and less confusing with a transition. \u003c/p\u003e\n\n\u003cp\u003eI first tried to write an API like this, wrapping a hook around our object:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003enotifications\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eNotifications\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kr\"\u003estring\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"nx\"\u003enotifications\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epush\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eSvelte\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003eNotifications\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eitems\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003euseObject\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003enotifications\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eitems\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eaddNew\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003enotifications\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epush\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eRxFx\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eol\u003c/span\u003e \u003cspan class=\"nx\"\u003eonClick\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eaddNew\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eitem\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eli\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eitem\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"sr\"\u003e/li\u0026gt;\u003c/span\u003e\u003cspan class=\"se\"\u003e))\u003c/span\u003e\u003cspan class=\"sr\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003e}\n\u003c/span\u003e  \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"sr\"\u003e/ol\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026gt;\n\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eI tried several times to implement this \u003ccode\u003euseObject\u003c/code\u003e hook, including polling \u003ccode\u003eitems\u003c/code\u003e, but I was never happy with it. Particularly since it didn't address animation, and looked bad without it.\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--dlQazFso--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_800/https://d2jksv3bi9fv68.cloudfront.net/rxfx/async-list-no-fade.gif\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--dlQazFso--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_800/https://d2jksv3bi9fv68.cloudfront.net/rxfx/async-list-no-fade.gif\" alt=\"notification list with no fade\" loading=\"lazy\" width=\"280\" height=\"278\" data-animated=\"true\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--OYZWLe1_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_800/https://d2jksv3bi9fv68.cloudfront.net/rxfx/async-list-fade.gif\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--OYZWLe1_--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_800/https://d2jksv3bi9fv68.cloudfront.net/rxfx/async-list-fade.gif\" alt=\"notification list with fade\" loading=\"lazy\" width=\"276\" height=\"264\" data-animated=\"true\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eThen I found an object called a Service, from the \u003ccode\u003e@rxfx/service\u003c/code\u003e package. With a Service, I could have what I wanted, even queued animations! I only had to change the API from the \u003ccode\u003euseObject\u003c/code\u003e hook by a little bit:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003enotifications\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003ecreateAsyncListService\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kr\"\u003estring\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"nx\"\u003enotifications\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e \u003cspan class=\"na\"\u003emethod\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003epush\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"na\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eSvelte\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003eNotifications\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"na\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eitems\u003c/span\u003e \u003cspan class=\"p\"\u003e}}\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003euseService\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003enotifications\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eaddNew\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003enotifications\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e \u003cspan class=\"na\"\u003emethod\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003epush\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"na\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eRxFx\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eol\u003c/span\u003e \u003cspan class=\"nx\"\u003eonClick\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eaddNew\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eitem\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eli\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eitem\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"sr\"\u003e/li\u0026gt;\u003c/span\u003e\u003cspan class=\"se\"\u003e))\u003c/span\u003e\u003cspan class=\"sr\"\u003e \u003c/span\u003e\u003cspan class=\"err\"\u003e}\n\u003c/span\u003e  \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"sr\"\u003e/ol\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026gt;\n\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eInstead of directly calling methods, I send objects with the method name into the service via its \u003ccode\u003erequest()\u003c/code\u003e method. I invoke \u003ccode\u003euseService\u003c/code\u003e with a service you'll see defined shortly. Then I extract the state from the return value of \u003ccode\u003euseService\u003c/code\u003e, and pluck of its \u003ccode\u003eitems\u003c/code\u003e field.\u003c/p\u003e\n\n\u003cp\u003eTo ensure it was reactive, I wrote the \u003ccode\u003eaddNew\u003c/code\u003e click handler to add an object on the fly. And did it update reactively? It did! Now, I had the reactive, async, animating list of my dreams!\u003c/p\u003e\n\n\u003cp\u003eAnd so I thought I'd share how you can build this functionality in just a few lines of code with an RxFx service, ending up with framework free code you can use in any view layer from ReactNative to Angular to Svelte.\u003c/p\u003e\n\n\u003ch3\u003e\n  \u003ca name=\"defining-the-service\" href=\"#defining-the-service\"\u003e\n  \u003c/a\u003e\n  Defining the Service\n\u003c/h3\u003e\n\n\u003cp\u003eThe first thing to understand about an async list vs. an immediate synchronous list, is that items can be in a state of entering or leaving, as well as fully present. So the state model can not simply be a list of \u003ccode\u003eitems\u003c/code\u003e as in the OOP model.\u003c/p\u003e\n\n\u003cp\u003eThere are at least two ways a service could represent this state.\u003c/p\u003e\n\n\u003cp\u003eOption 1 is that the state could contain a value ranging from 0 to 100, updated on every animation frame, representing how fully in the list the item was. So, for an appearing item in the list:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight javascript\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"na\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eRxFx\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\n    \u003cspan class=\"na\"\u003epercentComplete\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e95\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003e\u003ccode\u003epercentComplete\u003c/code\u003e could be used to update DOM properties like \u003ccode\u003eopacity\u003c/code\u003e, or \u003ccode\u003eheight\u003c/code\u003e. But this approach fails to make use of CSS' power to perform animations with just a class name. And it's also not clear whether the item is coming or going.\u003c/p\u003e\n\n\u003cp\u003eOption 2 might be to model our state with \u003ccode\u003eitems\u003c/code\u003e, but also with \u003ccode\u003eentering\u003c/code\u003e and \u003ccode\u003eleaving\u003c/code\u003e. Imagine we already had \u003ccode\u003e'Svelte'\u003c/code\u003e in the list, and pushed \u003ccode\u003e'RxFx'\u003c/code\u003e. The state would resemble this, until 'RxFx' is done animating in.\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nl\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eSvelte\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eRxFx\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eentering\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eRxFx\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eleaving\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eThis is the state model RxFx' \u003ccode\u003ecreateAsyncListService\u003c/code\u003e supplies. Here's all we have to do to use it. We define the service like this:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003ecreateAsyncListService\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e@rxfx/service\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ePER_ITEM_DELAY\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e250\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003enotifications\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ecreateAsyncListService\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kr\"\u003estring\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003elist/notifications\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003ePER_ITEM_DELAY\u003c/span\u003e\n\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eThe (optional) arguments are a name for logging, which we'll see more of later. And a delay in milliseconds for each animation. \u003c/p\u003e\n\n\u003cp\u003eNotice this service definition can and should live outside of any view component, it's just pure JavaScript! Let's see how to make our view layer react to it now.\u003c/p\u003e\n\n\u003ch3\u003e\n  \u003ca name=\"using-the-service\" href=\"#using-the-service\"\u003e\n  \u003c/a\u003e\n  Using the Service\n\u003c/h3\u003e\n\n\u003cp\u003eThanks to a utility from the \u003ccode\u003e@rxfx/react\u003c/code\u003e library called \u003ccode\u003euseService\u003c/code\u003e, the state of the service can be easily brought into the React view. This gives us arrays \u003ccode\u003eitems\u003c/code\u003e, and \u003ccode\u003eentering\u003c/code\u003e, and we only need to check if an item is in \u003ccode\u003eentering\u003c/code\u003e, to assign a CSS class to it to fade it in. The component using the service looks like this:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003eList\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"na\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eentering\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003euseService\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003enotifications\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eaddNew\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003enotifications\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e \u003cspan class=\"na\"\u003emethod\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003epush\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"na\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eRxFx\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eol\u003c/span\u003e \u003cspan class=\"nx\"\u003eonClick\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eaddNew\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emap\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"nx\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eisEntering\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eentering\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eincludes\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eclassName\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eisEntering\u003c/span\u003e \u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eitem-entering\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nx\"\u003eli\u003c/span\u003e \u003cspan class=\"nx\"\u003eclassName\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eclassName\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nx\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"sr\"\u003e/li\u0026gt;\u003c/span\u003e\u003cspan class=\"err\"\u003e;\n\u003c/span\u003e      \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"sr\"\u003e/ol\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026gt;\n\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eYou are easily able to test that calling \u003ccode\u003eaddNew\u003c/code\u003e adds an item to the service state, and React picks up on it right away. If you wanted to see every change of the service state, you could also send it to the console on every change with this:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"nx\"\u003enotifications\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eAnd if you wanted to see every lifecycle event of the service - you can use the fact that it's a listener on an RxFx event bus, and simply log all event bus events to the console:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003edefaultBus\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e@rxfx/service\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\n\n\u003cspan class=\"nx\"\u003edefaultBus\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003espy\u003c/span\u003e\u003cspan class=\"p\"\u003e(({\u003c/span\u003e \u003cspan class=\"kd\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003epayload\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003etype\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003epayload\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eThis makes debugging a breeze. Now, to finish things up, we just need some CSS to enable the fade, and voila, we're animating!\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight css\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003e@keyframes\u003c/span\u003e \u003cspan class=\"n\"\u003efadeIn\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"err\"\u003e0\u003c/span\u003e\u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nl\"\u003eopacity\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"err\"\u003e100\u003c/span\u003e\u003cspan class=\"o\"\u003e%\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nl\"\u003eopacity\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"nc\"\u003e.item-entering\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nl\"\u003eanimation\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003efadeIn\u003c/span\u003e \u003cspan class=\"n\"\u003evar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e--per-item-delay\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eA finishing touch is to send the same \u003ccode\u003eDELAY\u003c/code\u003e we used in JavaScript into CSS, so the CSS animation and the service' delay are the same:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003equerySelector\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e#root\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estyle\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esetProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e--per-item-delay\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ePER_ITEM_DELAY\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"mi\"\u003e1000\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003es\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003e(Thanks to David Khourshid of Stately AI for introducing me to CSS variables)\u003c/p\u003e\n\n\u003cp\u003eNow, see the \u003ca href=\"https://codesandbox.io/p/sandbox/rxfx-asynclist-hdtsv5\"\u003eCodeSandbox\u003c/a\u003e for the working version.\u003c/p\u003e\n\n\u003ch3\u003e\n  \u003ca name=\"use-raw-rxfxservice-endraw-for-all-the-things\" href=\"#use-raw-rxfxservice-endraw-for-all-the-things\"\u003e\n  \u003c/a\u003e\n  Use \u003ccode\u003e@rxfx/service\u003c/code\u003e for all the things!\n\u003c/h3\u003e\n\n\u003cp\u003eIt turns out, this \u003ccode\u003e@rxfx/service\u003c/code\u003e container is useful for any async effect, from animation to AJAX. And it has a standard API: \u003ccode\u003e.request()\u003c/code\u003e, \u003ccode\u003e.state.value\u003c/code\u003e, and \u003ccode\u003e.cancelCurrent()\u003c/code\u003e, so you learn it once, and use it for many use cases. Even better, this code is directly usable in Svelte, or Angular or Vue, since it is pure JS/TS code with no view-layer dependencies!\u003c/p\u003e\n\n\u003cp\u003eIt's built on RxJS, and in other articles I'll show you how other async situations can be handled easily by wrapping an effect in an \u003ccode\u003e@rxfx/service\u003c/code\u003e.\u003c/p\u003e\n\n\u003cp\u003eHappy Notifying!\u003c/p\u003e\n\n\u003cp\u003ePlease star \u003ca href=\"https://github.com/deanrad/rxfx/tree/main/service\"\u003e@rxfx/service on GitHub\u003c/a\u003e!\u003c/p\u003e\n\n\u003ch3\u003e\n  \u003ca name=\"appendix-integrating-with-redux\" href=\"#appendix-integrating-with-redux\"\u003e\n  \u003c/a\u003e\n  Appendix: Integrating with Redux\n\u003c/h3\u003e\n\n\u003cp\u003eMany times, the need for animation comes up after a basic non-animated solution is in place. This was the case for these notifications. The items were in a Redux store, a \u003ccode\u003edispatch\u003c/code\u003e was used to put an item into the store, and a \u003ccode\u003euseSelector\u003c/code\u003e hook brought the items to the page. After we add the RxFx service to handle transitions - will we need to keep Redux?\u003c/p\u003e\n\n\u003cp\u003eIn this app, in this particular case, we want to keep Redux informed of our list of notifications. We'll have the benefit of the Redux ecosystem, like Redux-Persist, to save and load the store to localStorage. \u003c/p\u003e\n\n\u003cp\u003eSo, we'll use the service for its animation ability, and Redux for persistence of state.\u003c/p\u003e\n\n\u003ch4\u003e\n  \u003ca name=\"inside-a-custom-hook-make-the-service-an-intermediary\" href=\"#inside-a-custom-hook-make-the-service-an-intermediary\"\u003e\n  \u003c/a\u003e\n  Inside a custom hook, make the service an intermediary\n\u003c/h4\u003e\n\n\u003cp\u003eInitially the Notifications component looked like this:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003eNotifications\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eaddNew\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003edismiss\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003euseNotifications\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"cm\"\u003e/* render items */\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eA custom hook \u003ccode\u003euseNotifications\u003c/code\u003e defined the API to notifications - you can retrieve \u003ccode\u003eitems\u003c/code\u003e, or \u003ccode\u003eaddNew\u003c/code\u003e or \u003ccode\u003edismiss\u003c/code\u003e, and these were implemented by a selector, and sending dispatches.\u003c/p\u003e\n\n\u003cp\u003eWe can keep this API - but internally we want to make the service an intermediary.\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eInstead of dispatching, we'll make \u003ccode\u003erequest()\u003c/code\u003e calls to the service\u003c/li\u003e\n\u003cli\u003eThe \u003ccode\u003eitems\u003c/code\u003e of our service are used to populate Redux\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eitems\u003c/code\u003e can still come from Redux\u003c/li\u003e\n\u003cli\u003eWe can get a class name for an item, based on the state of the service.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eWe'll add a \u003ccode\u003egetClassName(item)\u003c/code\u003e to the hook's return value, then get to work inside:\u003c/p\u003e\n\n\u003ch4\u003e\n  \u003ca name=\"changing-the-custom-hook\" href=\"#changing-the-custom-hook\"\u003e\n  \u003c/a\u003e\n  Changing the custom hook\n\u003c/h4\u003e\n\n\u003cp\u003eInside the hook, \u003ccode\u003epush\u003c/code\u003e and \u003ccode\u003eremove\u003c/code\u003e performed dispatches, and \u003ccode\u003eitems\u003c/code\u003e populated by a selector.\u003c/p\u003e\n\n\u003cp\u003eInstead, now we'll change the dispatching functions to make \u003ccode\u003erequest()\u003c/code\u003e of our service. This ensures our service is in charge of all changes to \u003ccode\u003eitems\u003c/code\u003e. \u003c/p\u003e\n\n\u003cp\u003eNext, we need to sync these items to Redux as they change. We'll use the power of RxJS to ensure that we have an Observable of only changes of \u003ccode\u003eitems\u003c/code\u003e. This enables us to keep Redux free of any information like what is entering and leaving, and focus only on what should persist across sessions.\u003c/p\u003e\n\n\u003cp\u003eThe finished useNotifications hook looks like this:\u003cbr\u003e\n\u003c/p\u003e\n\n\u003cdiv class=\"highlight js-code-highlight\"\u003e\n\u003cpre class=\"highlight typescript\"\u003e\u003ccode\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003emap\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003edistinctUntilChanged\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003erxjs\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003estore\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e./store\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\n\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003enotifications\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003efrom\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e./services/notifications\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\n\n\u003cspan class=\"c1\"\u003e// Sync to Redux\u003c/span\u003e\n\u003cspan class=\"nx\"\u003enotifications\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epipe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003emap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003estate\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003edistinctUntilChanged\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003esubscribe\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eitems\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003estore\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003edispatch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003esetItems\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e)))\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eexport\u003c/span\u003e \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003euseNotifications\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"na\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eentering\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eleaving\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003euseService\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003enotifications\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n  \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003egetClassName\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"cm\"\u003e/*  based on whether entering/leaving */\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"c1\"\u003e// Make changes first to our service\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003eaddNew\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003enotifications\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e \u003cspan class=\"na\"\u003emethod\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003epush\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eitem\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003edismiss\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eitem\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003enotifications\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003erequest\u003c/span\u003e\u003cspan class=\"p\"\u003e({\u003c/span\u003e \u003cspan class=\"na\"\u003emethod\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eremove\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eitem\u003c/span\u003e \u003cspan class=\"p\"\u003e})\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nx\"\u003eitems\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eaddNew\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003edismiss\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003egetClassName\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cdiv class=\"highlight__panel js-actions-panel\"\u003e\n\u003cdiv class=\"highlight__panel-action js-fullscreen-code-action\"\u003e\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-on\"\u003e\u003ctitle\u003eEnter fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M16 3h6v6h-2V5h-4V3zM2 3h6v2H4v4H2V3zm18 16v-4h2v6h-6v-2h4zM4 19h4v2H2v-6h2v4z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n    \u003csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"20px\" height=\"20px\" viewbox=\"0 0 24 24\" class=\"highlight-action crayons-icon highlight-action--fullscreen-off\"\u003e\u003ctitle\u003eExit fullscreen mode\u003c/title\u003e\n    \u003cpath d=\"M18 7h4v2h-6V3h2v4zM8 9H2V7h4V3h2v6zm10 8v4h-2v-6h6v2h-4zM8 15v6H6v-4H2v-2h6z\"\u003e\u003c/path\u003e\n\u003c/svg\u003e\n\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\n\n\n\u003cp\u003eWith that, we now have the service as our source of truth for the state of the UI, and Redux is a persistence layer, with all the benefits of its DevTools and persistence layer. \u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--jsy0lAMb--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_800/https://d2jksv3bi9fv68.cloudfront.net/rxfx/async-list-redux.gif\" class=\"article-body-image-wrapper\"\u003e\u003cimg src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--jsy0lAMb--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_66%2Cw_800/https://d2jksv3bi9fv68.cloudfront.net/rxfx/async-list-redux.gif\" alt=\"notification list with Redux\" loading=\"lazy\" width=\"766\" height=\"498\" data-animated=\"true\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eSo, that's how we integrate. We let Redux do persistence, and let dynamic effects and animations live in a service, which is not persisted. A service will help you keep state fields like \u003ccode\u003eloading\u003c/code\u003e out of your stores. That's right - you don't need to track \u003ccode\u003eloading\u003c/code\u003e if you have a service! If you want to know whether the animation is running, you can pluck off the \u003ccode\u003eisActive\u003c/code\u003e field from the \u003ccode\u003euseService\u003c/code\u003e return value.\u003c/p\u003e\n\n","published":true,"published_from_feed":false,"show_comments":true,"slug":"reactive-objects-and-effects-with-an-rxfx-service-1b64","social_image":null,"title":"Making Async, Animated Toasts with an RxFx Service","video":null,"video_code":null},{"created_at":"2023-12-13T04:46:38.897Z","crossposted_at":null,"edited_at":"2023-12-13T05:05:24.907Z","last_comment_at":"2023-12-13T04:46:38.882Z","published_at":"2023-12-13T04:46:38.882Z","canonical_url":null,"feed_source_url":null,"video_closed_caption_track_url":null,"video_source_url":null,"video_thumbnail_url":null,"body_markdown":"---\ntitle: \"Building the 7GUIs with GitHub Copilot\"\npublished: true\ndescription: \"Exploring the capabilities of GitHub Copilot in building UI applications\"\ntags: [Copilot, AI, Angular, React]\ncover_image: \"https://images.unsplash.com/photo-1684369175809-f9642140a1bd?q=80\u0026w=2484\u0026auto=format\u0026fit=crop\u0026ixlib=rb-4.0.3\u0026ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D\"\n---\n\nUnless you've been hiding under a rock, you know that 2023 has been quite a year for AI and programming. And Github Copilot is perhaps the biggest way programmers are using AI to supplement their work. But can AI replace the work of programming? \n\nI think we should put Github Copilot - end of 2023 version - up to some tasks relevant to the modern UI/UX developer. Someone like yourself who might be using React to code front-ends to web applications, and wondering - can AI do my job? Will it take my job? I have a plan to answer that question - at least in 2023 terms.\n\nThere are a set of UI programming benchmarks named the 7 GUIs [(link)](https://eugenkiss.github.io/7guis/). 7 apps whose specifications range from the simple — a counter — to the complex — a spreadsheet. 7 quests designed to test the mettle of any developer— or AI. If we ask Github Copilot to build each of these 7 GUIs of increasing complexity — how far will it get? Can it do it all for us, from the UI to the logic, or is it useful more for one part of the app than another?\n\nIn order to make these solutions understandable to the widest audience of developers, I'll specify that these must be built in React, with hooks, not classes. I'll avoid requiring TypeScript types, but evaulate whether the code was written with correct types, if any. I'll include the prompts that I use.\n\nA few disclaimers, for context: I am an English-speaking senior developer with over 20 years experience. I have built all the 7 GUIs in React before. But, I have been working with automated code generators like GitHub Copilot for only about a month. And I want to try, at least at first, getting it all done with standard English prompts that presume nothing about the target solution. I will not try my Spanish out in this series of posts, but I may in a future series, recognizing the global impact of AI across the diverse developer community. And finally I care about maintainability of software. I'll have a robot build my car, but I want the human mechanic to be able to get at the parts to replace them. And I want a certain aesthetic beauty when I look under the hood :)\n\nLastly, as part of the evaluation, I come with reference solutions to which I will compare the AI solutions. These reference solutions use my libraries `@rxfx/bus` and `@rxfx/service` [on Github here](https://github.com/deanrad/rxfx). So this might become a commercial for those libraries, if the translation of natural language prompts to code goes smoother with RxFx than with Copilot. \n\nWith that said, I think we're ready to begin! ❤️ or comment on this post if you are willing to partake in this experiment with me, or have any ideas for how I could tailor it to what you are interested in learning.\n\nSee you in the ring, AI!\n\n— Dean Radcliffe\n\nThe 7 GUIs:\n\n- [Counter](https://eugenkiss.github.io/7guis/tasks#counter)\n- [Temperature Converter](https://eugenkiss.github.io/7guis/tasks#temp)\n- [Flight Booker](https://eugenkiss.github.io/7guis/tasks#flight)\n- [Timer](https://eugenkiss.github.io/7guis/tasks#timer)\n- [CRUD](https://eugenkiss.github.io/7guis/tasks#crud)\n- [Circle Drawer](https://eugenkiss.github.io/7guis/tasks#circle)\n- [Cells](https://eugenkiss.github.io/7guis/tasks#cells)\n\n","cached_tag_list":"githubcopilot, ai, react","cached_user_name":"Dean Radcliffe","cached_user_username":"deanius","comments_count":0,"description":"Exploring the capabilities of GitHub Copilot in building UI applications","main_image":"https://images.unsplash.com/photo-1684369175809-f9642140a1bd?q=80\u0026w=2484\u0026auto=format\u0026fit=crop\u0026ixlib=rb-4.0.3\u0026ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D","main_image_background_hex_color":"#dddddd","path":"/deanius/building-the-7guis-with-github-copilot-3cgo","public_reactions_count":0,"processed_html":"\u003cp\u003eUnless you've been hiding under a rock, you know that 2023 has been quite a year for AI and programming. And Github Copilot is perhaps the biggest way programmers are using AI to supplement their work. But can AI replace the work of programming? \u003c/p\u003e\n\n\u003cp\u003eI think we should put Github Copilot - end of 2023 version - up to some tasks relevant to the modern UI/UX developer. Someone like yourself who might be using React to code front-ends to web applications, and wondering - can AI do my job? Will it take my job? I have a plan to answer that question - at least in 2023 terms.\u003c/p\u003e\n\n\u003cp\u003eThere are a set of UI programming benchmarks named the 7 GUIs \u003ca href=\"https://eugenkiss.github.io/7guis/\"\u003e(link)\u003c/a\u003e. 7 apps whose specifications range from the simple — a counter — to the complex — a spreadsheet. 7 quests designed to test the mettle of any developer— or AI. If we ask Github Copilot to build each of these 7 GUIs of increasing complexity — how far will it get? Can it do it all for us, from the UI to the logic, or is it useful more for one part of the app than another?\u003c/p\u003e\n\n\u003cp\u003eIn order to make these solutions understandable to the widest audience of developers, I'll specify that these must be built in React, with hooks, not classes. I'll avoid requiring TypeScript types, but evaulate whether the code was written with correct types, if any. I'll include the prompts that I use.\u003c/p\u003e\n\n\u003cp\u003eA few disclaimers, for context: I am an English-speaking senior developer with over 20 years experience. I have built all the 7 GUIs in React before. But, I have been working with automated code generators like GitHub Copilot for only about a month. And I want to try, at least at first, getting it all done with standard English prompts that presume nothing about the target solution. I will not try my Spanish out in this series of posts, but I may in a future series, recognizing the global impact of AI across the diverse developer community. And finally I care about maintainability of software. I'll have a robot build my car, but I want the human mechanic to be able to get at the parts to replace them. And I want a certain aesthetic beauty when I look under the hood :)\u003c/p\u003e\n\n\u003cp\u003eLastly, as part of the evaluation, I come with reference solutions to which I will compare the AI solutions. These reference solutions use my libraries \u003ccode\u003e@rxfx/bus\u003c/code\u003e and \u003ccode\u003e@rxfx/service\u003c/code\u003e \u003ca href=\"https://github.com/deanrad/rxfx\"\u003eon Github here\u003c/a\u003e. So this might become a commercial for those libraries, if the translation of natural language prompts to code goes smoother with RxFx than with Copilot. \u003c/p\u003e\n\n\u003cp\u003eWith that said, I think we're ready to begin! ❤️ or comment on this post if you are willing to partake in this experiment with me, or have any ideas for how I could tailor it to what you are interested in learning.\u003c/p\u003e\n\n\u003cp\u003eSee you in the ring, AI!\u003c/p\u003e\n\n\u003cp\u003e— Dean Radcliffe\u003c/p\u003e\n\n\u003cp\u003eThe 7 GUIs:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://eugenkiss.github.io/7guis/tasks#counter\"\u003eCounter\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://eugenkiss.github.io/7guis/tasks#temp\"\u003eTemperature Converter\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://eugenkiss.github.io/7guis/tasks#flight\"\u003eFlight Booker\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://eugenkiss.github.io/7guis/tasks#timer\"\u003eTimer\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://eugenkiss.github.io/7guis/tasks#crud\"\u003eCRUD\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://eugenkiss.github.io/7guis/tasks#circle\"\u003eCircle Drawer\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://eugenkiss.github.io/7guis/tasks#cells\"\u003eCells\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n","published":true,"published_from_feed":false,"show_comments":true,"slug":"building-the-7guis-with-github-copilot-3cgo","social_image":null,"title":"Building the 7GUIs with GitHub Copilot","video":null,"video_code":null}]